/**
 * name: @tresjs/cientos
 * version: v3.9.0
 * (c) 2024
 * description: Collection of useful helpers and fully functional, ready-made abstractions for Tres
 * author: Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)
 */
(function(te,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("three"),require("vue"),require("@tresjs/core"),require("tweakpane")):typeof define=="function"&&define.amd?define(["exports","three","vue","@tresjs/core","tweakpane"],l):(te=typeof globalThis<"u"?globalThis:te||self,l(te.trescientos={},te.Three,te.Vue,te.TresjsCore,te.tweakpane))})(this,function(te,l,u,ie,$i){"use strict";var Td=Object.defineProperty;var Id=(te,l,u)=>l in te?Td(te,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):te[l]=u;var ce=(te,l,u)=>(Id(te,typeof l!="symbol"?l+"":l,u),u);function eo(o){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const t in o)if(t!=="default"){const n=Object.getOwnPropertyDescriptor(o,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>o[t]})}}return e.default=o,Object.freeze(e)}const Kr=eo(l);function Qr(o,e){if(e===l.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===l.TriangleFanDrawMode||e===l.TriangleStripDrawMode){let t=o.getIndex();if(t===null){const i=[],a=o.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)i.push(c);o.setIndex(i),t=o.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const n=t.count-2,r=[];if(t)if(e===l.TriangleFanDrawMode)for(let i=1;i<=n;i++)r.push(t.getX(0)),r.push(t.getX(i)),r.push(t.getX(i+1));else for(let i=0;i<n;i++)i%2===0?(r.push(t.getX(i)),r.push(t.getX(i+1)),r.push(t.getX(i+2))):(r.push(t.getX(i+2)),r.push(t.getX(i+1)),r.push(t.getX(i)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=o.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}const Jr=parseInt(l.REVISION.replace(/\D+/g,""));var to=Object.defineProperty,no=(o,e,t)=>e in o?to(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,ro=(o,e,t)=>(no(o,e+"",t),t);async function Hr(o){const e=await o.arrayBuffer(),t=btoa(String.fromCharCode(...new Uint8Array(e)));return`data:${o.type||""};base64,${t}`}let _n,Xn,Ft,xn;function Zn(o,e=1/0,t=null){Xn||(Xn=new l.PlaneGeometry(2,2,1,1)),Ft||(Ft=new l.ShaderMaterial({uniforms:{blitTexture:new l.Uniform(o)},vertexShader:`
        varying vec2 vUv;
        void main(){
            vUv = uv;
            gl_Position = vec4(position.xy * 1.0,0.,.999999);
        }
      `,fragmentShader:`
          uniform sampler2D blitTexture; 
          varying vec2 vUv;

          void main(){ 
              gl_FragColor = vec4(vUv.xy, 0, 1);
              
              #ifdef IS_SRGB
              gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
              #else
              gl_FragColor = texture2D( blitTexture, vUv);
              #endif
          }
      `})),Ft.uniforms.blitTexture.value=o,Ft.defines.IS_SRGB="colorSpace"in o?o.colorSpace==="srgb":o.encoding===3001,Ft.needsUpdate=!0,xn||(xn=new l.Mesh(Xn,Ft),xn.frustrumCulled=!1);const n=new l.PerspectiveCamera,r=new l.Scene;r.add(xn),t||(t=_n=new l.WebGLRenderer({antialias:!1})),t.setSize(Math.min(o.image.width,e),Math.min(o.image.height,e)),t.clear(),t.render(r,n);const s=new l.Texture(t.domElement);return s.minFilter=o.minFilter,s.magFilter=o.magFilter,s.wrapS=o.wrapS,s.wrapT=o.wrapT,s.name=o.name,_n&&(_n.dispose(),_n=null),s}const $r={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class qn{constructor(){this.pluginCallbacks=[],this.register(function(e){return new po(e)}),this.register(function(e){return new mo(e)}),this.register(function(e){return new vo(e)}),this.register(function(e){return new _o(e)}),this.register(function(e){return new xo(e)}),this.register(function(e){return new wo(e)}),this.register(function(e){return new go(e)}),this.register(function(e){return new yo(e)}),this.register(function(e){return new bo(e)}),this.register(function(e){return new Mo(e)}),this.register(function(e){return new So(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){const s=new fo,i=[];for(let a=0,c=this.pluginCallbacks.length;a<c;a++)i.push(this.pluginCallbacks[a](s));s.setPlugins(i),s.write(e,t,r).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(r,s){n.parse(e,r,s,t)})}}ro(qn,"Utils",{insertKeyframe:function(o,e){const n=o.getValueSize(),r=new o.TimeBufferType(o.times.length+1),s=new o.ValueBufferType(o.values.length+n),i=o.createInterpolant(new o.ValueBufferType(n));let a;if(o.times.length===0){r[0]=e;for(let c=0;c<n;c++)s[c]=0;a=0}else if(e<o.times[0]){if(Math.abs(o.times[0]-e)<.001)return 0;r[0]=e,r.set(o.times,1),s.set(i.evaluate(e),0),s.set(o.values,n),a=0}else if(e>o.times[o.times.length-1]){if(Math.abs(o.times[o.times.length-1]-e)<.001)return o.times.length-1;r[r.length-1]=e,r.set(o.times,0),s.set(o.values,0),s.set(i.evaluate(e),o.values.length),a=r.length-1}else for(let c=0;c<o.times.length;c++){if(Math.abs(o.times[c]-e)<.001)return c;if(o.times[c]<e&&o.times[c+1]>e){r.set(o.times.slice(0,c+1),0),r[c+1]=e,r.set(o.times.slice(c+1),c+2),s.set(o.values.slice(0,(c+1)*n),0),s.set(i.evaluate(e),(c+1)*n),s.set(o.values.slice((c+1)*n),(c+2)*n),a=c+1;break}}return o.times=r,o.values=s,a},mergeMorphTargetTracks:function(o,e){const t=[],n={},r=o.tracks;for(let s=0;s<r.length;++s){let i=r[s];const a=l.PropertyBinding.parseTrackName(i.name),c=l.PropertyBinding.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(i);continue}if(i.createInterpolant!==i.InterpolantFactoryMethodDiscrete&&i.createInterpolant!==i.InterpolantFactoryMethodLinear){if(i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),i=i.clone(),i.setInterpolation(l.InterpolateLinear)}const h=c.morphTargetInfluences.length,f=c.morphTargetDictionary[a.propertyIndex];if(f===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(n[c.uuid]===void 0){d=i.clone();const g=new d.ValueBufferType(h*d.times.length);for(let x=0;x<d.times.length;x++)g[x*h+f]=d.values[x];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=g,n[c.uuid]=d,t.push(d);continue}const p=i.createInterpolant(new i.ValueBufferType(1));d=n[c.uuid];for(let g=0;g<d.times.length;g++)d.values[g*h+f]=p.evaluate(d.times[g]);for(let g=0;g<i.times.length;g++){const x=this.insertKeyframe(d,i.times[g]);d.values[x*h+f]=i.values[g]}}return o.tracks=t,o}});const xe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Kn="KHR_mesh_quantization",Ee={};Ee[l.NearestFilter]=xe.NEAREST,Ee[l.NearestMipmapNearestFilter]=xe.NEAREST_MIPMAP_NEAREST,Ee[l.NearestMipmapLinearFilter]=xe.NEAREST_MIPMAP_LINEAR,Ee[l.LinearFilter]=xe.LINEAR,Ee[l.LinearMipmapNearestFilter]=xe.LINEAR_MIPMAP_NEAREST,Ee[l.LinearMipmapLinearFilter]=xe.LINEAR_MIPMAP_LINEAR,Ee[l.ClampToEdgeWrapping]=xe.CLAMP_TO_EDGE,Ee[l.RepeatWrapping]=xe.REPEAT,Ee[l.MirroredRepeatWrapping]=xe.MIRRORED_REPEAT;const es={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},so=new l.Color,ts=12,io=1179937895,oo=2,ns=8,ao=1313821514,lo=5130562;function Kt(o,e){return o.length===e.length&&o.every(function(t,n){return t===e[n]})}function co(o){return new TextEncoder().encode(o).buffer}function uo(o){return Kt(o.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function ho(o,e,t){const n={min:new Array(o.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(o.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=e;r<e+t;r++)for(let s=0;s<o.itemSize;s++){let i;o.itemSize>4?i=o.array[r*o.itemSize+s]:(s===0?i=o.getX(r):s===1?i=o.getY(r):s===2?i=o.getZ(r):s===3&&(i=o.getW(r)),o.normalized===!0&&(i=l.MathUtils.normalize(i,o.array))),n.min[s]=Math.min(n.min[s],i),n.max[s]=Math.max(n.max[s],i)}return n}function rs(o){return Math.ceil(o/4)*4}function Qn(o,e=0){const t=rs(o.byteLength);if(t!==o.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(o)),e!==0)for(let r=o.byteLength;r<t;r++)n[r]=e;return n.buffer}return o}function ss(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function is(o,e){if(o.toBlob!==void 0)return new Promise(n=>o.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),o.convertToBlob({type:e,quality:t})}class fo{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,s=r.buffers,i=r.json;n=r.options;const a=r.extensionsUsed,c=r.extensionsRequired,h=new Blob(s,{type:"application/octet-stream"}),f=Object.keys(a),d=Object.keys(c);f.length>0&&(i.extensionsUsed=f),d.length>0&&(i.extensionsRequired=d),i.buffers&&i.buffers.length>0&&(i.buffers[0].byteLength=h.size),n.binary===!0?h.arrayBuffer().then(p=>{const g=Qn(p),x=new DataView(new ArrayBuffer(ns));x.setUint32(0,g.byteLength,!0),x.setUint32(4,lo,!0);const v=Qn(co(JSON.stringify(i)),32),_=new DataView(new ArrayBuffer(ns));_.setUint32(0,v.byteLength,!0),_.setUint32(4,ao,!0);const m=new ArrayBuffer(ts),M=new DataView(m);M.setUint32(0,io,!0),M.setUint32(4,oo,!0);const b=ts+_.byteLength+v.byteLength+x.byteLength+g.byteLength;M.setUint32(8,b,!0),new Blob([m,_,v,x,g],{type:"application/octet-stream"}).arrayBuffer().then(t)}):i.buffers&&i.buffers.length>0?Hr(h).then(p=>{i.buffers[0].uri=p,t(i)}):t(i)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,r=this.extensionsUsed;try{const s=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&s.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const i in s.gltfExtensions)t.extensions[i]=s.gltfExtensions[i],r[i]=!0;delete s.gltfExtensions}Object.keys(s).length>0&&(t.extras=s)}catch(s){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+s.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const r=new Map;r.set(!0,this.uid++),r.set(!1,this.uid++),this.uids.set(e,r)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const n=new l.Vector3;for(let r=0,s=e.count;r<s;r++)if(Math.abs(n.fromBufferAttribute(e,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),r=new l.Vector3;for(let s=0,i=n.count;s<i;s++)r.fromBufferAttribute(n,s),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),n.setXYZ(s,r.x,r.y,r.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const r={};(t.offset.x!==0||t.offset.y!==0)&&(r.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(r.rotation=t.rotation,n=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(g){return("colorSpace"in g?g.colorSpace==="srgb":g.encoding===3001)?function(v){return v<.04045?v*.0773993808:Math.pow(v*.9478672986+.0521327014,2.4)}:function(v){return v}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof l.CompressedTexture&&(e=Zn(e)),t instanceof l.CompressedTexture&&(t=Zn(t));const r=e?e.image:null,s=t?t.image:null,i=Math.max(r?r.width:0,s?s.width:0),a=Math.max(r?r.height:0,s?s.height:0),c=ss();c.width=i,c.height=a;const h=c.getContext("2d");h.fillStyle="#00ffff",h.fillRect(0,0,i,a);const f=h.getImageData(0,0,i,a);if(r){h.drawImage(r,0,0,i,a);const g=n(e),x=h.getImageData(0,0,i,a).data;for(let v=2;v<x.length;v+=4)f.data[v]=g(x[v]/256)*256}if(s){h.drawImage(s,0,0,i,a);const g=n(t),x=h.getImageData(0,0,i,a).data;for(let v=1;v<x.length;v+=4)f.data[v]=g(x[v]/256)*256}h.putImageData(f,0,0);const p=(e||t).clone();return p.source=new l.Texture(c).source,"colorSpace"in p?p.colorSpace="":p.encoding=3e3,p.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),p}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,r,s){const i=this.json;i.bufferViews||(i.bufferViews=[]);let a;switch(t){case xe.BYTE:case xe.UNSIGNED_BYTE:a=1;break;case xe.SHORT:case xe.UNSIGNED_SHORT:a=2;break;default:a=4}const c=rs(r*e.itemSize*a),h=new DataView(new ArrayBuffer(c));let f=0;for(let g=n;g<n+r;g++)for(let x=0;x<e.itemSize;x++){let v;e.itemSize>4?v=e.array[g*e.itemSize+x]:(x===0?v=e.getX(g):x===1?v=e.getY(g):x===2?v=e.getZ(g):x===3&&(v=e.getW(g)),e.normalized===!0&&(v=l.MathUtils.normalize(v,e.array))),t===xe.FLOAT?h.setFloat32(f,v,!0):t===xe.INT?h.setInt32(f,v,!0):t===xe.UNSIGNED_INT?h.setUint32(f,v,!0):t===xe.SHORT?h.setInt16(f,v,!0):t===xe.UNSIGNED_SHORT?h.setUint16(f,v,!0):t===xe.BYTE?h.setInt8(f,v):t===xe.UNSIGNED_BYTE&&h.setUint8(f,v),f+=a}const d={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:c};return s!==void 0&&(d.target=s),s===xe.ARRAY_BUFFER&&(d.byteStride=e.itemSize*a),this.byteOffset+=c,i.bufferViews.push(d),{id:i.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),e.arrayBuffer().then(r=>{const s=Qn(r),i={buffer:t.processBuffer(s),byteOffset:t.byteOffset,byteLength:s.byteLength};return t.byteOffset+=s.byteLength,n.bufferViews.push(i)-1})}processAccessor(e,t,n,r){const s=this.json,i={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=xe.FLOAT;else if(e.array.constructor===Int32Array)a=xe.INT;else if(e.array.constructor===Uint32Array)a=xe.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=xe.SHORT;else if(e.array.constructor===Uint16Array)a=xe.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=xe.BYTE;else if(e.array.constructor===Uint8Array)a=xe.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(n===void 0&&(n=0),r===void 0&&(r=e.count),r===0)return null;const c=ho(e,n,r);let h;t!==void 0&&(h=e===t.index?xe.ELEMENT_ARRAY_BUFFER:xe.ARRAY_BUFFER);const f=this.processBufferView(e,a,n,r,h),d={bufferView:f.id,byteOffset:f.byteOffset,componentType:a,count:r,max:c.max,min:c.min,type:i[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(d)-1}processImage(e,t,n,r="image/png"){if(e!==null){const s=this,i=s.cache,a=s.json,c=s.options,h=s.pending;i.images.has(e)||i.images.set(e,{});const f=i.images.get(e),d=r+":flipY/"+n.toString();if(f[d]!==void 0)return f[d];a.images||(a.images=[]);const p={mimeType:r},g=ss();g.width=Math.min(e.width,c.maxTextureSize),g.height=Math.min(e.height,c.maxTextureSize);const x=g.getContext("2d");if(n===!0&&(x.translate(0,g.height),x.scale(1,-1)),e.data!==void 0){t!==l.RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>c.maxTextureSize||e.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const _=new Uint8ClampedArray(e.height*e.width*4);for(let m=0;m<_.length;m+=4)_[m+0]=e.data[m+0],_[m+1]=e.data[m+1],_[m+2]=e.data[m+2],_[m+3]=e.data[m+3];x.putImageData(new ImageData(_,e.width,e.height),0,0)}else x.drawImage(e,0,0,g.width,g.height);c.binary===!0?h.push(is(g,r).then(_=>s.processBufferViewImage(_)).then(_=>{p.bufferView=_})):g.toDataURL!==void 0?p.uri=g.toDataURL(r):h.push(is(g,r).then(Hr).then(_=>{p.uri=_}));const v=a.images.push(p)-1;return f[d]=v,v}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Ee[e.magFilter],minFilter:Ee[e.minFilter],wrapS:Ee[e.wrapS],wrapT:Ee[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const n=this.options,r=this.cache,s=this.json;if(r.textures.has(e))return r.textures.get(e);s.textures||(s.textures=[]),e instanceof l.CompressedTexture&&(e=Zn(e,n.maxTextureSize));let i=e.userData.mimeType;i==="image/webp"&&(i="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,i)};e.name&&(a.name=e.name),this._invokeAll(function(h){h.writeTexture&&h.writeTexture(e,a)});const c=s.textures.push(a)-1;return r.textures.set(e,c),c}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const r={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=e.color.toArray().concat([e.opacity]);if(Kt(s,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),c={index:this.processTexture(a),channel:a.channel};this.applyTextureTransform(c,a),r.pbrMetallicRoughness.metallicRoughnessTexture=c}if(e.map){const a={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(a,e.map),r.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive;if(Math.max(a.r,a.g,a.b)>0&&(r.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const h={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(h,e.emissiveMap),r.emissiveTexture=h}}if(e.normalMap){const a={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),r.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),r.occlusionTexture=a}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===l.DoubleSide&&(r.doubleSided=!0),e.name!==""&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,r)});const i=n.materials.push(r)-1;return t.materials.set(e,i),i}processMesh(e){const t=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let b=0,S=e.material.length;b<S;b++)r.push(e.material[b].uuid);else r.push(e.material.uuid);const s=r.join(":");if(t.meshes.has(s))return t.meshes.get(s);const i=e.geometry;let a;e.isLineSegments?a=xe.LINES:e.isLineLoop?a=xe.LINE_LOOP:e.isLine?a=xe.LINE_STRIP:e.isPoints?a=xe.POINTS:a=e.material.wireframe?xe.LINES:xe.TRIANGLES;const c={},h={},f=[],d=[],p={...Jr>=152?{uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3"}:{uv:"TEXCOORD_0",uv2:"TEXCOORD_1"},color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},g=i.getAttribute("normal");g!==void 0&&!this.isNormalizedNormalAttribute(g)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),i.setAttribute("normal",this.createNormalizedNormalAttribute(g)));let x=null;for(let b in i.attributes){if(b.slice(0,5)==="morph")continue;const S=i.attributes[b];if(b=p[b]||b.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(b)||(b="_"+b),t.attributes.has(this.getUID(S))){h[b]=t.attributes.get(this.getUID(S));continue}x=null;const P=S.array;b==="JOINTS_0"&&!(P instanceof Uint16Array)&&!(P instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),x=new l.BufferAttribute(new Uint16Array(P),S.itemSize,S.normalized));const T=this.processAccessor(x||S,i);T!==null&&(b.startsWith("_")||this.detectMeshQuantization(b,S),h[b]=T,t.attributes.set(this.getUID(S),T))}if(g!==void 0&&i.setAttribute("normal",g),Object.keys(h).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const b=[],S=[],L={};if(e.morphTargetDictionary!==void 0)for(const P in e.morphTargetDictionary)L[e.morphTargetDictionary[P]]=P;for(let P=0;P<e.morphTargetInfluences.length;++P){const T={};let y=!1;for(const A in i.morphAttributes){if(A!=="position"&&A!=="normal"){y||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),y=!0);continue}const w=i.morphAttributes[A][P],D=A.toUpperCase(),k=i.attributes[A];if(t.attributes.has(this.getUID(w,!0))){T[D]=t.attributes.get(this.getUID(w,!0));continue}const R=w.clone();if(!i.morphTargetsRelative)for(let V=0,Y=w.count;V<Y;V++)for(let G=0;G<w.itemSize;G++)G===0&&R.setX(V,w.getX(V)-k.getX(V)),G===1&&R.setY(V,w.getY(V)-k.getY(V)),G===2&&R.setZ(V,w.getZ(V)-k.getZ(V)),G===3&&R.setW(V,w.getW(V)-k.getW(V));T[D]=this.processAccessor(R,i),t.attributes.set(this.getUID(k,!0),T[D])}d.push(T),b.push(e.morphTargetInfluences[P]),e.morphTargetDictionary!==void 0&&S.push(L[P])}c.weights=b,S.length>0&&(c.extras={},c.extras.targetNames=S)}const v=Array.isArray(e.material);if(v&&i.groups.length===0)return null;const _=v?e.material:[e.material],m=v?i.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let b=0,S=m.length;b<S;b++){const L={mode:a,attributes:h};if(this.serializeUserData(i,L),d.length>0&&(L.targets=d),i.index!==null){let T=this.getUID(i.index);(m[b].start!==void 0||m[b].count!==void 0)&&(T+=":"+m[b].start+":"+m[b].count),t.attributes.has(T)?L.indices=t.attributes.get(T):(L.indices=this.processAccessor(i.index,i,m[b].start,m[b].count),t.attributes.set(T,L.indices)),L.indices===null&&delete L.indices}const P=this.processMaterial(_[m[b].materialIndex]);P!==null&&(L.material=P),f.push(L)}c.primitives=f,n.meshes||(n.meshes=[]),this._invokeAll(function(b){b.writeMesh&&b.writeMesh(e,c)});const M=n.meshes.push(c)-1;return t.meshes.set(s,M),M}detectMeshQuantization(e,t){if(this.extensionsUsed[Kn])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const r=e.split("_",1)[0];$r[r]&&$r[r].includes(n)&&(this.extensionsUsed[Kn]=!0,this.extensionsRequired[Kn]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:l.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){const n=this.json,r=this.nodeMap;n.animations||(n.animations=[]),e=qn.Utils.mergeMorphTargetTracks(e.clone(),t);const s=e.tracks,i=[],a=[];for(let c=0;c<s.length;++c){const h=s[c],f=l.PropertyBinding.parseTrackName(h.name);let d=l.PropertyBinding.findNode(t,f.nodeName);const p=es[f.propertyName];if(f.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(f.objectIndex):d=void 0),!d||!p)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name),null;const g=1;let x=h.values.length/h.times.length;p===es.morphTargetInfluences&&(x/=d.morphTargetInfluences.length);let v;h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(v="CUBICSPLINE",x/=3):h.getInterpolation()===l.InterpolateDiscrete?v="STEP":v="LINEAR",a.push({input:this.processAccessor(new l.BufferAttribute(h.times,g)),output:this.processAccessor(new l.BufferAttribute(h.values,x)),interpolation:v}),i.push({sampler:a.length-1,target:{node:r.get(d),path:p}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:a,channels:i}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,r=t.nodes[n.get(e)],s=e.skeleton;if(s===void 0)return null;const i=e.skeleton.bones[0];if(i===void 0)return null;const a=[],c=new Float32Array(s.bones.length*16),h=new l.Matrix4;for(let d=0;d<s.bones.length;++d)a.push(n.get(s.bones[d])),h.copy(s.boneInverses[d]),h.multiply(e.bindMatrix).toArray(c,d*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new l.BufferAttribute(c,16)),joints:a,skeleton:n.get(i)}),r.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);const s={};if(n.trs){const a=e.quaternion.toArray(),c=e.position.toArray(),h=e.scale.toArray();Kt(a,[0,0,0,1])||(s.rotation=a),Kt(c,[0,0,0])||(s.translation=c),Kt(h,[1,1,1])||(s.scale=h)}else e.matrixAutoUpdate&&e.updateMatrix(),uo(e.matrix)===!1&&(s.matrix=e.matrix.elements);if(e.name!==""&&(s.name=String(e.name)),this.serializeUserData(e,s),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(s.mesh=a)}else e.isCamera&&(s.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let c=0,h=e.children.length;c<h;c++){const f=e.children[c];if(f.visible||n.onlyVisible===!1){const d=this.processNode(f);d!==null&&a.push(d)}}a.length>0&&(s.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,s)});const i=t.nodes.push(s)-1;return r.set(e,i),i}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};e.name!==""&&(r.name=e.name),t.scenes.push(r);const s=[];for(let i=0,a=e.children.length;i<a;i++){const c=e.children[i];if(c.visible||n.onlyVisible===!1){const h=this.processNode(c);h!==null&&s.push(h)}}s.length>0&&(r.nodes=s),this.serializeUserData(e,r)}processObjects(e){const t=new l.Scene;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(e)});const n=[];for(let r=0;r<e.length;r++)e[r]instanceof l.Scene?this.processScene(e[r]):n.push(e[r]);n.length>0&&this.processObjects(n);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class po{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const n=this.writer,r=n.json,s=n.extensionsUsed,i={};e.name&&(i.name=e.name),i.color=e.color.toArray(),i.intensity=e.intensity,e.isDirectionalLight?i.type="directional":e.isPointLight?(i.type="point",e.distance>0&&(i.range=e.distance)):e.isSpotLight&&(i.type="spot",e.distance>0&&(i.range=e.distance),i.spot={},i.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,i.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),s[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},s[this.name]=!0);const a=r.extensions[this.name].lights;a.push(i),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}let mo=class{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const r=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}},go=class{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const n=this.writer,r=n.extensionsUsed,s={};if(s.clearcoatFactor=e.clearcoat,e.clearcoatMap){const i={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(i,e.clearcoatMap),s.clearcoatTexture=i}if(s.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const i={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(i,e.clearcoatRoughnessMap),s.clearcoatRoughnessTexture=i}if(e.clearcoatNormalMap){const i={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(i,e.clearcoatNormalMap),s.clearcoatNormalTexture=i}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},yo=class{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const n=this.writer,r=n.extensionsUsed,s={};if(s.iridescenceFactor=e.iridescence,e.iridescenceMap){const i={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(i,e.iridescenceMap),s.iridescenceTexture=i}if(s.iridescenceIor=e.iridescenceIOR,s.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],s.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const i={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(i,e.iridescenceThicknessMap),s.iridescenceThicknessTexture=i}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},vo=class{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,r=n.extensionsUsed,s={};if(s.transmissionFactor=e.transmission,e.transmissionMap){const i={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(i,e.transmissionMap),s.transmissionTexture=i}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},_o=class{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,r=n.extensionsUsed,s={};if(s.thicknessFactor=e.thickness,e.thicknessMap){const i={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(i,e.thicknessMap),s.thicknessTexture=i}s.attenuationDistance=e.attenuationDistance,s.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},xo=class{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const r=this.writer.extensionsUsed,s={};s.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},wo=class{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(so)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const n=this.writer,r=n.extensionsUsed,s={};if(e.specularIntensityMap){const i={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(i,e.specularIntensityMap),s.specularTexture=i}if(e.specularColorMap){const i={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(i,e.specularColorMap),s.specularColorTexture=i}s.specularFactor=e.specularIntensity,s.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},bo=class{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const n=this.writer,r=n.extensionsUsed,s={};if(e.sheenRoughnessMap){const i={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(i,e.sheenRoughnessMap),s.sheenRoughnessTexture=i}if(e.sheenColorMap){const i={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(i,e.sheenColorMap),s.sheenColorTexture=i}s.sheenRoughnessFactor=e.sheenRoughness,s.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},Mo=class{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const n=this.writer,r=n.extensionsUsed,s={};if(e.anisotropyMap){const i={index:n.processTexture(e.anisotropyMap)};n.applyTextureTransform(i,e.anisotropyMap),s.anisotropyTexture=i}s.anisotropyStrength=e.anisotropy,s.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},So=class{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const r=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}};var qe=Uint8Array,mt=Uint16Array,Jn=Uint32Array,os=new qe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),as=new qe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ao=new qe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ls=function(o,e){for(var t=new mt(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var r=new Jn(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)r[s]=s-t[n]<<5|n;return[t,r]},cs=ls(os,2),us=cs[0],Co=cs[1];us[28]=258,Co[258]=28;for(var Po=ls(as,0),To=Po[0],Hn=new mt(32768),Pe=0;Pe<32768;++Pe){var gt=(Pe&43690)>>>1|(Pe&21845)<<1;gt=(gt&52428)>>>2|(gt&13107)<<2,gt=(gt&61680)>>>4|(gt&3855)<<4,Hn[Pe]=((gt&65280)>>>8|(gt&255)<<8)>>>1}for(var Qt=function(o,e,t){for(var n=o.length,r=0,s=new mt(e);r<n;++r)++s[o[r]-1];var i=new mt(e);for(r=0;r<e;++r)i[r]=i[r-1]+s[r-1]<<1;var a;if(t){a=new mt(1<<e);var c=15-e;for(r=0;r<n;++r)if(o[r])for(var h=r<<4|o[r],f=e-o[r],d=i[o[r]-1]++<<f,p=d|(1<<f)-1;d<=p;++d)a[Hn[d]>>>c]=h}else for(a=new mt(n),r=0;r<n;++r)o[r]&&(a[r]=Hn[i[o[r]-1]++]>>>15-o[r]);return a},Jt=new qe(288),Pe=0;Pe<144;++Pe)Jt[Pe]=8;for(var Pe=144;Pe<256;++Pe)Jt[Pe]=9;for(var Pe=256;Pe<280;++Pe)Jt[Pe]=7;for(var Pe=280;Pe<288;++Pe)Jt[Pe]=8;for(var hs=new qe(32),Pe=0;Pe<32;++Pe)hs[Pe]=5;var Io=Qt(Jt,9,1),Lo=Qt(hs,5,1),$n=function(o){for(var e=o[0],t=1;t<o.length;++t)o[t]>e&&(e=o[t]);return e},$e=function(o,e,t){var n=e/8|0;return(o[n]|o[n+1]<<8)>>(e&7)&t},er=function(o,e){var t=e/8|0;return(o[t]|o[t+1]<<8|o[t+2]<<16)>>(e&7)},Oo=function(o){return(o/8|0)+(o&7&&1)},Do=function(o,e,t){(t==null||t>o.length)&&(t=o.length);var n=new(o instanceof mt?mt:o instanceof Jn?Jn:qe)(t-e);return n.set(o.subarray(e,t)),n},ko=function(o,e,t){var n=o.length;if(!n||t&&!t.l&&n<5)return e||new qe(0);var r=!e||t,s=!t||t.i;t||(t={}),e||(e=new qe(n*3));var i=function(U){var F=e.length;if(U>F){var j=new qe(Math.max(F*2,U));j.set(e),e=j}},a=t.f||0,c=t.p||0,h=t.b||0,f=t.l,d=t.d,p=t.m,g=t.n,x=n*8;do{if(!f){t.f=a=$e(o,c,1);var v=$e(o,c+1,3);if(c+=3,v)if(v==1)f=Io,d=Lo,p=9,g=5;else if(v==2){var b=$e(o,c,31)+257,S=$e(o,c+10,15)+4,L=b+$e(o,c+5,31)+1;c+=14;for(var P=new qe(L),T=new qe(19),y=0;y<S;++y)T[Ao[y]]=$e(o,c+y*3,7);c+=S*3;for(var A=$n(T),w=(1<<A)-1,D=Qt(T,A,1),y=0;y<L;){var k=D[$e(o,c,w)];c+=k&15;var _=k>>>4;if(_<16)P[y++]=_;else{var R=0,V=0;for(_==16?(V=3+$e(o,c,3),c+=2,R=P[y-1]):_==17?(V=3+$e(o,c,7),c+=3):_==18&&(V=11+$e(o,c,127),c+=7);V--;)P[y++]=R}}var Y=P.subarray(0,b),G=P.subarray(b);p=$n(Y),g=$n(G),f=Qt(Y,p,1),d=Qt(G,g,1)}else throw"invalid block type";else{var _=Oo(c)+4,m=o[_-4]|o[_-3]<<8,M=_+m;if(M>n){if(s)throw"unexpected EOF";break}r&&i(h+m),e.set(o.subarray(_,M),h),t.b=h+=m,t.p=c=M*8;continue}if(c>x){if(s)throw"unexpected EOF";break}}r&&i(h+131072);for(var Q=(1<<p)-1,K=(1<<g)-1,ne=c;;ne=c){var R=f[er(o,c)&Q],ee=R>>>4;if(c+=R&15,c>x){if(s)throw"unexpected EOF";break}if(!R)throw"invalid length/literal";if(ee<256)e[h++]=ee;else if(ee==256){ne=c,f=null;break}else{var le=ee-254;if(ee>264){var y=ee-257,he=os[y];le=$e(o,c,(1<<he)-1)+us[y],c+=he}var de=d[er(o,c)&K],O=de>>>4;if(!de)throw"invalid distance";c+=de&15;var G=To[O];if(O>3){var he=as[O];G+=er(o,c)&(1<<he)-1,c+=he}if(c>x){if(s)throw"unexpected EOF";break}r&&i(h+131072);for(var z=h+le;h<z;h+=4)e[h]=e[h-G],e[h+1]=e[h+1-G],e[h+2]=e[h+2-G],e[h+3]=e[h+3-G];h=z}}t.l=f,t.p=ne,t.b=h,f&&(a=1,t.m=p,t.d=d,t.n=g)}while(!a);return h==e.length?e:Do(e,0,h)},Bo=new qe(0),Fo=function(o){if((o[0]&15)!=8||o[0]>>>4>7||(o[0]<<8|o[1])%31)throw"invalid zlib data";if(o[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Uo(o,e){return ko((Fo(o),o.subarray(2,-4)),e)}var No=typeof TextDecoder<"u"&&new TextDecoder,Vo=0;try{No.decode(Bo,{stream:!0}),Vo=1}catch{}const Fe=new l.Triangle,wn=new l.Vector3;class zo{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){const e=this.positionAttribute,t=this.weightAttribute,n=new Float32Array(e.count/3);for(let s=0;s<e.count;s+=3){let i=1;t&&(i=t.getX(s)+t.getX(s+1)+t.getX(s+2)),Fe.a.fromBufferAttribute(e,s),Fe.b.fromBufferAttribute(e,s+1),Fe.c.fromBufferAttribute(e,s+2),i*=Fe.getArea(),n[s/3]=i}this.distribution=new Float32Array(e.count/3);let r=0;for(let s=0;s<n.length;s++)r+=n[s],this.distribution[s]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,n){const r=this.sampleFaceIndex();return this.sampleFace(r,e,t,n)}sampleFaceIndex(){const e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){const t=this.distribution;let n=0,r=t.length-1,s=-1;for(;n<=r;){const i=Math.ceil((n+r)/2);if(i===0||t[i-1]<=e&&t[i]>e){s=i;break}else e<t[i]?r=i-1:n=i+1}return s}sampleFace(e,t,n,r){let s=this.randomFunction(),i=this.randomFunction();return s+i>1&&(s=1-s,i=1-i),Fe.a.fromBufferAttribute(this.positionAttribute,e*3),Fe.b.fromBufferAttribute(this.positionAttribute,e*3+1),Fe.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Fe.a,s).addScaledVector(Fe.b,i).addScaledVector(Fe.c,1-(s+i)),n!==void 0&&Fe.getNormal(n),r!==void 0&&this.colorAttribute!==void 0&&(Fe.a.fromBufferAttribute(this.colorAttribute,e*3),Fe.b.fromBufferAttribute(this.colorAttribute,e*3+1),Fe.c.fromBufferAttribute(this.colorAttribute,e*3+2),wn.set(0,0,0).addScaledVector(Fe.a,s).addScaledVector(Fe.b,i).addScaledVector(Fe.c,1-(s+i)),r.r=wn.x,r.g=wn.y,r.b=wn.z),this}}var Go=Object.defineProperty,jo=(o,e,t)=>e in o?Go(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,J=(o,e,t)=>(jo(o,typeof e!="symbol"?e+"":e,t),t);class Ro extends l.Object3D{constructor(e,t){super(),J(this,"isTransformControls",!0),J(this,"visible",!1),J(this,"domElement"),J(this,"raycaster",new l.Raycaster),J(this,"gizmo"),J(this,"plane"),J(this,"tempVector",new l.Vector3),J(this,"tempVector2",new l.Vector3),J(this,"tempQuaternion",new l.Quaternion),J(this,"unit",{X:new l.Vector3(1,0,0),Y:new l.Vector3(0,1,0),Z:new l.Vector3(0,0,1)}),J(this,"pointStart",new l.Vector3),J(this,"pointEnd",new l.Vector3),J(this,"offset",new l.Vector3),J(this,"rotationAxis",new l.Vector3),J(this,"startNorm",new l.Vector3),J(this,"endNorm",new l.Vector3),J(this,"rotationAngle",0),J(this,"cameraPosition",new l.Vector3),J(this,"cameraQuaternion",new l.Quaternion),J(this,"cameraScale",new l.Vector3),J(this,"parentPosition",new l.Vector3),J(this,"parentQuaternion",new l.Quaternion),J(this,"parentQuaternionInv",new l.Quaternion),J(this,"parentScale",new l.Vector3),J(this,"worldPositionStart",new l.Vector3),J(this,"worldQuaternionStart",new l.Quaternion),J(this,"worldScaleStart",new l.Vector3),J(this,"worldPosition",new l.Vector3),J(this,"worldQuaternion",new l.Quaternion),J(this,"worldQuaternionInv",new l.Quaternion),J(this,"worldScale",new l.Vector3),J(this,"eye",new l.Vector3),J(this,"positionStart",new l.Vector3),J(this,"quaternionStart",new l.Quaternion),J(this,"scaleStart",new l.Vector3),J(this,"camera"),J(this,"object"),J(this,"enabled",!0),J(this,"axis",null),J(this,"mode","translate"),J(this,"translationSnap",null),J(this,"rotationSnap",null),J(this,"scaleSnap",null),J(this,"space","world"),J(this,"size",1),J(this,"dragging",!1),J(this,"showX",!0),J(this,"showY",!0),J(this,"showZ",!0),J(this,"changeEvent",{type:"change"}),J(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),J(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),J(this,"objectChangeEvent",{type:"objectChange"}),J(this,"intersectObjectWithRay",(r,s,i)=>{const a=s.intersectObject(r,!0);for(let c=0;c<a.length;c++)if(a[c].object.visible||i)return a[c];return!1}),J(this,"attach",r=>(this.object=r,this.visible=!0,this)),J(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),J(this,"reset",()=>this.enabled?(this.dragging&&this.object!==void 0&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this),J(this,"updateMatrixWorld",()=>{this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),J(this,"pointerHover",r=>{if(this.object===void 0||this.dragging===!0)return;this.raycaster.setFromCamera(r,this.camera);const s=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);s?this.axis=s.object.name:this.axis=null}),J(this,"pointerDown",r=>{if(!(this.object===void 0||this.dragging===!0||r.button!==0)&&this.axis!==null){this.raycaster.setFromCamera(r,this.camera);const s=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(s){let i=this.space;if(this.mode==="scale"?i="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(i="world"),i==="local"&&this.mode==="rotate"){const a=this.rotationSnap;this.axis==="X"&&a&&(this.object.rotation.x=Math.round(this.object.rotation.x/a)*a),this.axis==="Y"&&a&&(this.object.rotation.y=Math.round(this.object.rotation.y/a)*a),this.axis==="Z"&&a&&(this.object.rotation.z=Math.round(this.object.rotation.z/a)*a)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(s.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),J(this,"pointerMove",r=>{const s=this.axis,i=this.mode,a=this.object;let c=this.space;if(i==="scale"?c="local":(s==="E"||s==="XYZE"||s==="XYZ")&&(c="world"),a===void 0||s===null||this.dragging===!1||r.button!==-1)return;this.raycaster.setFromCamera(r,this.camera);const h=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(h){if(this.pointEnd.copy(h.point).sub(this.worldPositionStart),i==="translate")this.offset.copy(this.pointEnd).sub(this.pointStart),c==="local"&&s!=="XYZ"&&this.offset.applyQuaternion(this.worldQuaternionInv),s.indexOf("X")===-1&&(this.offset.x=0),s.indexOf("Y")===-1&&(this.offset.y=0),s.indexOf("Z")===-1&&(this.offset.z=0),c==="local"&&s!=="XYZ"?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),a.position.copy(this.offset).add(this.positionStart),this.translationSnap&&(c==="local"&&(a.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this.quaternionStart)),c==="world"&&(a.parent&&a.position.add(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld)),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld))));else if(i==="scale"){if(s.search("XYZ")!==-1){let f=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(f*=-1),this.tempVector2.set(f,f,f)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),s.search("X")===-1&&(this.tempVector2.x=1),s.search("Y")===-1&&(this.tempVector2.y=1),s.search("Z")===-1&&(this.tempVector2.z=1);a.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(s.search("X")!==-1&&(this.object.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this.offset.copy(this.pointEnd).sub(this.pointStart);const f=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));s==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):s==="XYZE"?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*f):(s==="X"||s==="Y"||s==="Z")&&(this.rotationAxis.copy(this.unit[s]),this.tempVector.copy(this.unit[s]),c==="local"&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*f),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),c==="local"&&s!=="E"&&s!=="XYZE"?(a.quaternion.copy(this.quaternionStart),a.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),a.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),J(this,"pointerUp",r=>{r.button===0&&(this.dragging&&this.axis!==null&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),J(this,"getPointer",r=>{var s;if(this.domElement&&((s=this.domElement.ownerDocument)!=null&&s.pointerLockElement))return{x:0,y:0,button:r.button};{const i=r.changedTouches?r.changedTouches[0]:r,a=this.domElement.getBoundingClientRect();return{x:(i.clientX-a.left)/a.width*2-1,y:-(i.clientY-a.top)/a.height*2+1,button:r.button}}}),J(this,"onPointerHover",r=>{if(this.enabled)switch(r.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(r));break}}),J(this,"onPointerDown",r=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(r)),this.pointerDown(this.getPointer(r)))}),J(this,"onPointerMove",r=>{this.enabled&&this.pointerMove(this.getPointer(r))}),J(this,"onPointerUp",r=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(r)))}),J(this,"getMode",()=>this.mode),J(this,"setMode",r=>{this.mode=r}),J(this,"setTranslationSnap",r=>{this.translationSnap=r}),J(this,"setRotationSnap",r=>{this.rotationSnap=r}),J(this,"setScaleSnap",r=>{this.scaleSnap=r}),J(this,"setSize",r=>{this.size=r}),J(this,"setSpace",r=>{this.space=r}),J(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),J(this,"connect",r=>{r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=r,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),J(this,"dispose",()=>{var r,s,i,a,c,h;(r=this.domElement)==null||r.removeEventListener("pointerdown",this.onPointerDown),(s=this.domElement)==null||s.removeEventListener("pointermove",this.onPointerHover),(a=(i=this.domElement)==null?void 0:i.ownerDocument)==null||a.removeEventListener("pointermove",this.onPointerMove),(h=(c=this.domElement)==null?void 0:c.ownerDocument)==null||h.removeEventListener("pointerup",this.onPointerUp),this.traverse(f=>{const d=f;d.geometry&&d.geometry.dispose(),d.material&&d.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new Wo,this.add(this.gizmo),this.plane=new Yo,this.add(this.plane);const n=(r,s)=>{let i=s;Object.defineProperty(this,r,{get:function(){return i!==void 0?i:s},set:function(a){i!==a&&(i=a,this.plane[r]=a,this.gizmo[r]=a,this.dispatchEvent({type:r+"-changed",value:a}),this.dispatchEvent(this.changeEvent))}}),this[r]=s,this.plane[r]=s,this.gizmo[r]=s};n("camera",this.camera),n("object",this.object),n("enabled",this.enabled),n("axis",this.axis),n("mode",this.mode),n("translationSnap",this.translationSnap),n("rotationSnap",this.rotationSnap),n("scaleSnap",this.scaleSnap),n("space",this.space),n("size",this.size),n("dragging",this.dragging),n("showX",this.showX),n("showY",this.showY),n("showZ",this.showZ),n("worldPosition",this.worldPosition),n("worldPositionStart",this.worldPositionStart),n("worldQuaternion",this.worldQuaternion),n("worldQuaternionStart",this.worldQuaternionStart),n("cameraPosition",this.cameraPosition),n("cameraQuaternion",this.cameraQuaternion),n("pointStart",this.pointStart),n("pointEnd",this.pointEnd),n("rotationAxis",this.rotationAxis),n("rotationAngle",this.rotationAngle),n("eye",this.eye),t!==void 0&&this.connect(t)}}class Wo extends l.Object3D{constructor(){super(),J(this,"isTransformControlsGizmo",!0),J(this,"type","TransformControlsGizmo"),J(this,"tempVector",new l.Vector3(0,0,0)),J(this,"tempEuler",new l.Euler),J(this,"alignVector",new l.Vector3(0,1,0)),J(this,"zeroVector",new l.Vector3(0,0,0)),J(this,"lookAtMatrix",new l.Matrix4),J(this,"tempQuaternion",new l.Quaternion),J(this,"tempQuaternion2",new l.Quaternion),J(this,"identityQuaternion",new l.Quaternion),J(this,"unitX",new l.Vector3(1,0,0)),J(this,"unitY",new l.Vector3(0,1,0)),J(this,"unitZ",new l.Vector3(0,0,1)),J(this,"gizmo"),J(this,"picker"),J(this,"helper"),J(this,"rotationAxis",new l.Vector3),J(this,"cameraPosition",new l.Vector3),J(this,"worldPositionStart",new l.Vector3),J(this,"worldQuaternionStart",new l.Quaternion),J(this,"worldPosition",new l.Vector3),J(this,"worldQuaternion",new l.Quaternion),J(this,"eye",new l.Vector3),J(this,"camera",null),J(this,"enabled",!0),J(this,"axis",null),J(this,"mode","translate"),J(this,"space","world"),J(this,"size",1),J(this,"dragging",!1),J(this,"showX",!0),J(this,"showY",!0),J(this,"showZ",!0),J(this,"updateMatrixWorld",()=>{let ee=this.space;this.mode==="scale"&&(ee="local");const le=ee==="local"?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let he=[];he=he.concat(this.picker[this.mode].children),he=he.concat(this.gizmo[this.mode].children),he=he.concat(this.helper[this.mode].children);for(let de=0;de<he.length;de++){const O=he[de];O.visible=!0,O.rotation.set(0,0,0),O.position.copy(this.worldPosition);let z;if(this.camera.isOrthographicCamera?z=(this.camera.top-this.camera.bottom)/this.camera.zoom:z=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),O.scale.set(1,1,1).multiplyScalar(z*this.size/7),O.tag==="helper"){O.visible=!1,O.name==="AXIS"?(O.position.copy(this.worldPositionStart),O.visible=!!this.axis,this.axis==="X"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),O.quaternion.copy(le).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(le).dot(this.eye))>.9&&(O.visible=!1)),this.axis==="Y"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),O.quaternion.copy(le).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(le).dot(this.eye))>.9&&(O.visible=!1)),this.axis==="Z"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),O.quaternion.copy(le).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(le).dot(this.eye))>.9&&(O.visible=!1)),this.axis==="XYZE"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),O.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),O.quaternion.multiply(this.tempQuaternion),O.visible=this.dragging),this.axis==="E"&&(O.visible=!1)):O.name==="START"?(O.position.copy(this.worldPositionStart),O.visible=this.dragging):O.name==="END"?(O.position.copy(this.worldPosition),O.visible=this.dragging):O.name==="DELTA"?(O.position.copy(this.worldPositionStart),O.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),O.scale.copy(this.tempVector),O.visible=this.dragging):(O.quaternion.copy(le),this.dragging?O.position.copy(this.worldPositionStart):O.position.copy(this.worldPosition),this.axis&&(O.visible=this.axis.search(O.name)!==-1));continue}O.quaternion.copy(le),this.mode==="translate"||this.mode==="scale"?((O.name==="X"||O.name==="XYZX")&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(le).dot(this.eye))>.99&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),(O.name==="Y"||O.name==="XYZY")&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(le).dot(this.eye))>.99&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),(O.name==="Z"||O.name==="XYZZ")&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(le).dot(this.eye))>.99&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),O.name==="XY"&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(le).dot(this.eye))<.2&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),O.name==="YZ"&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(le).dot(this.eye))<.2&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),O.name==="XZ"&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(le).dot(this.eye))<.2&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),O.name.search("X")!==-1&&(this.alignVector.copy(this.unitX).applyQuaternion(le).dot(this.eye)<0?O.tag==="fwd"?O.visible=!1:O.scale.x*=-1:O.tag==="bwd"&&(O.visible=!1)),O.name.search("Y")!==-1&&(this.alignVector.copy(this.unitY).applyQuaternion(le).dot(this.eye)<0?O.tag==="fwd"?O.visible=!1:O.scale.y*=-1:O.tag==="bwd"&&(O.visible=!1)),O.name.search("Z")!==-1&&(this.alignVector.copy(this.unitZ).applyQuaternion(le).dot(this.eye)<0?O.tag==="fwd"?O.visible=!1:O.scale.z*=-1:O.tag==="bwd"&&(O.visible=!1))):this.mode==="rotate"&&(this.tempQuaternion2.copy(le),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(le).invert()),O.name.search("E")!==-1&&O.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),O.name==="X"&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),O.quaternion.copy(this.tempQuaternion)),O.name==="Y"&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),O.quaternion.copy(this.tempQuaternion)),O.name==="Z"&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),O.quaternion.copy(this.tempQuaternion))),O.visible=O.visible&&(O.name.indexOf("X")===-1||this.showX),O.visible=O.visible&&(O.name.indexOf("Y")===-1||this.showY),O.visible=O.visible&&(O.name.indexOf("Z")===-1||this.showZ),O.visible=O.visible&&(O.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),O.material.tempOpacity=O.material.tempOpacity||O.material.opacity,O.material.tempColor=O.material.tempColor||O.material.color.clone(),O.material.color.copy(O.material.tempColor),O.material.opacity=O.material.tempOpacity,this.enabled?this.axis&&(O.name===this.axis?(O.material.opacity=1,O.material.color.lerp(new l.Color(1,1,1),.5)):this.axis.split("").some(function(U){return O.name===U})?(O.material.opacity=1,O.material.color.lerp(new l.Color(1,1,1),.5)):(O.material.opacity*=.25,O.material.color.lerp(new l.Color(1,1,1),.5))):(O.material.opacity*=.5,O.material.color.lerp(new l.Color(1,1,1),.5))}super.updateMatrixWorld()});const e=new l.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:l.DoubleSide,fog:!1,toneMapped:!1}),t=new l.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=e.clone();n.opacity=.15;const r=e.clone();r.opacity=.33;const s=e.clone();s.color.set(16711680);const i=e.clone();i.color.set(65280);const a=e.clone();a.color.set(255);const c=e.clone();c.opacity=.25;const h=c.clone();h.color.set(16776960);const f=c.clone();f.color.set(65535);const d=c.clone();d.color.set(16711935),e.clone().color.set(16776960);const g=t.clone();g.color.set(16711680);const x=t.clone();x.color.set(65280);const v=t.clone();v.color.set(255);const _=t.clone();_.color.set(65535);const m=t.clone();m.color.set(16711935);const M=t.clone();M.color.set(16776960);const b=t.clone();b.color.set(7895160);const S=M.clone();S.opacity=.25;const L=new l.CylinderGeometry(0,.05,.2,12,1,!1),P=new l.BoxGeometry(.125,.125,.125),T=new l.BufferGeometry;T.setAttribute("position",new l.Float32BufferAttribute([0,0,0,1,0,0],3));const y=(ee,le)=>{const he=new l.BufferGeometry,de=[];for(let O=0;O<=64*le;++O)de.push(0,Math.cos(O/32*Math.PI)*ee,Math.sin(O/32*Math.PI)*ee);return he.setAttribute("position",new l.Float32BufferAttribute(de,3)),he},A=()=>{const ee=new l.BufferGeometry;return ee.setAttribute("position",new l.Float32BufferAttribute([0,0,0,1,1,1],3)),ee},w={X:[[new l.Mesh(L,s),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new l.Mesh(L,s),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new l.Line(T,g)]],Y:[[new l.Mesh(L,i),[0,1,0],null,null,"fwd"],[new l.Mesh(L,i),[0,1,0],[Math.PI,0,0],null,"bwd"],[new l.Line(T,x),null,[0,0,Math.PI/2]]],Z:[[new l.Mesh(L,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new l.Mesh(L,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new l.Line(T,v),null,[0,-Math.PI/2,0]]],XYZ:[[new l.Mesh(new l.OctahedronGeometry(.1,0),c.clone()),[0,0,0],[0,0,0]]],XY:[[new l.Mesh(new l.PlaneGeometry(.295,.295),h.clone()),[.15,.15,0]],[new l.Line(T,M),[.18,.3,0],null,[.125,1,1]],[new l.Line(T,M),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new l.Mesh(new l.PlaneGeometry(.295,.295),f.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new l.Line(T,_),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new l.Line(T,_),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new l.Mesh(new l.PlaneGeometry(.295,.295),d.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new l.Line(T,m),[.18,0,.3],null,[.125,1,1]],[new l.Line(T,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},D={X:[[new l.Mesh(new l.CylinderGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new l.Mesh(new l.CylinderGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new l.Mesh(new l.CylinderGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new l.Mesh(new l.OctahedronGeometry(.2,0),n)]],XY:[[new l.Mesh(new l.PlaneGeometry(.4,.4),n),[.2,.2,0]]],YZ:[[new l.Mesh(new l.PlaneGeometry(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new l.Mesh(new l.PlaneGeometry(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},k={START:[[new l.Mesh(new l.OctahedronGeometry(.01,2),r),null,null,null,"helper"]],END:[[new l.Mesh(new l.OctahedronGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new l.Line(A(),r),null,null,null,"helper"]],X:[[new l.Line(T,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new l.Line(T,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new l.Line(T,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R={X:[[new l.Line(y(1,.5),g)],[new l.Mesh(new l.OctahedronGeometry(.04,0),s),[0,0,.99],null,[1,3,1]]],Y:[[new l.Line(y(1,.5),x),null,[0,0,-Math.PI/2]],[new l.Mesh(new l.OctahedronGeometry(.04,0),i),[0,0,.99],null,[3,1,1]]],Z:[[new l.Line(y(1,.5),v),null,[0,Math.PI/2,0]],[new l.Mesh(new l.OctahedronGeometry(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new l.Line(y(1.25,1),S),null,[0,Math.PI/2,0]],[new l.Mesh(new l.CylinderGeometry(.03,0,.15,4,1,!1),S),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new l.Mesh(new l.CylinderGeometry(.03,0,.15,4,1,!1),S),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new l.Mesh(new l.CylinderGeometry(.03,0,.15,4,1,!1),S),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new l.Mesh(new l.CylinderGeometry(.03,0,.15,4,1,!1),S),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new l.Line(y(1,1),b),null,[0,Math.PI/2,0]]]},V={AXIS:[[new l.Line(T,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Y={X:[[new l.Mesh(new l.TorusGeometry(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new l.Mesh(new l.TorusGeometry(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new l.Mesh(new l.TorusGeometry(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new l.Mesh(new l.TorusGeometry(1.25,.1,2,24),n)]],XYZE:[[new l.Mesh(new l.SphereGeometry(.7,10,8),n)]]},G={X:[[new l.Mesh(P,s),[.8,0,0],[0,0,-Math.PI/2]],[new l.Line(T,g),null,null,[.8,1,1]]],Y:[[new l.Mesh(P,i),[0,.8,0]],[new l.Line(T,x),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new l.Mesh(P,a),[0,0,.8],[Math.PI/2,0,0]],[new l.Line(T,v),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new l.Mesh(P,h),[.85,.85,0],null,[2,2,.2]],[new l.Line(T,M),[.855,.98,0],null,[.125,1,1]],[new l.Line(T,M),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new l.Mesh(P,f),[0,.85,.85],null,[.2,2,2]],[new l.Line(T,_),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new l.Line(T,_),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new l.Mesh(P,d),[.85,0,.85],null,[2,.2,2]],[new l.Line(T,m),[.855,0,.98],null,[.125,1,1]],[new l.Line(T,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new l.Mesh(new l.BoxGeometry(.125,.125,.125),c.clone()),[1.1,0,0]]],XYZY:[[new l.Mesh(new l.BoxGeometry(.125,.125,.125),c.clone()),[0,1.1,0]]],XYZZ:[[new l.Mesh(new l.BoxGeometry(.125,.125,.125),c.clone()),[0,0,1.1]]]},Q={X:[[new l.Mesh(new l.CylinderGeometry(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new l.Mesh(new l.CylinderGeometry(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new l.Mesh(new l.CylinderGeometry(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new l.Mesh(P,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new l.Mesh(P,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new l.Mesh(P,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new l.Mesh(new l.BoxGeometry(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new l.Mesh(new l.BoxGeometry(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new l.Mesh(new l.BoxGeometry(.2,.2,.2),n),[0,0,1.1]]]},K={X:[[new l.Line(T,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new l.Line(T,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new l.Line(T,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},ne=ee=>{const le=new l.Object3D;for(let he in ee)for(let de=ee[he].length;de--;){const O=ee[he][de][0].clone(),z=ee[he][de][1],U=ee[he][de][2],F=ee[he][de][3],j=ee[he][de][4];O.name=he,O.tag=j,z&&O.position.set(z[0],z[1],z[2]),U&&O.rotation.set(U[0],U[1],U[2]),F&&O.scale.set(F[0],F[1],F[2]),O.updateMatrix();const C=O.geometry.clone();C.applyMatrix4(O.matrix),O.geometry=C,O.renderOrder=1/0,O.position.set(0,0,0),O.rotation.set(0,0,0),O.scale.set(1,1,1),le.add(O)}return le};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=ne(w)),this.add(this.gizmo.rotate=ne(R)),this.add(this.gizmo.scale=ne(G)),this.add(this.picker.translate=ne(D)),this.add(this.picker.rotate=ne(Y)),this.add(this.picker.scale=ne(Q)),this.add(this.helper.translate=ne(k)),this.add(this.helper.rotate=ne(V)),this.add(this.helper.scale=ne(K)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class Yo extends l.Mesh{constructor(){super(new l.PlaneGeometry(1e5,1e5,2,2),new l.MeshBasicMaterial({visible:!1,wireframe:!0,side:l.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),J(this,"isTransformControlsPlane",!0),J(this,"type","TransformControlsPlane"),J(this,"unitX",new l.Vector3(1,0,0)),J(this,"unitY",new l.Vector3(0,1,0)),J(this,"unitZ",new l.Vector3(0,0,1)),J(this,"tempVector",new l.Vector3),J(this,"dirVector",new l.Vector3),J(this,"alignVector",new l.Vector3),J(this,"tempMatrix",new l.Matrix4),J(this,"identityQuaternion",new l.Quaternion),J(this,"cameraQuaternion",new l.Quaternion),J(this,"worldPosition",new l.Vector3),J(this,"worldQuaternion",new l.Quaternion),J(this,"eye",new l.Vector3),J(this,"axis",null),J(this,"mode","translate"),J(this,"space","world"),J(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),this.unitX.set(1,0,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0);break}break;case"rotate":default:this.dirVector.set(0,0,0)}this.dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}var Eo=Object.defineProperty,Xo=(o,e,t)=>e in o?Eo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,ke=(o,e,t)=>(Xo(o,typeof e!="symbol"?e+"":e,t),t);const Ut=new l.Euler(0,0,0,"YXZ"),Nt=new l.Vector3,Zo={type:"change"},qo={type:"lock"},Ko={type:"unlock"},fs=Math.PI/2;class tr extends l.EventDispatcher{constructor(e,t){super(),ke(this,"camera"),ke(this,"domElement"),ke(this,"isLocked"),ke(this,"minPolarAngle"),ke(this,"maxPolarAngle"),ke(this,"pointerSpeed"),ke(this,"onMouseMove",n=>{if(!this.domElement||this.isLocked===!1)return;const r=n.movementX||n.mozMovementX||n.webkitMovementX||0,s=n.movementY||n.mozMovementY||n.webkitMovementY||0;Ut.setFromQuaternion(this.camera.quaternion),Ut.y-=r*.002*this.pointerSpeed,Ut.x-=s*.002*this.pointerSpeed,Ut.x=Math.max(fs-this.maxPolarAngle,Math.min(fs-this.minPolarAngle,Ut.x)),this.camera.quaternion.setFromEuler(Ut),this.dispatchEvent(Zo)}),ke(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(qo),this.isLocked=!0):(this.dispatchEvent(Ko),this.isLocked=!1))}),ke(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),ke(this,"connect",n=>{this.domElement=n||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),ke(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),ke(this,"dispose",()=>{this.disconnect()}),ke(this,"getObject",()=>this.camera),ke(this,"direction",new l.Vector3(0,0,-1)),ke(this,"getDirection",n=>n.copy(this.direction).applyQuaternion(this.camera.quaternion)),ke(this,"moveForward",n=>{Nt.setFromMatrixColumn(this.camera.matrix,0),Nt.crossVectors(this.camera.up,Nt),this.camera.position.addScaledVector(Nt,n)}),ke(this,"moveRight",n=>{Nt.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(Nt,n)}),ke(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),ke(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}}var Qo=Object.defineProperty,Jo=(o,e,t)=>e in o?Qo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,pe=(o,e,t)=>(Jo(o,typeof e!="symbol"?e+"":e,t),t);const bn=new l.Ray,ds=new l.Plane,Ho=Math.cos(70*(Math.PI/180)),ps=(o,e)=>(o%e+e)%e;class ms extends l.EventDispatcher{constructor(e,t){super(),pe(this,"object"),pe(this,"domElement"),pe(this,"enabled",!0),pe(this,"target",new l.Vector3),pe(this,"minDistance",0),pe(this,"maxDistance",1/0),pe(this,"minZoom",0),pe(this,"maxZoom",1/0),pe(this,"minPolarAngle",0),pe(this,"maxPolarAngle",Math.PI),pe(this,"minAzimuthAngle",-1/0),pe(this,"maxAzimuthAngle",1/0),pe(this,"enableDamping",!1),pe(this,"dampingFactor",.05),pe(this,"enableZoom",!0),pe(this,"zoomSpeed",1),pe(this,"enableRotate",!0),pe(this,"rotateSpeed",1),pe(this,"enablePan",!0),pe(this,"panSpeed",1),pe(this,"screenSpacePanning",!0),pe(this,"keyPanSpeed",7),pe(this,"zoomToCursor",!1),pe(this,"autoRotate",!1),pe(this,"autoRotateSpeed",2),pe(this,"reverseOrbit",!1),pe(this,"reverseHorizontalOrbit",!1),pe(this,"reverseVerticalOrbit",!1),pe(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),pe(this,"mouseButtons",{LEFT:l.MOUSE.ROTATE,MIDDLE:l.MOUSE.DOLLY,RIGHT:l.MOUSE.PAN}),pe(this,"touches",{ONE:l.TOUCH.ROTATE,TWO:l.TOUCH.DOLLY_PAN}),pe(this,"target0"),pe(this,"position0"),pe(this,"zoom0"),pe(this,"_domElementKeyEvents",null),pe(this,"getPolarAngle"),pe(this,"getAzimuthalAngle"),pe(this,"setPolarAngle"),pe(this,"setAzimuthalAngle"),pe(this,"getDistance"),pe(this,"listenToKeyEvents"),pe(this,"stopListenToKeyEvents"),pe(this,"saveState"),pe(this,"reset"),pe(this,"update"),pe(this,"connect"),pe(this,"dispose"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>f.phi,this.getAzimuthalAngle=()=>f.theta,this.setPolarAngle=q=>{let oe=ps(q,2*Math.PI),ge=f.phi;ge<0&&(ge+=2*Math.PI),oe<0&&(oe+=2*Math.PI);let Me=Math.abs(oe-ge);2*Math.PI-Me<Me&&(oe<ge?oe+=2*Math.PI:ge+=2*Math.PI),d.phi=oe-ge,n.update()},this.setAzimuthalAngle=q=>{let oe=ps(q,2*Math.PI),ge=f.theta;ge<0&&(ge+=2*Math.PI),oe<0&&(oe+=2*Math.PI);let Me=Math.abs(oe-ge);2*Math.PI-Me<Me&&(oe<ge?oe+=2*Math.PI:ge+=2*Math.PI),d.theta=oe-ge,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=q=>{q.addEventListener("keydown",Pt),this._domElementKeyEvents=q},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Pt),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),c=a.NONE},this.update=(()=>{const q=new l.Vector3,oe=new l.Vector3(0,1,0),ge=new l.Quaternion().setFromUnitVectors(e.up,oe),Me=ge.clone().invert(),Be=new l.Vector3,ft=new l.Quaternion,Tt=2*Math.PI;return function(){const Hi=n.object.position;ge.setFromUnitVectors(e.up,oe),Me.copy(ge).invert(),q.copy(Hi).sub(n.target),q.applyQuaternion(ge),f.setFromVector3(q),n.autoRotate&&c===a.NONE&&V(k()),n.enableDamping?(f.theta+=d.theta*n.dampingFactor,f.phi+=d.phi*n.dampingFactor):(f.theta+=d.theta,f.phi+=d.phi);let dt=n.minAzimuthAngle,pt=n.maxAzimuthAngle;isFinite(dt)&&isFinite(pt)&&(dt<-Math.PI?dt+=Tt:dt>Math.PI&&(dt-=Tt),pt<-Math.PI?pt+=Tt:pt>Math.PI&&(pt-=Tt),dt<=pt?f.theta=Math.max(dt,Math.min(pt,f.theta)):f.theta=f.theta>(dt+pt)/2?Math.max(dt,f.theta):Math.min(pt,f.theta)),f.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,f.phi)),f.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(g,n.dampingFactor):n.target.add(g),n.zoomToCursor&&A||n.object.isOrthographicCamera?f.radius=he(f.radius):f.radius=he(f.radius*p),q.setFromSpherical(f),q.applyQuaternion(Me),Hi.copy(n.target).add(q),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(d.theta*=1-n.dampingFactor,d.phi*=1-n.dampingFactor,g.multiplyScalar(1-n.dampingFactor)):(d.set(0,0,0),g.set(0,0,0));let gn=!1;if(n.zoomToCursor&&A){let yn=null;if(n.object instanceof l.PerspectiveCamera&&n.object.isPerspectiveCamera){const vn=q.length();yn=he(vn*p);const En=vn-yn;n.object.position.addScaledVector(T,En),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const vn=new l.Vector3(y.x,y.y,0);vn.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/p)),n.object.updateProjectionMatrix(),gn=!0;const En=new l.Vector3(y.x,y.y,0);En.unproject(n.object),n.object.position.sub(En).add(vn),n.object.updateMatrixWorld(),yn=q.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;yn!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(yn).add(n.object.position):(bn.origin.copy(n.object.position),bn.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(bn.direction))<Ho?e.lookAt(n.target):(ds.setFromNormalAndCoplanarPoint(n.object.up,n.target),bn.intersectPlane(ds,n.target))))}else n.object instanceof l.OrthographicCamera&&n.object.isOrthographicCamera&&(gn=p!==1,gn&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/p)),n.object.updateProjectionMatrix()));return p=1,A=!1,gn||Be.distanceToSquared(n.object.position)>h||8*(1-ft.dot(n.object.quaternion))>h?(n.dispatchEvent(r),Be.copy(n.object.position),ft.copy(n.object.quaternion),gn=!1,!0):!1}})(),this.connect=q=>{q===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),n.domElement=q,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",mn),n.domElement.addEventListener("pointerdown",ue),n.domElement.addEventListener("pointercancel",Te),n.domElement.addEventListener("wheel",Ze,{passive:!0})},this.dispose=()=>{var q,oe,ge,Me,Be,ft;n.domElement&&(n.domElement.style.touchAction="auto"),(q=n.domElement)==null||q.removeEventListener("contextmenu",mn),(oe=n.domElement)==null||oe.removeEventListener("pointerdown",ue),(ge=n.domElement)==null||ge.removeEventListener("pointercancel",Te),(Me=n.domElement)==null||Me.removeEventListener("wheel",Ze),(Be=n.domElement)==null||Be.ownerDocument.removeEventListener("pointermove",ve),(ft=n.domElement)==null||ft.ownerDocument.removeEventListener("pointerup",Oe),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Pt)};const n=this,r={type:"change"},s={type:"start"},i={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=a.NONE;const h=1e-6,f=new l.Spherical,d=new l.Spherical;let p=1;const g=new l.Vector3,x=new l.Vector2,v=new l.Vector2,_=new l.Vector2,m=new l.Vector2,M=new l.Vector2,b=new l.Vector2,S=new l.Vector2,L=new l.Vector2,P=new l.Vector2,T=new l.Vector3,y=new l.Vector2;let A=!1;const w=[],D={};function k(){return 2*Math.PI/60/60*n.autoRotateSpeed}function R(){return Math.pow(.95,n.zoomSpeed)}function V(q){n.reverseOrbit||n.reverseHorizontalOrbit?d.theta+=q:d.theta-=q}function Y(q){n.reverseOrbit||n.reverseVerticalOrbit?d.phi+=q:d.phi-=q}const G=(()=>{const q=new l.Vector3;return function(ge,Me){q.setFromMatrixColumn(Me,0),q.multiplyScalar(-ge),g.add(q)}})(),Q=(()=>{const q=new l.Vector3;return function(ge,Me){n.screenSpacePanning===!0?q.setFromMatrixColumn(Me,1):(q.setFromMatrixColumn(Me,0),q.crossVectors(n.object.up,q)),q.multiplyScalar(ge),g.add(q)}})(),K=(()=>{const q=new l.Vector3;return function(ge,Me){const Be=n.domElement;if(Be&&n.object instanceof l.PerspectiveCamera&&n.object.isPerspectiveCamera){const ft=n.object.position;q.copy(ft).sub(n.target);let Tt=q.length();Tt*=Math.tan(n.object.fov/2*Math.PI/180),G(2*ge*Tt/Be.clientHeight,n.object.matrix),Q(2*Me*Tt/Be.clientHeight,n.object.matrix)}else Be&&n.object instanceof l.OrthographicCamera&&n.object.isOrthographicCamera?(G(ge*(n.object.right-n.object.left)/n.object.zoom/Be.clientWidth,n.object.matrix),Q(Me*(n.object.top-n.object.bottom)/n.object.zoom/Be.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function ne(q){n.object instanceof l.PerspectiveCamera&&n.object.isPerspectiveCamera||n.object instanceof l.OrthographicCamera&&n.object.isOrthographicCamera?p/=q:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ee(q){n.object instanceof l.PerspectiveCamera&&n.object.isPerspectiveCamera||n.object instanceof l.OrthographicCamera&&n.object.isOrthographicCamera?p*=q:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function le(q){if(!n.zoomToCursor||!n.domElement)return;A=!0;const oe=n.domElement.getBoundingClientRect(),ge=q.clientX-oe.left,Me=q.clientY-oe.top,Be=oe.width,ft=oe.height;y.x=ge/Be*2-1,y.y=-(Me/ft)*2+1,T.set(y.x,y.y,1).unproject(n.object).sub(n.object.position).normalize()}function he(q){return Math.max(n.minDistance,Math.min(n.maxDistance,q))}function de(q){x.set(q.clientX,q.clientY)}function O(q){le(q),S.set(q.clientX,q.clientY)}function z(q){m.set(q.clientX,q.clientY)}function U(q){v.set(q.clientX,q.clientY),_.subVectors(v,x).multiplyScalar(n.rotateSpeed);const oe=n.domElement;oe&&(V(2*Math.PI*_.x/oe.clientHeight),Y(2*Math.PI*_.y/oe.clientHeight)),x.copy(v),n.update()}function F(q){L.set(q.clientX,q.clientY),P.subVectors(L,S),P.y>0?ne(R()):P.y<0&&ee(R()),S.copy(L),n.update()}function j(q){M.set(q.clientX,q.clientY),b.subVectors(M,m).multiplyScalar(n.panSpeed),K(b.x,b.y),m.copy(M),n.update()}function C(q){le(q),q.deltaY<0?ee(R()):q.deltaY>0&&ne(R()),n.update()}function I(q){let oe=!1;switch(q.code){case n.keys.UP:K(0,n.keyPanSpeed),oe=!0;break;case n.keys.BOTTOM:K(0,-n.keyPanSpeed),oe=!0;break;case n.keys.LEFT:K(n.keyPanSpeed,0),oe=!0;break;case n.keys.RIGHT:K(-n.keyPanSpeed,0),oe=!0;break}oe&&(q.preventDefault(),n.update())}function B(){if(w.length==1)x.set(w[0].pageX,w[0].pageY);else{const q=.5*(w[0].pageX+w[1].pageX),oe=.5*(w[0].pageY+w[1].pageY);x.set(q,oe)}}function Z(){if(w.length==1)m.set(w[0].pageX,w[0].pageY);else{const q=.5*(w[0].pageX+w[1].pageX),oe=.5*(w[0].pageY+w[1].pageY);m.set(q,oe)}}function X(){const q=w[0].pageX-w[1].pageX,oe=w[0].pageY-w[1].pageY,ge=Math.sqrt(q*q+oe*oe);S.set(0,ge)}function W(){n.enableZoom&&X(),n.enablePan&&Z()}function $(){n.enableZoom&&X(),n.enableRotate&&B()}function re(q){if(w.length==1)v.set(q.pageX,q.pageY);else{const ge=qr(q),Me=.5*(q.pageX+ge.x),Be=.5*(q.pageY+ge.y);v.set(Me,Be)}_.subVectors(v,x).multiplyScalar(n.rotateSpeed);const oe=n.domElement;oe&&(V(2*Math.PI*_.x/oe.clientHeight),Y(2*Math.PI*_.y/oe.clientHeight)),x.copy(v)}function se(q){if(w.length==1)M.set(q.pageX,q.pageY);else{const oe=qr(q),ge=.5*(q.pageX+oe.x),Me=.5*(q.pageY+oe.y);M.set(ge,Me)}b.subVectors(M,m).multiplyScalar(n.panSpeed),K(b.x,b.y),m.copy(M)}function E(q){const oe=qr(q),ge=q.pageX-oe.x,Me=q.pageY-oe.y,Be=Math.sqrt(ge*ge+Me*Me);L.set(0,Be),P.set(0,Math.pow(L.y/S.y,n.zoomSpeed)),ne(P.y),S.copy(L)}function N(q){n.enableZoom&&E(q),n.enablePan&&se(q)}function ae(q){n.enableZoom&&E(q),n.enableRotate&&re(q)}function ue(q){var oe,ge;n.enabled!==!1&&(w.length===0&&((oe=n.domElement)==null||oe.ownerDocument.addEventListener("pointermove",ve),(ge=n.domElement)==null||ge.ownerDocument.addEventListener("pointerup",Oe)),Rn(q),q.pointerType==="touch"?pn(q):He(q))}function ve(q){n.enabled!==!1&&(q.pointerType==="touch"?Zt(q):Ct(q))}function Oe(q){var oe,ge,Me;Wn(q),w.length===0&&((oe=n.domElement)==null||oe.releasePointerCapture(q.pointerId),(ge=n.domElement)==null||ge.ownerDocument.removeEventListener("pointermove",ve),(Me=n.domElement)==null||Me.ownerDocument.removeEventListener("pointerup",Oe)),n.dispatchEvent(i),c=a.NONE}function Te(q){Wn(q)}function He(q){let oe;switch(q.button){case 0:oe=n.mouseButtons.LEFT;break;case 1:oe=n.mouseButtons.MIDDLE;break;case 2:oe=n.mouseButtons.RIGHT;break;default:oe=-1}switch(oe){case l.MOUSE.DOLLY:if(n.enableZoom===!1)return;O(q),c=a.DOLLY;break;case l.MOUSE.ROTATE:if(q.ctrlKey||q.metaKey||q.shiftKey){if(n.enablePan===!1)return;z(q),c=a.PAN}else{if(n.enableRotate===!1)return;de(q),c=a.ROTATE}break;case l.MOUSE.PAN:if(q.ctrlKey||q.metaKey||q.shiftKey){if(n.enableRotate===!1)return;de(q),c=a.ROTATE}else{if(n.enablePan===!1)return;z(q),c=a.PAN}break;default:c=a.NONE}c!==a.NONE&&n.dispatchEvent(s)}function Ct(q){if(n.enabled!==!1)switch(c){case a.ROTATE:if(n.enableRotate===!1)return;U(q);break;case a.DOLLY:if(n.enableZoom===!1)return;F(q);break;case a.PAN:if(n.enablePan===!1)return;j(q);break}}function Ze(q){n.enabled===!1||n.enableZoom===!1||c!==a.NONE&&c!==a.ROTATE||(n.dispatchEvent(s),C(q),n.dispatchEvent(i))}function Pt(q){n.enabled===!1||n.enablePan===!1||I(q)}function pn(q){switch(Yn(q),w.length){case 1:switch(n.touches.ONE){case l.TOUCH.ROTATE:if(n.enableRotate===!1)return;B(),c=a.TOUCH_ROTATE;break;case l.TOUCH.PAN:if(n.enablePan===!1)return;Z(),c=a.TOUCH_PAN;break;default:c=a.NONE}break;case 2:switch(n.touches.TWO){case l.TOUCH.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;W(),c=a.TOUCH_DOLLY_PAN;break;case l.TOUCH.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;$(),c=a.TOUCH_DOLLY_ROTATE;break;default:c=a.NONE}break;default:c=a.NONE}c!==a.NONE&&n.dispatchEvent(s)}function Zt(q){switch(Yn(q),c){case a.TOUCH_ROTATE:if(n.enableRotate===!1)return;re(q),n.update();break;case a.TOUCH_PAN:if(n.enablePan===!1)return;se(q),n.update();break;case a.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;N(q),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;ae(q),n.update();break;default:c=a.NONE}}function mn(q){n.enabled!==!1&&q.preventDefault()}function Rn(q){w.push(q)}function Wn(q){delete D[q.pointerId];for(let oe=0;oe<w.length;oe++)if(w[oe].pointerId==q.pointerId){w.splice(oe,1);return}}function Yn(q){let oe=D[q.pointerId];oe===void 0&&(oe=new l.Vector2,D[q.pointerId]=oe),oe.set(q.pageX,q.pageY)}function qr(q){const oe=q.pointerId===w[0].pointerId?w[1]:w[0];return D[oe.pointerId]}t!==void 0&&this.connect(t),this.update()}}class $o extends ms{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=l.MOUSE.PAN,this.mouseButtons.RIGHT=l.MOUSE.ROTATE,this.touches.ONE=l.TOUCH.PAN,this.touches.TWO=l.TOUCH.DOLLY_ROTATE}}class ea extends l.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new ia(t)}),this.register(function(t){return new da(t)}),this.register(function(t){return new pa(t)}),this.register(function(t){return new ma(t)}),this.register(function(t){return new aa(t)}),this.register(function(t){return new la(t)}),this.register(function(t){return new ca(t)}),this.register(function(t){return new ua(t)}),this.register(function(t){return new sa(t)}),this.register(function(t){return new ha(t)}),this.register(function(t){return new oa(t)}),this.register(function(t){return new fa(t)}),this.register(function(t){return new na(t)}),this.register(function(t){return new ga(t)}),this.register(function(t){return new ya(t)})}load(e,t,n,r){const s=this;let i;this.resourcePath!==""?i=this.resourcePath:this.path!==""?i=this.path:i=l.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const a=function(h){r?r(h):console.error(h),s.manager.itemError(e),s.manager.itemEnd(e)},c=new l.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(h){try{s.parse(h,i,function(f){t(f),s.manager.itemEnd(e)},a)}catch(f){a(f)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let s;const i={},a={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4)))===gs){try{i[we.KHR_BINARY_GLTF]=new va(e)}catch(f){r&&r(f);return}s=JSON.parse(i[we.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.LoaderUtils.decodeText(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Oa(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const f=this.pluginCallbacks[h](c);a[f.name]=f,i[f.name]=!0}if(s.extensionsUsed)for(let h=0;h<s.extensionsUsed.length;++h){const f=s.extensionsUsed[h],d=s.extensionsRequired||[];switch(f){case we.KHR_MATERIALS_UNLIT:i[f]=new ra;break;case we.KHR_DRACO_MESH_COMPRESSION:i[f]=new _a(s,this.dracoLoader);break;case we.KHR_TEXTURE_TRANSFORM:i[f]=new xa;break;case we.KHR_MESH_QUANTIZATION:i[f]=new wa;break;default:d.indexOf(f)>=0&&a[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}c.setExtensions(i),c.setPlugins(a),c.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,s){n.parse(e,t,r,s)})}}function ta(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const we={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class na{constructor(e){this.parser=e,this.name=we.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const s=t.json,c=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let h;const f=new l.Color(16777215);c.color!==void 0&&f.fromArray(c.color);const d=c.range!==void 0?c.range:0;switch(c.type){case"directional":h=new l.DirectionalLight(f),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new l.PointLight(f),h.distance=d;break;case"spot":h=new l.SpotLight(f),h.distance=d,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,h.angle=c.spot.outerConeAngle,h.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return h.position.set(0,0,0),h.decay=2,vt(h,c),c.intensity!==void 0&&(h.intensity=c.intensity),h.name=t.createUniqueName(c.name||"light_"+e),r=Promise.resolve(h),t.cache.add(n,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return n._getNodeRef(t.cache,a,c)})}}class ra{constructor(){this.name=we.KHR_MATERIALS_UNLIT}getMaterialType(){return l.MeshBasicMaterial}extendParams(e,t,n){const r=[];e.color=new l.Color(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const i=s.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}s.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",s.baseColorTexture,3001))}return Promise.all(r)}}class sa{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class ia{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];if(i.clearcoatFactor!==void 0&&(t.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const a=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new l.Vector2(a,a)}return Promise.all(s)}}class oa{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return i.iridescenceFactor!==void 0&&(t.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(t.iridescenceIOR=i.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(s)}}class aa{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new l.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=r.extensions[this.name];return i.sheenColorFactor!==void 0&&t.sheenColor.fromArray(i.sheenColorFactor),i.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",i.sheenColorTexture,3001)),i.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(s)}}class la{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return i.transmissionFactor!==void 0&&(t.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(s)}}class ca{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];t.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||1/0;const a=i.attenuationColor||[1,1,1];return t.attenuationColor=new l.Color(a[0],a[1],a[2]),Promise.all(s)}}class ua{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class ha{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];t.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",i.specularTexture));const a=i.specularColorFactor||[1,1,1];return t.specularColor=new l.Color(a[0],a[1],a[2]),i.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",i.specularColorTexture,3001)),Promise.all(s)}}class fa{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return i.anisotropyStrength!==void 0&&(t.anisotropy=i.anisotropyStrength),i.anisotropyRotation!==void 0&&(t.anisotropyRotation=i.anisotropyRotation),i.anisotropyTexture!==void 0&&s.push(n.assignTexture(t,"anisotropyMap",i.anisotropyTexture)),Promise.all(s)}}class da{constructor(e){this.parser=e,this.name=we.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,i)}}class pa{constructor(e){this.parser=e,this.name=we.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const i=s.extensions[t],a=r.images[i.source];let c=n.textureLoader;if(a.uri){const h=n.options.manager.getHandler(a.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return n.loadTextureImage(e,i.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ma{constructor(e){this.parser=e,this.name=we.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const i=s.extensions[t],a=r.images[i.source];let c=n.textureLoader;if(a.uri){const h=n.options.manager.getHandler(a.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return n.loadTextureImage(e,i.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ga{constructor(e){this.name=we.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const c=r.byteOffset||0,h=r.byteLength||0,f=r.count,d=r.byteStride,p=new Uint8Array(a,c,h);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(f,d,p,r.mode,r.filter).then(function(g){return g.buffer}):i.ready.then(function(){const g=new ArrayBuffer(f*d);return i.decodeGltfBuffer(new Uint8Array(g),f,d,p,r.mode,r.filter),g})})}else return null}}class ya{constructor(e){this.name=we.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=t.meshes[n.mesh];for(const h of r.primitives)if(h.mode!==Ke.TRIANGLES&&h.mode!==Ke.TRIANGLE_STRIP&&h.mode!==Ke.TRIANGLE_FAN&&h.mode!==void 0)return null;const i=n.extensions[this.name].attributes,a=[],c={};for(const h in i)a.push(this.parser.getDependency("accessor",i[h]).then(f=>(c[h]=f,c[h])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(h=>{const f=h.pop(),d=f.isGroup?f.children:[f],p=h[0].count,g=[];for(const x of d){const v=new l.Matrix4,_=new l.Vector3,m=new l.Quaternion,M=new l.Vector3(1,1,1),b=new l.InstancedMesh(x.geometry,x.material,p);for(let S=0;S<p;S++)c.TRANSLATION&&_.fromBufferAttribute(c.TRANSLATION,S),c.ROTATION&&m.fromBufferAttribute(c.ROTATION,S),c.SCALE&&M.fromBufferAttribute(c.SCALE,S),b.setMatrixAt(S,v.compose(_,m,M));for(const S in c)S!=="TRANSLATION"&&S!=="ROTATION"&&S!=="SCALE"&&x.geometry.setAttribute(S,c[S]);l.Object3D.prototype.copy.call(b,x),this.parser.assignFinalMaterial(b),g.push(b)}return f.isGroup?(f.clear(),f.add(...g),f):g[0]}))}}const gs="glTF",Ht=12,ys={JSON:1313821514,BIN:5130562};class va{constructor(e){this.name=we.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Ht);if(this.header={magic:l.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==gs)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Ht,r=new DataView(e,Ht);let s=0;for(;s<n;){const i=r.getUint32(s,!0);s+=4;const a=r.getUint32(s,!0);if(s+=4,a===ys.JSON){const c=new Uint8Array(e,Ht+s,i);this.content=l.LoaderUtils.decodeText(c)}else if(a===ys.BIN){const c=Ht+s;this.body=e.slice(c,c+i)}s+=i}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class _a{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=we.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,a={},c={},h={};for(const f in i){const d=rr[f]||f.toLowerCase();a[d]=i[f]}for(const f in e.attributes){const d=rr[f]||f.toLowerCase();if(i[f]!==void 0){const p=n.accessors[e.attributes[f]],g=Vt[p.componentType];h[d]=g.name,c[d]=p.normalized===!0}}return t.getDependency("bufferView",s).then(function(f){return new Promise(function(d){r.decodeDracoFile(f,function(p){for(const g in p.attributes){const x=p.attributes[g],v=c[g];v!==void 0&&(x.normalized=v)}d(p)},a,h)})})}}class xa{constructor(){this.name=we.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class wa{constructor(){this.name=we.KHR_MESH_QUANTIZATION}}class vs extends l.Interpolant{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let i=0;i!==r;i++)t[i]=n[s+i];return t}interpolate_(e,t,n,r){const s=this.resultBuffer,i=this.sampleValues,a=this.valueSize,c=a*2,h=a*3,f=r-t,d=(n-t)/f,p=d*d,g=p*d,x=e*h,v=x-h,_=-2*g+3*p,m=g-p,M=1-_,b=m-p+d;for(let S=0;S!==a;S++){const L=i[v+S+a],P=i[v+S+c]*f,T=i[x+S+a],y=i[x+S]*f;s[S]=M*L+b*P+_*T+m*y}return s}}const ba=new l.Quaternion;class Ma extends vs{interpolate_(e,t,n,r){const s=super.interpolate_(e,t,n,r);return ba.fromArray(s).normalize().toArray(s),s}}const Ke={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Vt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_s={9728:l.NearestFilter,9729:l.LinearFilter,9984:l.NearestMipmapNearestFilter,9985:l.LinearMipmapNearestFilter,9986:l.NearestMipmapLinearFilter,9987:l.LinearMipmapLinearFilter},xs={33071:l.ClampToEdgeWrapping,33648:l.MirroredRepeatWrapping,10497:l.RepeatWrapping},nr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rr={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Jr>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},yt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Sa={CUBICSPLINE:void 0,LINEAR:l.InterpolateLinear,STEP:l.InterpolateDiscrete},sr={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Aa(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new l.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:l.FrontSide})),o.DefaultMaterial}function It(o,e,t){for(const n in t.extensions)o[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function vt(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ca(o,e,t){let n=!1,r=!1,s=!1;for(let h=0,f=e.length;h<f;h++){const d=e[h];if(d.POSITION!==void 0&&(n=!0),d.NORMAL!==void 0&&(r=!0),d.COLOR_0!==void 0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(o);const i=[],a=[],c=[];for(let h=0,f=e.length;h<f;h++){const d=e[h];if(n){const p=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):o.attributes.position;i.push(p)}if(r){const p=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):o.attributes.normal;a.push(p)}if(s){const p=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):o.attributes.color;c.push(p)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(c)]).then(function(h){const f=h[0],d=h[1],p=h[2];return n&&(o.morphAttributes.position=f),r&&(o.morphAttributes.normal=d),s&&(o.morphAttributes.color=p),o.morphTargetsRelative=!0,o})}function Pa(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)o.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ta(o){let e;const t=o.extensions&&o.extensions[we.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+ir(t.attributes):e=o.indices+":"+ir(o.attributes)+":"+o.mode,o.targets!==void 0)for(let n=0,r=o.targets.length;n<r;n++)e+=":"+ir(o.targets[n]);return e}function ir(o){let e="";const t=Object.keys(o).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+o[t[n]]+";";return e}function or(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ia(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const La=new l.Matrix4;class Oa{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ta,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&s<98?this.textureLoader=new l.TextureLoader(this.options.manager):this.textureLoader=new l.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new l.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(i){const a={scene:i[0][r.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:r.asset,parser:n,userData:{}};It(s,a,r),vt(a,r),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const i=t[r].joints;for(let a=0,c=i.length;a<c;a++)e[i[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const i=e[r];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(n[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),s=(i,a)=>{const c=this.associations.get(i);c!=null&&this.associations.set(a,c);for(const[h,f]of i.children.entries())s(f,a.children[h])};return s(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[we.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,i){n.load(l.LoaderUtils.resolveURL(t.uri,r.path),s,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const i=nr[r.type],a=Vt[r.componentType],c=r.normalized===!0,h=new a(r.count*i);return Promise.resolve(new l.BufferAttribute(h,i,c))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(i){const a=i[0],c=nr[r.type],h=Vt[r.componentType],f=h.BYTES_PER_ELEMENT,d=f*c,p=r.byteOffset||0,g=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,x=r.normalized===!0;let v,_;if(g&&g!==d){const m=Math.floor(p/g),M="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+m+":"+r.count;let b=t.cache.get(M);b||(v=new h(a,m*g,r.count*g/f),b=new l.InterleavedBuffer(v,g/f),t.cache.add(M,b)),_=new l.InterleavedBufferAttribute(b,c,p%g/f,x)}else a===null?v=new h(r.count*c):v=new h(a,p,r.count*c),_=new l.BufferAttribute(v,c,x);if(r.sparse!==void 0){const m=nr.SCALAR,M=Vt[r.sparse.indices.componentType],b=r.sparse.indices.byteOffset||0,S=r.sparse.values.byteOffset||0,L=new M(i[1],b,r.sparse.count*m),P=new h(i[2],S,r.sparse.count*c);a!==null&&(_=new l.BufferAttribute(_.array.slice(),_.itemSize,_.normalized));for(let T=0,y=L.length;T<y;T++){const A=L[T];if(_.setX(A,P[T*c]),c>=2&&_.setY(A,P[T*c+1]),c>=3&&_.setZ(A,P[T*c+2]),c>=4&&_.setW(A,P[T*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return _})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,i=t.images[s];let a=this.textureLoader;if(i.uri){const c=n.manager.getHandler(i.uri);c!==null&&(a=c)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,n){const r=this,s=this.json,i=s.textures[e],a=s.images[t],c=(a.uri||a.bufferView)+":"+i.sampler;if(this.textureCache[c])return this.textureCache[c];const h=this.loadImageSource(t,n).then(function(f){f.flipY=!1,f.name=i.name||a.name||"",f.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(f.name=a.uri);const p=(s.samplers||{})[i.sampler]||{};return f.magFilter=_s[p.magFilter]||l.LinearFilter,f.minFilter=_s[p.minFilter]||l.LinearMipmapLinearFilter,f.wrapS=xs[p.wrapS]||l.RepeatWrapping,f.wrapT=xs[p.wrapT]||l.RepeatWrapping,r.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[c]=h,h}loadImageSource(e,t){const n=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const i=r.images[e],a=self.URL||self.webkitURL;let c=i.uri||"",h=!1;if(i.bufferView!==void 0)c=n.getDependency("bufferView",i.bufferView).then(function(d){h=!0;const p=new Blob([d],{type:i.mimeType});return c=a.createObjectURL(p),c});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(c).then(function(d){return new Promise(function(p,g){let x=p;t.isImageBitmapLoader===!0&&(x=function(v){const _=new l.Texture(v);_.needsUpdate=!0,p(_)}),t.load(l.LoaderUtils.resolveURL(d,s.path),x,void 0,g)})}).then(function(d){return h===!0&&a.revokeObjectURL(c),d.userData.mimeType=i.mimeType||Ia(i.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),d});return this.sourceCache[e]=f,f}assignTexture(e,t,n,r){const s=this;return this.getDependency("texture",n.index).then(function(i){if(!i)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(i=i.clone(),i.channel=n.texCoord),s.extensions[we.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[we.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=s.associations.get(i);i=s.extensions[we.KHR_TEXTURE_TRANSFORM].extendTexture(i,a),s.associations.set(i,c)}}return r!==void 0&&("colorSpace"in i?i.colorSpace=r===3001?"srgb":"srgb-linear":i.encoding=r),e[t]=i,i})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,i=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new l.PointsMaterial,l.Material.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(a,c)),n=c}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new l.LineBasicMaterial,l.Material.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(a,c)),n=c}if(r||s||i){let a="ClonedMaterial:"+n.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),i&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=n.clone(),s&&(c.vertexColors=!0),i&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(n))),n=c}e.material=n}getMaterialType(){return l.MeshStandardMaterial}loadMaterial(e){const t=this,n=this.json,r=this.extensions,s=n.materials[e];let i;const a={},c=s.extensions||{},h=[];if(c[we.KHR_MATERIALS_UNLIT]){const d=r[we.KHR_MATERIALS_UNLIT];i=d.getMaterialType(),h.push(d.extendParams(a,s,t))}else{const d=s.pbrMetallicRoughness||{};if(a.color=new l.Color(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const p=d.baseColorFactor;a.color.fromArray(p),a.opacity=p[3]}d.baseColorTexture!==void 0&&h.push(t.assignTexture(a,"map",d.baseColorTexture,3001)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),h.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),i=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=l.DoubleSide);const f=s.alphaMode||sr.OPAQUE;if(f===sr.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,f===sr.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&i!==l.MeshBasicMaterial&&(h.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new l.Vector2(1,1),s.normalTexture.scale!==void 0)){const d=s.normalTexture.scale;a.normalScale.set(d,d)}return s.occlusionTexture!==void 0&&i!==l.MeshBasicMaterial&&(h.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&i!==l.MeshBasicMaterial&&(a.emissive=new l.Color().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&i!==l.MeshBasicMaterial&&h.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,3001)),Promise.all(h).then(function(){const d=new i(a);return s.name&&(d.name=s.name),vt(d,s),t.associations.set(d,{materials:e}),s.extensions&&It(r,d,s),d})}createUniqueName(e){const t=l.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function s(a){return n[we.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return ws(c,a,t)})}const i=[];for(let a=0,c=e.length;a<c;a++){const h=e[a],f=Ta(h),d=r[f];if(d)i.push(d.promise);else{let p;h.extensions&&h.extensions[we.KHR_DRACO_MESH_COMPRESSION]?p=s(h):p=ws(new l.BufferGeometry,h,t),r[f]={primitive:h,promise:p},i.push(p)}}return Promise.all(i)}loadMesh(e){const t=this,n=this.json,r=this.extensions,s=n.meshes[e],i=s.primitives,a=[];for(let c=0,h=i.length;c<h;c++){const f=i[c].material===void 0?Aa(this.cache):this.getDependency("material",i[c].material);a.push(f)}return a.push(t.loadGeometries(i)),Promise.all(a).then(function(c){const h=c.slice(0,c.length-1),f=c[c.length-1],d=[];for(let g=0,x=f.length;g<x;g++){const v=f[g],_=i[g];let m;const M=h[g];if(_.mode===Ke.TRIANGLES||_.mode===Ke.TRIANGLE_STRIP||_.mode===Ke.TRIANGLE_FAN||_.mode===void 0)m=s.isSkinnedMesh===!0?new l.SkinnedMesh(v,M):new l.Mesh(v,M),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),_.mode===Ke.TRIANGLE_STRIP?m.geometry=Qr(m.geometry,l.TriangleStripDrawMode):_.mode===Ke.TRIANGLE_FAN&&(m.geometry=Qr(m.geometry,l.TriangleFanDrawMode));else if(_.mode===Ke.LINES)m=new l.LineSegments(v,M);else if(_.mode===Ke.LINE_STRIP)m=new l.Line(v,M);else if(_.mode===Ke.LINE_LOOP)m=new l.LineLoop(v,M);else if(_.mode===Ke.POINTS)m=new l.Points(v,M);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+_.mode);Object.keys(m.geometry.morphAttributes).length>0&&Pa(m,s),m.name=t.createUniqueName(s.name||"mesh_"+e),vt(m,s),_.extensions&&It(r,m,_),t.assignFinalMaterial(m),d.push(m)}for(let g=0,x=d.length;g<x;g++)t.associations.set(d[g],{meshes:e,primitives:g});if(d.length===1)return s.extensions&&It(r,d[0],s),d[0];const p=new l.Group;s.extensions&&It(r,p,s),t.associations.set(p,{meshes:e});for(let g=0,x=d.length;g<x;g++)p.add(d[g]);return p})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new l.PerspectiveCamera(l.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new l.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),vt(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,s=t.joints.length;r<s;r++)n.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const s=r.pop(),i=r,a=[],c=[];for(let h=0,f=i.length;h<f;h++){const d=i[h];if(d){a.push(d);const p=new l.Matrix4;s!==null&&p.fromArray(s.array,h*16),c.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new l.Skeleton(a,c)})}loadAnimation(e){const n=this.json.animations[e],r=n.name?n.name:"animation_"+e,s=[],i=[],a=[],c=[],h=[];for(let f=0,d=n.channels.length;f<d;f++){const p=n.channels[f],g=n.samplers[p.sampler],x=p.target,v=x.node,_=n.parameters!==void 0?n.parameters[g.input]:g.input,m=n.parameters!==void 0?n.parameters[g.output]:g.output;x.node!==void 0&&(s.push(this.getDependency("node",v)),i.push(this.getDependency("accessor",_)),a.push(this.getDependency("accessor",m)),c.push(g),h.push(x))}return Promise.all([Promise.all(s),Promise.all(i),Promise.all(a),Promise.all(c),Promise.all(h)]).then(function(f){const d=f[0],p=f[1],g=f[2],x=f[3],v=f[4],_=[];for(let m=0,M=d.length;m<M;m++){const b=d[m],S=p[m],L=g[m],P=x[m],T=v[m];if(b===void 0)continue;b.updateMatrix();let y;switch(yt[T.path]){case yt.weights:y=l.NumberKeyframeTrack;break;case yt.rotation:y=l.QuaternionKeyframeTrack;break;case yt.position:case yt.scale:default:y=l.VectorKeyframeTrack;break}const A=b.name?b.name:b.uuid,w=P.interpolation!==void 0?Sa[P.interpolation]:l.InterpolateLinear,D=[];yt[T.path]===yt.weights?b.traverse(function(R){R.morphTargetInfluences&&D.push(R.name?R.name:R.uuid)}):D.push(A);let k=L.array;if(L.normalized){const R=or(k.constructor),V=new Float32Array(k.length);for(let Y=0,G=k.length;Y<G;Y++)V[Y]=k[Y]*R;k=V}for(let R=0,V=D.length;R<V;R++){const Y=new y(D[R]+"."+yt[T.path],S.array,k,w);P.interpolation==="CUBICSPLINE"&&(Y.createInterpolant=function(Q){const K=this instanceof l.QuaternionKeyframeTrack?Ma:vs;return new K(this.times,this.values,this.getValueSize()/3,Q)},Y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),_.push(Y)}}return new l.AnimationClip(r,void 0,_)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(s){const i=n._getNodeRef(n.meshCache,r.mesh,s);return r.weights!==void 0&&i.traverse(function(a){if(a.isMesh)for(let c=0,h=r.weights.length;c<h;c++)a.morphTargetInfluences[c]=r.weights[c]}),i})}loadNode(e){const t=this.json,n=this,r=t.nodes[e],s=n._loadNodeShallow(e),i=[],a=r.children||[];for(let h=0,f=a.length;h<f;h++)i.push(n.getDependency("node",a[h]));const c=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([s,Promise.all(i),c]).then(function(h){const f=h[0],d=h[1],p=h[2];p!==null&&f.traverse(function(g){g.isSkinnedMesh&&g.bind(p,La)});for(let g=0,x=d.length;g<x;g++)f.add(d[g]);return f})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],i=s.name?r.createUniqueName(s.name):"",a=[],c=r._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return c&&a.push(c),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(h){return r._getNodeRef(r.cameraCache,s.camera,h)})),r._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){a.push(h)}),this.nodeCache[e]=Promise.all(a).then(function(h){let f;if(s.isBone===!0?f=new l.Bone:h.length>1?f=new l.Group:h.length===1?f=h[0]:f=new l.Object3D,f!==h[0])for(let d=0,p=h.length;d<p;d++)f.add(h[d]);if(s.name&&(f.userData.name=s.name,f.name=i),vt(f,s),s.extensions&&It(n,f,s),s.matrix!==void 0){const d=new l.Matrix4;d.fromArray(s.matrix),f.applyMatrix4(d)}else s.translation!==void 0&&f.position.fromArray(s.translation),s.rotation!==void 0&&f.quaternion.fromArray(s.rotation),s.scale!==void 0&&f.scale.fromArray(s.scale);return r.associations.has(f)||r.associations.set(f,{}),r.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,s=new l.Group;n.name&&(s.name=r.createUniqueName(n.name)),vt(s,n),n.extensions&&It(t,s,n);const i=n.nodes||[],a=[];for(let c=0,h=i.length;c<h;c++)a.push(r.getDependency("node",i[c]));return Promise.all(a).then(function(c){for(let f=0,d=c.length;f<d;f++)s.add(c[f]);const h=f=>{const d=new Map;for(const[p,g]of r.associations)(p instanceof l.Material||p instanceof l.Texture)&&d.set(p,g);return f.traverse(p=>{const g=r.associations.get(p);g!=null&&d.set(p,g)}),d};return r.associations=h(s),s})}}function Da(o,e,t){const n=e.attributes,r=new l.Box3;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],c=a.min,h=a.max;if(c!==void 0&&h!==void 0){if(r.set(new l.Vector3(c[0],c[1],c[2]),new l.Vector3(h[0],h[1],h[2])),a.normalized){const f=or(Vt[a.componentType]);r.min.multiplyScalar(f),r.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new l.Vector3,c=new l.Vector3;for(let h=0,f=s.length;h<f;h++){const d=s[h];if(d.POSITION!==void 0){const p=t.json.accessors[d.POSITION],g=p.min,x=p.max;if(g!==void 0&&x!==void 0){if(c.setX(Math.max(Math.abs(g[0]),Math.abs(x[0]))),c.setY(Math.max(Math.abs(g[1]),Math.abs(x[1]))),c.setZ(Math.max(Math.abs(g[2]),Math.abs(x[2]))),p.normalized){const v=or(Vt[p.componentType]);c.multiplyScalar(v)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}o.boundingBox=r;const i=new l.Sphere;r.getCenter(i.center),i.radius=r.min.distanceTo(r.max)/2,o.boundingSphere=i}function ws(o,e,t){const n=e.attributes,r=[];function s(i,a){return t.getDependency("accessor",i).then(function(c){o.setAttribute(a,c)})}for(const i in n){const a=rr[i]||i.toLowerCase();a in o.attributes||r.push(s(n[i],a))}if(e.indices!==void 0&&!o.index){const i=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});r.push(i)}return vt(o,e),Da(o,e,t),Promise.all(r).then(function(){return e.targets!==void 0?Ca(o,e.targets,t):o})}const $t=new l.Vector3;function Qe(o,e,t,n,r,s){const i=2*Math.PI*r/4,a=Math.max(s-2*r,0),c=Math.PI/4;$t.copy(e),$t[n]=0,$t.normalize();const h=.5*i/(i+a),f=1-$t.angleTo(o)/c;return Math.sign($t[t])===1?f*h:a/(i+a)+h+h*(1-f)}class ka extends l.BoxGeometry{constructor(e=1,t=1,n=1,r=2,s=.1){if(r=r*2+1,s=Math.min(e/2,t/2,n/2,s),super(1,1,1,r,r,r),r===1)return;const i=this.toNonIndexed();this.index=null,this.attributes.position=i.attributes.position,this.attributes.normal=i.attributes.normal,this.attributes.uv=i.attributes.uv;const a=new l.Vector3,c=new l.Vector3,h=new l.Vector3(e,t,n).divideScalar(2).subScalar(s),f=this.attributes.position.array,d=this.attributes.normal.array,p=this.attributes.uv.array,g=f.length/6,x=new l.Vector3,v=.5/r;for(let _=0,m=0;_<f.length;_+=3,m+=2)switch(a.fromArray(f,_),c.copy(a),c.x-=Math.sign(c.x)*v,c.y-=Math.sign(c.y)*v,c.z-=Math.sign(c.z)*v,c.normalize(),f[_+0]=h.x*Math.sign(a.x)+c.x*s,f[_+1]=h.y*Math.sign(a.y)+c.y*s,f[_+2]=h.z*Math.sign(a.z)+c.z*s,d[_+0]=c.x,d[_+1]=c.y,d[_+2]=c.z,Math.floor(_/g)){case 0:x.set(1,0,0),p[m+0]=Qe(x,c,"z","y",s,n),p[m+1]=1-Qe(x,c,"y","z",s,t);break;case 1:x.set(-1,0,0),p[m+0]=1-Qe(x,c,"z","y",s,n),p[m+1]=1-Qe(x,c,"y","z",s,t);break;case 2:x.set(0,1,0),p[m+0]=1-Qe(x,c,"x","z",s,e),p[m+1]=Qe(x,c,"z","x",s,n);break;case 3:x.set(0,-1,0),p[m+0]=1-Qe(x,c,"x","z",s,e),p[m+1]=1-Qe(x,c,"z","x",s,n);break;case 4:x.set(0,0,1),p[m+0]=1-Qe(x,c,"x","y",s,e),p[m+1]=1-Qe(x,c,"y","x",s,t);break;case 5:x.set(0,0,-1),p[m+0]=Qe(x,c,"x","y",s,e),p[m+1]=1-Qe(x,c,"y","x",s,t);break}}}class bs extends l.ExtrudeGeometry{constructor(e,t={}){const{bevelEnabled:n=!1,bevelSize:r=8,bevelThickness:s=10,font:i,height:a=50,size:c=100,lineHeight:h=1,letterSpacing:f=0,...d}=t;if(i===void 0)super();else{const p=i.generateShapes(e,c,{lineHeight:h,letterSpacing:f});super(p,{...d,bevelEnabled:n,bevelSize:r,bevelThickness:s,depth:a})}this.type="TextGeometry"}}const Ba={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},Fa={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};function Ms(o,e,t){const n=t.length-o-1;if(e>=t[n])return n-1;if(e<=t[o])return o;let r=o,s=n,i=Math.floor((r+s)/2);for(;e<t[i]||e>=t[i+1];)e<t[i]?s=i:r=i,i=Math.floor((r+s)/2);return i}function Ua(o,e,t,n){const r=[],s=[],i=[];r[0]=1;for(let a=1;a<=t;++a){s[a]=e-n[o+1-a],i[a]=n[o+a]-e;let c=0;for(let h=0;h<a;++h){const f=i[h+1],d=s[a-h],p=r[h]/(f+d);r[h]=c+f*p,c=d*p}r[a]=c}return r}function Na(o,e,t,n){const r=Ms(o,n,e),s=Ua(r,n,o,e),i=new l.Vector4(0,0,0,0);for(let a=0;a<=o;++a){const c=t[r-o+a],h=s[a],f=c.w*h;i.x+=c.x*f,i.y+=c.y*f,i.z+=c.z*f,i.w+=c.w*h}return i}function Va(o,e,t,n,r){const s=[];for(let d=0;d<=t;++d)s[d]=0;const i=[];for(let d=0;d<=n;++d)i[d]=s.slice(0);const a=[];for(let d=0;d<=t;++d)a[d]=s.slice(0);a[0][0]=1;const c=s.slice(0),h=s.slice(0);for(let d=1;d<=t;++d){c[d]=e-r[o+1-d],h[d]=r[o+d]-e;let p=0;for(let g=0;g<d;++g){const x=h[g+1],v=c[d-g];a[d][g]=x+v;const _=a[g][d-1]/a[d][g];a[g][d]=p+x*_,p=v*_}a[d][d]=p}for(let d=0;d<=t;++d)i[0][d]=a[d][t];for(let d=0;d<=t;++d){let p=0,g=1;const x=[];for(let v=0;v<=t;++v)x[v]=s.slice(0);x[0][0]=1;for(let v=1;v<=n;++v){let _=0;const m=d-v,M=t-v;d>=v&&(x[g][0]=x[p][0]/a[M+1][m],_=x[g][0]*a[m][M]);const b=m>=-1?1:-m,S=d-1<=M?v-1:t-d;for(let P=b;P<=S;++P)x[g][P]=(x[p][P]-x[p][P-1])/a[M+1][m+P],_+=x[g][P]*a[m+P][M];d<=M&&(x[g][v]=-x[p][v-1]/a[M+1][d],_+=x[g][v]*a[d][M]),i[v][d]=_;const L=p;p=g,g=L}}let f=t;for(let d=1;d<=n;++d){for(let p=0;p<=t;++p)i[d][p]*=f;f*=t-d}return i}function za(o,e,t,n,r){const s=r<o?r:o,i=[],a=Ms(o,n,e),c=Va(a,n,o,s,e),h=[];for(let f=0;f<t.length;++f){const d=t[f].clone(),p=d.w;d.x*=p,d.y*=p,d.z*=p,h[f]=d}for(let f=0;f<=s;++f){const d=h[a-o].clone().multiplyScalar(c[f][0]);for(let p=1;p<=o;++p)d.add(h[a-o+p].clone().multiplyScalar(c[f][p]));i[f]=d}for(let f=s+1;f<=r+1;++f)i[f]=new l.Vector4(0,0,0);return i}function Ga(o,e){let t=1;for(let r=2;r<=o;++r)t*=r;let n=1;for(let r=2;r<=e;++r)n*=r;for(let r=2;r<=o-e;++r)n*=r;return t/n}function ja(o){const e=o.length,t=[],n=[];for(let s=0;s<e;++s){const i=o[s];t[s]=new l.Vector3(i.x,i.y,i.z),n[s]=i.w}const r=[];for(let s=0;s<e;++s){const i=t[s].clone();for(let a=1;a<=s;++a)i.sub(r[s-a].clone().multiplyScalar(Ga(s,a)*n[a]));r[s]=i.divideScalar(n[0])}return r}function Ra(o,e,t,n,r){const s=za(o,e,t,n,r);return ja(s)}class Ss extends l.Curve{constructor(e,t,n,r,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let i=0;i<n.length;++i){const a=n[i];this.controlPoints[i]=new l.Vector4(a.x,a.y,a.z,a.w)}}getPoint(e,t){const n=t||new l.Vector3,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=Na(this.degree,this.knots,this.controlPoints,r);return s.w!=1&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(e,t){const n=t||new l.Vector3,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=Ra(this.degree,this.knots,this.controlPoints,r,1);return n.copy(s[1]).normalize(),n}}let _e,De,je;class Wa extends l.Loader{constructor(e){super(e)}load(e,t,n,r){const s=this,i=s.path===""?l.LoaderUtils.extractUrlBase(e):s.path,a=new l.FileLoader(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(c){try{t(s.parse(c,i))}catch(h){r?r(h):console.error(h),s.manager.itemError(e)}},n,r)}parse(e,t){if(Ka(e))_e=new qa().parse(e);else{const r=Ls(e);if(!Qa(r))throw new Error("THREE.FBXLoader: Unknown format.");if(Ps(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Ps(r));_e=new Za().parse(r)}const n=new l.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Ya(n,this.manager).parse(_e)}}class Ya{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){De=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),s=new Ea().parse(r);return this.parseScene(r,s,n),je}parseConnections(){const e=new Map;return"Connections"in _e&&_e.Connections.connections.forEach(function(n){const r=n[0],s=n[1],i=n[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:s,relationship:i};e.get(r).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const c={ID:r,relationship:i};e.get(s).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in _e.Objects){const n=_e.Objects.Video;for(const r in n){const s=n[r],i=parseInt(r);if(e[i]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,c=typeof s.Content=="string"&&s.Content!=="";if(a||c){const h=this.parseImage(n[r]);t[s.RelativeFilename||s.Filename]=h}}}}for(const n in e){const r=e[n];t[r]!==void 0?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const i=new Uint8Array(t);return window.URL.createObjectURL(new Blob([i],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in _e.Objects){const n=_e.Objects.Texture;for(const r in n){const s=this.parseTexture(n[r],e);t.set(parseInt(r),s)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,i=r!==void 0?r.value:0,a=s!==void 0?s.value:0;if(n.wrapS=i===0?l.RepeatWrapping:l.ClampToEdgeWrapping,n.wrapT=a===0?l.RepeatWrapping:l.ClampToEdgeWrapping,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,s=De.get(e.id).children;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(n=t[s[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let i;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new l.Texture):(c.setPath(this.textureLoader.path),i=c.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new l.Texture):i=this.textureLoader.load(n);return this.textureLoader.setPath(r),i}parseMaterials(e){const t=new Map;if("Material"in _e.Objects){const n=_e.Objects.Material;for(const r in n){const s=this.parseMaterial(n[r],e);s!==null&&t.set(parseInt(r),s)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!De.has(n))return null;const i=this.parseParameters(e,t,n);let a;switch(s.toLowerCase()){case"phong":a=new l.MeshPhongMaterial;break;case"lambert":a=new l.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new l.MeshPhongMaterial;break}return a.setValues(i),a.name=r,a}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new l.Color().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=new l.Color().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new l.Color().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=new l.Color().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new l.Color().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new l.Color().fromArray(e.SpecularColor.value));const s=this;return De.get(n).children.forEach(function(i){const a=i.relationship;switch(a){case"Bump":r.bumpMap=s.getTexture(t,i.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(t,i.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(t,i.ID),r.map!==void 0&&("colorSpace"in r.map?r.map.colorSpace="srgb":r.map.encoding=3001);break;case"DisplacementColor":r.displacementMap=s.getTexture(t,i.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(t,i.ID),r.emissiveMap!==void 0&&("colorSpace"in r.emissiveMap?r.emissiveMap.colorSpace="srgb":r.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(t,i.ID);break;case"ReflectionColor":r.envMap=s.getTexture(t,i.ID),r.envMap!==void 0&&(r.envMap.mapping=l.EquirectangularReflectionMapping,"colorSpace"in r.envMap?r.envMap.colorSpace="srgb":r.envMap.encoding=3001);break;case"SpecularColor":r.specularMap=s.getTexture(t,i.ID),r.specularMap!==void 0&&("colorSpace"in r.specularMap?r.specularMap.colorSpace="srgb":r.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(t,i.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),r}getTexture(e,t){return"LayeredTexture"in _e.Objects&&t in _e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=De.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in _e.Objects){const n=_e.Objects.Deformer;for(const r in n){const s=n[r],i=De.get(parseInt(r));if(s.attrType==="Skin"){const a=this.parseSkeleton(i,n);a.ID=r,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=i.parents[0].ID,e[r]=a}else if(s.attrType==="BlendShape"){const a={id:r};a.rawTargets=this.parseMorphTargets(i,n),a.id=r,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(r){const s=t[r.ID];if(s.attrType!=="Cluster")return;const i={ID:r.ID,indices:[],weights:[],transformLink:new l.Matrix4().fromArray(s.TransformLink.a)};"Indexes"in s&&(i.indices=s.Indexes.a,i.weights=s.Weights.a),n.push(i)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const s=e.children[r],i=t[s.ID],a={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if(i.attrType!=="BlendShapeChannel")return;a.geoID=De.get(parseInt(s.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){je=new l.Group;const r=this.parseModels(e.skeletons,t,n),s=_e.Objects.Model,i=this;r.forEach(function(c){const h=s[c.ID];i.setLookAtProperties(c,h),De.get(c.ID).parents.forEach(function(d){const p=r.get(d.ID);p!==void 0&&p.add(c)}),c.parent===null&&je.add(c)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),je.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const h=Ts(c.userData.transformData);c.applyMatrix4(h),c.updateWorldMatrix()}});const a=new Xa().parse();je.children.length===1&&je.children[0].isGroup&&(je.children[0].animations=a,je=je.children[0]),je.animations=a}parseModels(e,t,n){const r=new Map,s=_e.Objects.Model;for(const i in s){const a=parseInt(i),c=s[i],h=De.get(a);let f=this.buildSkeleton(h,e,a,c.attrName);if(!f){switch(c.attrType){case"Camera":f=this.createCamera(h);break;case"Light":f=this.createLight(h);break;case"Mesh":f=this.createMesh(h,t,n);break;case"NurbsCurve":f=this.createCurve(h,t);break;case"LimbNode":case"Root":f=new l.Bone;break;case"Null":default:f=new l.Group;break}f.name=c.attrName?l.PropertyBinding.sanitizeNodeName(c.attrName):"",f.ID=a}this.getTransformData(f,c),r.set(a,f)}return r}buildSkeleton(e,t,n,r){let s=null;return e.parents.forEach(function(i){for(const a in t){const c=t[a];c.rawBones.forEach(function(h,f){if(h.ID===i.ID){const d=s;s=new l.Bone,s.matrixWorld.copy(h.transformLink),s.name=r?l.PropertyBinding.sanitizeNodeName(r):"",s.ID=n,c.bones[f]=s,d!==null&&s.add(d)}})}}),s}createCamera(e){let t,n;if(e.children.forEach(function(r){const s=_e.Objects.NodeAttribute[r.ID];s!==void 0&&(n=s)}),n===void 0)t=new l.Object3D;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let s=1;n.NearPlane!==void 0&&(s=n.NearPlane.value/1e3);let i=1e3;n.FarPlane!==void 0&&(i=n.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,c=n.AspectHeight.value);const h=a/c;let f=45;n.FieldOfView!==void 0&&(f=n.FieldOfView.value);const d=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new l.PerspectiveCamera(f,h,s,i),d!==null&&t.setFocalLength(d);break;case 1:t=new l.OrthographicCamera(-a/2,a/2,c/2,-c/2,s,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new l.Object3D;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(r){const s=_e.Objects.NodeAttribute[r.ID];s!==void 0&&(n=s)}),n===void 0)t=new l.Object3D;else{let r;n.LightType===void 0?r=0:r=n.LightType.value;let s=16777215;n.Color!==void 0&&(s=new l.Color().fromArray(n.Color.value));let i=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(i=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const c=1;switch(r){case 0:t=new l.PointLight(s,i,a,c);break;case 1:t=new l.DirectionalLight(s,i);break;case 2:let h=Math.PI/3;n.InnerAngle!==void 0&&(h=l.MathUtils.degToRad(n.InnerAngle.value));let f=0;n.OuterAngle!==void 0&&(f=l.MathUtils.degToRad(n.OuterAngle.value),f=Math.max(f,1)),t=new l.SpotLight(s,i,a,h,f,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new l.PointLight(s,i);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,s=null,i=null;const a=[];return e.children.forEach(function(c){t.has(c.ID)&&(s=t.get(c.ID)),n.has(c.ID)&&a.push(n.get(c.ID))}),a.length>1?i=a:a.length>0?i=a[0]:(i=new l.MeshPhongMaterial({color:13421772}),a.push(i)),"color"in s.attributes&&a.forEach(function(c){c.vertexColors=!0}),s.FBX_Deformer?(r=new l.SkinnedMesh(s,i),r.normalizeSkinWeights()):r=new l.Mesh(s,i),r}createCurve(e,t){const n=e.children.reduce(function(s,i){return t.has(i.ID)&&(s=t.get(i.ID)),s},null),r=new l.LineBasicMaterial({color:3342591,linewidth:1});return new l.Line(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=Is(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&De.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=_e.Objects.Model[r.ID];if("Lcl_Translation"in s){const i=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(i),je.add(e.target)):e.lookAt(new l.Vector3().fromArray(i))}}})}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const s in e){const i=e[s];De.get(parseInt(i.ID)).parents.forEach(function(c){if(t.has(c.ID)){const h=c.ID;De.get(h).parents.forEach(function(d){n.has(d.ID)&&n.get(d.ID).bind(new l.Skeleton(i.bones),r[d.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in _e.Objects){const t=_e.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(s){e[s.Node]=new l.Matrix4().fromArray(s.Matrix.a)}):e[r.Node]=new l.Matrix4().fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in _e&&"AmbientColor"in _e.GlobalSettings){const e=_e.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(t!==0||n!==0||r!==0){const s=new l.Color(t,n,r);je.add(new l.AmbientLight(s,1))}}}}class Ea{parse(e){const t=new Map;if("Geometry"in _e.Objects){const n=_e.Objects.Geometry;for(const r in n){const s=De.get(parseInt(r)),i=this.parseGeometry(s,n[r],e);t.set(parseInt(r),i)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,s=[],i=e.parents.map(function(d){return _e.Objects.Model[d.ID]});if(i.length===0)return;const a=e.children.reduce(function(d,p){return r[p.ID]!==void 0&&(d=r[p.ID]),d},null);e.children.forEach(function(d){n.morphTargets[d.ID]!==void 0&&s.push(n.morphTargets[d.ID])});const c=i[0],h={};"RotationOrder"in c&&(h.eulerOrder=Is(c.RotationOrder.value)),"InheritType"in c&&(h.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(h.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(h.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(h.scale=c.GeometricScaling.value);const f=Ts(h);return this.genGeometry(t,a,s,f)}genGeometry(e,t,n,r){const s=new l.BufferGeometry;e.attrName&&(s.name=e.attrName);const i=this.parseGeoNode(e,t),a=this.genBuffers(i),c=new l.Float32BufferAttribute(a.vertex,3);if(c.applyMatrix4(r),s.setAttribute("position",c),a.colors.length>0&&s.setAttribute("color",new l.Float32BufferAttribute(a.colors,3)),t&&(s.setAttribute("skinIndex",new l.Uint16BufferAttribute(a.weightsIndices,4)),s.setAttribute("skinWeight",new l.Float32BufferAttribute(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const h=new l.Matrix3().getNormalMatrix(r),f=new l.Float32BufferAttribute(a.normal,3);f.applyNormalMatrix(h),s.setAttribute("normal",f)}if(a.uvs.forEach(function(h,f){let d="uv"+(f+1).toString();f===0&&(d="uv"),s.setAttribute(d,new l.Float32BufferAttribute(a.uvs[f],2))}),i.material&&i.material.mappingType!=="AllSame"){let h=a.materialIndex[0],f=0;if(a.materialIndex.forEach(function(d,p){d!==h&&(s.addGroup(f,p-f,h),h=d,f=p)}),s.groups.length>0){const d=s.groups[s.groups.length-1],p=d.start+d.count;p!==a.materialIndex.length&&s.addGroup(p,a.materialIndex.length-p,h)}s.groups.length===0&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,n,r),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,s){r.indices.forEach(function(i,a){n.weightTable[i]===void 0&&(n.weightTable[i]=[]),n.weightTable[i].push({id:s,weight:r.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,s=!1,i=[],a=[],c=[],h=[],f=[],d=[];const p=this;return e.vertexIndices.forEach(function(g,x){let v,_=!1;g<0&&(g=g^-1,_=!0);let m=[],M=[];if(i.push(g*3,g*3+1,g*3+2),e.color){const b=Mn(x,n,g,e.color);c.push(b[0],b[1],b[2])}if(e.skeleton){if(e.weightTable[g]!==void 0&&e.weightTable[g].forEach(function(b){M.push(b.weight),m.push(b.id)}),M.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const b=[0,0,0,0],S=[0,0,0,0];M.forEach(function(L,P){let T=L,y=m[P];S.forEach(function(A,w,D){if(T>A){D[w]=T,T=A;const k=b[w];b[w]=y,y=k}})}),m=b,M=S}for(;M.length<4;)M.push(0),m.push(0);for(let b=0;b<4;++b)f.push(M[b]),d.push(m[b])}if(e.normal){const b=Mn(x,n,g,e.normal);a.push(b[0],b[1],b[2])}e.material&&e.material.mappingType!=="AllSame"&&(v=Mn(x,n,g,e.material)[0]),e.uv&&e.uv.forEach(function(b,S){const L=Mn(x,n,g,b);h[S]===void 0&&(h[S]=[]),h[S].push(L[0]),h[S].push(L[1])}),r++,_&&(p.genFace(t,e,i,v,a,c,h,f,d,r),n++,r=0,i=[],a=[],c=[],h=[],f=[],d=[])}),t}genFace(e,t,n,r,s,i,a,c,h,f){for(let d=2;d<f;d++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(d-1)*3]]),e.vertex.push(t.vertexPositions[n[(d-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(d-1)*3+2]]),e.vertex.push(t.vertexPositions[n[d*3]]),e.vertex.push(t.vertexPositions[n[d*3+1]]),e.vertex.push(t.vertexPositions[n[d*3+2]]),t.skeleton&&(e.vertexWeights.push(c[0]),e.vertexWeights.push(c[1]),e.vertexWeights.push(c[2]),e.vertexWeights.push(c[3]),e.vertexWeights.push(c[(d-1)*4]),e.vertexWeights.push(c[(d-1)*4+1]),e.vertexWeights.push(c[(d-1)*4+2]),e.vertexWeights.push(c[(d-1)*4+3]),e.vertexWeights.push(c[d*4]),e.vertexWeights.push(c[d*4+1]),e.vertexWeights.push(c[d*4+2]),e.vertexWeights.push(c[d*4+3]),e.weightsIndices.push(h[0]),e.weightsIndices.push(h[1]),e.weightsIndices.push(h[2]),e.weightsIndices.push(h[3]),e.weightsIndices.push(h[(d-1)*4]),e.weightsIndices.push(h[(d-1)*4+1]),e.weightsIndices.push(h[(d-1)*4+2]),e.weightsIndices.push(h[(d-1)*4+3]),e.weightsIndices.push(h[d*4]),e.weightsIndices.push(h[d*4+1]),e.weightsIndices.push(h[d*4+2]),e.weightsIndices.push(h[d*4+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[(d-1)*3]),e.colors.push(i[(d-1)*3+1]),e.colors.push(i[(d-1)*3+2]),e.colors.push(i[d*3]),e.colors.push(i[d*3+1]),e.colors.push(i[d*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[(d-1)*3]),e.normal.push(s[(d-1)*3+1]),e.normal.push(s[(d-1)*3+2]),e.normal.push(s[d*3]),e.normal.push(s[d*3+1]),e.normal.push(s[d*3+2])),t.uv&&t.uv.forEach(function(p,g){e.uvs[g]===void 0&&(e.uvs[g]=[]),e.uvs[g].push(a[g][0]),e.uvs[g].push(a[g][1]),e.uvs[g].push(a[g][(d-1)*2]),e.uvs[g].push(a[g][(d-1)*2+1]),e.uvs[g].push(a[g][d*2]),e.uvs[g].push(a[g][d*2+1])})}addMorphTargets(e,t,n,r){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;n.forEach(function(i){i.rawTargets.forEach(function(a){const c=_e.Objects.Geometry[a.geoID];c!==void 0&&s.genMorphGeometry(e,t,c,r,a.name)})})}genMorphGeometry(e,t,n,r,s){const i=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],h=e.attributes.position.count*3,f=new Float32Array(h);for(let x=0;x<c.length;x++){const v=c[x]*3;f[v]=a[x*3],f[v+1]=a[x*3+1],f[v+2]=a[x*3+2]}const d={vertexIndices:i,vertexPositions:f},p=this.genBuffers(d),g=new l.Float32BufferAttribute(p.vertex,3);g.name=s||n.attrName,g.applyMatrix4(r),e.morphAttributes.position.push(g)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let s=[];return n==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:s,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let s=[];return n==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:r,indices:s,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let s=[];return n==="IndexToDirect"&&(s=e.ColorIndex.a),{dataSize:4,buffer:r,indices:s,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,s=[];for(let i=0;i<r.length;++i)s.push(i);return{dataSize:1,buffer:r,indices:s,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(Ss===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new l.BufferGeometry;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new l.BufferGeometry;const n=t-1,r=e.KnotVector.a,s=[],i=e.Points.a;for(let d=0,p=i.length;d<p;d+=4)s.push(new l.Vector4().fromArray(i,d));let a,c;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){a=n,c=r.length-1-a;for(let d=0;d<n;++d)s.push(s[d])}const f=new Ss(n,r,s,a,c).getPoints(s.length*12);return new l.BufferGeometry().setFromPoints(f)}}class Xa{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],s=this.addClip(r);e.push(s)}return e}parseClips(){if(_e.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=_e.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:r.id,attr:r.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=_e.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(Ja),values:t[n].KeyValueFloat.a},s=De.get(r.id);if(s!==void 0){const i=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?e.get(i).curves.x=r:a.match(/Y/)?e.get(i).curves.y=r:a.match(/Z/)?e.get(i).curves.z=r:a.match(/d|DeformPercent/)&&e.has(i)&&(e.get(i).curves.morph=r)}}}parseAnimationLayers(e){const t=_e.Objects.AnimationLayer,n=new Map;for(const r in t){const s=[],i=De.get(parseInt(r));i!==void 0&&(i.children.forEach(function(c,h){if(e.has(c.ID)){const f=e.get(c.ID);if(f.curves.x!==void 0||f.curves.y!==void 0||f.curves.z!==void 0){if(s[h]===void 0){const d=De.get(c.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(d!==void 0){const p=_e.Objects.Model[d.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const g={modelName:p.attrName?l.PropertyBinding.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};je.traverse(function(x){x.ID===p.id&&(g.transform=x.matrix,x.userData.transformData&&(g.eulerOrder=x.userData.transformData.eulerOrder))}),g.transform||(g.transform=new l.Matrix4),"PreRotation"in p&&(g.preRotation=p.PreRotation.value),"PostRotation"in p&&(g.postRotation=p.PostRotation.value),s[h]=g}}s[h]&&(s[h][f.attr]=f)}else if(f.curves.morph!==void 0){if(s[h]===void 0){const d=De.get(c.ID).parents.filter(function(m){return m.relationship!==void 0})[0].ID,p=De.get(d).parents[0].ID,g=De.get(p).parents[0].ID,x=De.get(g).parents[0].ID,v=_e.Objects.Model[x],_={modelName:v.attrName?l.PropertyBinding.sanitizeNodeName(v.attrName):"",morphName:_e.Objects.Deformer[d].attrName};s[h]=_}s[h][f.attr]=f}}}),n.set(parseInt(r),s))}return n}parseAnimStacks(e){const t=_e.Objects.AnimationStack,n={};for(const r in t){const s=De.get(parseInt(r)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const i=e.get(s[0].ID);n[r]={name:t[r].attrName,layer:i}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new l.AnimationClip(e.name,-1,t)}generateTracks(e){const t=[];let n=new l.Vector3,r=new l.Quaternion,s=new l.Vector3;if(e.transform&&e.transform.decompose(n,r,s),n=n.toArray(),r=new l.Euler().setFromQuaternion(r,e.eulerOrder).toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");i!==void 0&&t.push(i)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const i=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);i!==void 0&&t.push(i)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");i!==void 0&&t.push(i)}if(e.DeformPercent!==void 0){const i=this.generateMorphTrack(e);i!==void 0&&t.push(i)}return t}generateVectorTrack(e,t,n,r){const s=this.getTimesForAllAxes(t),i=this.getKeyframeTrackValues(s,t,n);return new l.VectorKeyframeTrack(e+"."+r,s,i)}generateRotationTrack(e,t,n,r,s,i){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(l.MathUtils.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(l.MathUtils.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(l.MathUtils.degToRad));const a=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(a,t,n);r!==void 0&&(r=r.map(l.MathUtils.degToRad),r.push(i),r=new l.Euler().fromArray(r),r=new l.Quaternion().setFromEuler(r)),s!==void 0&&(s=s.map(l.MathUtils.degToRad),s.push(i),s=new l.Euler().fromArray(s),s=new l.Quaternion().setFromEuler(s).invert());const h=new l.Quaternion,f=new l.Euler,d=[];for(let p=0;p<c.length;p+=3)f.set(c[p],c[p+1],c[p+2],i),h.setFromEuler(f),r!==void 0&&h.premultiply(r),s!==void 0&&h.multiply(s),h.toArray(d,p/3*4);return new l.QuaternionKeyframeTrack(e+".quaternion",a,d)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(s){return s/100}),r=je.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new l.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let s=1;s<t.length;s++){const i=t[s];i!==r&&(t[n]=i,r=i,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const r=n,s=[];let i=-1,a=-1,c=-1;return e.forEach(function(h){if(t.x&&(i=t.x.times.indexOf(h)),t.y&&(a=t.y.times.indexOf(h)),t.z&&(c=t.z.times.indexOf(h)),i!==-1){const f=t.x.values[i];s.push(f),r[0]=f}else s.push(r[0]);if(a!==-1){const f=t.y.values[a];s.push(f),r[1]=f}else s.push(r[1]);if(c!==-1){const f=t.z.values[c];s.push(f),r[2]=f}else s.push(r[2])}),s}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,s=Math.abs(r);if(s>=180){const i=s/180,a=r/i;let c=n+a;const h=e.times[t-1],d=(e.times[t]-h)/i;let p=h+d;const g=[],x=[];for(;p<e.times[t];)g.push(p),p+=d,x.push(c),c+=a;e.times=Os(e.times,t,g),e.values=Os(e.values,t,x)}}}}class Za{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Cs,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(r,s){const i=r.match(/^[\s\t]*;/),a=r.match(/^[\s\t]*$/);if(i||a)return;const c=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),h=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=r.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(r,c):h?t.parseNodeProperty(r,h,n[++s]):f?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},i=this.parseNodeAttr(r),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,s):n in a?(n==="PoseNode"?a.PoseNode.push(s):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),i.id!==""&&(a[n][i.id]=s)):typeof i.id=="number"?(a[n]={},a[n][i.id]=s):n!=="Properties70"&&(n==="PoseNode"?a[n]=[s]:a[n]=s),typeof i.id=="number"&&(s.id=i.id),i.name!==""&&(s.attrName=i.name),i.type!==""&&(s.attrType=i.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&s===","&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());const i=this.getCurrentNode();if(i.name==="Properties70"){this.parseNodeSpecialProperty(e,r,s);return}if(r==="C"){const c=s.split(",").slice(1),h=parseInt(c[0]),f=parseInt(c[1]);let d=s.split(",").slice(3);d=d.map(function(p){return p.trim().replace(/^"/,"")}),r="connections",s=[h,f],$a(s,d),i[r]===void 0&&(i[r]=[])}r==="Node"&&(i.id=s),r in i&&Array.isArray(i[r])?i[r].push(s):r!=="a"?i[r]=s:i.a=s,this.setCurrentProp(i,r),r==="a"&&s.slice(-1)!==","&&(i.a=lr(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=lr(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],i=r[1],a=r[2],c=r[3];let h=r[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=lr(h);break}this.getPrevNode()[s]={type:i,type2:a,flag:c,value:h},this.setCurrentProp(this.getPrevNode(),s)}}class qa{parse(e){const t=new As(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new Cs;for(;!this.endOfContent(t);){const s=this.parseNode(t,n);s!==null&&r.add(s.name,s)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const i=e.getUint8(),a=e.getString(i);if(r===0)return null;const c=[];for(let p=0;p<s;p++)c.push(this.parseProperty(e));const h=c.length>0?c[0]:"",f=c.length>1?c[1]:"",d=c.length>2?c[2]:"";for(n.singleProperty=s===1&&e.getOffset()===r;r>e.getOffset();){const p=this.parseNode(e,t);p!==null&&this.parseSubNode(a,n,p)}return n.propertyList=c,typeof h=="number"&&(n.id=h),f!==""&&(n.attrName=f),d!==""&&(n.attrType=d),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(e==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(s,i){i!==0&&r.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){t[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let r=n.propertyList[0],s=n.propertyList[1];const i=n.propertyList[2],a=n.propertyList[3];let c;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],t[r]={type:s,type2:i,flag:a,value:c}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),i=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const a=Uo(new Uint8Array(e.getArrayBuffer(i))),c=new As(a.buffer);switch(t){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class As{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),l.LoaderUtils.decodeText(new Uint8Array(t))}}class Cs{add(e,t){this[e]=t}}function Ka(o){const e="Kaydara FBX Binary  \0";return o.byteLength>=e.length&&e===Ls(o,0,e.length)}function Qa(o){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(r){const s=o[r-1];return o=o.slice(t+r),t++,s}for(let r=0;r<e.length;++r)if(n(1)===e[r])return!1;return!0}function Ps(o){const e=/FBXVersion: (\d+)/,t=o.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Ja(o){return o/46186158e3}const Ha=[];function Mn(o,e,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=o;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const s=r*n.dataSize,i=s+n.dataSize;return el(Ha,n.buffer,s,i)}const ar=new l.Euler,zt=new l.Vector3;function Ts(o){const e=new l.Matrix4,t=new l.Matrix4,n=new l.Matrix4,r=new l.Matrix4,s=new l.Matrix4,i=new l.Matrix4,a=new l.Matrix4,c=new l.Matrix4,h=new l.Matrix4,f=new l.Matrix4,d=new l.Matrix4,p=new l.Matrix4,g=o.inheritType?o.inheritType:0;if(o.translation&&e.setPosition(zt.fromArray(o.translation)),o.preRotation){const w=o.preRotation.map(l.MathUtils.degToRad);w.push(o.eulerOrder),t.makeRotationFromEuler(ar.fromArray(w))}if(o.rotation){const w=o.rotation.map(l.MathUtils.degToRad);w.push(o.eulerOrder),n.makeRotationFromEuler(ar.fromArray(w))}if(o.postRotation){const w=o.postRotation.map(l.MathUtils.degToRad);w.push(o.eulerOrder),r.makeRotationFromEuler(ar.fromArray(w)),r.invert()}o.scale&&s.scale(zt.fromArray(o.scale)),o.scalingOffset&&a.setPosition(zt.fromArray(o.scalingOffset)),o.scalingPivot&&i.setPosition(zt.fromArray(o.scalingPivot)),o.rotationOffset&&c.setPosition(zt.fromArray(o.rotationOffset)),o.rotationPivot&&h.setPosition(zt.fromArray(o.rotationPivot)),o.parentMatrixWorld&&(d.copy(o.parentMatrix),f.copy(o.parentMatrixWorld));const x=t.clone().multiply(n).multiply(r),v=new l.Matrix4;v.extractRotation(f);const _=new l.Matrix4;_.copyPosition(f);const m=_.clone().invert().multiply(f),M=v.clone().invert().multiply(m),b=s,S=new l.Matrix4;if(g===0)S.copy(v).multiply(x).multiply(M).multiply(b);else if(g===1)S.copy(v).multiply(M).multiply(x).multiply(b);else{const D=new l.Matrix4().scale(new l.Vector3().setFromMatrixScale(d)).clone().invert(),k=M.clone().multiply(D);S.copy(v).multiply(x).multiply(k).multiply(b)}const L=h.clone().invert(),P=i.clone().invert();let T=e.clone().multiply(c).multiply(h).multiply(t).multiply(n).multiply(r).multiply(L).multiply(a).multiply(i).multiply(s).multiply(P);const y=new l.Matrix4().copyPosition(T),A=f.clone().multiply(y);return p.copyPosition(A),T=p.clone().multiply(S),T.premultiply(f.invert()),T}function Is(o){o=o||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return o===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[o]}function lr(o){return o.split(",").map(function(t){return parseFloat(t)})}function Ls(o,e,t){return e===void 0&&(e=0),t===void 0&&(t=o.byteLength),l.LoaderUtils.decodeText(new Uint8Array(o,e,t))}function $a(o,e){for(let t=0,n=o.length,r=e.length;t<r;t++,n++)o[n]=e[t]}function el(o,e,t,n){for(let r=t,s=0;r<n;r++,s++)o[s]=e[r];return o}function Os(o,e,t){return o.slice(0,e).concat(t).concat(o.slice(e))}var tl=Object.defineProperty,nl=(o,e,t)=>e in o?tl(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,cr=(o,e,t)=>(nl(o,typeof e!="symbol"?e+"":e,t),t);class rl extends l.Loader{constructor(e){super(e)}load(e,t,n,r){const s=new l.FileLoader(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,i=>{if(typeof i!="string")throw new Error("unsupported data type");const a=JSON.parse(i),c=this.parse(a);t&&t(c)},n,r)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new ur(e)}}class ur{constructor(e){cr(this,"data"),this.data=e}generateShapes(e,t=100,n){const r=[],s={letterSpacing:0,lineHeight:1,...n},i=sl(e,t,this.data,s);for(let a=0,c=i.length;a<c;a++)Array.prototype.push.apply(r,i[a].toShapes(!1));return r}}cr(ur,"isFont"),cr(ur,"type");function sl(o,e,t,n){const r=Array.from(o),s=e/t.resolution,i=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,a=[];let c=0,h=0;for(let f=0;f<r.length;f++){const d=r[f];if(d===`
`)c=0,h-=i*n.lineHeight;else{const p=il(d,s,c,h,t);p&&(c+=p.offsetX+n.letterSpacing,a.push(p.path))}}return a}function il(o,e,t,n,r){const s=r.glyphs[o]||r.glyphs["?"];if(!s){console.error('THREE.Font: character "'+o+'" does not exists in font family '+r.familyName+".");return}const i=new l.ShapePath;let a,c,h,f,d,p,g,x;if(s.o){const v=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let _=0,m=v.length;_<m;)switch(v[_++]){case"m":a=parseInt(v[_++])*e+t,c=parseInt(v[_++])*e+n,i.moveTo(a,c);break;case"l":a=parseInt(v[_++])*e+t,c=parseInt(v[_++])*e+n,i.lineTo(a,c);break;case"q":h=parseInt(v[_++])*e+t,f=parseInt(v[_++])*e+n,d=parseInt(v[_++])*e+t,p=parseInt(v[_++])*e+n,i.quadraticCurveTo(d,p,h,f);break;case"b":h=parseInt(v[_++])*e+t,f=parseInt(v[_++])*e+n,d=parseInt(v[_++])*e+t,p=parseInt(v[_++])*e+n,g=parseInt(v[_++])*e+t,x=parseInt(v[_++])*e+n,i.bezierCurveTo(d,p,g,x,h,f);break}}return{offsetX:s.ha*e,path:i}}class Ds extends l.DataTextureLoader{constructor(e){super(e),this.type=l.HalfFloatType}parse(e){const i=function(y,A){switch(y){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(A||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(A||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(A||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(A||""))}},f=`
`,d=function(y,A,w){A=A||1024;let k=y.pos,R=-1,V=0,Y="",G=String.fromCharCode.apply(null,new Uint16Array(y.subarray(k,k+128)));for(;0>(R=G.indexOf(f))&&V<A&&k<y.byteLength;)Y+=G,V+=G.length,k+=128,G+=String.fromCharCode.apply(null,new Uint16Array(y.subarray(k,k+128)));return-1<R?(y.pos+=V+R+1,Y+G.slice(0,R)):!1},p=function(y){const A=/^#\?(\S+)/,w=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,D=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,k=/^\s*FORMAT=(\S+)\s*$/,R=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,V={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Y,G;for((y.pos>=y.byteLength||!(Y=d(y)))&&i(1,"no header found"),(G=Y.match(A))||i(3,"bad initial token"),V.valid|=1,V.programtype=G[1],V.string+=Y+`
`;Y=d(y),Y!==!1;){if(V.string+=Y+`
`,Y.charAt(0)==="#"){V.comments+=Y+`
`;continue}if((G=Y.match(w))&&(V.gamma=parseFloat(G[1])),(G=Y.match(D))&&(V.exposure=parseFloat(G[1])),(G=Y.match(k))&&(V.valid|=2,V.format=G[1]),(G=Y.match(R))&&(V.valid|=4,V.height=parseInt(G[1],10),V.width=parseInt(G[2],10)),V.valid&2&&V.valid&4)break}return V.valid&2||i(3,"missing format specifier"),V.valid&4||i(3,"missing image size specifier"),V},g=function(y,A,w){const D=A;if(D<8||D>32767||y[0]!==2||y[1]!==2||y[2]&128)return new Uint8Array(y);D!==(y[2]<<8|y[3])&&i(3,"wrong scanline width");const k=new Uint8Array(4*A*w);k.length||i(4,"unable to allocate buffer space");let R=0,V=0;const Y=4*D,G=new Uint8Array(4),Q=new Uint8Array(Y);let K=w;for(;K>0&&V<y.byteLength;){V+4>y.byteLength&&i(1),G[0]=y[V++],G[1]=y[V++],G[2]=y[V++],G[3]=y[V++],(G[0]!=2||G[1]!=2||(G[2]<<8|G[3])!=D)&&i(3,"bad rgbe scanline format");let ne=0,ee;for(;ne<Y&&V<y.byteLength;){ee=y[V++];const he=ee>128;if(he&&(ee-=128),(ee===0||ne+ee>Y)&&i(3,"bad scanline data"),he){const de=y[V++];for(let O=0;O<ee;O++)Q[ne++]=de}else Q.set(y.subarray(V,V+ee),ne),ne+=ee,V+=ee}const le=D;for(let he=0;he<le;he++){let de=0;k[R]=Q[he+de],de+=D,k[R+1]=Q[he+de],de+=D,k[R+2]=Q[he+de],de+=D,k[R+3]=Q[he+de],R+=4}K--}return k},x=function(y,A,w,D){const k=y[A+3],R=Math.pow(2,k-128)/255;w[D+0]=y[A+0]*R,w[D+1]=y[A+1]*R,w[D+2]=y[A+2]*R,w[D+3]=1},v=function(y,A,w,D){const k=y[A+3],R=Math.pow(2,k-128)/255;w[D+0]=l.DataUtils.toHalfFloat(Math.min(y[A+0]*R,65504)),w[D+1]=l.DataUtils.toHalfFloat(Math.min(y[A+1]*R,65504)),w[D+2]=l.DataUtils.toHalfFloat(Math.min(y[A+2]*R,65504)),w[D+3]=l.DataUtils.toHalfFloat(1)},_=new Uint8Array(e);_.pos=0;const m=p(_),M=m.width,b=m.height,S=g(_.subarray(_.pos),M,b);let L,P,T;switch(this.type){case l.FloatType:T=S.length/4;const y=new Float32Array(T*4);for(let w=0;w<T;w++)x(S,w*4,y,w*4);L=y,P=l.FloatType;break;case l.HalfFloatType:T=S.length/4;const A=new Uint16Array(T*4);for(let w=0;w<T;w++)v(S,w*4,A,w*4);L=A,P=l.HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:M,height:b,data:L,header:m.string,gamma:m.gamma,exposure:m.exposure,type:P}}setDataType(e){return this.type=e,this}load(e,t,n,r){function s(i,a){switch(i.type){case l.FloatType:case l.HalfFloatType:"colorSpace"in i?i.colorSpace="srgb-linear":i.encoding=3e3,i.minFilter=l.LinearFilter,i.magFilter=l.LinearFilter,i.generateMipmaps=!1,i.flipY=!0;break}t&&t(i,a)}return super.load(e,s,n,r)}}const ol="srgb";class en extends l.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,n,r){const s=this,i=new l.FileLoader(s.manager);i.setPath(s.path),i.setRequestHeader(s.requestHeader),i.setWithCredentials(s.withCredentials),i.load(e,function(a){try{t(s.parse(a))}catch(c){r?r(c):console.error(c),s.manager.itemError(e)}},n,r)}parse(e){const t=this;function n(O,z){if(O.nodeType!==1)return;const U=S(O);let F=!1,j=null;switch(O.nodeName){case"svg":z=x(O,z);break;case"style":s(O);break;case"g":z=x(O,z);break;case"path":z=x(O,z),O.hasAttribute("d")&&(j=r(O));break;case"rect":z=x(O,z),j=c(O);break;case"polygon":z=x(O,z),j=h(O);break;case"polyline":z=x(O,z),j=f(O);break;case"circle":z=x(O,z),j=d(O);break;case"ellipse":z=x(O,z),j=p(O);break;case"line":z=x(O,z),j=g(O);break;case"defs":F=!0;break;case"use":z=x(O,z);const B=(O.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),Z=O.viewportElement.getElementById(B);Z?n(Z,z):console.warn("SVGLoader: 'use node' references non-existent node id: "+B);break}j&&(z.fill!==void 0&&z.fill!=="none"&&j.color.setStyle(z.fill,ol),P(j,le),k.push(j),j.userData={node:O,style:z});const C=O.childNodes;for(let I=0;I<C.length;I++){const B=C[I];F&&B.nodeName!=="style"&&B.nodeName!=="defs"||n(B,z)}U&&(V.pop(),V.length>0?le.copy(V[V.length-1]):le.identity())}function r(O){const z=new l.ShapePath,U=new l.Vector2,F=new l.Vector2,j=new l.Vector2;let C=!0,I=!1;const B=O.getAttribute("d");if(B===""||B==="none")return null;const Z=B.match(/[a-df-z][^a-df-z]*/gi);for(let X=0,W=Z.length;X<W;X++){const $=Z[X],re=$.charAt(0),se=$.slice(1).trim();C===!0&&(I=!0,C=!1);let E;switch(re){case"M":E=_(se);for(let N=0,ae=E.length;N<ae;N+=2)U.x=E[N+0],U.y=E[N+1],F.x=U.x,F.y=U.y,N===0?z.moveTo(U.x,U.y):z.lineTo(U.x,U.y),N===0&&j.copy(U);break;case"H":E=_(se);for(let N=0,ae=E.length;N<ae;N++)U.x=E[N],F.x=U.x,F.y=U.y,z.lineTo(U.x,U.y),N===0&&I===!0&&j.copy(U);break;case"V":E=_(se);for(let N=0,ae=E.length;N<ae;N++)U.y=E[N],F.x=U.x,F.y=U.y,z.lineTo(U.x,U.y),N===0&&I===!0&&j.copy(U);break;case"L":E=_(se);for(let N=0,ae=E.length;N<ae;N+=2)U.x=E[N+0],U.y=E[N+1],F.x=U.x,F.y=U.y,z.lineTo(U.x,U.y),N===0&&I===!0&&j.copy(U);break;case"C":E=_(se);for(let N=0,ae=E.length;N<ae;N+=6)z.bezierCurveTo(E[N+0],E[N+1],E[N+2],E[N+3],E[N+4],E[N+5]),F.x=E[N+2],F.y=E[N+3],U.x=E[N+4],U.y=E[N+5],N===0&&I===!0&&j.copy(U);break;case"S":E=_(se);for(let N=0,ae=E.length;N<ae;N+=4)z.bezierCurveTo(v(U.x,F.x),v(U.y,F.y),E[N+0],E[N+1],E[N+2],E[N+3]),F.x=E[N+0],F.y=E[N+1],U.x=E[N+2],U.y=E[N+3],N===0&&I===!0&&j.copy(U);break;case"Q":E=_(se);for(let N=0,ae=E.length;N<ae;N+=4)z.quadraticCurveTo(E[N+0],E[N+1],E[N+2],E[N+3]),F.x=E[N+0],F.y=E[N+1],U.x=E[N+2],U.y=E[N+3],N===0&&I===!0&&j.copy(U);break;case"T":E=_(se);for(let N=0,ae=E.length;N<ae;N+=2){const ue=v(U.x,F.x),ve=v(U.y,F.y);z.quadraticCurveTo(ue,ve,E[N+0],E[N+1]),F.x=ue,F.y=ve,U.x=E[N+0],U.y=E[N+1],N===0&&I===!0&&j.copy(U)}break;case"A":E=_(se,[3,4],7);for(let N=0,ae=E.length;N<ae;N+=7){if(E[N+5]==U.x&&E[N+6]==U.y)continue;const ue=U.clone();U.x=E[N+5],U.y=E[N+6],F.x=U.x,F.y=U.y,i(z,E[N],E[N+1],E[N+2],E[N+3],E[N+4],ue,U),N===0&&I===!0&&j.copy(U)}break;case"m":E=_(se);for(let N=0,ae=E.length;N<ae;N+=2)U.x+=E[N+0],U.y+=E[N+1],F.x=U.x,F.y=U.y,N===0?z.moveTo(U.x,U.y):z.lineTo(U.x,U.y),N===0&&j.copy(U);break;case"h":E=_(se);for(let N=0,ae=E.length;N<ae;N++)U.x+=E[N],F.x=U.x,F.y=U.y,z.lineTo(U.x,U.y),N===0&&I===!0&&j.copy(U);break;case"v":E=_(se);for(let N=0,ae=E.length;N<ae;N++)U.y+=E[N],F.x=U.x,F.y=U.y,z.lineTo(U.x,U.y),N===0&&I===!0&&j.copy(U);break;case"l":E=_(se);for(let N=0,ae=E.length;N<ae;N+=2)U.x+=E[N+0],U.y+=E[N+1],F.x=U.x,F.y=U.y,z.lineTo(U.x,U.y),N===0&&I===!0&&j.copy(U);break;case"c":E=_(se);for(let N=0,ae=E.length;N<ae;N+=6)z.bezierCurveTo(U.x+E[N+0],U.y+E[N+1],U.x+E[N+2],U.y+E[N+3],U.x+E[N+4],U.y+E[N+5]),F.x=U.x+E[N+2],F.y=U.y+E[N+3],U.x+=E[N+4],U.y+=E[N+5],N===0&&I===!0&&j.copy(U);break;case"s":E=_(se);for(let N=0,ae=E.length;N<ae;N+=4)z.bezierCurveTo(v(U.x,F.x),v(U.y,F.y),U.x+E[N+0],U.y+E[N+1],U.x+E[N+2],U.y+E[N+3]),F.x=U.x+E[N+0],F.y=U.y+E[N+1],U.x+=E[N+2],U.y+=E[N+3],N===0&&I===!0&&j.copy(U);break;case"q":E=_(se);for(let N=0,ae=E.length;N<ae;N+=4)z.quadraticCurveTo(U.x+E[N+0],U.y+E[N+1],U.x+E[N+2],U.y+E[N+3]),F.x=U.x+E[N+0],F.y=U.y+E[N+1],U.x+=E[N+2],U.y+=E[N+3],N===0&&I===!0&&j.copy(U);break;case"t":E=_(se);for(let N=0,ae=E.length;N<ae;N+=2){const ue=v(U.x,F.x),ve=v(U.y,F.y);z.quadraticCurveTo(ue,ve,U.x+E[N+0],U.y+E[N+1]),F.x=ue,F.y=ve,U.x=U.x+E[N+0],U.y=U.y+E[N+1],N===0&&I===!0&&j.copy(U)}break;case"a":E=_(se,[3,4],7);for(let N=0,ae=E.length;N<ae;N+=7){if(E[N+5]==0&&E[N+6]==0)continue;const ue=U.clone();U.x+=E[N+5],U.y+=E[N+6],F.x=U.x,F.y=U.y,i(z,E[N],E[N+1],E[N+2],E[N+3],E[N+4],ue,U),N===0&&I===!0&&j.copy(U)}break;case"Z":case"z":z.currentPath.autoClose=!0,z.currentPath.curves.length>0&&(U.copy(j),z.currentPath.currentPoint.copy(U),C=!0);break;default:console.warn($)}I=!1}return z}function s(O){if(!(!O.sheet||!O.sheet.cssRules||!O.sheet.cssRules.length))for(let z=0;z<O.sheet.cssRules.length;z++){const U=O.sheet.cssRules[z];if(U.type!==1)continue;const F=U.selectorText.split(/,/gm).filter(Boolean).map(j=>j.trim());for(let j=0;j<F.length;j++){const C=Object.fromEntries(Object.entries(U.style).filter(([,I])=>I!==""));R[F[j]]=Object.assign(R[F[j]]||{},C)}}}function i(O,z,U,F,j,C,I,B){if(z==0||U==0){O.lineTo(B.x,B.y);return}F=F*Math.PI/180,z=Math.abs(z),U=Math.abs(U);const Z=(I.x-B.x)/2,X=(I.y-B.y)/2,W=Math.cos(F)*Z+Math.sin(F)*X,$=-Math.sin(F)*Z+Math.cos(F)*X;let re=z*z,se=U*U;const E=W*W,N=$*$,ae=E/re+N/se;if(ae>1){const Zt=Math.sqrt(ae);z=Zt*z,U=Zt*U,re=z*z,se=U*U}const ue=re*N+se*E,ve=(re*se-ue)/ue;let Oe=Math.sqrt(Math.max(0,ve));j===C&&(Oe=-Oe);const Te=Oe*z*$/U,He=-Oe*U*W/z,Ct=Math.cos(F)*Te-Math.sin(F)*He+(I.x+B.x)/2,Ze=Math.sin(F)*Te+Math.cos(F)*He+(I.y+B.y)/2,Pt=a(1,0,(W-Te)/z,($-He)/U),pn=a((W-Te)/z,($-He)/U,(-W-Te)/z,(-$-He)/U)%(Math.PI*2);O.currentPath.absellipse(Ct,Ze,z,U,Pt,Pt+pn,C===0,F)}function a(O,z,U,F){const j=O*U+z*F,C=Math.sqrt(O*O+z*z)*Math.sqrt(U*U+F*F);let I=Math.acos(Math.max(-1,Math.min(1,j/C)));return O*F-z*U<0&&(I=-I),I}function c(O){const z=b(O.getAttribute("x")||0),U=b(O.getAttribute("y")||0),F=b(O.getAttribute("rx")||O.getAttribute("ry")||0),j=b(O.getAttribute("ry")||O.getAttribute("rx")||0),C=b(O.getAttribute("width")),I=b(O.getAttribute("height")),B=1-.551915024494,Z=new l.ShapePath;return Z.moveTo(z+F,U),Z.lineTo(z+C-F,U),(F!==0||j!==0)&&Z.bezierCurveTo(z+C-F*B,U,z+C,U+j*B,z+C,U+j),Z.lineTo(z+C,U+I-j),(F!==0||j!==0)&&Z.bezierCurveTo(z+C,U+I-j*B,z+C-F*B,U+I,z+C-F,U+I),Z.lineTo(z+F,U+I),(F!==0||j!==0)&&Z.bezierCurveTo(z+F*B,U+I,z,U+I-j*B,z,U+I-j),Z.lineTo(z,U+j),(F!==0||j!==0)&&Z.bezierCurveTo(z,U+j*B,z+F*B,U,z+F,U),Z}function h(O){function z(C,I,B){const Z=b(I),X=b(B);j===0?F.moveTo(Z,X):F.lineTo(Z,X),j++}const U=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,F=new l.ShapePath;let j=0;return O.getAttribute("points").replace(U,z),F.currentPath.autoClose=!0,F}function f(O){function z(C,I,B){const Z=b(I),X=b(B);j===0?F.moveTo(Z,X):F.lineTo(Z,X),j++}const U=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,F=new l.ShapePath;let j=0;return O.getAttribute("points").replace(U,z),F.currentPath.autoClose=!1,F}function d(O){const z=b(O.getAttribute("cx")||0),U=b(O.getAttribute("cy")||0),F=b(O.getAttribute("r")||0),j=new l.Path;j.absarc(z,U,F,0,Math.PI*2);const C=new l.ShapePath;return C.subPaths.push(j),C}function p(O){const z=b(O.getAttribute("cx")||0),U=b(O.getAttribute("cy")||0),F=b(O.getAttribute("rx")||0),j=b(O.getAttribute("ry")||0),C=new l.Path;C.absellipse(z,U,F,j,0,Math.PI*2);const I=new l.ShapePath;return I.subPaths.push(C),I}function g(O){const z=b(O.getAttribute("x1")||0),U=b(O.getAttribute("y1")||0),F=b(O.getAttribute("x2")||0),j=b(O.getAttribute("y2")||0),C=new l.ShapePath;return C.moveTo(z,U),C.lineTo(F,j),C.currentPath.autoClose=!1,C}function x(O,z){z=Object.assign({},z);let U={};if(O.hasAttribute("class")){const I=O.getAttribute("class").split(/\s/).filter(Boolean).map(B=>B.trim());for(let B=0;B<I.length;B++)U=Object.assign(U,R["."+I[B]])}O.hasAttribute("id")&&(U=Object.assign(U,R["#"+O.getAttribute("id")]));function F(I,B,Z){Z===void 0&&(Z=function(W){return W.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),W}),O.hasAttribute(I)&&(z[B]=Z(O.getAttribute(I))),U[I]&&(z[B]=Z(U[I])),O.style&&O.style[I]!==""&&(z[B]=Z(O.style[I]))}function j(I){return Math.max(0,Math.min(1,b(I)))}function C(I){return Math.max(0,b(I))}return F("fill","fill"),F("fill-opacity","fillOpacity",j),F("fill-rule","fillRule"),F("opacity","opacity",j),F("stroke","stroke"),F("stroke-opacity","strokeOpacity",j),F("stroke-width","strokeWidth",C),F("stroke-linejoin","strokeLineJoin"),F("stroke-linecap","strokeLineCap"),F("stroke-miterlimit","strokeMiterLimit",C),F("visibility","visibility"),z}function v(O,z){return O-(z-O)}function _(O,z,U){if(typeof O!="string")throw new TypeError("Invalid input: "+typeof O);const F={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},j=0,C=1,I=2,B=3;let Z=j,X=!0,W="",$="";const re=[];function se(ue,ve,Oe){const Te=new SyntaxError('Unexpected character "'+ue+'" at index '+ve+".");throw Te.partial=Oe,Te}function E(){W!==""&&($===""?re.push(Number(W)):re.push(Number(W)*Math.pow(10,Number($)))),W="",$=""}let N;const ae=O.length;for(let ue=0;ue<ae;ue++){if(N=O[ue],Array.isArray(z)&&z.includes(re.length%U)&&F.FLAGS.test(N)){Z=C,W=N,E();continue}if(Z===j){if(F.WHITESPACE.test(N))continue;if(F.DIGIT.test(N)||F.SIGN.test(N)){Z=C,W=N;continue}if(F.POINT.test(N)){Z=I,W=N;continue}F.COMMA.test(N)&&(X&&se(N,ue,re),X=!0)}if(Z===C){if(F.DIGIT.test(N)){W+=N;continue}if(F.POINT.test(N)){W+=N,Z=I;continue}if(F.EXP.test(N)){Z=B;continue}F.SIGN.test(N)&&W.length===1&&F.SIGN.test(W[0])&&se(N,ue,re)}if(Z===I){if(F.DIGIT.test(N)){W+=N;continue}if(F.EXP.test(N)){Z=B;continue}F.POINT.test(N)&&W[W.length-1]==="."&&se(N,ue,re)}if(Z===B){if(F.DIGIT.test(N)){$+=N;continue}if(F.SIGN.test(N)){if($===""){$+=N;continue}$.length===1&&F.SIGN.test($)&&se(N,ue,re)}}F.WHITESPACE.test(N)?(E(),Z=j,X=!1):F.COMMA.test(N)?(E(),Z=j,X=!0):F.SIGN.test(N)?(E(),Z=C,W=N):F.POINT.test(N)?(E(),Z=I,W=N):se(N,ue,re)}return E(),re}const m=["mm","cm","in","pt","pc","px"],M={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function b(O){let z="px";if(typeof O=="string"||O instanceof String)for(let F=0,j=m.length;F<j;F++){const C=m[F];if(O.endsWith(C)){z=C,O=O.substring(0,O.length-C.length);break}}let U;return z==="px"&&t.defaultUnit!=="px"?U=M.in[t.defaultUnit]/t.defaultDPI:(U=M[z][t.defaultUnit],U<0&&(U=M[z].in*t.defaultDPI)),U*parseFloat(O)}function S(O){if(!(O.hasAttribute("transform")||O.nodeName==="use"&&(O.hasAttribute("x")||O.hasAttribute("y"))))return null;const z=L(O);return V.length>0&&z.premultiply(V[V.length-1]),le.copy(z),V.push(z),z}function L(O){const z=new l.Matrix3,U=Y;if(O.nodeName==="use"&&(O.hasAttribute("x")||O.hasAttribute("y"))){const F=b(O.getAttribute("x")),j=b(O.getAttribute("y"));z.translate(F,j)}if(O.hasAttribute("transform")){const F=O.getAttribute("transform").split(")");for(let j=F.length-1;j>=0;j--){const C=F[j].trim();if(C==="")continue;const I=C.indexOf("("),B=C.length;if(I>0&&I<B){const Z=C.slice(0,I),X=_(C.slice(I+1));switch(U.identity(),Z){case"translate":if(X.length>=1){const W=X[0];let $=0;X.length>=2&&($=X[1]),U.translate(W,$)}break;case"rotate":if(X.length>=1){let W=0,$=0,re=0;W=X[0]*Math.PI/180,X.length>=3&&($=X[1],re=X[2]),G.makeTranslation(-$,-re),Q.makeRotation(W),K.multiplyMatrices(Q,G),G.makeTranslation($,re),U.multiplyMatrices(G,K)}break;case"scale":if(X.length>=1){const W=X[0];let $=W;X.length>=2&&($=X[1]),U.scale(W,$)}break;case"skewX":X.length===1&&U.set(1,Math.tan(X[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":X.length===1&&U.set(1,0,0,Math.tan(X[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":X.length===6&&U.set(X[0],X[2],X[4],X[1],X[3],X[5],0,0,1);break}}z.premultiply(U)}}return z}function P(O,z){function U(I){ee.set(I.x,I.y,1).applyMatrix3(z),I.set(ee.x,ee.y)}function F(I){const B=I.xRadius,Z=I.yRadius,X=Math.cos(I.aRotation),W=Math.sin(I.aRotation),$=new l.Vector3(B*X,B*W,0),re=new l.Vector3(-Z*W,Z*X,0),se=$.applyMatrix3(z),E=re.applyMatrix3(z),N=Y.set(se.x,E.x,0,se.y,E.y,0,0,0,1),ae=G.copy(N).invert(),Oe=Q.copy(ae).transpose().multiply(ae).elements,Te=D(Oe[0],Oe[1],Oe[4]),He=Math.sqrt(Te.rt1),Ct=Math.sqrt(Te.rt2);if(I.xRadius=1/He,I.yRadius=1/Ct,I.aRotation=Math.atan2(Te.sn,Te.cs),!((I.aEndAngle-I.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const Pt=G.set(He,0,0,0,Ct,0,0,0,1),pn=Q.set(Te.cs,Te.sn,0,-Te.sn,Te.cs,0,0,0,1),Zt=Pt.multiply(pn).multiply(N),mn=Rn=>{const{x:Wn,y:Yn}=new l.Vector3(Math.cos(Rn),Math.sin(Rn),0).applyMatrix3(Zt);return Math.atan2(Yn,Wn)};I.aStartAngle=mn(I.aStartAngle),I.aEndAngle=mn(I.aEndAngle),T(z)&&(I.aClockwise=!I.aClockwise)}}function j(I){const B=A(z),Z=w(z);I.xRadius*=B,I.yRadius*=Z;const X=B>Number.EPSILON?Math.atan2(z.elements[1],z.elements[0]):Math.atan2(-z.elements[3],z.elements[4]);I.aRotation+=X,T(z)&&(I.aStartAngle*=-1,I.aEndAngle*=-1,I.aClockwise=!I.aClockwise)}const C=O.subPaths;for(let I=0,B=C.length;I<B;I++){const X=C[I].curves;for(let W=0;W<X.length;W++){const $=X[W];$.isLineCurve?(U($.v1),U($.v2)):$.isCubicBezierCurve?(U($.v0),U($.v1),U($.v2),U($.v3)):$.isQuadraticBezierCurve?(U($.v0),U($.v1),U($.v2)):$.isEllipseCurve&&(ne.set($.aX,$.aY),U(ne),$.aX=ne.x,$.aY=ne.y,y(z)?F($):j($))}}}function T(O){const z=O.elements;return z[0]*z[4]-z[1]*z[3]<0}function y(O){const z=O.elements,U=z[0]*z[3]+z[1]*z[4];if(U===0)return!1;const F=A(O),j=w(O);return Math.abs(U/(F*j))>Number.EPSILON}function A(O){const z=O.elements;return Math.sqrt(z[0]*z[0]+z[1]*z[1])}function w(O){const z=O.elements;return Math.sqrt(z[3]*z[3]+z[4]*z[4])}function D(O,z,U){let F,j,C,I,B;const Z=O+U,X=O-U,W=Math.sqrt(X*X+4*z*z);return Z>0?(F=.5*(Z+W),B=1/F,j=O*B*U-z*B*z):Z<0?j=.5*(Z-W):(F=.5*W,j=-.5*W),X>0?C=X+W:C=X-W,Math.abs(C)>2*Math.abs(z)?(B=-2*z/C,I=1/Math.sqrt(1+B*B),C=B*I):Math.abs(z)===0?(C=1,I=0):(B=-.5*C/z,C=1/Math.sqrt(1+B*B),I=B*C),X>0&&(B=C,C=-I,I=B),{rt1:F,rt2:j,cs:C,sn:I}}const k=[],R={},V=[],Y=new l.Matrix3,G=new l.Matrix3,Q=new l.Matrix3,K=new l.Matrix3,ne=new l.Vector2,ee=new l.Vector3,le=new l.Matrix3,he=new DOMParser().parseFromString(e,"image/svg+xml");return n(he.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:k,xml:he.documentElement}}static createShapes(e){const n={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},r={loc:n.ORIGIN,t:0};function s(v,_,m,M){const b=v.x,S=_.x,L=m.x,P=M.x,T=v.y,y=_.y,A=m.y,w=M.y,D=(P-L)*(T-A)-(w-A)*(b-L),k=(S-b)*(T-A)-(y-T)*(b-L),R=(w-A)*(S-b)-(P-L)*(y-T),V=D/R,Y=k/R;if(R===0&&D!==0||V<=0||V>=1||Y<0||Y>1)return null;if(D===0&&R===0){for(let G=0;G<2;G++)if(i(G===0?m:M,v,_),r.loc==n.ORIGIN){const Q=G===0?m:M;return{x:Q.x,y:Q.y,t:r.t}}else if(r.loc==n.BETWEEN){const Q=+(b+r.t*(S-b)).toPrecision(10),K=+(T+r.t*(y-T)).toPrecision(10);return{x:Q,y:K,t:r.t}}return null}else{for(let K=0;K<2;K++)if(i(K===0?m:M,v,_),r.loc==n.ORIGIN){const ne=K===0?m:M;return{x:ne.x,y:ne.y,t:r.t}}const G=+(b+V*(S-b)).toPrecision(10),Q=+(T+V*(y-T)).toPrecision(10);return{x:G,y:Q,t:V}}}function i(v,_,m){const M=m.x-_.x,b=m.y-_.y,S=v.x-_.x,L=v.y-_.y,P=M*L-S*b;if(v.x===_.x&&v.y===_.y){r.loc=n.ORIGIN,r.t=0;return}if(v.x===m.x&&v.y===m.y){r.loc=n.DESTINATION,r.t=1;return}if(P<-Number.EPSILON){r.loc=n.LEFT;return}if(P>Number.EPSILON){r.loc=n.RIGHT;return}if(M*S<0||b*L<0){r.loc=n.BEHIND;return}if(Math.sqrt(M*M+b*b)<Math.sqrt(S*S+L*L)){r.loc=n.BEYOND;return}let T;M!==0?T=S/M:T=L/b,r.loc=n.BETWEEN,r.t=T}function a(v,_){const m=[],M=[];for(let b=1;b<v.length;b++){const S=v[b-1],L=v[b];for(let P=1;P<_.length;P++){const T=_[P-1],y=_[P],A=s(S,L,T,y);A!==null&&m.find(w=>w.t<=A.t+Number.EPSILON&&w.t>=A.t-Number.EPSILON)===void 0&&(m.push(A),M.push(new l.Vector2(A.x,A.y)))}}return M}function c(v,_,m){const M=new l.Vector2;_.getCenter(M);const b=[];return m.forEach(S=>{S.boundingBox.containsPoint(M)&&a(v,S.points).forEach(P=>{b.push({identifier:S.identifier,isCW:S.isCW,point:P})})}),b.sort((S,L)=>S.point.x-L.point.x),b}function h(v,_,m,M,b){(b==null||b==="")&&(b="nonzero");const S=new l.Vector2;v.boundingBox.getCenter(S);const L=[new l.Vector2(m,S.y),new l.Vector2(M,S.y)],P=c(L,v.boundingBox,_);P.sort((k,R)=>k.point.x-R.point.x);const T=[],y=[];P.forEach(k=>{k.identifier===v.identifier?T.push(k):y.push(k)});const A=T[0].point.x,w=[];let D=0;for(;D<y.length&&y[D].point.x<A;)w.length>0&&w[w.length-1]===y[D].identifier?w.pop():w.push(y[D].identifier),D++;if(w.push(v.identifier),b==="evenodd"){const k=w.length%2===0,R=w[w.length-2];return{identifier:v.identifier,isHole:k,for:R}}else if(b==="nonzero"){let k=!0,R=null,V=null;for(let Y=0;Y<w.length;Y++){const G=w[Y];k?(V=_[G].isCW,k=!1,R=G):V!==_[G].isCW&&(V=_[G].isCW,k=!0)}return{identifier:v.identifier,isHole:k,for:R}}else console.warn('fill-rule: "'+b+'" is currently not implemented.')}let f=999999999,d=-999999999,p=e.subPaths.map(v=>{const _=v.getPoints();let m=-999999999,M=999999999,b=-999999999,S=999999999;for(let L=0;L<_.length;L++){const P=_[L];P.y>m&&(m=P.y),P.y<M&&(M=P.y),P.x>b&&(b=P.x),P.x<S&&(S=P.x)}return d<=b&&(d=b+1),f>=S&&(f=S-1),{curves:v.curves,points:_,isCW:l.ShapeUtils.isClockWise(_),identifier:-1,boundingBox:new l.Box2(new l.Vector2(S,M),new l.Vector2(b,m))}});p=p.filter(v=>v.points.length>1);for(let v=0;v<p.length;v++)p[v].identifier=v;const g=p.map(v=>h(v,p,f,d,e.userData?e.userData.style.fillRule:void 0)),x=[];return p.forEach(v=>{if(!g[v.identifier].isHole){const m=new l.Shape;m.curves=v.curves,g.filter(b=>b.isHole&&b.for===v.identifier).forEach(b=>{const S=p[b.identifier],L=new l.Path;L.curves=S.curves,m.holes.push(L)}),x.push(m)}}),x}static getStrokeStyle(e,t,n,r,s){return e=e!==void 0?e:1,t=t!==void 0?t:"#000",n=n!==void 0?n:"miter",r=r!==void 0?r:"butt",s=s!==void 0?s:4,{strokeColor:t,strokeWidth:e,strokeLineJoin:n,strokeLineCap:r,strokeMiterLimit:s}}static pointsToStroke(e,t,n,r){const s=[],i=[],a=[];if(en.pointsToStrokeWithBuffers(e,t,n,r,s,i,a)===0)return null;const c=new l.BufferGeometry;return c.setAttribute("position",new l.Float32BufferAttribute(s,3)),c.setAttribute("normal",new l.Float32BufferAttribute(i,3)),c.setAttribute("uv",new l.Float32BufferAttribute(a,2)),c}static pointsToStrokeWithBuffers(e,t,n,r,s,i,a,c){const h=new l.Vector2,f=new l.Vector2,d=new l.Vector2,p=new l.Vector2,g=new l.Vector2,x=new l.Vector2,v=new l.Vector2,_=new l.Vector2,m=new l.Vector2,M=new l.Vector2,b=new l.Vector2,S=new l.Vector2,L=new l.Vector2,P=new l.Vector2,T=new l.Vector2,y=new l.Vector2,A=new l.Vector2;n=n!==void 0?n:12,r=r!==void 0?r:.001,c=c!==void 0?c:0,e=X(e);const w=e.length;if(w<2)return 0;const D=e[0].equals(e[w-1]);let k,R=e[0],V;const Y=t.strokeWidth/2,G=1/(w-1);let Q=0,K,ne,ee,le,he=!1,de=0,O=c*3,z=c*2;U(e[0],e[1],h).multiplyScalar(Y),_.copy(e[0]).sub(h),m.copy(e[0]).add(h),M.copy(_),b.copy(m);for(let W=1;W<w;W++){k=e[W],W===w-1?D?V=e[1]:V=void 0:V=e[W+1];const $=h;if(U(R,k,$),d.copy($).multiplyScalar(Y),S.copy(k).sub(d),L.copy(k).add(d),K=Q+G,ne=!1,V!==void 0){U(k,V,f),d.copy(f).multiplyScalar(Y),P.copy(k).sub(d),T.copy(k).add(d),ee=!0,d.subVectors(V,R),$.dot(d)<0&&(ee=!1),W===1&&(he=ee),d.subVectors(V,k),d.normalize();const re=Math.abs($.dot(d));if(re>Number.EPSILON){const se=Y/re;d.multiplyScalar(-se),p.subVectors(k,R),g.copy(p).setLength(se).add(d),y.copy(g).negate();const E=g.length(),N=p.length();p.divideScalar(N),x.subVectors(V,k);const ae=x.length();switch(x.divideScalar(ae),p.dot(y)<N&&x.dot(y)<ae&&(ne=!0),A.copy(g).add(k),y.add(k),le=!1,ne?ee?(T.copy(y),L.copy(y)):(P.copy(y),S.copy(y)):C(),t.strokeLineJoin){case"bevel":I(ee,ne,K);break;case"round":B(ee,ne),ee?j(k,S,P,K,0):j(k,T,L,K,1);break;case"miter":case"miter-clip":default:const ue=Y*t.strokeMiterLimit/E;if(ue<1)if(t.strokeLineJoin!=="miter-clip"){I(ee,ne,K);break}else B(ee,ne),ee?(x.subVectors(A,S).multiplyScalar(ue).add(S),v.subVectors(A,P).multiplyScalar(ue).add(P),F(S,K,0),F(x,K,0),F(k,K,.5),F(k,K,.5),F(x,K,0),F(v,K,0),F(k,K,.5),F(v,K,0),F(P,K,0)):(x.subVectors(A,L).multiplyScalar(ue).add(L),v.subVectors(A,T).multiplyScalar(ue).add(T),F(L,K,1),F(x,K,1),F(k,K,.5),F(k,K,.5),F(x,K,1),F(v,K,1),F(k,K,.5),F(v,K,1),F(T,K,1));else ne?(ee?(F(m,Q,1),F(_,Q,0),F(A,K,0),F(m,Q,1),F(A,K,0),F(y,K,1)):(F(m,Q,1),F(_,Q,0),F(A,K,1),F(_,Q,0),F(y,K,0),F(A,K,1)),ee?P.copy(A):T.copy(A)):ee?(F(S,K,0),F(A,K,0),F(k,K,.5),F(k,K,.5),F(A,K,0),F(P,K,0)):(F(L,K,1),F(A,K,1),F(k,K,.5),F(k,K,.5),F(A,K,1),F(T,K,1)),le=!0;break}}else C()}else C();!D&&W===w-1&&Z(e[0],M,b,ee,!0,Q),Q=K,R=k,_.copy(P),m.copy(T)}if(!D)Z(k,S,L,ee,!1,K);else if(ne&&s){let W=A,$=y;he!==ee&&(W=y,$=A),ee?(le||he)&&($.toArray(s,0*3),$.toArray(s,3*3),le&&W.toArray(s,1*3)):(le||!he)&&($.toArray(s,1*3),$.toArray(s,3*3),le&&W.toArray(s,0*3))}return de;function U(W,$,re){return re.subVectors($,W),re.set(-re.y,re.x).normalize()}function F(W,$,re){s&&(s[O]=W.x,s[O+1]=W.y,s[O+2]=0,i&&(i[O]=0,i[O+1]=0,i[O+2]=1),O+=3,a&&(a[z]=$,a[z+1]=re,z+=2)),de+=3}function j(W,$,re,se,E){h.copy($).sub(W).normalize(),f.copy(re).sub(W).normalize();let N=Math.PI;const ae=h.dot(f);Math.abs(ae)<1&&(N=Math.abs(Math.acos(ae))),N/=n,d.copy($);for(let ue=0,ve=n-1;ue<ve;ue++)p.copy(d).rotateAround(W,N),F(d,se,E),F(p,se,E),F(W,se,.5),d.copy(p);F(p,se,E),F(re,se,E),F(W,se,.5)}function C(){F(m,Q,1),F(_,Q,0),F(S,K,0),F(m,Q,1),F(S,K,0),F(L,K,1)}function I(W,$,re){$?W?(F(m,Q,1),F(_,Q,0),F(S,K,0),F(m,Q,1),F(S,K,0),F(y,K,1),F(S,re,0),F(P,re,0),F(y,re,.5)):(F(m,Q,1),F(_,Q,0),F(L,K,1),F(_,Q,0),F(y,K,0),F(L,K,1),F(L,re,1),F(y,re,0),F(T,re,1)):W?(F(S,re,0),F(P,re,0),F(k,re,.5)):(F(L,re,1),F(T,re,0),F(k,re,.5))}function B(W,$){$&&(W?(F(m,Q,1),F(_,Q,0),F(S,K,0),F(m,Q,1),F(S,K,0),F(y,K,1),F(S,Q,0),F(k,K,.5),F(y,K,1),F(k,K,.5),F(P,Q,0),F(y,K,1)):(F(m,Q,1),F(_,Q,0),F(L,K,1),F(_,Q,0),F(y,K,0),F(L,K,1),F(L,Q,1),F(y,K,0),F(k,K,.5),F(k,K,.5),F(y,K,0),F(T,Q,1)))}function Z(W,$,re,se,E,N){switch(t.strokeLineCap){case"round":E?j(W,re,$,N,.5):j(W,$,re,N,.5);break;case"square":if(E)h.subVectors($,W),f.set(h.y,-h.x),d.addVectors(h,f).add(W),p.subVectors(f,h).add(W),se?(d.toArray(s,1*3),p.toArray(s,0*3),p.toArray(s,3*3)):(d.toArray(s,1*3),a[3*2+1]===1?p.toArray(s,3*3):d.toArray(s,3*3),p.toArray(s,0*3));else{h.subVectors(re,W),f.set(h.y,-h.x),d.addVectors(h,f).add(W),p.subVectors(f,h).add(W);const ae=s.length;se?(d.toArray(s,ae-1*3),p.toArray(s,ae-2*3),p.toArray(s,ae-4*3)):(p.toArray(s,ae-2*3),d.toArray(s,ae-1*3),p.toArray(s,ae-4*3))}break}}function X(W){let $=!1;for(let se=1,E=W.length-1;se<E;se++)if(W[se].distanceTo(W[se+1])<r){$=!0;break}if(!$)return W;const re=[];re.push(W[0]);for(let se=1,E=W.length-1;se<E;se++)W[se].distanceTo(W[se+1])>=r&&re.push(W[se]);return re.push(W[W.length-1]),re}}}const hr=new WeakMap;class al extends l.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const s=new l.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,i=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(i,a).then(t).catch(r)},n,r)}decodeDracoFile(e,t,n,r){const s={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const c in t.attributeTypes){const h=t.attributeTypes[c];h.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[c]=h.name)}const n=JSON.stringify(t);if(hr.has(e)){const c=hr.get(e);if(c.key===n)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,i=e.byteLength,a=this._getWorker(s,i).then(c=>(r=c,new Promise((h,f)=>{r._callbacks[s]={resolve:h,reject:f},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),hr.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new l.BufferGeometry;e.index&&t.setIndex(new l.BufferAttribute(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],s=r.name,i=r.array,a=r.itemSize;t.setAttribute(s,new l.BufferAttribute(i,a))}return t}_loadLibrary(e,t){const n=new l.FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((r,s)=>{n.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const r=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const s=ll.toString(),i=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){const i=s.data;switch(i.type){case"decode":r._callbacks[i.id].resolve(i);break;case"error":r._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function ll(){let o,e;onmessage=function(i){const a=i.data;switch(a.type){case"init":o=a.decoderConfig,e=new Promise(function(f){o.onModuleLoaded=function(d){f({draco:d})},DracoDecoderModule(o)});break;case"decode":const c=a.buffer,h=a.taskConfig;e.then(f=>{const d=f.draco,p=new d.Decoder,g=new d.DecoderBuffer;g.Init(new Int8Array(c),c.byteLength);try{const x=t(d,p,g,h),v=x.attributes.map(_=>_.array.buffer);x.index&&v.push(x.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:x},v)}catch(x){console.error(x),self.postMessage({type:"error",id:a.id,error:x.message})}finally{d.destroy(g),d.destroy(p)}});break}};function t(i,a,c,h){const f=h.attributeIDs,d=h.attributeTypes;let p,g;const x=a.GetEncodedGeometryType(c);if(x===i.TRIANGULAR_MESH)p=new i.Mesh,g=a.DecodeBufferToMesh(c,p);else if(x===i.POINT_CLOUD)p=new i.PointCloud,g=a.DecodeBufferToPointCloud(c,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!g.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+g.error_msg());const v={index:null,attributes:[]};for(const _ in f){const m=self[d[_]];let M,b;if(h.useUniqueIDs)b=f[_],M=a.GetAttributeByUniqueId(p,b);else{if(b=a.GetAttributeId(p,i[f[_]]),b===-1)continue;M=a.GetAttribute(p,b)}v.attributes.push(r(i,a,p,_,m,M))}return x===i.TRIANGULAR_MESH&&(v.index=n(i,a,p)),i.destroy(p),v}function n(i,a,c){const f=c.num_faces()*3,d=f*4,p=i._malloc(d);a.GetTrianglesUInt32Array(c,d,p);const g=new Uint32Array(i.HEAPF32.buffer,p,f).slice();return i._free(p),{array:g,itemSize:1}}function r(i,a,c,h,f,d){const p=d.num_components(),x=c.num_points()*p,v=x*f.BYTES_PER_ELEMENT,_=s(i,f),m=i._malloc(v);a.GetAttributeDataArrayForAllPoints(c,d,_,v,m);const M=new f(i.HEAPF32.buffer,m,x).slice();return i._free(m),{name:h,array:M,itemSize:p}}function s(i,a){switch(a){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32}}}class ks extends l.Line{constructor(e,t){const n=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],r=new l.BufferGeometry;r.setAttribute("position",new l.Float32BufferAttribute(n,3)),r.computeBoundingSphere();const s=new l.LineBasicMaterial({fog:!1});super(r,s),this.light=e,this.color=t,this.type="RectAreaLightHelper";const i=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],a=new l.BufferGeometry;a.setAttribute("position",new l.Float32BufferAttribute(i,3)),a.computeBoundingSphere(),this.add(new l.Mesh(a,new l.MeshBasicMaterial({side:l.BackSide,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const cl=["args","center"],ul=u.defineComponent({__name:"Text3D",props:{font:{},text:{},size:{default:.5},height:{default:.2},curveSegments:{default:5},bevelEnabled:{type:Boolean,default:!0},bevelThickness:{default:.05},bevelSize:{default:.02},bevelOffset:{default:0},bevelSegments:{default:4},center:{type:Boolean,default:!1},needUpdates:{type:Boolean,default:!1}},async setup(o,{expose:e}){let t,n;const r=o,{center:s,font:i,text:a,needUpdates:c,size:h,height:f,curveSegments:d,bevelEnabled:p,bevelThickness:g,bevelSize:x,bevelOffset:v,bevelSegments:_}=u.toRefs(r),{extend:m}=ie.useTresContext();m({TextGeometry:bs});const M=new rl,b=u.useSlots(),S=u.computed(()=>{var y;return a!=null&&a.value?a.value:b.default?(y=b.default()[0].children)==null?void 0:y.trim():c.value?"":"TresJS"}),L=u.shallowRef();e({value:L});const P=([t,n]=u.withAsyncContext(()=>new Promise((y,A)=>{try{typeof i.value=="string"?M.load(i.value,w=>{y(w)}):y(i.value)}catch(w){A(console.error("cientos",w))}})),t=await t,n(),t),T=u.computed(()=>({font:P,size:u.toValue(h),height:u.toValue(f),curveSegments:u.toValue(d),bevelEnabled:u.toValue(p),bevelThickness:u.toValue(g),bevelSize:u.toValue(x),bevelOffset:u.toValue(v),bevelSegments:u.toValue(_)}));return u.watchEffect(()=>{L.value&&c.value&&(L.value.geometry.dispose(),L.value.geometry=new bs(S.value,T.value),s.value&&L.value.geometry.center())}),(y,A)=>u.unref(i)?(u.openBlock(),u.createElementBlock("TresMesh",{key:0,ref_key:"text3DRef",ref:L},[S.value?(u.openBlock(),u.createElementBlock("TresTextGeometry",{key:0,args:[S.value,T.value],center:u.unref(s)},null,8,cl)):u.createCommentVNode("",!0),u.renderSlot(y.$slots,"default")],512)):u.createCommentVNode("",!0)}});function hl(o,e){const t=u.ref(e),n=new l.AnimationMixer(t.value),r=u.shallowReactive({});o.forEach(i=>{const a=n.clipAction(i,t.value);r[i.name]=a});const{onLoop:s}=ie.useRenderLoop();return s(({delta:i})=>{n.update(i)}),{actions:r,mixer:n}}const fl=u.defineComponent({__name:"Levioso",props:{speed:{default:1},rotationFactor:{default:1},floatFactor:{default:1},range:{default:()=>[-.1,.1]}},setup(o,{expose:e}){const t=o,n=u.shallowRef();e({value:n});{const c=Math.random()*1e4,{onLoop:h}=ie.useRenderLoop();let f=c;h(({delta:d})=>{if(!n.value)return;f+=d*t.speed;const p=f*.25,g=n.value;g.rotation.x=Math.cos(p)*.125*t.rotationFactor,g.rotation.y=Math.sin(p)*.125*t.rotationFactor,g.rotation.z=Math.sin(p)*.05*t.rotationFactor,g.position.y=l.MathUtils.mapLinear(Math.sin(p),-1,1,t.range[0],t.range[1])*t.floatFactor})}return(r,s)=>(u.openBlock(),u.createElementBlock("TresGroup",u.mergeProps(r.$attrs,{ref_key:"groupRef",ref:n}),[u.renderSlot(r.$slots,"default")],16))}});class tn extends l.Mesh{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new l.PerspectiveCamera;const n=this,r=t.color!==void 0?new l.Color(t.color):new l.Color(8355711),s=t.textureWidth||512,i=t.textureHeight||512,a=t.clipBias||0,c=t.shader||tn.ReflectorShader,h=t.multisample!==void 0?t.multisample:4,f=new l.Plane,d=new l.Vector3,p=new l.Vector3,g=new l.Vector3,x=new l.Matrix4,v=new l.Vector3(0,0,-1),_=new l.Vector4,m=new l.Vector3,M=new l.Vector3,b=new l.Vector4,S=new l.Matrix4,L=this.camera,P=new l.WebGLRenderTarget(s,i,{samples:h,type:l.HalfFloatType}),T=new l.ShaderMaterial({name:c.name!==void 0?c.name:"unspecified",uniforms:l.UniformsUtils.clone(c.uniforms),fragmentShader:c.fragmentShader,vertexShader:c.vertexShader});T.uniforms.tDiffuse.value=P.texture,T.uniforms.color.value=r,T.uniforms.textureMatrix.value=S,this.material=T,this.onBeforeRender=function(y,A,w){if(p.setFromMatrixPosition(n.matrixWorld),g.setFromMatrixPosition(w.matrixWorld),x.extractRotation(n.matrixWorld),d.set(0,0,1),d.applyMatrix4(x),m.subVectors(p,g),m.dot(d)>0)return;m.reflect(d).negate(),m.add(p),x.extractRotation(w.matrixWorld),v.set(0,0,-1),v.applyMatrix4(x),v.add(g),M.subVectors(p,v),M.reflect(d).negate(),M.add(p),L.position.copy(m),L.up.set(0,1,0),L.up.applyMatrix4(x),L.up.reflect(d),L.lookAt(M),L.far=w.far,L.updateMatrixWorld(),L.projectionMatrix.copy(w.projectionMatrix),S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(L.projectionMatrix),S.multiply(L.matrixWorldInverse),S.multiply(n.matrixWorld),f.setFromNormalAndCoplanarPoint(d,p),f.applyMatrix4(L.matrixWorldInverse),_.set(f.normal.x,f.normal.y,f.normal.z,f.constant);const D=L.projectionMatrix;b.x=(Math.sign(_.x)+D.elements[8])/D.elements[0],b.y=(Math.sign(_.y)+D.elements[9])/D.elements[5],b.z=-1,b.w=(1+D.elements[10])/D.elements[14],_.multiplyScalar(2/_.dot(b)),D.elements[2]=_.x,D.elements[6]=_.y,D.elements[10]=_.z+1-a,D.elements[14]=_.w,n.visible=!1;const k=y.getRenderTarget(),R=y.xr.enabled,V=y.shadowMap.autoUpdate;y.xr.enabled=!1,y.shadowMap.autoUpdate=!1,y.setRenderTarget(P),y.state.buffers.depth.setMask(!0),y.autoClear===!1&&y.clear(),y.render(A,L),y.xr.enabled=R,y.shadowMap.autoUpdate=V,y.setRenderTarget(k);const Y=w.viewport;Y!==void 0&&y.state.viewport(Y),n.visible=!0},this.getRenderTarget=function(){return P},this.dispose=function(){P.dispose(),n.material.dispose()}}}tn.ReflectorShader={name:"ReflectorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};const dl=["args","material-uniforms-color-value"],pl=u.createElementVNode("TresPlaneGeometry",{args:[5,5]},null,-1),ml=u.defineComponent({__name:"Reflector",props:{color:{default:"#333"},textureWidth:{default:512},textureHeight:{default:512},clipBias:{default:0},multisample:{default:4},shader:{default:tn.ReflectorShader}},setup(o,{expose:e}){const t=o,{extend:n}=ie.useTresContext(),r=u.shallowRef();n({Reflector:tn});const{color:s,textureWidth:i,textureHeight:a,clipBias:c,multisample:h,shader:f}=u.toRefs(t);return e({reflectorRef:r}),(d,p)=>(u.openBlock(),u.createElementBlock("TresReflector",{ref_key:"reflectorRef",ref:r,args:[void 0,{textureWidth:u.unref(i),textureHeight:u.unref(a),clipBias:u.unref(c),multisample:u.unref(h),shader:u.unref(f)}],"material-uniforms-color-value":u.unref(s)},[u.renderSlot(d.$slots,"default",{},()=>[pl])],8,dl))}});function fr(o){return u.getCurrentScope()?(u.onScopeDispose(o),!0):!1}function Xe(o){return typeof o=="function"?o():u.unref(o)}const gl=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const yl=Object.prototype.toString,vl=o=>yl.call(o)==="[object Object]",Lt=()=>{};function dr(o,e){function t(...n){return new Promise((r,s)=>{Promise.resolve(o(()=>e.apply(this,n),{fn:e,thisArg:this,args:n})).then(r).catch(s)})}return t}const _l=o=>o();function xl(o,e={}){let t,n,r=Lt;const s=a=>{clearTimeout(a),r(),r=Lt};return a=>{const c=Xe(o),h=Xe(e.maxWait);return t&&s(t),c<=0||h!==void 0&&h<=0?(n&&(s(n),n=null),Promise.resolve(a())):new Promise((f,d)=>{r=e.rejectOnCancel?d:f,h&&!n&&(n=setTimeout(()=>{t&&s(t),n=null,f(a())},h)),t=setTimeout(()=>{n&&s(n),n=null,f(a())},c)})}}function Bs(...o){let e=0,t,n=!0,r=Lt,s,i,a,c,h;!u.isRef(o[0])&&typeof o[0]=="object"?{delay:i,trailing:a=!0,leading:c=!0,rejectOnCancel:h=!1}=o[0]:[i,a=!0,c=!0,h=!1]=o;const f=()=>{t&&(clearTimeout(t),t=void 0,r(),r=Lt)};return p=>{const g=Xe(i),x=Date.now()-e,v=()=>s=p();return f(),g<=0?(e=Date.now(),v()):(x>g&&(c||!n)?(e=Date.now(),v()):a&&(s=new Promise((_,m)=>{r=h?m:_,t=setTimeout(()=>{e=Date.now(),n=!0,_(v()),f()},Math.max(0,g-x))})),!c&&!t&&(t=setTimeout(()=>n=!0,g)),n=!1,s)}}function wl(o){return u.getCurrentInstance()}function bl(o,e=200,t={}){return dr(xl(e,t),o)}function Ml(o,e=200,t=!1,n=!0,r=!1){return dr(Bs(e,t,n,r),o)}function Sl(o,e,t={}){const{eventFilter:n=_l,...r}=t;return u.watch(o,dr(n,e),r)}function pr(o,e=!0,t){wl()?u.onMounted(o,t):e?o():u.nextTick(o)}function Al(o,e,t={}){const{throttle:n=0,trailing:r=!0,leading:s=!0,...i}=t;return Sl(o,e,{...i,eventFilter:Bs(n,r,s)})}function _t(o){var e;const t=Xe(o);return(e=t==null?void 0:t.$el)!=null?e:t}const lt=gl?window:void 0;function Ie(...o){let e,t,n,r;if(typeof o[0]=="string"||Array.isArray(o[0])?([t,n,r]=o,e=lt):[e,t,n,r]=o,!e)return Lt;Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]);const s=[],i=()=>{s.forEach(f=>f()),s.length=0},a=(f,d,p,g)=>(f.addEventListener(d,p,g),()=>f.removeEventListener(d,p,g)),c=u.watch(()=>[_t(e),Xe(r)],([f,d])=>{if(i(),!f)return;const p=vl(d)?{...d}:d;s.push(...t.flatMap(g=>n.map(x=>a(f,g,x,p))))},{immediate:!0,flush:"post"}),h=()=>{c(),i()};return fr(h),h}function Cl(o){return typeof o=="function"?o:typeof o=="string"?e=>e.key===o:Array.isArray(o)?e=>o.includes(e.key):()=>!0}function Ot(...o){let e,t,n={};o.length===3?(e=o[0],t=o[1],n=o[2]):o.length===2?typeof o[1]=="object"?(e=!0,t=o[0],n=o[1]):(e=o[0],t=o[1]):(e=!0,t=o[0]);const{target:r=lt,eventName:s="keydown",passive:i=!1,dedupe:a=!1}=n,c=Cl(e);return Ie(r,s,f=>{f.repeat&&Xe(a)||c(f)&&t(f)},i)}function Pl(){const o=u.ref(!1),e=u.getCurrentInstance();return e&&u.onMounted(()=>{o.value=!0},e),o}function Fs(o){const e=Pl();return u.computed(()=>(e.value,!!o()))}function Tl(o,e={}){const{window:t=lt}=e,n=Fs(()=>t&&"matchMedia"in t&&typeof t.matchMedia=="function");let r;const s=u.ref(!1),i=h=>{s.value=h.matches},a=()=>{r&&("removeEventListener"in r?r.removeEventListener("change",i):r.removeListener(i))},c=u.watchEffect(()=>{n.value&&(a(),r=t.matchMedia(Xe(o)),"addEventListener"in r?r.addEventListener("change",i):r.addListener(i),s.value=r.matches)});return fr(()=>{c(),a(),r=void 0}),s}function Il(o,e,t={}){const{window:n=lt,...r}=t;let s;const i=Fs(()=>n&&"ResizeObserver"in n),a=()=>{s&&(s.disconnect(),s=void 0)},c=u.computed(()=>Array.isArray(o)?o.map(d=>_t(d)):[_t(o)]),h=u.watch(c,d=>{if(a(),i.value&&n){s=new ResizeObserver(e);for(const p of d)p&&s.observe(p,r)}},{immediate:!0,flush:"post"}),f=()=>{a(),h()};return fr(f),{isSupported:i,stop:f}}function Ll(o,e={width:0,height:0},t={}){const{window:n=lt,box:r="content-box"}=t,s=u.computed(()=>{var d,p;return(p=(d=_t(o))==null?void 0:d.namespaceURI)==null?void 0:p.includes("svg")}),i=u.ref(e.width),a=u.ref(e.height),{stop:c}=Il(o,([d])=>{const p=r==="border-box"?d.borderBoxSize:r==="content-box"?d.contentBoxSize:d.devicePixelContentBoxSize;if(n&&s.value){const g=_t(o);if(g){const x=n.getComputedStyle(g);i.value=Number.parseFloat(x.width),a.value=Number.parseFloat(x.height)}}else if(p){const g=Array.isArray(p)?p:[p];i.value=g.reduce((x,{inlineSize:v})=>x+v,0),a.value=g.reduce((x,{blockSize:v})=>x+v,0)}else i.value=d.contentRect.width,a.value=d.contentRect.height},t);pr(()=>{const d=_t(o);d&&(i.value="offsetWidth"in d?d.offsetWidth:e.width,a.value="offsetHeight"in d?d.offsetHeight:e.height)});const h=u.watch(()=>_t(o),d=>{i.value=d?e.width:0,a.value=d?e.height:0});function f(){c(),h()}return{width:i,height:a,stop:f}}const Us=1;function Ol(o,e={}){const{throttle:t=0,idle:n=200,onStop:r=Lt,onScroll:s=Lt,offset:i={left:0,right:0,top:0,bottom:0},eventListenerOptions:a={capture:!1,passive:!0},behavior:c="auto",window:h=lt,onError:f=T=>{console.error(T)}}=e,d=u.ref(0),p=u.ref(0),g=u.computed({get(){return d.value},set(T){v(T,void 0)}}),x=u.computed({get(){return p.value},set(T){v(void 0,T)}});function v(T,y){var A,w,D;if(!h)return;const k=Xe(o);k&&((D=k instanceof Document?h.document.body:k)==null||D.scrollTo({top:(A=Xe(y))!=null?A:x.value,left:(w=Xe(T))!=null?w:g.value,behavior:Xe(c)}))}const _=u.ref(!1),m=u.reactive({left:!0,right:!1,top:!0,bottom:!1}),M=u.reactive({left:!1,right:!1,top:!1,bottom:!1}),b=T=>{_.value&&(_.value=!1,M.left=!1,M.right=!1,M.top=!1,M.bottom=!1,r(T))},S=bl(b,t+n),L=T=>{var y;if(!h)return;const A=((y=T==null?void 0:T.document)==null?void 0:y.documentElement)||(T==null?void 0:T.documentElement)||_t(T),{display:w,flexDirection:D}=getComputedStyle(A),k=A.scrollLeft;M.left=k<d.value,M.right=k>d.value;const R=Math.abs(k)<=(i.left||0),V=Math.abs(k)+A.clientWidth>=A.scrollWidth-(i.right||0)-Us;w==="flex"&&D==="row-reverse"?(m.left=V,m.right=R):(m.left=R,m.right=V),d.value=k;let Y=A.scrollTop;T===h.document&&!Y&&(Y=h.document.body.scrollTop),M.top=Y<p.value,M.bottom=Y>p.value;const G=Math.abs(Y)<=(i.top||0),Q=Math.abs(Y)+A.clientHeight>=A.scrollHeight-(i.bottom||0)-Us;w==="flex"&&D==="column-reverse"?(m.top=Q,m.bottom=G):(m.top=G,m.bottom=Q),p.value=Y},P=T=>{var y;if(!h)return;const A=(y=T.target.documentElement)!=null?y:T.target;L(A),_.value=!0,S(T),s(T)};return Ie(o,"scroll",t?Ml(P,t,!0,!1):P,a),pr(()=>{try{const T=Xe(o);if(!T)return;L(T)}catch(T){f(T)}}),Ie(o,"scrollend",b,a),{x:g,y:x,isScrolling:_,arrivedState:m,directions:M,measure(){const T=Xe(o);h&&T&&L(T)}}}const Dl={page:o=>[o.pageX,o.pageY],client:o=>[o.clientX,o.clientY],screen:o=>[o.screenX,o.screenY],movement:o=>o instanceof Touch?null:[o.movementX,o.movementY]};function kl(o={}){const{type:e="page",touch:t=!0,resetOnTouchEnds:n=!1,initialValue:r={x:0,y:0},window:s=lt,target:i=s,scroll:a=!0,eventFilter:c}=o;let h=null;const f=u.ref(r.x),d=u.ref(r.y),p=u.ref(null),g=typeof e=="function"?e:Dl[e],x=L=>{const P=g(L);h=L,P&&([f.value,d.value]=P,p.value="mouse")},v=L=>{if(L.touches.length>0){const P=g(L.touches[0]);P&&([f.value,d.value]=P,p.value="touch")}},_=()=>{if(!h||!s)return;const L=g(h);h instanceof MouseEvent&&L&&(f.value=L[0]+s.scrollX,d.value=L[1]+s.scrollY)},m=()=>{f.value=r.x,d.value=r.y},M=c?L=>c(()=>x(L),{}):L=>x(L),b=c?L=>c(()=>v(L),{}):L=>v(L),S=c?()=>c(()=>_(),{}):()=>_();if(i){const L={passive:!0};Ie(i,["mousemove","dragover"],M,L),t&&e!=="movement"&&(Ie(i,["touchstart","touchmove"],b,L),n&&Ie(i,"touchend",m,L)),a&&e==="page"&&Ie(s,"scroll",S,{passive:!0})}return{x:f,y:d,sourceType:p}}function Bl(o={}){const{window:e=lt,behavior:t="auto"}=o;if(!e)return{x:u.ref(0),y:u.ref(0)};const n=u.ref(e.scrollX),r=u.ref(e.scrollY),s=u.computed({get(){return n.value},set(a){scrollTo({left:a,behavior:t})}}),i=u.computed({get(){return r.value},set(a){scrollTo({top:a,behavior:t})}});return Ie(e,"scroll",()=>{n.value=e.scrollX,r.value=e.scrollY},{capture:!1,passive:!0}),{x:s,y:i}}function Ns(o={}){const{window:e=lt,initialWidth:t=Number.POSITIVE_INFINITY,initialHeight:n=Number.POSITIVE_INFINITY,listenOrientation:r=!0,includeScrollbar:s=!0}=o,i=u.ref(t),a=u.ref(n),c=()=>{e&&(s?(i.value=e.innerWidth,a.value=e.innerHeight):(i.value=e.document.documentElement.clientWidth,a.value=e.document.documentElement.clientHeight))};if(c(),pr(c),Ie("resize",c,{passive:!0}),r){const h=Tl("(orientation: portrait)");u.watch(h,()=>c())}return{width:i,height:a}}const Fl=u.defineComponent({__name:"MouseParallax",props:{disabled:{type:Boolean,default:!1},factor:{default:2.5},ease:{default:.1},local:{type:Boolean,default:!1}},setup(o){const e=o,{camera:t,renderer:n}=ie.useTresContext(),{disabled:r,factor:s,ease:i,local:a}=u.toRefs(e),c={};a.value&&(c.target=n.value.domElement,c.type="client");const{x:h,y:f}=kl(c),{width:d,height:p}=a.value?Ll(n.value.domElement):Ns(),g=u.ref(),x=u.computed(()=>(h.value/d.value-.5)*s.value),v=u.computed(()=>-(f.value/p.value-.5)*s.value),{onLoop:_}=ie.useRenderLoop();return _(({delta:m})=>{r.value||!g.value||Number.isNaN(x.value)||Number.isNaN(v.value)||(g.value.position.x+=(x.value-g.value.position.x)*i.value*m,g.value.position.y+=(v.value-g.value.position.y)*i.value*m)}),u.watch(()=>g.value,m=>m==null?void 0:m.add(t.value)),(m,M)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"cameraGroupRef",ref:g},null,512))}}),Ul=u.defineComponent({name:"GlobalAudio",props:["src","loop","volume","playbackRate","playTrigger","stopTrigger"],async setup(o,{expose:e,emit:t}){var d;const{camera:n,renderer:r}=ie.useTresContext(),s=new l.AudioListener;(d=n.value)==null||d.add(s);const i=new l.Audio(s),a=new l.AudioLoader;e({sound:i}),u.onUnmounted(()=>{i&&i.disconnect()}),u.watch(()=>[o.playbackRate],()=>i.setPlaybackRate(o.playbackRate??1),{immediate:!0}),u.watch(()=>[o.volume],()=>i.setVolume(o.volume??.5),{immediate:!0}),u.watch(()=>[o.loop],()=>i.setLoop(o.loop??!1),{immediate:!0}),u.watch(()=>[o.src],async()=>{const p=await a.loadAsync(o.src);i.setBuffer(p)},{immediate:!0});const h=document.getElementById(o.playTrigger??"")||r.value.domElement;Ie(h,"click",()=>{i.isPlaying?i.pause():i.play(),t("isPlaying",i.isPlaying)});const f=document.getElementById(o.stopTrigger??"");return f&&Ie(f,"click",()=>{i.stop(),t("isPlaying",i.isPlaying)}),null}});class nn extends l.Mesh{constructor(){super(nn.Geometry,new l.MeshBasicMaterial({opacity:0,transparent:!0})),this.isLensflare=!0,this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const e=new l.Vector3,t=new l.Vector3,n=new l.FramebufferTexture(16,16),r=new l.FramebufferTexture(16,16);let s=l.UnsignedByteType;const i=nn.Geometry,a=new l.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;

				void main() {

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				void main() {

					gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );

				}`,depthTest:!0,depthWrite:!1,transparent:!1}),c=new l.RawShaderMaterial({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;
				attribute vec2 uv;

				varying vec2 vUV;

				void main() {

					vUV = uv;

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				uniform sampler2D map;

				varying vec2 vUV;

				void main() {

					gl_FragColor = texture2D( map, vUV );

				}`,depthTest:!1,depthWrite:!1,transparent:!1}),h=new l.Mesh(i,a),f=[],d=Vs.Shader,p=new l.RawShaderMaterial({name:d.name,uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new l.Color(16777215)},scale:{value:new l.Vector2},screenPosition:{value:new l.Vector3}},vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:l.AdditiveBlending,transparent:!0,depthWrite:!1}),g=new l.Mesh(i,p);this.addElement=function(M){f.push(M)};const x=new l.Vector2,v=new l.Vector2,_=new l.Box2,m=new l.Vector4;this.onBeforeRender=function(M,b,S){M.getCurrentViewport(m);const L=M.getRenderTarget(),P=L!==null?L.texture.type:l.UnsignedByteType;s!==P&&(n.dispose(),r.dispose(),n.type=r.type=P,s=P);const T=m.w/m.z,y=m.z/2,A=m.w/2;let w=16/m.w;if(x.set(w*T,w),_.min.set(m.x,m.y),_.max.set(m.x+(m.z-16),m.y+(m.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(S.matrixWorldInverse),!(t.z>0)&&(e.copy(t).applyMatrix4(S.projectionMatrix),v.x=m.x+e.x*y+y-8,v.y=m.y+e.y*A+A-8,_.containsPoint(v))){M.copyFramebufferToTexture(v,n);let D=a.uniforms;D.scale.value=x,D.screenPosition.value=e,M.renderBufferDirect(S,null,i,a,h,null),M.copyFramebufferToTexture(v,r),D=c.uniforms,D.scale.value=x,D.screenPosition.value=e,M.renderBufferDirect(S,null,i,c,h,null);const k=-e.x*2,R=-e.y*2;for(let V=0,Y=f.length;V<Y;V++){const G=f[V],Q=p.uniforms;Q.color.value.copy(G.color),Q.map.value=G.texture,Q.screenPosition.value.x=e.x+k*G.distance,Q.screenPosition.value.y=e.y+R*G.distance,w=G.size/m.w;const K=m.w/m.z;Q.scale.value.set(w*K,w),p.uniformsNeedUpdate=!0,M.renderBufferDirect(S,null,i,p,g,null)}}},this.dispose=function(){a.dispose(),c.dispose(),p.dispose(),n.dispose(),r.dispose();for(let M=0,b=f.length;M<b;M++)f[M].texture.dispose()}}}class Vs{constructor(e,t=1,n=0,r=new l.Color(16777215)){this.texture=e,this.size=t,this.distance=n,this.color=r}}Vs.Shader={name:"LensflareElementShader",uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:`

		precision highp float;

		uniform vec3 screenPosition;
		uniform vec2 scale;

		uniform sampler2D occlusionMap;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vUV = uv;

			vec2 pos = position.xy;

			vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );

			vVisibility =        visibility.r / 9.0;
			vVisibility *= 1.0 - visibility.g / 9.0;
			vVisibility *=       visibility.b / 9.0;

			gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D map;
		uniform vec3 color;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vec4 texture = texture2D( map, vUV );
			texture.a *= vVisibility;
			gl_FragColor = texture;
			gl_FragColor.rgb *= color;

		}`},nn.Geometry=function(){const o=new l.BufferGeometry,e=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),t=new l.InterleavedBuffer(e,5);return o.setIndex([0,1,2,0,2,3]),o.setAttribute("position",new l.InterleavedBufferAttribute(t,3,0,!1)),o.setAttribute("uv",new l.InterleavedBufferAttribute(t,2,3,!1)),o}();function Nl(o){return o}function Vl(o){return o*o*o}function zl(o){return o<.5?4*o*o*o:1-(-2*o+2)**3/2}function Gl(o){return o*o*o*o}function jl(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375}const zs=l.MathUtils.clamp;class Gs{constructor(e=0,t){ce(this,"_getNext");ce(this,"_getGenerator");this._getGenerator=t??this.getMulberry32,this._getNext=this._getGenerator(e)}seed(e){this._getNext=this._getGenerator(e)}rand(){return this._getNext()}float(e,t){return e+this._getNext()*(t-e)}floatSpread(e){return this.float(-.5*e,.5*e)}int(e,t){return e+Math.floor(this._getNext()*(t-e+1))}choice(e){return e.length?e[Math.floor(this._getNext()*e.length)]:null}defaultChoice(e,t){return e.length?e[Math.floor(this._getNext()*e.length)]:t}sample(e,t,n){const r=e.length;t=zs(t,0,r-1),n=zs(n??r-1,0,r-1);const s=this.int(t,n),i=this.shuffle(e.map((c,h)=>h)),a=Math.min(e.length,s);return i.slice(0,a).sort().map(c=>e[c])}shuffle(e){return e.map(t=>({value:t,sort:this._getNext()})).sort((t,n)=>t.sort-n.sort).map(({value:t})=>t)}getMulberry32(e=0){return e>0&&e<1&&(e=Math.floor(e*2**16)),()=>{e+=1831565813;let t=e;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}}const ct="https://raw.githubusercontent.com/Tresjs/assets/93976c7d63ac83d4a254a41a10b2362bc17e90c9/textures/lensflare/",mr=`${ct}circle.png`,Sn=`${ct}circleBlur.png`,Rl=`${ct}circleRainbow.png`,Wl=`${ct}line.png`,js=`${ct}poly6.png`,Rs=`${ct}polyStroke6.png`,Yl=`${ct}rays.png`,An=`${ct}ring.png`,El=`${ct}starThin6.png`,Xl={texture:[Wl,An],color:["white"],distance:[0,0],size:[750,1024],length:[0,2]},Zl={texture:[Sn],color:["white"],distance:[0,0],size:[180,512],length:[1,1]},ql={texture:[Yl],color:["white"],distance:[0,0],size:[180,512],length:[1,1]},Kl={texture:[mr,Rl,An,El],color:["white"],distance:[0,0],size:[180,512],length:[2,3]},[Ws,Ys]=[3679071,132442],gr=[Xl,Zl,ql,Kl,{texture:[Sn,mr,An,js,Rs],color:["dimgray","gray","darkgray",Ws,Ys],distance:[.5,2.5],size:[20,180],length:[5,21]},{texture:[Sn,mr,An,js,Rs],color:["dimgray","gray","darkgray",Ws,Ys],distance:[-.6,-.1],size:[180,360],length:[0,5]}],Cn={color:"white",distance:0,size:512,texture:Sn},Ql=[Nl,Vl,zl,Gl,jl],Es=l.MathUtils.lerp,Xs=(o=0,e=gr)=>{const n=new Gs(o).choice(Ql);return e.map((r,s)=>{const i=new Gs(o*(s*7907+1)+(typeof r.seed=="number"?r.seed:0)),a=i.int(r.length[0],r.length[1]);return Array.from({length:a}).fill(0).map(()=>{const c=n(i.rand());return{texture:i.defaultChoice(r.texture,Cn.texture),size:Es(r.size[0],r.size[1],n(1-c)),distance:Es(r.distance[0],r.distance[1],c),color:i.defaultChoice(r.color,Cn.color)}})}).flat()},Zs=(o,e,t=void 0,n=void 0,r=Cn)=>{if(o!==void 0&&o.length>0&&(typeof t=="number"||typeof n<"u")){const a=Xs(t??0,n??gr),c=a.length,h=o.length;return c>=h?a.map((f,d)=>Object.assign(f,e,d<h?o[d]:{})):o.map((f,d)=>Object.assign({},r,d<c?a[d]:{},e,f))}if(o!==void 0&&o.length>0){const a=Object.assign({},r,e);return o.map(c=>Object.assign({},a,c))}const s=n===void 0||n.length===0?gr:n;return Xs(t??0,s).map(a=>Object.assign({},a,e))};function Jl(o){return Hl(o,(e,t)=>t in Cn&&e!==void 0)}function Hl(o,e){const t={};return Object.keys(o).forEach(n=>{e(o[n],n)&&(t[n]=o[n])}),t}const $l=u.defineComponent({__name:"component",props:{scale:{default:1},elements:{default:void 0},seed:{default:void 0},seedProps:{default:void 0},color:{default:void 0},distance:{default:void 0},size:{default:void 0},texture:{default:void 0}},setup(o,{expose:e}){const t=o,n=u.shallowRef(),r=u.shallowRef([]),s=u.shallowRef(Jl(t));e({value:n});const i=new l.TextureLoader,a=new nn,c=[],h=()=>{var g,x,v;for(;c.length;)c.pop();(g=n.value)==null||g.children.forEach(_=>{"dispose"in _&&_.dispose()}),(x=n.value)==null||x.remove(...n.value.children),(v=n.value)==null||v.dispose()},f=g=>{if(typeof g.texture=="string"){const x=g.texture;g.texture=i.load(x),g.texture.name=x}return g.color=ie.normalizeColor(g.color),g},d=()=>{for(let g=r.value.length-1;g<c.length;g++)c[g].size=0;r.value.forEach((g,x)=>{c[x].size=g.size*t.scale})},p=()=>{for(;r.value.length>c.length;){const x={...f(r.value[c.length])};c.push(x),a.addElement(x)}r.value.forEach((g,x)=>{const v=c[x],{texture:_,size:m,distance:M,color:b}=g;if(typeof _=="string"){if(v.texture.name!==_){v.texture.dispose();const S=_;v.texture=i.load(S),v.texture.name=S}}else v.texture!==_&&(v.texture.dispose(),v.texture=_);v.size=m,v.distance=M,v.color=ie.normalizeColor(b)}),d()};return u.onUnmounted(()=>{h()}),u.onMounted(()=>{var g;(g=n.value)==null||g.add(a),r.value=Zs(t.elements,s.value,t.seed,t.seedProps)}),u.watch(()=>[t.color,t.distance,t.size,t.texture],()=>{s.value={color:t.color,distance:t.distance,size:t.size,texture:t.texture}}),u.watch(()=>[s.value,t.elements,t.seed,t.seedProps],()=>{r.value=Zs(t.elements,s.value,t.seed,t.seedProps)}),u.watch(()=>t.scale,()=>{d()}),u.watch(()=>r.value,()=>{p()}),(g,x)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"lensflareRef",ref:n},null,512))}});function qs(o){const e=u.ref(null),{height:t,width:n,settings:r,depth:s}=u.isReactive(o)?u.toRefs(o):u.toRefs(u.reactive(o)),{onLoop:i}=ie.useRenderLoop(),{camera:a,renderer:c,scene:h,sizes:f}=ie.useTresContext();return u.watchEffect(()=>{var d;(d=e.value)==null||d.dispose(),e.value=new l.WebGLRenderTarget((n==null?void 0:n.value)||f.width.value,(t==null?void 0:t.value)||f.height.value,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,type:l.HalfFloatType,...r==null?void 0:r.value}),s!=null&&s.value&&(e.value.depthTexture=new l.DepthTexture((n==null?void 0:n.value)||f.width.value,(t==null?void 0:t.value)||f.height.value,l.FloatType))}),i(()=>{c.value.setRenderTarget(e.value),c.value.clear(),c.value.render(h.value,a.value),c.value.setRenderTarget(null)}),u.onBeforeUnmount(()=>{var d;(d=e.value)==null||d.dispose()}),e}const ec=u.defineComponent({__name:"component",props:{width:{},height:{},depth:{type:Boolean,default:!1},settings:{default:void 0}},setup(o,{expose:e}){const n=qs(o);return e({value:n}),()=>{}}}),Ks=(o,e=16,t,n,r)=>{const s=new Float32Array(e*16),i=u.ref(new l.InterleavedBuffer(s,16));return(()=>{if(!o)return;const c=new zo(o);n&&c.setWeightAttribute(n),c.build();const h=new l.Vector3,f=new l.Vector3,d=new l.Color,p=new l.Object3D;o.updateMatrixWorld(!0);for(let g=0;g<e;g++)c.sample(h,f,d),typeof r=="function"?r({dummy:p,sampledMesh:o,position:h,normal:f,color:d},g):p.position.copy(h),p.updateMatrix(),t&&t.setMatrixAt(g,p.matrix),p.matrix.toArray(i.value.array,g*16);t&&(t.instanceMatrix.needsUpdate=!0),i.value.needsUpdate=!0})(),{buffer:i}},tc=u.defineComponent({__name:"component",props:{transform:{type:Function},weight:{},count:{},mesh:{},instanceMesh:{}},setup(o,{expose:e}){const t=o,n=u.ref(),r=u.ref(),s=u.ref();return u.watchEffect(()=>{var i,a;r.value=t.instanceMesh??((i=n.value)==null?void 0:i.children.find(c=>Object.prototype.hasOwnProperty.call(c,"instanceMatrix"))),s.value=t.mesh??((a=n.value)==null?void 0:a.children.find(c=>c.type==="Mesh")),Ks(s.value,t.count,r.value,t.weight,t.transform)}),e({samplerRef:n}),(i,a)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"samplerRef",ref:n},[u.renderSlot(i.$slots,"default")],512))}});class nc extends l.Line{constructor(e,t=1,n=16,r=2){const s=new l.BufferGeometry,i=n+r*2,a=new Float32Array((i*3+3)*3);s.setAttribute("position",new l.BufferAttribute(a,3));const c=new l.LineBasicMaterial({color:65280}),h=new l.LineBasicMaterial({color:16776960});super(s,[h,c]),this.audio=e,this.range=t,this.divisionsInnerAngle=n,this.divisionsOuterAngle=r,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,n=this.divisionsInnerAngle,r=this.divisionsOuterAngle,s=l.MathUtils.degToRad(e.panner.coneInnerAngle),i=l.MathUtils.degToRad(e.panner.coneOuterAngle),a=s/2,c=i/2;let h=0,f=0,d,p;const g=this.geometry,x=g.attributes.position;g.clearGroups();function v(_,m,M,b){const S=(m-_)/M;for(x.setXYZ(h,0,0,0),f++,d=_;d<m;d+=S)p=h+f,x.setXYZ(p,Math.sin(d)*t,0,Math.cos(d)*t),x.setXYZ(p+1,Math.sin(Math.min(d+S,m))*t,0,Math.cos(Math.min(d+S,m))*t),x.setXYZ(p+2,0,0,0),f+=3;g.addGroup(h,f,b),h+=f,f=0}v(-c,-a,r,0),v(-a,a,n,1),v(a,c,r,0),x.needsUpdate=!0,s===i&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}const rc=["args"],sc=u.defineComponent({__name:"PositionalAudio",props:{ready:{type:Boolean,default:!1},url:{},distance:{default:2},helper:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1},innerAngle:{default:360},outerAngle:{default:360},outerGain:{default:0}},emits:["isPlaying"],async setup(o,{expose:e,emit:t}){let n,r;const s=o,i=t,{ready:a,url:c,distance:h,helper:f,loop:d,autoplay:p,innerAngle:g,outerAngle:x,outerGain:v}=u.toRefs(s),{camera:_}=ie.useTresContext(),m=u.shallowRef(null),M=u.shallowRef(null),b=u.shallowRef(null),S=u.shallowReactive(new l.AudioListener),L=()=>{var R,V,Y;(R=m==null?void 0:m.value)!=null&&R.isPlaying||((V=m==null?void 0:m.value)==null||V.play(),i("isPlaying",(Y=m==null?void 0:m.value)==null?void 0:Y.isPlaying))},P=()=>{var R,V;(R=m==null?void 0:m.value)!=null&&R.isPlaying&&(m.value.pause(),i("isPlaying",(V=m==null?void 0:m.value)==null?void 0:V.isPlaying))},T=()=>{var R;m.value&&(m.value.stop(),i("isPlaying",(R=m==null?void 0:m.value)==null?void 0:R.isPlaying))},y=()=>{if(!(m!=null&&m.value))return;T();const R=m.value;R.source&&R.disconnect()},A=()=>{var R,V;!(m!=null&&m.value)||!(M!=null&&M.value)||((R=M==null?void 0:M.value)==null||R.dispose(),(V=m==null?void 0:m.value)==null||V.remove(M==null?void 0:M.value))},w=()=>{var R;if(m.value&&(m.value.setBuffer(b.value),m.value.setRefDistance(h.value),m.value.setLoop(d.value),m.value.setDirectionalCone(g.value,x.value,v.value),(R=M==null?void 0:M.value)==null||R.update(),M!=null&&M.value)){const V=M.value.material[0];!V.visible&&x.value!==g.value&&(V.visible=!0)}},D=()=>{var G,Q;w();const R=(G=m.value)==null?void 0:G.parent,V=new l.Box3().setFromObject(R),Y=(V.max.z-V.min.z)*2;M.value=new nc(m.value,Y,32,16),(Q=m==null?void 0:m.value)==null||Q.add(M.value),M.value.update()},k=()=>{var R;(R=_==null?void 0:_.value)==null||R.remove(S),y(),A()};return e({root:m,play:L,stop:T,pause:P,dispose:k}),b.value=([n,r]=u.withAsyncContext(()=>ie.useLoader(l.AudioLoader,c.value)),n=await n,r(),n),u.watch(m,()=>{m!=null&&m.value&&(f.value&&D(),a.value&&p&&L())}),u.watch(f,()=>{f.value?D():A()}),u.watch(a,()=>{a.value&&w(),p.value&&a.value&&L(),!p.value&&a.value&&T()}),u.watch([h,d,b,g,x,v,p],()=>{w()}),u.onMounted(()=>{var R;(R=_==null?void 0:_.value)==null||R.add(S)}),u.onBeforeUnmount(()=>{k()}),(R,V)=>(u.openBlock(),u.createElementBlock("TresPositionalAudio",u.mergeProps({ref_key:"positionalAudioRef",ref:m,args:[u.unref(S)]},R.$attrs),null,16,rc))}}),Pn={sunset:"venice/venice_sunset_1k.hdr",studio:"studio/poly_haven_studio_1k.hdr",city:"city/canary_wharf_1k.hdr",umbrellas:"outdoor/outdoor_umbrellas_1k.hdr",night:"outdoor/satara_night_1k.hdr",forest:"outood/mossy_forest_1k.hdr",snow:"outdoor/snowy_forest_path_01_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",hangar:"indoor/small_hangar_01_1k.hdr",urban:"indoor/abandoned_games_room_02_1k.hdr",modern:"city/modern_buildings_2_1k.hdr",shangai:"city/shanghai_bund_1k.hdr"},ic="https://raw.githubusercontent.com/Tresjs/assets/main/textures/hdr/";async function Qs(o,e){const{scene:t}=ie.useTresContext(),{preset:n,blur:r,files:s=[],path:i="",background:a}=u.toRefs(o),c=u.ref(),h=u.computed(()=>Array.isArray(s.value)),f=u.computed(()=>h.value?l.CubeTextureLoader:Ds),d=u.ref(null);return u.watch(()=>[s,i],async([p,g])=>{if(p.value.length>0&&!n.value){try{d.value=await ie.useLoader(u.unref(f),h.value?[u.unref(p)]:u.unref(p),x=>{g.value&&x.setPath(u.unref(g))})}catch(x){throw new Error(`Failed to load environment map: ${x}`)}d.value&&(c.value=h.value?d.value[0]:d.value,c.value.mapping=h.value?l.CubeReflectionMapping:l.EquirectangularReflectionMapping)}},{immediate:!0}),u.watch(()=>c.value,p=>{t.value&&(t.value.environment=p)},{immediate:!0}),u.watch(()=>[a.value,c.value],([p,g])=>{if(t.value){const x=e!=null&&e.value?e.value.texture:g;t.value.background=p?x:void 0}},{immediate:!0}),u.watch(()=>r==null?void 0:r.value,p=>{t.value&&(t.value.backgroundBlurriness=p)},{immediate:!0}),u.watch(n,async p=>{if(p&&p in Pn){const g=ic,x=Pn[p];try{d.value=await ie.useLoader(Ds,x,v=>{g&&v.setPath(g)})}catch(v){throw new Error(`Failed to load environment map: ${v}`)}d.value&&(c.value=d.value,c.value.mapping=l.EquirectangularReflectionMapping)}else if(p&&!(p in Pn))throw new Error(`Preset must be one of: ${Object.keys(Pn).join(", ")}`)},{immediate:!0}),{texture:c}}let xt=null;function oc(o,e){return t=>{e&&e(t),o.draco&&(xt||(xt=new al),xt.setDecoderPath(o.decoderPath||"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),t.setDRACOLoader(xt))}}async function Js(o,e={draco:!1},t){const n=await ie.useLoader(ea,o,oc(e,t));return xt==null||xt.dispose(),xt=null,n}const ac=["object"],lc=u.defineComponent({__name:"component",props:{path:{},draco:{type:Boolean,default:!1},decoderPath:{default:"https://www.gstatic.com/draco/versioned/decoders/1.4.1/"},castShadow:{type:Boolean,default:!1},receiveShadow:{type:Boolean,default:!1}},async setup(o,{expose:e}){let t,n;const r=o,s=u.ref();e({value:s});const{scene:i}=([t,n]=u.withAsyncContext(()=>Js(r.path,{draco:r.draco,decoderPath:r.decoderPath})),t=await t,n(),t);return(r.castShadow||r.receiveShadow)&&i.traverse(a=>{a.isMesh&&(a.castShadow=r.castShadow,a.receiveShadow=r.receiveShadow)}),(a,c)=>(u.openBlock(),u.createElementBlock("primitive",u.mergeProps({ref_key:"modelRef",ref:s,object:u.unref(i)},a.$attrs),null,16,ac))}});async function Hs(o){return await ie.useLoader(Wa,o)}const cc=["object"],uc=u.defineComponent({__name:"component",props:{path:{},castShadow:{type:Boolean,default:!1},receiveShadow:{type:Boolean,default:!1}},async setup(o,{expose:e}){let t,n;const r=o,s=u.ref();e({value:s});const i=([t,n]=u.withAsyncContext(()=>Hs(r.path)),t=await t,n(),t);return(r.castShadow||r.receiveShadow)&&i.traverse(a=>{a.isMesh&&(a.castShadow=r.castShadow,a.receiveShadow=r.receiveShadow)}),(a,c)=>(u.openBlock(),u.createElementBlock("primitive",u.mergeProps({ref_key:"modelRef",ref:s,object:u.unref(i)},a.$attrs),null,16,cc))}}),hc=["geometry","render-order"],fc=u.defineComponent({__name:"component",props:{src:{},skipStrokes:{type:Boolean,default:!1},skipFills:{type:Boolean,default:!1},fillMaterial:{},strokeMaterial:{},fillMeshProps:{},strokeMeshProps:{},depth:{default:"renderOrder"}},setup(o,{expose:e}){const t=o,{src:n,skipStrokes:r,skipFills:s,fillMaterial:i,strokeMaterial:a,fillMeshProps:c,strokeMeshProps:h,depth:f}=u.toRefs(t),d=u.shallowRef(),p=u.shallowRef([]),g=u.shallowRef([]);e({value:d}),u.watchEffect(async()=>x(n.value).then(m=>g.value=m.paths)),u.watch([s,r,i,a,g],_);async function x(m){const M=m.startsWith("<svg")?encodeURI(`data:image/svg+xml;utf8,${m}`):m;return ie.useLoader(en,M)}u.onUnmounted(v);function v(){p.value.forEach(m=>m.geometry.dispose())}function _(){var L,P,T;v();const m=[],[M,b]=(()=>{const y={flat:!1,renderOrder:!1,offsetZ:!0},A={flat:0,renderOrder:0,offsetZ:.025},w=f.value;return typeof w=="number"?[!0,w]:[y[w],A[w]]})();let S=0;for(const y of g.value){const A=((L=y.userData)==null?void 0:L.style)??{},w=Object.assign({color:A.fill,opacity:A.fillOpacity,transparent:!0,side:l.DoubleSide,depthWrite:M},t.fillMaterial);if(!s.value&&A.fill!==void 0&&A.fill!=="none")for(const D of en.createShapes(y)){const k=new l.ShapeGeometry(D);k.scale(1,-1,1),b&&k.translate(0,0,S++*b),m.push({geometry:k,material:w,isStroke:!1})}if(!r.value&&A.stroke!==void 0&&A.stroke!=="none"){const D=Object.assign({color:(P=y.userData)==null?void 0:P.style.stroke,opacity:(T=y.userData)==null?void 0:T.style.strokeOpacity,transparent:!0,side:l.DoubleSide,depthWrite:M},t.strokeMaterial);for(const k of y.subPaths){const R=k.getPoints().map(Y=>new l.Vector2(Y.x,-Y.y)),V=en.pointsToStroke(R,A||"none");b&&V.translate(0,0,S++*b),m.push({geometry:V,material:D,isStroke:!0})}}}p.value=m}return(m,M)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"svgRef",ref:d},[(u.openBlock(!0),u.createElementBlock(u.Fragment,null,u.renderList(p.value,({geometry:b,material:S,isStroke:L},P)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({key:`${P}`,ref_for:!0},L?u.unref(h):u.unref(c),{geometry:b,"render-order":u.unref(f)==="renderOrder"?P:0}),[u.createElementVNode("TresMeshBasicMaterial",u.mergeProps({ref_for:!0},S),null,16)],16,hc))),128))],512))}}),$s="[TresJS - Cientos   ] ";function yr(){function o(n,r){console.error(`${$s} ${n}`,r||"")}function e(n){console.warn(`${$s} ${n}`)}function t(n,r){}return{logError:o,logWarning:e,logMessage:t}}let vr=0;function dc(){const o=u.ref(!1),e=u.ref(0),t=u.ref([]),{logError:n}=yr();return new Promise(r=>{l.DefaultLoadingManager.onStart=()=>{o.value=!1},l.DefaultLoadingManager.onLoad=()=>{o.value=!0},l.DefaultLoadingManager.onProgress=(s,i,a)=>{i===a&&(vr=a,o.value=!0,t.value.push(s)),e.value=Math.round((i-vr)/(a-vr)*100||100,2)},l.DefaultLoadingManager.onError=s=>{n("Error loading assets",new Error(s)),o.value=!0},r({items:t,hasFinishLoading:o,progress:e})})}async function pc(o,e){const{logError:t}=yr();if(!o)return t("Error no path provided");const{unsuspend:n,start:r,crossOrigin:s,muted:i,loop:a,...c}={unsuspend:"loadedmetadata",crossOrigin:"Anonymous",muted:!0,loop:!0,start:!0,playsInline:!0,...e};function h(){return new Promise((f,d)=>{const p=Object.assign(document.createElement("video"),{src:typeof o=="string"&&o||void 0,crossOrigin:s,loop:a,muted:i,autoplay:!0,...c}),g=new l.VideoTexture(p);return p.addEventListener(n,()=>f(g)),p.addEventListener("error",()=>d(new Error("Error loading video"))),g})}try{const f=await h();return r&&f.image&&f.image.play(),f}catch{t("Error loading resource")}}const mc=["target","auto-rotate","auto-rotate-speed","enable-damping","damping-factor","enable-pan","key-pan-speed","keys","max-azimuth-angle","min-azimuth-angle","max-polar-angle","min-polar-angle","min-distance","max-distance","min-zoom","max-zoom","touches","enable-zoom","zoom-speed","enable-rotate","rotate-speed","args"],gc=u.defineComponent({__name:"OrbitControls",props:{makeDefault:{type:Boolean,default:!1},camera:{},domElement:{},target:{default:()=>[0,0,0]},enableDamping:{type:Boolean,default:!0},dampingFactor:{default:.05},autoRotate:{type:Boolean,default:!1},autoRotateSpeed:{default:2},enablePan:{type:Boolean,default:!0},keyPanSpeed:{default:7},keys:{},maxAzimuthAngle:{default:Number.POSITIVE_INFINITY},minAzimuthAngle:{default:Number.NEGATIVE_INFINITY},maxPolarAngle:{default:Math.PI},minPolarAngle:{default:0},minDistance:{default:0},maxDistance:{default:Number.POSITIVE_INFINITY},minZoom:{default:0},maxZoom:{default:Number.POSITIVE_INFINITY},touches:{default:()=>({ONE:l.TOUCH.ROTATE,TWO:l.TOUCH.DOLLY_PAN})},enableZoom:{type:Boolean,default:!0},zoomSpeed:{default:1},enableRotate:{type:Boolean,default:!0},rotateSpeed:{default:1}},emits:["change","start","end"],setup(o,{expose:e,emit:t}){const n=o,r=t,{makeDefault:s,autoRotate:i,autoRotateSpeed:a,enableDamping:c,dampingFactor:h,enablePan:f,keyPanSpeed:d,maxAzimuthAngle:p,minAzimuthAngle:g,maxPolarAngle:x,minPolarAngle:v,minDistance:_,maxDistance:m,minZoom:M,maxZoom:b,enableZoom:S,zoomSpeed:L,enableRotate:P,touches:T,rotateSpeed:y,target:A}=u.toRefs(n),{camera:w,renderer:D,extend:k,controls:R}=ie.useTresContext(),V=u.ref(null);k({OrbitControls:ms}),u.watch(V,Q=>{Y(),Q&&s.value?R.value=Q:R.value=null});function Y(){Ie(V.value,"change",()=>r("change",V.value)),Ie(V.value,"start",()=>r("start",V.value)),Ie(V.value,"end",()=>r("end",V.value))}const{onLoop:G}=ie.useRenderLoop();return G(()=>{V.value&&(c.value||i.value)&&V.value.update()}),u.onUnmounted(()=>{V.value&&V.value.dispose()}),e({value:V}),(Q,K)=>(Q.camera||u.unref(w))&&(Q.domElement||u.unref(D))?(u.openBlock(),u.createElementBlock("TresOrbitControls",{key:0,ref_key:"controlsRef",ref:V,target:u.unref(A),"auto-rotate":u.unref(i),"auto-rotate-speed":u.unref(a),"enable-damping":u.unref(c),"damping-factor":u.unref(h),"enable-pan":u.unref(f),"key-pan-speed":u.unref(d),keys:Q.keys,"max-azimuth-angle":u.unref(p),"min-azimuth-angle":u.unref(g),"max-polar-angle":u.unref(x),"min-polar-angle":u.unref(v),"min-distance":u.unref(_),"max-distance":u.unref(m),"min-zoom":u.unref(M),"max-zoom":u.unref(b),touches:u.unref(T),"enable-zoom":u.unref(S),"zoom-speed":u.unref(L),"enable-rotate":u.unref(P),"rotate-speed":u.unref(y),args:[Q.camera||u.unref(w),Q.domElement||u.unref(D).domElement]},null,8,mc)):u.createCommentVNode("",!0)}}),yc=5,vc=6,_c=.3,xc=u.defineComponent({__name:"KeyboardControls",props:{forward:{default:()=>["w","W"]},back:{default:()=>["s","S"]},left:{default:()=>["a","A"]},right:{default:()=>["d","D"]},jump:{default:()=>[" "]},gravity:{default:9.8},moveSpeed:{default:.1},headBobbing:{type:Boolean,default:!1},is2D:{type:Boolean,default:!1}},setup(o){var w;const e=o,{forward:t,back:n,left:r,right:s,jump:i,gravity:a,moveSpeed:c,headBobbing:h,is2D:f}=u.toRefs(e),{camera:d,controls:p}=ie.useTresContext(),g=u.ref(0),x=u.ref(0),v=u.ref(!1),_=u.ref(!1),m=u.ref(0),M=u.shallowRef(),b=f.value?"y":"z",S=((w=d.value.position)==null?void 0:w.y)||0;Ot(t.value,()=>{v.value=!0,x.value=c.value},{eventName:"keydown"}),Ot(n.value,()=>{v.value=!0,x.value=-c.value},{eventName:"keydown"}),Ot([...t.value,...n.value],()=>{v.value=!1,x.value=0},{eventName:"keyup"}),Ot(r.value,()=>{v.value=!0,g.value=-c.value},{eventName:"keydown"}),Ot(s.value,()=>{v.value=!0,g.value=c.value},{eventName:"keydown"}),Ot([...r.value,...s.value],()=>{v.value=!1,g.value=0},{eventName:"keyup"}),Ot(i.value,()=>{_.value||(m.value=Date.now()),_.value=!0});const L=D=>v.value?Math.sin(D*yc)*_c+S:S,P=()=>(Date.now()-m.value)/1e3*3,T=D=>S+vc*D-.5*a.value*D**2,y=()=>{if(_.value){const D=T(P());return D<=S&&(_.value=!1),D}return 0},{onLoop:A}=ie.useRenderLoop();return A(({elapsed:D})=>{var k;p.value instanceof tr&&((k=p.value)!=null&&k.isLocked)?(p.value.moveForward(x.value),p.value.moveRight(g.value),d.value.position&&(d.value.position.y=h.value?L(D):S,d.value.position.y+=y())):M.value.children.length>0&&!(p.value instanceof tr)&&(M.value.position.x+=g.value,M.value.position[b]+=f.value?x.value:-x.value)}),(D,k)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"wrapperRef",ref:M},[u.renderSlot(D.$slots,"default")],512))}}),wc=["object","args","mode","enabled","axis","translation-snap","rotation-snap","scale-snap","space","size","show-x","show-y","show-z"],bc=u.defineComponent({__name:"TransformControls",props:{object:{},camera:{},mode:{default:"translate"},enabled:{type:Boolean,default:!0},axis:{default:"XYZ"},translationSnap:{},rotationSnap:{},scaleSnap:{},space:{default:"world"},size:{default:1},showX:{type:Boolean,default:!0},showY:{type:Boolean,default:!0},showZ:{type:Boolean,default:!0}},emits:["dragging","change","mouseDown","mouseUp","objectChange"],setup(o,{emit:e}){const t=o,n=e,{object:r,mode:s,enabled:i,axis:a,translationSnap:c,rotationSnap:h,scaleSnap:f,space:d,size:p,showX:g,showY:x,showZ:v}=u.toRefs(t),_=u.shallowRef(),{controls:m,camera:M,renderer:b,extend:S}=ie.useTresContext();S({TransformControls:Ro});const L=T=>{m.value&&(m.value.enabled=!T.value),n("dragging",T.value)};function P(){Ie(_.value,"change",()=>n("change")),Ie(_.value,"dragging-changed",L),Ie(_.value,"mouseDown",()=>n("mouseDown")),Ie(_.value,"mouseUp",()=>n("mouseUp")),Ie(_.value,"objectChange",()=>n("objectChange"))}return u.watchEffect(()=>{_.value&&P()}),u.onUnmounted(()=>{_.value&&_.value.dispose()}),(T,y)=>{var A;return(T.camera||u.unref(M))&&u.unref(b)?(u.openBlock(),u.createElementBlock("TresTransformControls",{ref_key:"controlsRef",ref:_,key:(A=T.camera||u.unref(M))==null?void 0:A.uuid,object:u.unref(r),args:[T.camera||u.unref(M),u.unref(b).domElement],mode:u.unref(s),enabled:u.unref(i),axis:u.unref(a),"translation-snap":u.unref(c),"rotation-snap":u.unref(h),"scale-snap":u.unref(f),space:u.unref(d),size:u.unref(p),"show-x":u.unref(g),"show-y":u.unref(x),"show-z":u.unref(v),visible:!0},null,8,wc)):u.createCommentVNode("",!0)}}}),Mc=["args"],Sc=u.defineComponent({__name:"PointerLockControls",props:{makeDefault:{type:Boolean,default:!1},camera:{},domElement:{},selector:{}},emits:["isLock","change"],setup(o,{expose:e,emit:t}){const n=o,r=t,{camera:s,renderer:i,extend:a,controls:c}=ie.useTresContext(),h=u.ref(null);let f;a({PointerLockControls:tr});const d=p=>{r("isLock",p)};return u.watch(h,p=>{p&&n.makeDefault?c.value=p:c.value=null,f=document.getElementById(n.selector||"")||i.value.domElement,Ie(c.value,"change",()=>r("change",c.value)),Ie(f,"click",()=>{var x,v,_;(x=c.value)==null||x.lock(),(v=c.value)==null||v.addEventListener("lock",()=>d(!0)),(_=c.value)==null||_.addEventListener("unlock",()=>d(!1))})}),u.onUnmounted(()=>{var p,g;(p=c.value)==null||p.removeEventListener("lock",()=>d(!0)),(g=c.value)==null||g.removeEventListener("unlock",()=>d(!1)),h.value&&h.value.dispose()}),e({value:c}),(p,g)=>(p.camera||u.unref(s))&&(p.domElement||u.unref(i))?(u.openBlock(),u.createElementBlock("TresPointerLockControls",{key:0,ref_key:"controlsRef",ref:h,args:[p.camera||u.unref(s),p.domElement||u.unref(i).domElement]},null,8,Mc)):u.createCommentVNode("",!0)}}),Ac=["args"],Cc=u.defineComponent({__name:"MapControls",props:{makeDefault:{type:Boolean,default:!1},camera:{},domElement:{}},setup(o){const e=o,{camera:t,renderer:n,extend:r,controls:s}=ie.useTresContext(),i=u.ref(null);return r({MapControls:$o}),u.watch(s,a=>{a&&e.makeDefault?s.value=a:s.value=null}),u.onUnmounted(()=>{i.value&&i.value.dispose()}),(a,c)=>(a.camera||u.unref(t))&&(a.domElement||u.unref(n))?(u.openBlock(),u.createElementBlock("TresMapControls",{key:0,ref_key:"controlsRef",ref:i,args:[a.camera||u.unref(t),a.domElement||u.unref(n).domElement]},null,8,Ac)):u.createCommentVNode("",!0)}}),Pc=u.defineComponent({__name:"ScrollControls",props:{pages:{default:4},distance:{default:4},smoothScroll:{default:.1},horizontal:{type:Boolean,default:!1},htmlScroll:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:e}){const t=o,n=e,{logWarning:r}=ie.useLogger();t.smoothScroll<0&&r("SmoothControl must be greater than zero"),t.pages<0&&r("Pages must be greater than zero");const{camera:s,controls:i,renderer:a}=ie.useTresContext(),c=u.shallowRef(),h=document.createElement("div"),{y:f}=Bl(),{x:d,y:p,isScrolling:g}=Ol(h),{height:x,width:v}=Ns();let _=0;const m=u.ref(!1),M=u.ref(0),b=u.ref(0),S=u.ref(0),L=t.horizontal?"x":"y",P=u.watch(s,y=>{if(m.value){P();return}_=t.horizontal?(y==null?void 0:y.position.x)||0:(y==null?void 0:y.position.y)||0,m.value=!0},{immediate:!0});u.watch(g,y=>{i.value&&(i.value.enabled=!y)},{immediate:!0}),u.watch(f,y=>{!g.value&&!t.htmlScroll||(b.value=y/x.value/(S.value/x.value-1),M.value=-1*b.value,n("update:modelValue",b.value))}),u.watch(p,y=>{b.value=y/x.value/(S.value/x.value),M.value=-1*b.value,n("update:modelValue",b.value)}),u.watch(d,y=>{b.value=y/v.value/(S.value/v.value-1),M.value=+b.value,n("update:modelValue",b.value)}),u.watch(a,y=>{var w,D;const A=y==null?void 0:y.domElement;if(t.htmlScroll&&(y!=null&&y.domElement))A!=null&&A.style.width&&(A!=null&&A.style.position)&&(A!=null&&A.style.top)&&(A!=null&&A.style.left)&&(A.style.width="100%",A.style.position="fixed",A.style.zIndex=" -99999",A.style.top="0",A.style.left="0"),S.value=document.body.scrollHeight;else{const k=document.createElement("div"),R=document.createElement("div");h.style[t.horizontal?"overflowX":"overflowY"]="auto",h.style[t.horizontal?"overflowY":"overflowX"]="hidden",h.style.position="absolute",h.style.width="100%",h.style.height=" 100%",h.style.top="0",h.style.left="0",h.classList.add("scrollContainer"),k.style.position="sticky",k.style.top="0px",k.style.left="0px",k.style.width="100%",k.style.height="100%",k.style.overflow="hidden",h.appendChild(k),R.style.height=t.horizontal?"100%":`${x.value*t.pages}px`,R.style.width=t.horizontal?`${v.value*t.pages}px`:"100vw",R.style.pointerEvents="none",A.style.position="fixed",A.style.zIndex="0",A!=null&&A.style.width&&(A.style.width="100%"),h.appendChild(R),y.domElement.parentNode.style.position="relative",(D=(w=y==null?void 0:y.domElement)==null?void 0:w.parentNode)==null||D.appendChild(h),S.value=t.horizontal?v.value*t.pages:x.value*t.pages}},{immediate:!0});const{onLoop:T}=ie.useRenderLoop();return T(()=>{var y;if((y=s.value)!=null&&y.position){const A=(M.value*t.distance-s.value.position[L]+_)*t.smoothScroll;s.value.position[L]+=A,c.value.children.length>0&&(c.value.position[L]+=A)}}),(y,A)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"wrapperRef",ref:c},[u.renderSlot(y.$slots,"default")],512))}});/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Le={LEFT:1,RIGHT:2,MIDDLE:4},H=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Gt={NONE:0,IN:1,OUT:-1};function Dt(o){return o.isPerspectiveCamera}function wt(o){return o.isOrthographicCamera}const jt=Math.PI*2,ei=Math.PI/2,ti=1e-5,rn=Math.PI/180;function et(o,e,t){return Math.max(e,Math.min(t,o))}function Ce(o,e=ti){return Math.abs(o)<e}function Se(o,e,t=ti){return Ce(o-e,t)}function ni(o,e){return Math.round(o/e)*e}function sn(o){return isFinite(o)?o:o<0?-Number.MAX_VALUE:Number.MAX_VALUE}function on(o){return Math.abs(o)<Number.MAX_VALUE?o:o*(1/0)}function Tn(o,e,t,n,r=1/0,s){n=Math.max(1e-4,n);const i=2/n,a=i*s,c=1/(1+a+.48*a*a+.235*a*a*a);let h=o-e;const f=e,d=r*n;h=et(h,-d,d),e=o-h;const p=(t.value+i*h)*s;t.value=(t.value-i*p)*c;let g=e+(h+p)*c;return f-o>0==g>f&&(g=f,t.value=(g-f)/s),g}function ri(o,e,t,n,r=1/0,s,i){n=Math.max(1e-4,n);const a=2/n,c=a*s,h=1/(1+c+.48*c*c+.235*c*c*c);let f=e.x,d=e.y,p=e.z,g=o.x-f,x=o.y-d,v=o.z-p;const _=f,m=d,M=p,b=r*n,S=b*b,L=g*g+x*x+v*v;if(L>S){const Y=Math.sqrt(L);g=g/Y*b,x=x/Y*b,v=v/Y*b}f=o.x-g,d=o.y-x,p=o.z-v;const P=(t.x+a*g)*s,T=(t.y+a*x)*s,y=(t.z+a*v)*s;t.x=(t.x-a*P)*h,t.y=(t.y-a*T)*h,t.z=(t.z-a*y)*h,i.x=f+(g+P)*h,i.y=d+(x+T)*h,i.z=p+(v+y)*h;const A=_-o.x,w=m-o.y,D=M-o.z,k=i.x-_,R=i.y-m,V=i.z-M;return A*k+w*R+D*V>0&&(i.x=_,i.y=m,i.z=M,t.x=(i.x-_)/s,t.y=(i.y-m)/s,t.z=(i.z-M)/s),i}function _r(o,e){e.set(0,0),o.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=o.length,e.y/=o.length}function xr(o,e){return wt(o)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Tc{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,i=r.length;s<i;s++)r[s].call(this,e)}}}var wr;const Ic="2.8.3",In=1/8,Lc=/Mac/.test((wr=globalThis==null?void 0:globalThis.navigator)===null||wr===void 0?void 0:wr.platform);let fe,si,Ln,br,Re,ye,be,Rt,an,rt,st,kt,ii,oi,Je,ln,Wt,ai,Mr,li,Sr,Ar,On;class Ue extends Tc{static install(e){fe=e.THREE,si=Object.freeze(new fe.Vector3(0,0,0)),Ln=Object.freeze(new fe.Vector3(0,1,0)),br=Object.freeze(new fe.Vector3(0,0,1)),Re=new fe.Vector2,ye=new fe.Vector3,be=new fe.Vector3,Rt=new fe.Vector3,an=new fe.Vector3,rt=new fe.Vector3,st=new fe.Vector3,kt=new fe.Vector3,ii=new fe.Vector3,oi=new fe.Vector3,Je=new fe.Spherical,ln=new fe.Spherical,Wt=new fe.Box3,ai=new fe.Box3,Mr=new fe.Sphere,li=new fe.Quaternion,Sr=new fe.Quaternion,Ar=new fe.Matrix4,On=new fe.Raycaster}static get ACTION(){return H}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=H.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Gt.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new fe.Vector3,this._focalOffsetVelocity=new fe.Vector3,this._zoomVelocity={value:0},this._truckInternal=(m,M,b)=>{let S,L;if(Dt(this._camera)){const P=ye.copy(this._camera.position).sub(this._target),T=this._camera.getEffectiveFOV()*rn,y=P.length()*Math.tan(T*.5);S=this.truckSpeed*m*y/this._elementRect.height,L=this.truckSpeed*M*y/this._elementRect.height}else if(wt(this._camera)){const P=this._camera;S=m*(P.right-P.left)/P.zoom/this._elementRect.width,L=M*(P.top-P.bottom)/P.zoom/this._elementRect.height}else return;this.verticalDragToForward?(b?this.setFocalOffset(this._focalOffsetEnd.x+S,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(S,0,!0),this.forward(-L,!0)):b?this.setFocalOffset(this._focalOffsetEnd.x+S,this._focalOffsetEnd.y+L,this._focalOffsetEnd.z,!0):this.truck(S,L,!0)},this._rotateInternal=(m,M)=>{const b=jt*this.azimuthRotateSpeed*m/this._elementRect.height,S=jt*this.polarRotateSpeed*M/this._elementRect.height;this.rotate(b,S,!0)},this._dollyInternal=(m,M,b)=>{const S=Math.pow(.95,-m*this.dollySpeed),L=this._sphericalEnd.radius,P=this._sphericalEnd.radius*S,T=et(P,this.minDistance,this.maxDistance),y=T-P;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(P,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(y,!0),this._dollyToNoClamp(T,!0)):this._dollyToNoClamp(T,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?P:T)-L,this._dollyControlCoord.set(M,b)),this._lastDollyDirection=Math.sign(-m)},this._zoomInternal=(m,M,b)=>{const S=Math.pow(.95,m*this.dollySpeed),L=this._zoom,P=this._zoom*S;this.zoomTo(P,!0),this.dollyToCursor&&(this._changedZoom+=P-L,this._dollyControlCoord.set(M,b))},typeof fe>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new fe.Quaternion().setFromUnitVectors(this._camera.up,Ln),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=H.NONE,this._target=new fe.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new fe.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new fe.Spherical().setFromVector3(ye.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new fe.Vector3,new fe.Vector3,new fe.Vector3,new fe.Vector3],this._updateNearPlaneCorners(),this._boundary=new fe.Box3(new fe.Vector3(-1/0,-1/0,-1/0),new fe.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new fe.Vector2,this.mouseButtons={left:H.ROTATE,middle:H.DOLLY,right:H.TRUCK,wheel:Dt(this._camera)?H.DOLLY:wt(this._camera)?H.ZOOM:H.NONE},this.touches={one:H.TOUCH_ROTATE,two:Dt(this._camera)?H.TOUCH_DOLLY_TRUCK:wt(this._camera)?H.TOUCH_ZOOM_TRUCK:H.NONE,three:H.TOUCH_TRUCK};const n=new fe.Vector2,r=new fe.Vector2,s=new fe.Vector2,i=m=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const S=this._domElement.getBoundingClientRect(),L=m.clientX/S.width,P=m.clientY/S.height;if(L<this._interactiveArea.left||L>this._interactiveArea.right||P<this._interactiveArea.top||P>this._interactiveArea.bottom)return}const M=m.pointerType!=="mouse"?null:(m.buttons&Le.LEFT)===Le.LEFT?Le.LEFT:(m.buttons&Le.MIDDLE)===Le.MIDDLE?Le.MIDDLE:(m.buttons&Le.RIGHT)===Le.RIGHT?Le.RIGHT:null;if(M!==null){const S=this._findPointerByMouseButton(M);S&&this._disposePointer(S)}if((m.buttons&Le.LEFT)===Le.LEFT&&this._lockedPointer)return;const b={pointerId:m.pointerId,clientX:m.clientX,clientY:m.clientY,deltaX:0,deltaY:0,mouseButton:M};this._activePointers.push(b),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,p(m)},a=m=>{m.cancelable&&m.preventDefault();const M=m.pointerId,b=this._lockedPointer||this._findPointerById(M);if(b){if(b.clientX=m.clientX,b.clientY=m.clientY,b.deltaX=m.movementX,b.deltaY=m.movementY,this._state=0,m.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(m.buttons&Le.LEFT)===Le.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(m.buttons&Le.MIDDLE)===Le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(m.buttons&Le.RIGHT)===Le.RIGHT&&(this._state=this._state|this.mouseButtons.right);g()}},c=m=>{const M=this._findPointerById(m.pointerId);if(!(M&&M===this._lockedPointer)){if(M&&this._disposePointer(M),m.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=H.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=H.NONE;x()}};let h=-1;const f=m=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===H.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const P=this._domElement.getBoundingClientRect(),T=m.clientX/P.width,y=m.clientY/P.height;if(T<this._interactiveArea.left||T>this._interactiveArea.right||y<this._interactiveArea.top||y>this._interactiveArea.bottom)return}if(m.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===H.ROTATE||this.mouseButtons.wheel===H.TRUCK){const P=performance.now();h-P<1e3&&this._getClientRect(this._elementRect),h=P}const M=Lc?-1:-3,b=m.deltaMode===1?m.deltaY/M:m.deltaY/(M*10),S=this.dollyToCursor?(m.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,L=this.dollyToCursor?(m.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case H.ROTATE:{this._rotateInternal(m.deltaX,m.deltaY),this._isUserControllingRotate=!0;break}case H.TRUCK:{this._truckInternal(m.deltaX,m.deltaY,!1),this._isUserControllingTruck=!0;break}case H.OFFSET:{this._truckInternal(m.deltaX,m.deltaY,!0),this._isUserControllingOffset=!0;break}case H.DOLLY:{this._dollyInternal(-b,S,L),this._isUserControllingDolly=!0;break}case H.ZOOM:{this._zoomInternal(-b,S,L),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},d=m=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Ue.ACTION.NONE){const M=m instanceof PointerEvent?m.pointerId:0,b=this._findPointerById(M);b&&this._disposePointer(b),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}m.preventDefault()}},p=m=>{if(!this._enabled)return;if(_r(this._activePointers,Re),this._getClientRect(this._elementRect),n.copy(Re),r.copy(Re),this._activePointers.length>=2){const b=Re.x-this._activePointers[1].clientX,S=Re.y-this._activePointers[1].clientY,L=Math.sqrt(b*b+S*S);s.set(0,L);const P=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,T=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(P,T)}if(this._state=0,!m)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in m&&m.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(m.buttons&Le.LEFT)===Le.LEFT&&(this._state=this._state|this.mouseButtons.left),(m.buttons&Le.MIDDLE)===Le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(m.buttons&Le.RIGHT)===Le.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&H.ROTATE)===H.ROTATE||(this._state&H.TOUCH_ROTATE)===H.TOUCH_ROTATE||(this._state&H.TOUCH_DOLLY_ROTATE)===H.TOUCH_DOLLY_ROTATE||(this._state&H.TOUCH_ZOOM_ROTATE)===H.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&H.TRUCK)===H.TRUCK||(this._state&H.TOUCH_TRUCK)===H.TOUCH_TRUCK||(this._state&H.TOUCH_DOLLY_TRUCK)===H.TOUCH_DOLLY_TRUCK||(this._state&H.TOUCH_ZOOM_TRUCK)===H.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&H.DOLLY)===H.DOLLY||(this._state&H.TOUCH_DOLLY)===H.TOUCH_DOLLY||(this._state&H.TOUCH_DOLLY_TRUCK)===H.TOUCH_DOLLY_TRUCK||(this._state&H.TOUCH_DOLLY_OFFSET)===H.TOUCH_DOLLY_OFFSET||(this._state&H.TOUCH_DOLLY_ROTATE)===H.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&H.ZOOM)===H.ZOOM||(this._state&H.TOUCH_ZOOM)===H.TOUCH_ZOOM||(this._state&H.TOUCH_ZOOM_TRUCK)===H.TOUCH_ZOOM_TRUCK||(this._state&H.TOUCH_ZOOM_OFFSET)===H.TOUCH_ZOOM_OFFSET||(this._state&H.TOUCH_ZOOM_ROTATE)===H.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&H.OFFSET)===H.OFFSET||(this._state&H.TOUCH_OFFSET)===H.TOUCH_OFFSET||(this._state&H.TOUCH_DOLLY_OFFSET)===H.TOUCH_DOLLY_OFFSET||(this._state&H.TOUCH_ZOOM_OFFSET)===H.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},g=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,_r(this._activePointers,Re);const M=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,b=M?-M.deltaX:r.x-Re.x,S=M?-M.deltaY:r.y-Re.y;if(r.copy(Re),((this._state&H.ROTATE)===H.ROTATE||(this._state&H.TOUCH_ROTATE)===H.TOUCH_ROTATE||(this._state&H.TOUCH_DOLLY_ROTATE)===H.TOUCH_DOLLY_ROTATE||(this._state&H.TOUCH_ZOOM_ROTATE)===H.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(b,S),this._isUserControllingRotate=!0),(this._state&H.DOLLY)===H.DOLLY||(this._state&H.ZOOM)===H.ZOOM){const L=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,P=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,T=this.dollyDragInverted?-1:1;(this._state&H.DOLLY)===H.DOLLY?(this._dollyInternal(T*S*In,L,P),this._isUserControllingDolly=!0):(this._zoomInternal(T*S*In,L,P),this._isUserControllingZoom=!0)}if((this._state&H.TOUCH_DOLLY)===H.TOUCH_DOLLY||(this._state&H.TOUCH_ZOOM)===H.TOUCH_ZOOM||(this._state&H.TOUCH_DOLLY_TRUCK)===H.TOUCH_DOLLY_TRUCK||(this._state&H.TOUCH_ZOOM_TRUCK)===H.TOUCH_ZOOM_TRUCK||(this._state&H.TOUCH_DOLLY_OFFSET)===H.TOUCH_DOLLY_OFFSET||(this._state&H.TOUCH_ZOOM_OFFSET)===H.TOUCH_ZOOM_OFFSET||(this._state&H.TOUCH_DOLLY_ROTATE)===H.TOUCH_DOLLY_ROTATE||(this._state&H.TOUCH_ZOOM_ROTATE)===H.TOUCH_ZOOM_ROTATE){const L=Re.x-this._activePointers[1].clientX,P=Re.y-this._activePointers[1].clientY,T=Math.sqrt(L*L+P*P),y=s.y-T;s.set(0,T);const A=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,w=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&H.TOUCH_DOLLY)===H.TOUCH_DOLLY||(this._state&H.TOUCH_DOLLY_ROTATE)===H.TOUCH_DOLLY_ROTATE||(this._state&H.TOUCH_DOLLY_TRUCK)===H.TOUCH_DOLLY_TRUCK||(this._state&H.TOUCH_DOLLY_OFFSET)===H.TOUCH_DOLLY_OFFSET?(this._dollyInternal(y*In,A,w),this._isUserControllingDolly=!0):(this._zoomInternal(y*In,A,w),this._isUserControllingZoom=!0)}((this._state&H.TRUCK)===H.TRUCK||(this._state&H.TOUCH_TRUCK)===H.TOUCH_TRUCK||(this._state&H.TOUCH_DOLLY_TRUCK)===H.TOUCH_DOLLY_TRUCK||(this._state&H.TOUCH_ZOOM_TRUCK)===H.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(b,S,!1),this._isUserControllingTruck=!0),((this._state&H.OFFSET)===H.OFFSET||(this._state&H.TOUCH_OFFSET)===H.TOUCH_OFFSET||(this._state&H.TOUCH_DOLLY_OFFSET)===H.TOUCH_DOLLY_OFFSET||(this._state&H.TOUCH_ZOOM_OFFSET)===H.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(b,S,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},x=()=>{_r(this._activePointers,Re),r.copy(Re),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",v),this._domElement.ownerDocument.addEventListener("pointerlockerror",_),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),p())},this.unlockPointer=()=>{var m,M,b;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(m=this._domElement)===null||m===void 0||m.ownerDocument.exitPointerLock(),(M=this._domElement)===null||M===void 0||M.ownerDocument.removeEventListener("pointerlockchange",v),(b=this._domElement)===null||b===void 0||b.ownerDocument.removeEventListener("pointerlockerror",_),this.cancel()};const v=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},_=()=>{this.unlockPointer()};this._addAllEventListeners=m=>{this._domElement=m,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",i),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",d)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",i),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",d),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",_))},this.cancel=()=>{this._state!==H.NONE&&(this._state=H.NONE,this._activePointers.length=0,x())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=et(e.width,0,1),this._interactiveArea.height=et(e.height,0,1),this._interactiveArea.x=et(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=et(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const r=et(e,this.minAzimuthAngle,this.maxAzimuthAngle),s=et(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const i=!n||Se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(i)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Gt.NONE,this._changedDolly=0,this._dollyToNoClamp(et(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const i=this._collisionTest(),a=Se(i,this._spherical.radius);if(!(n>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,i)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const s=!t||Se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(an).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||Se(this._target.x,this._targetEnd.x,this.restThreshold)&&Se(this._target.y,this._targetEnd.y,this.restThreshold)&&Se(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=et(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||Se(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),rt.setFromMatrixColumn(this._camera.matrix,0),st.setFromMatrixColumn(this._camera.matrix,1),rt.multiplyScalar(e),st.multiplyScalar(-t);const r=ye.copy(rt).add(st),s=be.copy(this._targetEnd).add(r);return this.moveTo(s.x,s.y,s.z,n)}forward(e,t=!1){ye.setFromMatrixColumn(this._camera.matrix,0),ye.crossVectors(this._camera.up,ye),ye.multiplyScalar(e);const n=be.copy(this._targetEnd).add(ye);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return ye.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ye.x,this._targetEnd.y+ye.y,this._targetEnd.z+ye.z,t)}moveTo(e,t,n,r=!1){this._isUserControllingTruck=!1;const s=ye.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const i=!r||Se(this._target.x,this._targetEnd.x,this.restThreshold)&&Se(this._target.y,this._targetEnd.y,this.restThreshold)&&Se(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}lookInDirectionOf(e,t,n,r=!1){const a=ye.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,r)}fitToBox(e,t,{cover:n=!1,paddingLeft:r=0,paddingRight:s=0,paddingBottom:i=0,paddingTop:a=0}={}){const c=[],h=e.isBox3?Wt.copy(e):Wt.setFromObject(e);h.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const f=ni(this._sphericalEnd.theta,ei),d=ni(this._sphericalEnd.phi,ei);c.push(this.rotateTo(f,d,t));const p=ye.setFromSpherical(this._sphericalEnd).normalize(),g=li.setFromUnitVectors(p,br),x=Se(Math.abs(p.y),1);x&&g.multiply(Sr.setFromAxisAngle(Ln,f)),g.multiply(this._yAxisUpSpaceInverse);const v=ai.makeEmpty();be.copy(h.min).applyQuaternion(g),v.expandByPoint(be),be.copy(h.min).setX(h.max.x).applyQuaternion(g),v.expandByPoint(be),be.copy(h.min).setY(h.max.y).applyQuaternion(g),v.expandByPoint(be),be.copy(h.max).setZ(h.min.z).applyQuaternion(g),v.expandByPoint(be),be.copy(h.min).setZ(h.max.z).applyQuaternion(g),v.expandByPoint(be),be.copy(h.max).setY(h.min.y).applyQuaternion(g),v.expandByPoint(be),be.copy(h.max).setX(h.min.x).applyQuaternion(g),v.expandByPoint(be),be.copy(h.max).applyQuaternion(g),v.expandByPoint(be),v.min.x-=r,v.min.y-=i,v.max.x+=s,v.max.y+=a,g.setFromUnitVectors(br,p),x&&g.premultiply(Sr.invert()),g.premultiply(this._yAxisUpSpace);const _=v.getSize(ye),m=v.getCenter(be).applyQuaternion(g);if(Dt(this._camera)){const M=this.getDistanceToFitBox(_.x,_.y,_.z,n);c.push(this.moveTo(m.x,m.y,m.z,t)),c.push(this.dollyTo(M,t)),c.push(this.setFocalOffset(0,0,0,t))}else if(wt(this._camera)){const M=this._camera,b=M.right-M.left,S=M.top-M.bottom,L=n?Math.max(b/_.x,S/_.y):Math.min(b/_.x,S/_.y);c.push(this.moveTo(m.x,m.y,m.z,t)),c.push(this.zoomTo(L,t)),c.push(this.setFocalOffset(0,0,0,t))}return Promise.all(c)}fitToSphere(e,t){const n=[],s=e instanceof fe.Sphere?Mr.copy(e):Ue.createBoundingSphere(e,Mr);if(n.push(this.moveTo(s.center.x,s.center.y,s.center.z,t)),Dt(this._camera)){const i=this.getDistanceToFitSphere(s.radius);n.push(this.dollyTo(i,t))}else if(wt(this._camera)){const i=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,c=2*s.radius,h=Math.min(i/c,a/c);n.push(this.zoomTo(h,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,r,s,i,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Gt.NONE,this._changedDolly=0;const c=be.set(r,s,i),h=ye.set(e,t,n);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(h.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!a||Se(this._target.x,this._targetEnd.x,this.restThreshold)&&Se(this._target.y,this._targetEnd.y,this.restThreshold)&&Se(this._target.z,this._targetEnd.z,this.restThreshold)&&Se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}lerpLookAt(e,t,n,r,s,i,a,c,h,f,d,p,g,x=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Gt.NONE,this._changedDolly=0;const v=ye.set(r,s,i),_=be.set(e,t,n);Je.setFromVector3(_.sub(v).applyQuaternion(this._yAxisUpSpace));const m=Rt.set(f,d,p),M=be.set(a,c,h);ln.setFromVector3(M.sub(m).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(v.lerp(m,g));const b=ln.theta-Je.theta,S=ln.phi-Je.phi,L=ln.radius-Je.radius;this._sphericalEnd.set(Je.radius+L*g,Je.phi+S*g,Je.theta+b*g),this.normalizeRotations(),this._needsUpdate=!0,x||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const P=!x||Se(this._target.x,this._targetEnd.x,this.restThreshold)&&Se(this._target.y,this._targetEnd.y,this.restThreshold)&&Se(this._target.z,this._targetEnd.z,this.restThreshold)&&Se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(P)}setPosition(e,t,n,r=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,n,r=!1){const s=this.getPosition(ye),i=this.setLookAt(s.x,s.y,s.z,e,t,n,r);return this._sphericalEnd.phi=et(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),i}setFocalOffset(e,t,n,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const s=!r||Se(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Se(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Se(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),rt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),st.setFromMatrixColumn(this._camera.matrixWorldInverse,1),kt.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=ye.set(e,t,n),s=r.distanceTo(this._camera.position),i=r.sub(this._camera.position);rt.multiplyScalar(i.x),st.multiplyScalar(i.y),kt.multiplyScalar(i.z),ye.copy(rt).add(st).add(kt),ye.z=ye.z+s,this.dollyTo(s,!1),this.setFocalOffset(-ye.x,ye.y,-ye.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,r){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new fe.Vector4,typeof e=="number"?this._viewport.set(e,t,n,r):this._viewport.copy(e)}getDistanceToFitBox(e,t,n,r=!1){if(xr(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const s=e/t,i=this._camera.getEffectiveFOV()*rn,a=this._camera.aspect;return((r?s>a:s<a)?t:e/a)*.5/Math.tan(i*.5)+n*.5}getDistanceToFitSphere(e){if(xr(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*rn,n=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,r=1<this._camera.aspect?t:n;return e/Math.sin(r*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new fe.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new fe.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof fe.Spherical?e:new fe.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new fe.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%jt,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=jt),this._spherical.theta+=jt*Math.round((this._sphericalEnd.theta-this._spherical.theta)/jt)}reset(e=!1){if(!Se(this._camera.up.x,this._cameraUp0.x)||!Se(this._camera.up.y,this._cameraUp0.y)||!Se(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const n=this.getPosition(ye);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Ln),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ye.subVectors(this._target,this._camera.position).normalize(),t=be.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(ye);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,s=ii.subVectors(this._targetEnd,this._target),i=oi.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(Ce(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Tn(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,d,1/0,e),this._needsUpdate=!0}if(Ce(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Tn(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,d,1/0,e),this._needsUpdate=!0}if(Ce(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const d=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Tn(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,d,this.maxSpeed,e),this._needsUpdate=!0}if(Ce(s.x)&&Ce(s.y)&&Ce(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const d=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;ri(this._target,this._targetEnd,this._targetVelocity,d,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(Ce(i.x)&&Ce(i.y)&&Ce(i.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const d=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;ri(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,d,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(Ce(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const d=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Tn(this._zoom,this._zoomEnd,this._zoomVelocity,d,1/0,e)}if(this.dollyToCursor){if(Dt(this._camera)&&this._changedDolly!==0){const d=this._spherical.radius-this._lastDistance,p=this._camera,g=this._getCameraDirection(an),x=ye.copy(g).cross(p.up).normalize();x.lengthSq()===0&&(x.x=1);const v=be.crossVectors(x,g),_=this._sphericalEnd.radius*Math.tan(p.getEffectiveFOV()*rn*.5),M=(this._sphericalEnd.radius-d-this._sphericalEnd.radius)/this._sphericalEnd.radius,b=Rt.copy(this._targetEnd).add(x.multiplyScalar(this._dollyControlCoord.x*_*p.aspect)).add(v.multiplyScalar(this._dollyControlCoord.y*_)),S=ye.copy(this._targetEnd).lerp(b,M),L=this._lastDollyDirection===Gt.IN&&this._spherical.radius<=this.minDistance,P=this._lastDollyDirection===Gt.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(L||P)){this._sphericalEnd.radius-=d,this._spherical.radius-=d;const y=be.copy(g).multiplyScalar(-d);S.add(y)}this._boundary.clampPoint(S,S);const T=be.subVectors(S,this._targetEnd);this._targetEnd.copy(S),this._target.add(T),this._changedDolly-=d,Ce(this._changedDolly)&&(this._changedDolly=0)}else if(wt(this._camera)&&this._changedZoom!==0){const d=this._zoom-this._lastZoom,p=this._camera,g=ye.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(p.near+p.far)/(p.near-p.far)).unproject(p),x=be.set(0,0,-1).applyQuaternion(p.quaternion),v=Rt.copy(g).add(x.multiplyScalar(-g.dot(p.up))),m=-(this._zoom-d-this._zoom)/this._zoom,M=this._getCameraDirection(an),b=this._targetEnd.dot(M),S=ye.copy(this._targetEnd).lerp(v,m),L=S.dot(M),P=M.multiplyScalar(L-b);S.sub(P),this._boundary.clampPoint(S,S);const T=be.subVectors(S,this._targetEnd);this._targetEnd.copy(S),this._target.add(T),this._changedZoom-=d,Ce(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Ce(this._focalOffset.x)||!Ce(this._focalOffset.y)||!Ce(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),rt.setFromMatrixColumn(this._camera.matrix,0),st.setFromMatrixColumn(this._camera.matrix,1),kt.setFromMatrixColumn(this._camera.matrix,2),rt.multiplyScalar(this._focalOffset.x),st.multiplyScalar(-this._focalOffset.y),kt.multiplyScalar(this._focalOffset.z),ye.copy(rt).add(st).add(kt),this._camera.position.add(ye)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ye.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const f=this._needsUpdate;return f&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):f?(this.dispatchEvent({type:"update"}),Ce(t,this.restThreshold)&&Ce(n,this.restThreshold)&&Ce(r,this.restThreshold)&&Ce(s.x,this.restThreshold)&&Ce(s.y,this.restThreshold)&&Ce(s.z,this.restThreshold)&&Ce(i.x,this.restThreshold)&&Ce(i.y,this.restThreshold)&&Ce(i.z,this.restThreshold)&&Ce(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!f&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=f,this._needsUpdate=!1,f}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:sn(this.maxDistance),minZoom:this.minZoom,maxZoom:sn(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:sn(this.maxPolarAngle),minAzimuthAngle:sn(this.minAzimuthAngle),maxAzimuthAngle:sn(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:ye.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=on(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=on(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=on(n.maxPolarAngle),this.minAzimuthAngle=on(n.minAzimuthAngle),this.maxAzimuthAngle=on(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this.verticalDragToForward=n.verticalDragToForward,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),Je.setFromVector3(ye.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Je.theta,Je.phi,t),this.dollyTo(Je.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Ic),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const r=t.lengthSq();if(r===0)return e;const s=be.copy(t).add(e),a=this._boundary.clampPoint(s,Rt).sub(s),c=a.lengthSq();if(c===0)return e.add(t);if(c===r)return e;if(n===0)return e.add(t).add(a);{const h=1+n*c/t.dot(a);return e.add(be.copy(t).multiplyScalar(h)).add(a.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(Dt(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*rn,r=Math.tan(n*.5)*t,s=r*e.aspect;this._nearPlaneCorners[0].set(-s,-r,0),this._nearPlaneCorners[1].set(s,-r,0),this._nearPlaneCorners[2].set(s,r,0),this._nearPlaneCorners[3].set(-s,r,0)}else if(wt(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,r=e.right*t,s=e.top*t,i=e.bottom*t;this._nearPlaneCorners[0].set(n,s,0),this._nearPlaneCorners[1].set(r,s,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(n,i,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||xr(this._camera,"_collisionTest"))return e;const n=this._getTargetDirection(an);Ar.lookAt(si,n,this._camera.up);for(let r=0;r<4;r++){const s=be.copy(this._nearPlaneCorners[r]);s.applyMatrix4(Ar);const i=Rt.addVectors(this._target,s);On.set(i,n),On.far=this._spherical.radius+1;const a=On.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const n=()=>{this.removeEventListener("rest",n),t()};this.addEventListener("rest",n)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new fe.Sphere){const n=t,r=n.center;Wt.makeEmpty(),e.traverseVisible(i=>{i.isMesh&&Wt.expandByObject(i)}),Wt.getCenter(r);let s=0;return e.traverseVisible(i=>{if(!i.isMesh)return;const a=i,c=a.geometry.clone();c.applyMatrix4(a.matrixWorld);const f=c.attributes.position;for(let d=0,p=f.count;d<p;d++)ye.fromBufferAttribute(f,d),s=Math.max(s,r.distanceToSquared(ye))}),n.radius=Math.sqrt(s),n}}const ci=o=>!!(o&&o.isPerspectiveCamera),ui=o=>!!(o&&o.isOrthographicCamera),Oc=["min-polar-angle","max-polar-angle","min-azimuth-angle","max-azimuth-angle","distance","min-distance","max-distance","infinity-dolly","min-zoom","max-zoom","smooth-time","dragging-smooth-time","max-speed","azimuth-rotate-speed","polar-rotate-speed","dolly-speed","dolly-drag-inverted","truck-speed","dolly-to-cursor","drag-to-offset","vertical-drag-to-forward","boundary-friction","rest-threshold","collider-meshes","args","mouse-buttons","touches"],hi=(o,e)=>({left:Ue.ACTION.ROTATE,middle:Ue.ACTION.DOLLY,right:Ue.ACTION.TRUCK,wheel:ci(o)?Ue.ACTION.DOLLY:ui(o)?Ue.ACTION.ZOOM:Ue.ACTION.NONE,...e}),fi=(o,e)=>({one:Ue.ACTION.TOUCH_ROTATE,two:ci(o)?Ue.ACTION.TOUCH_DOLLY_TRUCK:ui(o)?Ue.ACTION.TOUCH_ZOOM_TRUCK:Ue.ACTION.NONE,three:Ue.ACTION.TOUCH_TRUCK,...e}),Dc=u.defineComponent({__name:"CameraControls",props:{makeDefault:{type:Boolean,default:!1},camera:{},domElement:{},minPolarAngle:{default:0},maxPolarAngle:{default:Math.PI},minAzimuthAngle:{default:Number.NEGATIVE_INFINITY},maxAzimuthAngle:{default:Number.POSITIVE_INFINITY},distance:{default:()=>ie.useTresContext().camera.value.position.z},minDistance:{default:Number.EPSILON},maxDistance:{default:Number.POSITIVE_INFINITY},infinityDolly:{type:Boolean,default:!1},minZoom:{default:.01},maxZoom:{default:Number.POSITIVE_INFINITY},smoothTime:{default:.25},draggingSmoothTime:{default:.125},maxSpeed:{default:Number.POSITIVE_INFINITY},azimuthRotateSpeed:{default:1},polarRotateSpeed:{default:1},dollySpeed:{default:1},dollyDragInverted:{type:Boolean,default:!1},truckSpeed:{default:2},dollyToCursor:{type:Boolean,default:!1},dragToOffset:{type:Boolean,default:!1},verticalDragToForward:{type:Boolean,default:!1},boundaryFriction:{default:0},restThreshold:{default:.01},colliderMeshes:{default:()=>[]},mouseButtons:{default:()=>hi(ie.useTresContext().camera.value)},touches:{default:()=>fi(ie.useTresContext().camera.value)}},emits:["change","start","end"],setup(o,{expose:e,emit:t}){const n=o,r=t,{makeDefault:s,minPolarAngle:i,maxPolarAngle:a,minAzimuthAngle:c,maxAzimuthAngle:h,distance:f,minDistance:d,maxDistance:p,infinityDolly:g,minZoom:x,maxZoom:v,smoothTime:_,draggingSmoothTime:m,maxSpeed:M,azimuthRotateSpeed:b,polarRotateSpeed:S,dollySpeed:L,dollyDragInverted:P,truckSpeed:T,dollyToCursor:y,dragToOffset:A,verticalDragToForward:w,boundaryFriction:D,restThreshold:k,colliderMeshes:R}=u.toRefs(n),V={Box3:l.Box3,MathUtils:{clamp:l.MathUtils.clamp},Matrix4:l.Matrix4,Quaternion:l.Quaternion,Raycaster:l.Raycaster,Sphere:l.Sphere,Spherical:l.Spherical,Vector2:l.Vector2,Vector3:l.Vector3,Vector4:l.Vector4};Ue.install({THREE:V});const{camera:Y,renderer:G,extend:Q,controls:K}=ie.useTresContext(),ne=u.computed(()=>hi(n.camera||Y.value,n.mouseButtons)),ee=u.computed(()=>fi(n.camera||Y.value,n.touches)),le=u.ref(null);Q({CameraControls:Ue}),u.watchEffect(()=>{he(),le.value&&s.value?K.value=le.value:K.value=null});function he(){Ie(le.value,"update",()=>r("change",le.value)),Ie(le.value,"controlend",()=>r("end",le.value)),Ie(le.value,"controlstart",()=>r("start",le.value))}const{onLoop:de}=ie.useRenderLoop();return de(({delta:O})=>{var z,U;(z=le.value)!=null&&z.enabled&&((U=le.value)==null||U.update(O))}),u.onUnmounted(()=>{le.value&&le.value.disconnect()}),e({value:le}),(O,z)=>(O.camera||u.unref(Y))&&(O.domElement||u.unref(G))?(u.openBlock(),u.createElementBlock("TresCameraControls",{key:0,ref_key:"controlsRef",ref:le,"min-polar-angle":u.unref(i),"max-polar-angle":u.unref(a),"min-azimuth-angle":u.unref(c),"max-azimuth-angle":u.unref(h),distance:u.unref(f),"min-distance":u.unref(d),"max-distance":u.unref(p),"infinity-dolly":u.unref(g),"min-zoom":u.unref(x),"max-zoom":u.unref(v),"smooth-time":u.unref(_),"dragging-smooth-time":u.unref(m),"max-speed":u.unref(M),"azimuth-rotate-speed":u.unref(b),"polar-rotate-speed":u.unref(S),"dolly-speed":u.unref(L),"dolly-drag-inverted":u.unref(P),"truck-speed":u.unref(T),"dolly-to-cursor":u.unref(y),"drag-to-offset":u.unref(A),"vertical-drag-to-forward":u.unref(w),"boundary-friction":u.unref(D),"rest-threshold":u.unref(k),"collider-meshes":u.unref(R),args:[O.camera||u.unref(Y),O.domElement||u.unref(G).domElement],"mouse-buttons":ne.value,touches:ee.value},null,8,Oc)):u.createCommentVNode("",!0)}});class kc extends l.MeshStandardMaterial{constructor(t={}){super(t);ce(this,"_time");ce(this,"_factor");this.setValues(t),this._time={value:0},this._factor={value:1}}onBeforeCompile(t){t.uniforms||(t.uniforms={}),t.uniforms.time=this._time,t.uniforms.factor=this._factor,t.vertexShader=`
        uniform float time;
        uniform float factor;
        ${t.vertexShader}
      `,t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",`float theta = sin( time + position.y ) / 2.0 * factor;
          float c = cos( theta );
          float s = sin( theta );
          mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );
          vec3 transformed = vec3( position ) * m;
          vNormal = vNormal * m;`)}get time(){return this._time.value}set time(t){this._time.value=t}get factor(){return this._factor.value}set factor(t){this._factor.value=t}}const Bc=["factor"],Fc=u.defineComponent({__name:"index",props:{speed:{default:1},factor:{default:1}},setup(o){const e=o,t=u.shallowRef(),{extend:n}=ie.useTresContext();n({MeshWobbleMaterial:kc});const{onLoop:r}=ie.useRenderLoop();return r(({elapsed:s})=>{t.value&&(t.value.time=s*(e==null?void 0:e.speed))}),(s,i)=>(u.openBlock(),u.createElementBlock("TresMeshWobbleMaterial",u.mergeProps({ref_key:"materialRef",ref:t,factor:s.factor},s.$attrs),null,16,Bc))}});function bt(o,e,t){return Math.max(e,Math.min(t,o))}function Uc(o,e){return(o%e+e)%e}function Nc(o,e,t,n,r){return n+(o-e)*(r-n)/(t-e)}function Cr(o,e,t){return(1-t)*o+t*e}class Pr{constructor(e=0,t=0){Pr.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(bt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,i=this.y-e.y;return this.x=s*n-i*r+e.x,this.y=s*r+i*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}const Vc="",Mt="srgb",Tr="srgb-linear",zc="display-p3",di="display-p3-linear",Ir="linear",pi="srgb",mi="rec709",gi="p3";class cn{constructor(e,t,n,r,s,i,a,c,h){cn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,i,a,c,h)}set(e,t,n,r,s,i,a,c,h){const f=this.elements;return f[0]=e,f[1]=r,f[2]=a,f[3]=t,f[4]=s,f[5]=c,f[6]=n,f[7]=i,f[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,i=n[0],a=n[3],c=n[6],h=n[1],f=n[4],d=n[7],p=n[2],g=n[5],x=n[8],v=r[0],_=r[3],m=r[6],M=r[1],b=r[4],S=r[7],L=r[2],P=r[5],T=r[8];return s[0]=i*v+a*M+c*L,s[3]=i*_+a*b+c*P,s[6]=i*m+a*S+c*T,s[1]=h*v+f*M+d*L,s[4]=h*_+f*b+d*P,s[7]=h*m+f*S+d*T,s[2]=p*v+g*M+x*L,s[5]=p*_+g*b+x*P,s[8]=p*m+g*S+x*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],i=e[4],a=e[5],c=e[6],h=e[7],f=e[8];return t*i*f-t*a*h-n*s*f+n*a*c+r*s*h-r*i*c}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],i=e[4],a=e[5],c=e[6],h=e[7],f=e[8],d=f*i-a*h,p=a*c-f*s,g=h*s-i*c,x=t*d+n*p+r*g;if(x===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/x;return e[0]=d*v,e[1]=(r*h-f*n)*v,e[2]=(a*n-r*i)*v,e[3]=p*v,e[4]=(f*t-r*c)*v,e[5]=(r*s-a*t)*v,e[6]=g*v,e[7]=(n*c-h*t)*v,e[8]=(i*t-n*s)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,i,a){const c=Math.cos(s),h=Math.sin(s);return this.set(n*c,n*h,-n*(c*i+h*a)+i+e,-r*h,r*c,-r*(-h*i+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Lr.makeScale(e,t)),this}rotate(e){return this.premultiply(Lr.makeRotation(-e)),this}translate(e,t){return this.premultiply(Lr.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Lr=new cn,yi=new cn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),vi=new cn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Dn={[Tr]:{transfer:Ir,primaries:mi,toReference:o=>o,fromReference:o=>o},[Mt]:{transfer:pi,primaries:mi,toReference:o=>o.convertSRGBToLinear(),fromReference:o=>o.convertLinearToSRGB()},[di]:{transfer:Ir,primaries:gi,toReference:o=>o.applyMatrix3(vi),fromReference:o=>o.applyMatrix3(yi)},[zc]:{transfer:pi,primaries:gi,toReference:o=>o.convertSRGBToLinear().applyMatrix3(vi),fromReference:o=>o.applyMatrix3(yi).convertLinearToSRGB()}},Gc=new Set([Tr,di]),tt={enabled:!0,_workingColorSpace:Tr,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(o){if(!Gc.has(o))throw new Error(`Unsupported working color space, "${o}".`);this._workingColorSpace=o},convert:function(o,e,t){if(this.enabled===!1||e===t||!e||!t)return o;const n=Dn[e].toReference,r=Dn[t].fromReference;return r(n(o))},fromWorkingColorSpace:function(o,e){return this.convert(o,this._workingColorSpace,e)},toWorkingColorSpace:function(o,e){return this.convert(o,e,this._workingColorSpace)},getPrimaries:function(o){return Dn[o].primaries},getTransfer:function(o){return o===Vc?Ir:Dn[o].transfer}};function Or(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function Dr(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}const _i={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},St={h:0,s:0,l:0},kn={h:0,s:0,l:0};function kr(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*6*t:t<1/2?e:t<2/3?o+(e-o)*6*(2/3-t):o}class Bn{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Mt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,tt.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=tt.workingColorSpace){return this.r=e,this.g=t,this.b=n,tt.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=tt.workingColorSpace){if(e=Uc(e,1),t=bt(t,0,1),n=bt(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,i=2*n-s;this.r=kr(i,s,e+1/3),this.g=kr(i,s,e),this.b=kr(i,s,e-1/3)}return tt.toWorkingColorSpace(this,r),this}setStyle(e,t=Mt){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const i=r[1],a=r[2];switch(i){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],i=s.length;if(i===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(i===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Mt){const n=_i[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Or(e.r),this.g=Or(e.g),this.b=Or(e.b),this}copyLinearToSRGB(e){return this.r=Dr(e.r),this.g=Dr(e.g),this.b=Dr(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Mt){return tt.fromWorkingColorSpace(Ge.copy(this),e),Math.round(bt(Ge.r*255,0,255))*65536+Math.round(bt(Ge.g*255,0,255))*256+Math.round(bt(Ge.b*255,0,255))}getHexString(e=Mt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=tt.workingColorSpace){tt.fromWorkingColorSpace(Ge.copy(this),t);const n=Ge.r,r=Ge.g,s=Ge.b,i=Math.max(n,r,s),a=Math.min(n,r,s);let c,h;const f=(a+i)/2;if(a===i)c=0,h=0;else{const d=i-a;switch(h=f<=.5?d/(i+a):d/(2-i-a),i){case n:c=(r-s)/d+(r<s?6:0);break;case r:c=(s-n)/d+2;break;case s:c=(n-r)/d+4;break}c/=6}return e.h=c,e.s=h,e.l=f,e}getRGB(e,t=tt.workingColorSpace){return tt.fromWorkingColorSpace(Ge.copy(this),t),e.r=Ge.r,e.g=Ge.g,e.b=Ge.b,e}getStyle(e=Mt){tt.fromWorkingColorSpace(Ge.copy(this),e);const t=Ge.r,n=Ge.g,r=Ge.b;return e!==Mt?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(St),this.setHSL(St.h+e,St.s+t,St.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(St),e.getHSL(kn);const n=Cr(St.h,kn.h,t),r=Cr(St.s,kn.s,t),s=Cr(St.l,kn.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ge=new Bn;Bn.NAMES=_i;class jc extends l.MeshStandardMaterial{constructor(t={}){super();ce(this,"isMeshPhysicalMaterial");ce(this,"clearcoatMap");ce(this,"clearcoatRoughness");ce(this,"clearcoatRoughnessMap");ce(this,"clearcoatNormalScale");ce(this,"clearcoatNormalMap");ce(this,"ior");ce(this,"transmissionMap");ce(this,"thickness");ce(this,"thicknessMap");ce(this,"attenuationDistance");ce(this,"attenuationColor");ce(this,"specularIntensity");ce(this,"specularIntensityMap");ce(this,"specularColor");ce(this,"specularColorMap");ce(this,"_clearcoat");ce(this,"_transmission");this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Pr(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get(){return bt(2.5*(this.ior-1)/(this.ior+1),0,1)},set(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.roughness=0,this.transmissionMap=null,this.thickness=.5,this.thicknessMap=null,this.attenuationDistance=Number.POSITIVE_INFINITY,this.attenuationColor=new Bn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Bn(1,1,1),this.specularColorMap=null,this._clearcoat=.5,this._transmission=1,this.setValues(t)}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}const Rc=u.defineComponent({__name:"index",setup(o,{expose:e}){const t=u.shallowRef(),{extend:n}=ie.useTresContext();return n({MeshGlassMaterial:jc}),e({MeshGlassMaterialClass:t}),(r,s)=>(u.openBlock(),u.createElementBlock("TresMeshGlassMaterial",{ref_key:"MeshGlassMaterialClass",ref:t},null,512))}});var Wc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function un(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Fn(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var xi={exports:{}};(function(o,e){(function(t){o.exports=t()})(function(){return function t(n,r,s){function i(h,f){if(!r[h]){if(!n[h]){var d=typeof Fn=="function"&&Fn;if(!f&&d)return d(h,!0);if(a)return a(h,!0);throw new Error("Cannot find module '"+h+"'")}f=r[h]={exports:{}},n[h][0].call(f.exports,function(p){var g=n[h][1][p];return i(g||p)},f,f.exports,t,n,r,s)}return r[h].exports}for(var a=typeof Fn=="function"&&Fn,c=0;c<s.length;c++)i(s[c]);return i}({1:[function(t,n,r){(function(s,i,a,c,h,f,d,p,g){var x=t("crypto");function v(P,T){T=M(P,T);var y;return(y=T.algorithm!=="passthrough"?x.createHash(T.algorithm):new L).write===void 0&&(y.write=y.update,y.end=y.update),S(T,y).dispatch(P),y.update||y.end(""),y.digest?y.digest(T.encoding==="buffer"?void 0:T.encoding):(P=y.read(),T.encoding!=="buffer"?P.toString(T.encoding):P)}(r=n.exports=v).sha1=function(P){return v(P)},r.keys=function(P){return v(P,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},r.MD5=function(P){return v(P,{algorithm:"md5",encoding:"hex"})},r.keysMD5=function(P){return v(P,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var _=x.getHashes?x.getHashes().slice():["sha1","md5"],m=(_.push("passthrough"),["buffer","hex","binary","base64"]);function M(P,T){var y={};if(y.algorithm=(T=T||{}).algorithm||"sha1",y.encoding=T.encoding||"hex",y.excludeValues=!!T.excludeValues,y.algorithm=y.algorithm.toLowerCase(),y.encoding=y.encoding.toLowerCase(),y.ignoreUnknown=T.ignoreUnknown===!0,y.respectType=T.respectType!==!1,y.respectFunctionNames=T.respectFunctionNames!==!1,y.respectFunctionProperties=T.respectFunctionProperties!==!1,y.unorderedArrays=T.unorderedArrays===!0,y.unorderedSets=T.unorderedSets!==!1,y.unorderedObjects=T.unorderedObjects!==!1,y.replacer=T.replacer||void 0,y.excludeKeys=T.excludeKeys||void 0,P===void 0)throw new Error("Object argument required.");for(var A=0;A<_.length;++A)_[A].toLowerCase()===y.algorithm.toLowerCase()&&(y.algorithm=_[A]);if(_.indexOf(y.algorithm)===-1)throw new Error('Algorithm "'+y.algorithm+'"  not supported. supported values: '+_.join(", "));if(m.indexOf(y.encoding)===-1&&y.algorithm!=="passthrough")throw new Error('Encoding "'+y.encoding+'"  not supported. supported values: '+m.join(", "));return y}function b(P){if(typeof P=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(P))!=null}function S(P,T,y){y=y||[];function A(w){return T.update?T.update(w,"utf8"):T.write(w,"utf8")}return{dispatch:function(w){return this["_"+((w=P.replacer?P.replacer(w):w)===null?"null":typeof w)](w)},_object:function(w){var D,k=Object.prototype.toString.call(w),R=/\[object (.*)\]/i.exec(k);if(R=(R=R?R[1]:"unknown:["+k+"]").toLowerCase(),0<=(k=y.indexOf(w)))return this.dispatch("[CIRCULAR:"+k+"]");if(y.push(w),a!==void 0&&a.isBuffer&&a.isBuffer(w))return A("buffer:"),A(w);if(R==="object"||R==="function"||R==="asyncfunction")return k=Object.keys(w),P.unorderedObjects&&(k=k.sort()),P.respectType===!1||b(w)||k.splice(0,0,"prototype","__proto__","constructor"),P.excludeKeys&&(k=k.filter(function(V){return!P.excludeKeys(V)})),A("object:"+k.length+":"),D=this,k.forEach(function(V){D.dispatch(V),A(":"),P.excludeValues||D.dispatch(w[V]),A(",")});if(!this["_"+R]){if(P.ignoreUnknown)return A("["+R+"]");throw new Error('Unknown object type "'+R+'"')}this["_"+R](w)},_array:function(w,V){V=V!==void 0?V:P.unorderedArrays!==!1;var k=this;if(A("array:"+w.length+":"),!V||w.length<=1)return w.forEach(function(Y){return k.dispatch(Y)});var R=[],V=w.map(function(Y){var G=new L,Q=y.slice();return S(P,G,Q).dispatch(Y),R=R.concat(Q.slice(y.length)),G.read().toString()});return y=y.concat(R),V.sort(),this._array(V,!1)},_date:function(w){return A("date:"+w.toJSON())},_symbol:function(w){return A("symbol:"+w.toString())},_error:function(w){return A("error:"+w.toString())},_boolean:function(w){return A("bool:"+w.toString())},_string:function(w){A("string:"+w.length+":"),A(w.toString())},_function:function(w){A("fn:"),b(w)?this.dispatch("[native]"):this.dispatch(w.toString()),P.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(w.name)),P.respectFunctionProperties&&this._object(w)},_number:function(w){return A("number:"+w.toString())},_xml:function(w){return A("xml:"+w.toString())},_null:function(){return A("Null")},_undefined:function(){return A("Undefined")},_regexp:function(w){return A("regex:"+w.toString())},_uint8array:function(w){return A("uint8array:"),this.dispatch(Array.prototype.slice.call(w))},_uint8clampedarray:function(w){return A("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(w))},_int8array:function(w){return A("int8array:"),this.dispatch(Array.prototype.slice.call(w))},_uint16array:function(w){return A("uint16array:"),this.dispatch(Array.prototype.slice.call(w))},_int16array:function(w){return A("int16array:"),this.dispatch(Array.prototype.slice.call(w))},_uint32array:function(w){return A("uint32array:"),this.dispatch(Array.prototype.slice.call(w))},_int32array:function(w){return A("int32array:"),this.dispatch(Array.prototype.slice.call(w))},_float32array:function(w){return A("float32array:"),this.dispatch(Array.prototype.slice.call(w))},_float64array:function(w){return A("float64array:"),this.dispatch(Array.prototype.slice.call(w))},_arraybuffer:function(w){return A("arraybuffer:"),this.dispatch(new Uint8Array(w))},_url:function(w){return A("url:"+w.toString())},_map:function(w){return A("map:"),w=Array.from(w),this._array(w,P.unorderedSets!==!1)},_set:function(w){return A("set:"),w=Array.from(w),this._array(w,P.unorderedSets!==!1)},_file:function(w){return A("file:"),this.dispatch([w.name,w.size,w.type,w.lastModfied])},_blob:function(){if(P.ignoreUnknown)return A("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return A("domwindow")},_bigint:function(w){return A("bigint:"+w.toString())},_process:function(){return A("process")},_timer:function(){return A("timer")},_pipe:function(){return A("pipe")},_tcp:function(){return A("tcp")},_udp:function(){return A("udp")},_tty:function(){return A("tty")},_statwatcher:function(){return A("statwatcher")},_securecontext:function(){return A("securecontext")},_connection:function(){return A("connection")},_zlib:function(){return A("zlib")},_context:function(){return A("context")},_nodescript:function(){return A("nodescript")},_httpparser:function(){return A("httpparser")},_dataview:function(){return A("dataview")},_signal:function(){return A("signal")},_fsevent:function(){return A("fsevent")},_tlswrap:function(){return A("tlswrap")}}}function L(){return{buf:"",write:function(P){this.buf+=P},end:function(P){this.buf+=P},read:function(){return this.buf}}}r.writeToStream=function(P,T,y){return y===void 0&&(y=T,T={}),S(T=M(P,T),y).dispatch(P)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,r){(function(s,i,a,c,h,f,d,p,g){(function(x){var v=typeof Uint8Array<"u"?Uint8Array:Array,_=43,m=47,M=48,b=97,S=65,L=45,P=95;function T(y){return y=y.charCodeAt(0),y===_||y===L?62:y===m||y===P?63:y<M?-1:y<M+10?y-M+26+26:y<S+26?y-S:y<b+26?y-b+26:void 0}x.toByteArray=function(y){var A,w;if(0<y.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var D=y.length,D=y.charAt(D-2)==="="?2:y.charAt(D-1)==="="?1:0,k=new v(3*y.length/4-D),R=0<D?y.length-4:y.length,V=0;function Y(G){k[V++]=G}for(A=0;A<R;A+=4,0)Y((16711680&(w=T(y.charAt(A))<<18|T(y.charAt(A+1))<<12|T(y.charAt(A+2))<<6|T(y.charAt(A+3))))>>16),Y((65280&w)>>8),Y(255&w);return D==2?Y(255&(w=T(y.charAt(A))<<2|T(y.charAt(A+1))>>4)):D==1&&(Y((w=T(y.charAt(A))<<10|T(y.charAt(A+1))<<4|T(y.charAt(A+2))>>2)>>8&255),Y(255&w)),k},x.fromByteArray=function(y){var A,w,D,k,R=y.length%3,V="";function Y(G){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(G)}for(A=0,D=y.length-R;A<D;A+=3)w=(y[A]<<16)+(y[A+1]<<8)+y[A+2],V+=Y((k=w)>>18&63)+Y(k>>12&63)+Y(k>>6&63)+Y(63&k);switch(R){case 1:V=(V+=Y((w=y[y.length-1])>>2))+Y(w<<4&63)+"==";break;case 2:V=(V=(V+=Y((w=(y[y.length-2]<<8)+y[y.length-1])>>10))+Y(w>>4&63))+Y(w<<2&63)+"="}return V}})(r===void 0?this.base64js={}:r)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,r){(function(s,i,_,c,h,f,d,p,g){var x=t("base64-js"),v=t("ieee754");function _(C,I,B){if(!(this instanceof _))return new _(C,I,B);var Z,X,W,$,re=typeof C;if(I==="base64"&&re=="string")for(C=($=C).trim?$.trim():$.replace(/^\s+|\s+$/g,"");C.length%4!=0;)C+="=";if(re=="number")Z=K(C);else if(re=="string")Z=_.byteLength(C,I);else{if(re!="object")throw new Error("First argument needs to be a number, array or string.");Z=K(C.length)}if(_._useTypedArrays?X=_._augment(new Uint8Array(Z)):((X=this).length=Z,X._isBuffer=!0),_._useTypedArrays&&typeof C.byteLength=="number")X._set(C);else if(ne($=C)||_.isBuffer($)||$&&typeof $=="object"&&typeof $.length=="number")for(W=0;W<Z;W++)_.isBuffer(C)?X[W]=C.readUInt8(W):X[W]=C[W];else if(re=="string")X.write(C,0,I);else if(re=="number"&&!_._useTypedArrays&&!B)for(W=0;W<Z;W++)X[W]=0;return X}function m(C,I,B,Z){return _._charsWritten=de(function(X){for(var W=[],$=0;$<X.length;$++)W.push(255&X.charCodeAt($));return W}(I),C,B,Z)}function M(C,I,B,Z){return _._charsWritten=de(function(X){for(var W,$,re=[],se=0;se<X.length;se++)$=X.charCodeAt(se),W=$>>8,$=$%256,re.push($),re.push(W);return re}(I),C,B,Z)}function b(C,I,B){var Z="";B=Math.min(C.length,B);for(var X=I;X<B;X++)Z+=String.fromCharCode(C[X]);return Z}function S(C,I,B,W){W||(j(typeof B=="boolean","missing or invalid endian"),j(I!=null,"missing offset"),j(I+1<C.length,"Trying to read beyond buffer length"));var X,W=C.length;if(!(W<=I))return B?(X=C[I],I+1<W&&(X|=C[I+1]<<8)):(X=C[I]<<8,I+1<W&&(X|=C[I+1])),X}function L(C,I,B,W){W||(j(typeof B=="boolean","missing or invalid endian"),j(I!=null,"missing offset"),j(I+3<C.length,"Trying to read beyond buffer length"));var X,W=C.length;if(!(W<=I))return B?(I+2<W&&(X=C[I+2]<<16),I+1<W&&(X|=C[I+1]<<8),X|=C[I],I+3<W&&(X+=C[I+3]<<24>>>0)):(I+1<W&&(X=C[I+1]<<16),I+2<W&&(X|=C[I+2]<<8),I+3<W&&(X|=C[I+3]),X+=C[I]<<24>>>0),X}function P(C,I,B,Z){if(Z||(j(typeof B=="boolean","missing or invalid endian"),j(I!=null,"missing offset"),j(I+1<C.length,"Trying to read beyond buffer length")),!(C.length<=I))return Z=S(C,I,B,!0),32768&Z?-1*(65535-Z+1):Z}function T(C,I,B,Z){if(Z||(j(typeof B=="boolean","missing or invalid endian"),j(I!=null,"missing offset"),j(I+3<C.length,"Trying to read beyond buffer length")),!(C.length<=I))return Z=L(C,I,B,!0),2147483648&Z?-1*(4294967295-Z+1):Z}function y(C,I,B,Z){return Z||(j(typeof B=="boolean","missing or invalid endian"),j(I+3<C.length,"Trying to read beyond buffer length")),v.read(C,I,B,23,4)}function A(C,I,B,Z){return Z||(j(typeof B=="boolean","missing or invalid endian"),j(I+7<C.length,"Trying to read beyond buffer length")),v.read(C,I,B,52,8)}function w(C,I,B,Z,X){if(X||(j(I!=null,"missing value"),j(typeof Z=="boolean","missing or invalid endian"),j(B!=null,"missing offset"),j(B+1<C.length,"trying to write beyond buffer length"),z(I,65535)),X=C.length,!(X<=B))for(var W=0,$=Math.min(X-B,2);W<$;W++)C[B+W]=(I&255<<8*(Z?W:1-W))>>>8*(Z?W:1-W)}function D(C,I,B,Z,X){if(X||(j(I!=null,"missing value"),j(typeof Z=="boolean","missing or invalid endian"),j(B!=null,"missing offset"),j(B+3<C.length,"trying to write beyond buffer length"),z(I,4294967295)),X=C.length,!(X<=B))for(var W=0,$=Math.min(X-B,4);W<$;W++)C[B+W]=I>>>8*(Z?W:3-W)&255}function k(C,I,B,Z,X){X||(j(I!=null,"missing value"),j(typeof Z=="boolean","missing or invalid endian"),j(B!=null,"missing offset"),j(B+1<C.length,"Trying to write beyond buffer length"),U(I,32767,-32768)),C.length<=B||w(C,0<=I?I:65535+I+1,B,Z,X)}function R(C,I,B,Z,X){X||(j(I!=null,"missing value"),j(typeof Z=="boolean","missing or invalid endian"),j(B!=null,"missing offset"),j(B+3<C.length,"Trying to write beyond buffer length"),U(I,2147483647,-2147483648)),C.length<=B||D(C,0<=I?I:4294967295+I+1,B,Z,X)}function V(C,I,B,Z,X){X||(j(I!=null,"missing value"),j(typeof Z=="boolean","missing or invalid endian"),j(B!=null,"missing offset"),j(B+3<C.length,"Trying to write beyond buffer length"),F(I,34028234663852886e22,-34028234663852886e22)),C.length<=B||v.write(C,I,B,Z,23,4)}function Y(C,I,B,Z,X){X||(j(I!=null,"missing value"),j(typeof Z=="boolean","missing or invalid endian"),j(B!=null,"missing offset"),j(B+7<C.length,"Trying to write beyond buffer length"),F(I,17976931348623157e292,-17976931348623157e292)),C.length<=B||v.write(C,I,B,Z,52,8)}r.Buffer=_,r.SlowBuffer=_,r.INSPECT_MAX_BYTES=50,_.poolSize=8192,_._useTypedArrays=function(){try{var C=new ArrayBuffer(0),I=new Uint8Array(C);return I.foo=function(){return 42},I.foo()===42&&typeof I.subarray=="function"}catch{return!1}}(),_.isEncoding=function(C){switch(String(C).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_.isBuffer=function(C){return!(C==null||!C._isBuffer)},_.byteLength=function(C,I){var B;switch(C+="",I||"utf8"){case"hex":B=C.length/2;break;case"utf8":case"utf-8":B=le(C).length;break;case"ascii":case"binary":case"raw":B=C.length;break;case"base64":B=he(C).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":B=2*C.length;break;default:throw new Error("Unknown encoding")}return B},_.concat=function(C,I){if(j(ne(C),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),C.length===0)return new _(0);if(C.length===1)return C[0];if(typeof I!="number")for(X=I=0;X<C.length;X++)I+=C[X].length;for(var B=new _(I),Z=0,X=0;X<C.length;X++){var W=C[X];W.copy(B,Z),Z+=W.length}return B},_.prototype.write=function(C,I,B,Z){isFinite(I)?isFinite(B)||(Z=B,B=void 0):(se=Z,Z=I,I=B,B=se),I=Number(I)||0;var X,W,$,re,se=this.length-I;switch((!B||se<(B=Number(B)))&&(B=se),Z=String(Z||"utf8").toLowerCase()){case"hex":X=function(E,N,ae,ue){ae=Number(ae)||0;var ve=E.length-ae;(!ue||ve<(ue=Number(ue)))&&(ue=ve),j((ve=N.length)%2==0,"Invalid hex string"),ve/2<ue&&(ue=ve/2);for(var Oe=0;Oe<ue;Oe++){var Te=parseInt(N.substr(2*Oe,2),16);j(!isNaN(Te),"Invalid hex string"),E[ae+Oe]=Te}return _._charsWritten=2*Oe,Oe}(this,C,I,B);break;case"utf8":case"utf-8":W=this,$=I,re=B,X=_._charsWritten=de(le(C),W,$,re);break;case"ascii":case"binary":X=m(this,C,I,B);break;case"base64":W=this,$=I,re=B,X=_._charsWritten=de(he(C),W,$,re);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":X=M(this,C,I,B);break;default:throw new Error("Unknown encoding")}return X},_.prototype.toString=function(C,I,B){var Z,X,W,$,re=this;if(C=String(C||"utf8").toLowerCase(),I=Number(I)||0,(B=B!==void 0?Number(B):re.length)===I)return"";switch(C){case"hex":Z=function(se,E,N){var ae=se.length;(!E||E<0)&&(E=0),(!N||N<0||ae<N)&&(N=ae);for(var ue="",ve=E;ve<N;ve++)ue+=ee(se[ve]);return ue}(re,I,B);break;case"utf8":case"utf-8":Z=function(se,E,N){var ae="",ue="";N=Math.min(se.length,N);for(var ve=E;ve<N;ve++)se[ve]<=127?(ae+=O(ue)+String.fromCharCode(se[ve]),ue=""):ue+="%"+se[ve].toString(16);return ae+O(ue)}(re,I,B);break;case"ascii":case"binary":Z=b(re,I,B);break;case"base64":X=re,$=B,Z=(W=I)===0&&$===X.length?x.fromByteArray(X):x.fromByteArray(X.slice(W,$));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Z=function(se,E,N){for(var ae=se.slice(E,N),ue="",ve=0;ve<ae.length;ve+=2)ue+=String.fromCharCode(ae[ve]+256*ae[ve+1]);return ue}(re,I,B);break;default:throw new Error("Unknown encoding")}return Z},_.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},_.prototype.copy=function(C,I,B,Z){if(I=I||0,(Z=Z||Z===0?Z:this.length)!==(B=B||0)&&C.length!==0&&this.length!==0){j(B<=Z,"sourceEnd < sourceStart"),j(0<=I&&I<C.length,"targetStart out of bounds"),j(0<=B&&B<this.length,"sourceStart out of bounds"),j(0<=Z&&Z<=this.length,"sourceEnd out of bounds"),Z>this.length&&(Z=this.length);var X=(Z=C.length-I<Z-B?C.length-I+B:Z)-B;if(X<100||!_._useTypedArrays)for(var W=0;W<X;W++)C[W+I]=this[W+B];else C._set(this.subarray(B,B+X),I)}},_.prototype.slice=function(C,I){var B=this.length;if(C=Q(C,B,0),I=Q(I,B,B),_._useTypedArrays)return _._augment(this.subarray(C,I));for(var Z=I-C,X=new _(Z,void 0,!0),W=0;W<Z;W++)X[W]=this[W+C];return X},_.prototype.get=function(C){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(C)},_.prototype.set=function(C,I){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(C,I)},_.prototype.readUInt8=function(C,I){if(I||(j(C!=null,"missing offset"),j(C<this.length,"Trying to read beyond buffer length")),!(C>=this.length))return this[C]},_.prototype.readUInt16LE=function(C,I){return S(this,C,!0,I)},_.prototype.readUInt16BE=function(C,I){return S(this,C,!1,I)},_.prototype.readUInt32LE=function(C,I){return L(this,C,!0,I)},_.prototype.readUInt32BE=function(C,I){return L(this,C,!1,I)},_.prototype.readInt8=function(C,I){if(I||(j(C!=null,"missing offset"),j(C<this.length,"Trying to read beyond buffer length")),!(C>=this.length))return 128&this[C]?-1*(255-this[C]+1):this[C]},_.prototype.readInt16LE=function(C,I){return P(this,C,!0,I)},_.prototype.readInt16BE=function(C,I){return P(this,C,!1,I)},_.prototype.readInt32LE=function(C,I){return T(this,C,!0,I)},_.prototype.readInt32BE=function(C,I){return T(this,C,!1,I)},_.prototype.readFloatLE=function(C,I){return y(this,C,!0,I)},_.prototype.readFloatBE=function(C,I){return y(this,C,!1,I)},_.prototype.readDoubleLE=function(C,I){return A(this,C,!0,I)},_.prototype.readDoubleBE=function(C,I){return A(this,C,!1,I)},_.prototype.writeUInt8=function(C,I,B){B||(j(C!=null,"missing value"),j(I!=null,"missing offset"),j(I<this.length,"trying to write beyond buffer length"),z(C,255)),I>=this.length||(this[I]=C)},_.prototype.writeUInt16LE=function(C,I,B){w(this,C,I,!0,B)},_.prototype.writeUInt16BE=function(C,I,B){w(this,C,I,!1,B)},_.prototype.writeUInt32LE=function(C,I,B){D(this,C,I,!0,B)},_.prototype.writeUInt32BE=function(C,I,B){D(this,C,I,!1,B)},_.prototype.writeInt8=function(C,I,B){B||(j(C!=null,"missing value"),j(I!=null,"missing offset"),j(I<this.length,"Trying to write beyond buffer length"),U(C,127,-128)),I>=this.length||(0<=C?this.writeUInt8(C,I,B):this.writeUInt8(255+C+1,I,B))},_.prototype.writeInt16LE=function(C,I,B){k(this,C,I,!0,B)},_.prototype.writeInt16BE=function(C,I,B){k(this,C,I,!1,B)},_.prototype.writeInt32LE=function(C,I,B){R(this,C,I,!0,B)},_.prototype.writeInt32BE=function(C,I,B){R(this,C,I,!1,B)},_.prototype.writeFloatLE=function(C,I,B){V(this,C,I,!0,B)},_.prototype.writeFloatBE=function(C,I,B){V(this,C,I,!1,B)},_.prototype.writeDoubleLE=function(C,I,B){Y(this,C,I,!0,B)},_.prototype.writeDoubleBE=function(C,I,B){Y(this,C,I,!1,B)},_.prototype.fill=function(C,I,B){if(I=I||0,B=B||this.length,j(typeof(C=typeof(C=C||0)=="string"?C.charCodeAt(0):C)=="number"&&!isNaN(C),"value is not a number"),j(I<=B,"end < start"),B!==I&&this.length!==0){j(0<=I&&I<this.length,"start out of bounds"),j(0<=B&&B<=this.length,"end out of bounds");for(var Z=I;Z<B;Z++)this[Z]=C}},_.prototype.inspect=function(){for(var C=[],I=this.length,B=0;B<I;B++)if(C[B]=ee(this[B]),B===r.INSPECT_MAX_BYTES){C[B+1]="...";break}return"<Buffer "+C.join(" ")+">"},_.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(_._useTypedArrays)return new _(this).buffer;for(var C=new Uint8Array(this.length),I=0,B=C.length;I<B;I+=1)C[I]=this[I];return C.buffer};var G=_.prototype;function Q(C,I,B){return typeof C!="number"?B:I<=(C=~~C)?I:0<=C||0<=(C+=I)?C:0}function K(C){return(C=~~Math.ceil(+C))<0?0:C}function ne(C){return(Array.isArray||function(I){return Object.prototype.toString.call(I)==="[object Array]"})(C)}function ee(C){return C<16?"0"+C.toString(16):C.toString(16)}function le(C){for(var I=[],B=0;B<C.length;B++){var Z=C.charCodeAt(B);if(Z<=127)I.push(C.charCodeAt(B));else for(var X=B,W=(55296<=Z&&Z<=57343&&B++,encodeURIComponent(C.slice(X,B+1)).substr(1).split("%")),$=0;$<W.length;$++)I.push(parseInt(W[$],16))}return I}function he(C){return x.toByteArray(C)}function de(C,I,B,Z){for(var X=0;X<Z&&!(X+B>=I.length||X>=C.length);X++)I[X+B]=C[X];return X}function O(C){try{return decodeURIComponent(C)}catch{return""}}function z(C,I){j(typeof C=="number","cannot write a non-number as a number"),j(0<=C,"specified a negative value for writing an unsigned value"),j(C<=I,"value is larger than maximum value for type"),j(Math.floor(C)===C,"value has a fractional component")}function U(C,I,B){j(typeof C=="number","cannot write a non-number as a number"),j(C<=I,"value larger than maximum allowed value"),j(B<=C,"value smaller than minimum allowed value"),j(Math.floor(C)===C,"value has a fractional component")}function F(C,I,B){j(typeof C=="number","cannot write a non-number as a number"),j(C<=I,"value larger than maximum allowed value"),j(B<=C,"value smaller than minimum allowed value")}function j(C,I){if(!C)throw new Error(I||"Failed assertion")}_._augment=function(C){return C._isBuffer=!0,C._get=C.get,C._set=C.set,C.get=G.get,C.set=G.set,C.write=G.write,C.toString=G.toString,C.toLocaleString=G.toString,C.toJSON=G.toJSON,C.copy=G.copy,C.slice=G.slice,C.readUInt8=G.readUInt8,C.readUInt16LE=G.readUInt16LE,C.readUInt16BE=G.readUInt16BE,C.readUInt32LE=G.readUInt32LE,C.readUInt32BE=G.readUInt32BE,C.readInt8=G.readInt8,C.readInt16LE=G.readInt16LE,C.readInt16BE=G.readInt16BE,C.readInt32LE=G.readInt32LE,C.readInt32BE=G.readInt32BE,C.readFloatLE=G.readFloatLE,C.readFloatBE=G.readFloatBE,C.readDoubleLE=G.readDoubleLE,C.readDoubleBE=G.readDoubleBE,C.writeUInt8=G.writeUInt8,C.writeUInt16LE=G.writeUInt16LE,C.writeUInt16BE=G.writeUInt16BE,C.writeUInt32LE=G.writeUInt32LE,C.writeUInt32BE=G.writeUInt32BE,C.writeInt8=G.writeInt8,C.writeInt16LE=G.writeInt16LE,C.writeInt16BE=G.writeInt16BE,C.writeInt32LE=G.writeInt32LE,C.writeInt32BE=G.writeInt32BE,C.writeFloatLE=G.writeFloatLE,C.writeFloatBE=G.writeFloatBE,C.writeDoubleLE=G.writeDoubleLE,C.writeDoubleBE=G.writeDoubleBE,C.fill=G.fill,C.inspect=G.inspect,C.toArrayBuffer=G.toArrayBuffer,C}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,r){(function(s,i,x,c,h,f,d,p,g){var x=t("buffer").Buffer,v=4,_=new x(v);_.fill(0),n.exports={hash:function(m,M,b,S){for(var L=M(function(w,D){w.length%v!=0&&(k=w.length+(v-w.length%v),w=x.concat([w,_],k));for(var k,R=[],V=D?w.readInt32BE:w.readInt32LE,Y=0;Y<w.length;Y+=v)R.push(V.call(w,Y));return R}(m=x.isBuffer(m)?m:new x(m),S),8*m.length),M=S,P=new x(b),T=M?P.writeInt32BE:P.writeInt32LE,y=0;y<L.length;y++)T.call(P,L[y],4*y,!0);return P}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,r){(function(s,i,x,c,h,f,d,p,g){var x=t("buffer").Buffer,v=t("./sha"),_=t("./sha256"),m=t("./rng"),M={sha1:v,sha256:_,md5:t("./md5")},b=64,S=new x(b);function L(w,D){var k=M[w=w||"sha1"],R=[];return k||P("algorithm:",w,"is not yet supported"),{update:function(V){return x.isBuffer(V)||(V=new x(V)),R.push(V),V.length,this},digest:function(V){var Y=x.concat(R),Y=D?function(G,Q,K){x.isBuffer(Q)||(Q=new x(Q)),x.isBuffer(K)||(K=new x(K)),Q.length>b?Q=G(Q):Q.length<b&&(Q=x.concat([Q,S],b));for(var ne=new x(b),ee=new x(b),le=0;le<b;le++)ne[le]=54^Q[le],ee[le]=92^Q[le];return K=G(x.concat([ne,K])),G(x.concat([ee,K]))}(k,D,Y):k(Y);return R=null,V?Y.toString(V):Y}}}function P(){var w=[].slice.call(arguments).join(" ");throw new Error([w,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}S.fill(0),r.createHash=function(w){return L(w)},r.createHmac=L,r.randomBytes=function(w,D){if(!D||!D.call)return new x(m(w));try{D.call(this,void 0,new x(m(w)))}catch(k){D(k)}};var T,y=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],A=function(w){r[w]=function(){P("sorry,",w,"is not implemented yet")}};for(T in y)A(y[T])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,r){(function(s,i,a,c,h,f,d,p,g){var x=t("./helpers");function v(P,T){P[T>>5]|=128<<T%32,P[14+(T+64>>>9<<4)]=T;for(var y=1732584193,A=-271733879,w=-1732584194,D=271733878,k=0;k<P.length;k+=16){var R=y,V=A,Y=w,G=D,y=m(y,A,w,D,P[k+0],7,-680876936),D=m(D,y,A,w,P[k+1],12,-389564586),w=m(w,D,y,A,P[k+2],17,606105819),A=m(A,w,D,y,P[k+3],22,-1044525330);y=m(y,A,w,D,P[k+4],7,-176418897),D=m(D,y,A,w,P[k+5],12,1200080426),w=m(w,D,y,A,P[k+6],17,-1473231341),A=m(A,w,D,y,P[k+7],22,-45705983),y=m(y,A,w,D,P[k+8],7,1770035416),D=m(D,y,A,w,P[k+9],12,-1958414417),w=m(w,D,y,A,P[k+10],17,-42063),A=m(A,w,D,y,P[k+11],22,-1990404162),y=m(y,A,w,D,P[k+12],7,1804603682),D=m(D,y,A,w,P[k+13],12,-40341101),w=m(w,D,y,A,P[k+14],17,-1502002290),y=M(y,A=m(A,w,D,y,P[k+15],22,1236535329),w,D,P[k+1],5,-165796510),D=M(D,y,A,w,P[k+6],9,-1069501632),w=M(w,D,y,A,P[k+11],14,643717713),A=M(A,w,D,y,P[k+0],20,-373897302),y=M(y,A,w,D,P[k+5],5,-701558691),D=M(D,y,A,w,P[k+10],9,38016083),w=M(w,D,y,A,P[k+15],14,-660478335),A=M(A,w,D,y,P[k+4],20,-405537848),y=M(y,A,w,D,P[k+9],5,568446438),D=M(D,y,A,w,P[k+14],9,-1019803690),w=M(w,D,y,A,P[k+3],14,-187363961),A=M(A,w,D,y,P[k+8],20,1163531501),y=M(y,A,w,D,P[k+13],5,-1444681467),D=M(D,y,A,w,P[k+2],9,-51403784),w=M(w,D,y,A,P[k+7],14,1735328473),y=b(y,A=M(A,w,D,y,P[k+12],20,-1926607734),w,D,P[k+5],4,-378558),D=b(D,y,A,w,P[k+8],11,-2022574463),w=b(w,D,y,A,P[k+11],16,1839030562),A=b(A,w,D,y,P[k+14],23,-35309556),y=b(y,A,w,D,P[k+1],4,-1530992060),D=b(D,y,A,w,P[k+4],11,1272893353),w=b(w,D,y,A,P[k+7],16,-155497632),A=b(A,w,D,y,P[k+10],23,-1094730640),y=b(y,A,w,D,P[k+13],4,681279174),D=b(D,y,A,w,P[k+0],11,-358537222),w=b(w,D,y,A,P[k+3],16,-722521979),A=b(A,w,D,y,P[k+6],23,76029189),y=b(y,A,w,D,P[k+9],4,-640364487),D=b(D,y,A,w,P[k+12],11,-421815835),w=b(w,D,y,A,P[k+15],16,530742520),y=S(y,A=b(A,w,D,y,P[k+2],23,-995338651),w,D,P[k+0],6,-198630844),D=S(D,y,A,w,P[k+7],10,1126891415),w=S(w,D,y,A,P[k+14],15,-1416354905),A=S(A,w,D,y,P[k+5],21,-57434055),y=S(y,A,w,D,P[k+12],6,1700485571),D=S(D,y,A,w,P[k+3],10,-1894986606),w=S(w,D,y,A,P[k+10],15,-1051523),A=S(A,w,D,y,P[k+1],21,-2054922799),y=S(y,A,w,D,P[k+8],6,1873313359),D=S(D,y,A,w,P[k+15],10,-30611744),w=S(w,D,y,A,P[k+6],15,-1560198380),A=S(A,w,D,y,P[k+13],21,1309151649),y=S(y,A,w,D,P[k+4],6,-145523070),D=S(D,y,A,w,P[k+11],10,-1120210379),w=S(w,D,y,A,P[k+2],15,718787259),A=S(A,w,D,y,P[k+9],21,-343485551),y=L(y,R),A=L(A,V),w=L(w,Y),D=L(D,G)}return Array(y,A,w,D)}function _(P,T,y,A,w,D){return L((T=L(L(T,P),L(A,D)))<<w|T>>>32-w,y)}function m(P,T,y,A,w,D,k){return _(T&y|~T&A,P,T,w,D,k)}function M(P,T,y,A,w,D,k){return _(T&A|y&~A,P,T,w,D,k)}function b(P,T,y,A,w,D,k){return _(T^y^A,P,T,w,D,k)}function S(P,T,y,A,w,D,k){return _(y^(T|~A),P,T,w,D,k)}function L(P,T){var y=(65535&P)+(65535&T);return(P>>16)+(T>>16)+(y>>16)<<16|65535&y}n.exports=function(P){return x.hash(P,v,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,r){(function(s,i,a,c,h,f,d,p,g){n.exports=function(x){for(var v,_=new Array(x),m=0;m<x;m++)!(3&m)&&(v=4294967296*Math.random()),_[m]=v>>>((3&m)<<3)&255;return _}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,r){(function(s,i,a,c,h,f,d,p,g){var x=t("./helpers");function v(M,b){M[b>>5]|=128<<24-b%32,M[15+(b+64>>9<<4)]=b;for(var S,L,P,T=Array(80),y=1732584193,A=-271733879,w=-1732584194,D=271733878,k=-1009589776,R=0;R<M.length;R+=16){for(var V=y,Y=A,G=w,Q=D,K=k,ne=0;ne<80;ne++){T[ne]=ne<16?M[R+ne]:m(T[ne-3]^T[ne-8]^T[ne-14]^T[ne-16],1);var ee=_(_(m(y,5),(ee=A,L=w,P=D,(S=ne)<20?ee&L|~ee&P:!(S<40)&&S<60?ee&L|ee&P|L&P:ee^L^P)),_(_(k,T[ne]),(S=ne)<20?1518500249:S<40?1859775393:S<60?-1894007588:-899497514)),k=D,D=w,w=m(A,30),A=y,y=ee}y=_(y,V),A=_(A,Y),w=_(w,G),D=_(D,Q),k=_(k,K)}return Array(y,A,w,D,k)}function _(M,b){var S=(65535&M)+(65535&b);return(M>>16)+(b>>16)+(S>>16)<<16|65535&S}function m(M,b){return M<<b|M>>>32-b}n.exports=function(M){return x.hash(M,v,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,r){(function(s,i,a,c,h,f,d,p,g){function x(b,S){var L=(65535&b)+(65535&S);return(b>>16)+(S>>16)+(L>>16)<<16|65535&L}function v(b,S){var L,P=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),T=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),y=new Array(64);b[S>>5]|=128<<24-S%32,b[15+(S+64>>9<<4)]=S;for(var A,w,D=0;D<b.length;D+=16){for(var k=T[0],R=T[1],V=T[2],Y=T[3],G=T[4],Q=T[5],K=T[6],ne=T[7],ee=0;ee<64;ee++)y[ee]=ee<16?b[ee+D]:x(x(x((w=y[ee-2],m(w,17)^m(w,19)^M(w,10)),y[ee-7]),(w=y[ee-15],m(w,7)^m(w,18)^M(w,3))),y[ee-16]),L=x(x(x(x(ne,m(w=G,6)^m(w,11)^m(w,25)),G&Q^~G&K),P[ee]),y[ee]),A=x(m(A=k,2)^m(A,13)^m(A,22),k&R^k&V^R&V),ne=K,K=Q,Q=G,G=x(Y,L),Y=V,V=R,R=k,k=x(L,A);T[0]=x(k,T[0]),T[1]=x(R,T[1]),T[2]=x(V,T[2]),T[3]=x(Y,T[3]),T[4]=x(G,T[4]),T[5]=x(Q,T[5]),T[6]=x(K,T[6]),T[7]=x(ne,T[7])}return T}var _=t("./helpers"),m=function(b,S){return b>>>S|b<<32-S},M=function(b,S){return b>>>S};n.exports=function(b){return _.hash(b,v,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,r){(function(s,i,a,c,h,f,d,p,g){r.read=function(x,v,_,m,D){var b,S,L=8*D-m-1,P=(1<<L)-1,T=P>>1,y=-7,A=_?D-1:0,w=_?-1:1,D=x[v+A];for(A+=w,b=D&(1<<-y)-1,D>>=-y,y+=L;0<y;b=256*b+x[v+A],A+=w,y-=8);for(S=b&(1<<-y)-1,b>>=-y,y+=m;0<y;S=256*S+x[v+A],A+=w,y-=8);if(b===0)b=1-T;else{if(b===P)return S?NaN:1/0*(D?-1:1);S+=Math.pow(2,m),b-=T}return(D?-1:1)*S*Math.pow(2,b-m)},r.write=function(x,v,_,m,M,k){var S,L,P=8*k-M-1,T=(1<<P)-1,y=T>>1,A=M===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=m?0:k-1,D=m?1:-1,k=v<0||v===0&&1/v<0?1:0;for(v=Math.abs(v),isNaN(v)||v===1/0?(L=isNaN(v)?1:0,S=T):(S=Math.floor(Math.log(v)/Math.LN2),v*(m=Math.pow(2,-S))<1&&(S--,m*=2),2<=(v+=1<=S+y?A/m:A*Math.pow(2,1-y))*m&&(S++,m/=2),T<=S+y?(L=0,S=T):1<=S+y?(L=(v*m-1)*Math.pow(2,M),S+=y):(L=v*Math.pow(2,y-1)*Math.pow(2,M),S=0));8<=M;x[_+w]=255&L,w+=D,L/=256,M-=8);for(S=S<<M|L,P+=M;0<P;x[_+w]=255&S,w+=D,S/=256,P-=8);x[_+w-D]|=128*k}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,r){(function(s,i,a,c,h,f,d,p,g){var x,v,_;function m(){}(s=n.exports={}).nextTick=(v=typeof window<"u"&&window.setImmediate,_=typeof window<"u"&&window.postMessage&&window.addEventListener,v?function(M){return window.setImmediate(M)}:_?(x=[],window.addEventListener("message",function(M){var b=M.source;b!==window&&b!==null||M.data!=="process-tick"||(M.stopPropagation(),0<x.length&&x.shift()())},!0),function(M){x.push(M),window.postMessage("process-tick","*")}):function(M){setTimeout(M,0)}),s.title="browser",s.browser=!0,s.env={},s.argv=[],s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.binding=function(M){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(M){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(xi);var Yc=xi.exports;const Ec=un(Yc);var wi=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],Xc=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],bi=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"],Zc=wi,qc=Zc.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"]),Br=bi;Br=Br.slice().filter(function(o){return!/^(gl\_|texture)/.test(o)});var Kc=Br.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]),Qc=ou,Jc=wi,Mi=Xc,Hc=bi,$c=qc,eu=Kc,nt=999,Si=9999,Fr=0,Ur=1,Ai=2,Ci=3,Pi=4,hn=5,tu=6,nu=7,ru=8,Ti=9,su=10,Ii=11,iu=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function ou(o){var e=0,t=0,n=nt,r,s,i=[],a=[],c=1,h=0,f=0,d=!1,p=!1,g="",x;o=o||{};var v=Hc,_=Jc;o.version==="300 es"&&(v=eu,_=$c);for(var m={},M={},e=0;e<v.length;e++)m[v[e]]=!0;for(var e=0;e<_.length;e++)M[_[e]]=!0;return function(Q){return a=[],Q!==null?S(Q):L()};function b(Q){Q.length&&a.push({type:iu[n],data:Q,position:f,line:c,column:h})}function S(Q){e=0,Q.toString&&(Q=Q.toString()),g+=Q.replace(/\r\n/g,`
`),x=g.length;for(var K;r=g[e],e<x;){switch(K=e,n){case Fr:e=w();break;case Ur:e=A();break;case Ai:e=y();break;case Ci:e=D();break;case Pi:e=V();break;case Ii:e=R();break;case hn:e=Y();break;case Si:e=G();break;case Ti:e=T();break;case nt:e=P();break}if(K!==e)switch(g[K]){case`
`:h=0,++c;break;default:++h;break}}return t+=e,g=g.slice(e),a}function L(Q){return i.length&&b(i.join("")),n=su,b("(eof)"),a}function P(){return i=i.length?[]:i,s==="/"&&r==="*"?(f=t+e-1,n=Fr,s=r,e+1):s==="/"&&r==="/"?(f=t+e-1,n=Ur,s=r,e+1):r==="#"?(n=Ai,f=t+e,e):/\s/.test(r)?(n=Ti,f=t+e,e):(d=/\d/.test(r),p=/[^\w_]/.test(r),f=t+e,n=d?Pi:p?Ci:Si,e)}function T(){return/[^\s]/g.test(r)?(b(i.join("")),n=nt,e):(i.push(r),s=r,e+1)}function y(){return(r==="\r"||r===`
`)&&s!=="\\"?(b(i.join("")),n=nt,e):(i.push(r),s=r,e+1)}function A(){return y()}function w(){return r==="/"&&s==="*"?(i.push(r),b(i.join("")),n=nt,e+1):(i.push(r),s=r,e+1)}function D(){if(s==="."&&/\d/.test(r))return n=hn,e;if(s==="/"&&r==="*")return n=Fr,e;if(s==="/"&&r==="/")return n=Ur,e;if(r==="."&&i.length){for(;k(i););return n=hn,e}if(r===";"||r===")"||r==="("){if(i.length)for(;k(i););return b(r),n=nt,e+1}var Q=i.length===2&&r!=="=";if(/[\w_\d\s]/.test(r)||Q){for(;k(i););return n=nt,e}return i.push(r),s=r,e+1}function k(Q){var K=0,ne,ee;do{if(ne=Mi.indexOf(Q.slice(0,Q.length+K).join("")),ee=Mi[ne],ne===-1){if(K--+Q.length>0)continue;ee=Q.slice(0,1).join("")}return b(ee),f+=ee.length,i=i.slice(ee.length),i.length}while(!0)}function R(){return/[^a-fA-F0-9]/.test(r)?(b(i.join("")),n=nt,e):(i.push(r),s=r,e+1)}function V(){return r==="."||/[eE]/.test(r)?(i.push(r),n=hn,s=r,e+1):r==="x"&&i.length===1&&i[0]==="0"?(n=Ii,i.push(r),s=r,e+1):/[^\d]/.test(r)?(b(i.join("")),n=nt,e):(i.push(r),s=r,e+1)}function Y(){return r==="f"&&(i.push(r),s=r,e+=1),/[eE]/.test(r)||(r==="-"||r==="+")&&/[eE]/.test(s)?(i.push(r),s=r,e+1):/[^\d]/.test(r)?(b(i.join("")),n=nt,e):(i.push(r),s=r,e+1)}function G(){if(/[^\d\w_]/.test(r)){var Q=i.join("");return M[Q]?n=ru:m[Q]?n=nu:n=tu,b(i.join("")),n=nt,e}return i.push(r),s=r,e+1}}var au=Qc,lu=cu;function cu(o,e){var t=au(e),n=[];return n=n.concat(t(o)),n=n.concat(t(null)),n}const uu=un(lu);var hu=fu;function fu(o){for(var e=[],t=0;t<o.length;t++)o[t].type!=="eof"&&e.push(o[t].data);return e.join("")}const Li=un(hu);var du=pu;function pu(o){var e=null,t=null,n=0,r=0,s=0,i=0,a=0,c=[],h,f,d;for(h=0,f;h<o.length;h++)if(d=o[h],d.data==="{"){if(n&&n++||(f=g(h,At(")"),At()),f<0)||(i=f,f=g(f,At("("),At(")")),f<0)||(a=f,f=g(f,fn),f<0)||o[f].type!=="ident"||(t=o[f].data,f=g(f,fn),f<0))continue;n=1,r=h,e=o[f].data,s=f;var p=g(f,fn);switch(o[p]&&o[p].data){case"lowp":case"highp":case"mediump":s=p}}else if(n&&d.data==="}"){if(--n)continue;c.push({name:t,type:e,body:[r+1,h],args:[a,i+1],outer:[s,h+1]})}for(h=0;h<o.length;h++)if(d=o[h],d.data===";"){if(f=g(h,At(")"),At()),f<0||(i=f,f=g(f,At("("),At(")")),f<0)||(a=f,f=g(f,fn),f<0)||o[f].type!=="ident"||(t=o[f].data,f=g(f,fn),f<0)||o[f].type==="operator"||o[f].data==="return")continue;e=o[f].data,c.push({name:t,type:e,body:!1,args:[a,i+1],outer:[f,h+1]})}return c.sort(function(x,v){return x.outer[0]-v.outer[0]});function g(x,v,_){for(var m=x-1;m>=0;m--){if(v(o[m]))return m;if(_&&_(o[m]))return-1}return-1}}function At(o){return function(e){return e.type==="operator"&&(!o||e.data===o)}}function fn(o){return o.type!=="whitespace"}const mu=un(du);function gu(o,e){if(typeof o!="object"||o===null)return o;var t=o[Symbol.toPrimitive];if(t!==void 0){var n=t.call(o,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(o)}function Oi(o){var e=gu(o,"string");return typeof e=="symbol"?e:String(e)}function Ae(o,e,t){return e=Oi(e),e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}function Di(o,e){var t=Object.keys(o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(o);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(o,r).enumerable})),t.push.apply(t,n)}return t}function Yt(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Di(Object(t),!0).forEach(function(n){Ae(o,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)):Di(Object(t)).forEach(function(n){Object.defineProperty(o,n,Object.getOwnPropertyDescriptor(t,n))})}return o}function yu(o,e){if(o==null)return{};var t={},n=Object.keys(o),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=o[r]);return t}function vu(o,e){if(o==null)return{};var t=yu(o,e),n,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);for(r=0;r<s.length;r++)n=s[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(o,n)&&(t[n]=o[n])}return t}function _u(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function xu(o,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,Oi(n.key),n)}}function wu(o,e,t){return e&&xu(o.prototype,e),Object.defineProperty(o,"prototype",{writable:!1}),o}function ki(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function Nr(o,e){return Nr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Nr(o,e)}function bu(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),e&&Nr(o,e)}function Un(o){return Un=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Un(o)}function Mu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Su(o,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ki(o)}function Au(o){var e=Mu();return function(){var n=Un(o),r;if(e){var s=Un(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return Su(this,r)}}var me={position:"csm_Position",positionRaw:"csm_PositionRaw",pointSize:"csm_PointSize",fragColor:"csm_FragColor",diffuseColor:"csm_DiffuseColor",normal:"csm_Normal",roughness:"csm_Roughness",metalness:"csm_Metalness",emissive:"csm_Emissive",ao:"csm_AO",bump:"csm_Bump",depthAlpha:"csm_DepthAlpha"},We,Et,Cu=(We={},Ae(We,"".concat(me.normal),{"#include <beginnormal_vertex>":`
    vec3 objectNormal = `.concat(me.normal,`;
    #ifdef USE_TANGENT
	    vec3 objectTangent = vec3( tangent.xyz );
    #endif
    `)}),Ae(We,"".concat(me.position),{"#include <begin_vertex>":`
    vec3 transformed = `.concat(me.position,`;
  `)}),Ae(We,"".concat(me.positionRaw),{"#include <begin_vertex>":`
    vec4 csm_internal_positionUnprojected = `.concat(me.positionRaw,`;
    mat4x4 csm_internal_unprojectMatrix = projectionMatrix * modelViewMatrix;
    #ifdef USE_INSTANCING
      csm_internal_unprojectMatrix = csm_internal_unprojectMatrix * instanceMatrix;
    #endif
    csm_internal_positionUnprojected = inverse(csm_internal_unprojectMatrix) * csm_internal_positionUnprojected;
    vec3 transformed = csm_internal_positionUnprojected.xyz;
  `)}),Ae(We,"".concat(me.pointSize),{"gl_PointSize = size;":`
    gl_PointSize = `.concat(me.pointSize,`;
    `)}),Ae(We,"".concat(me.diffuseColor),{"#include <color_fragment>":`
    #include <color_fragment>
    diffuseColor = `.concat(me.diffuseColor,`;
  `)}),Ae(We,"".concat(me.fragColor),{"#include <dithering_fragment>":`
    #include <dithering_fragment>
    gl_FragColor  = `.concat(me.fragColor,`;
  `)}),Ae(We,"".concat(me.emissive),{"vec3 totalEmissiveRadiance = emissive;":`
    vec3 totalEmissiveRadiance = `.concat(me.emissive,`;
    `)}),Ae(We,"".concat(me.roughness),{"#include <roughnessmap_fragment>":`
    #include <roughnessmap_fragment>
    roughnessFactor = `.concat(me.roughness,`;
    `)}),Ae(We,"".concat(me.metalness),{"#include <metalnessmap_fragment>":`
    #include <metalnessmap_fragment>
    metalnessFactor = `.concat(me.metalness,`;
    `)}),Ae(We,"".concat(me.ao),{"#include <aomap_fragment>":`
    #include <aomap_fragment>
    reflectedLight.indirectDiffuse *= 1. - `.concat(me.ao,`;
    `)}),Ae(We,"".concat(me.bump),{"#include <normal_fragment_maps>":`
    #include <normal_fragment_maps>

    vec3 csm_internal_orthogonal = `.concat(me.bump," - (dot(").concat(me.bump,`, normal) * normal);
    vec3 csm_internal_projectedbump = mat3(csm_internal_vModelViewMatrix) * csm_internal_orthogonal;
    normal = normalize(normal - csm_internal_projectedbump);
    `)}),Ae(We,"".concat(me.depthAlpha),{"gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );":`
      gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity * `.concat(me.depthAlpha,` );
    `),"gl_FragColor = packDepthToRGBA( fragCoordZ );":`
      gl_FragColor = packDepthToRGBA( fragCoordZ );
      gl_FragColor.a *= `.concat(me.depthAlpha,`;
    `)}),We),Pu=(Et={},Ae(Et,"".concat(me.position),{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`
    gl_Position = projectionMatrix * modelViewMatrix * vec4( `.concat(me.position,`, 1.0 );
  `)}),Ae(Et,"".concat(me.positionRaw),{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`
    gl_Position = `.concat(me.position,`;
  `)}),Ae(Et,"".concat(me.diffuseColor),{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`
    gl_FragColor = `.concat(me.diffuseColor,`;
  `)}),Ae(Et,"".concat(me.fragColor),{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`
    gl_FragColor = `.concat(me.fragColor,`;
  `)}),Et),Tu=`

#ifdef IS_VERTEX
    // csm_Position & csm_PositionRaw
    #ifdef IS_UNKNOWN
        vec3 csm_Position = vec3(0.0);
        vec4 csm_PositionRaw = vec4(0.0);
        vec3 csm_Normal = vec3(0.0);
    #else
        vec3 csm_Position = position;
        vec4 csm_PositionRaw = projectionMatrix * modelViewMatrix * vec4(position, 1.);
        vec3 csm_Normal = normal;
    #endif

    // csm_PointSize
    #ifdef IS_POINTSMATERIAL
        float csm_PointSize = size;
    #endif
#else
    // csm_DiffuseColor & csm_FragColor
    #if defined IS_UNKNOWN || defined IS_SHADERMATERIAL || defined IS_MESHDEPTHMATERIAL || defined IS_MESHNORMALMATERIAL || defined IS_SHADOWMATERIAL
        vec4 csm_DiffuseColor = vec4(1.0, 0.0, 1.0, 1.0);
        vec4 csm_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
    #else
        #ifdef USE_MAP
            vec4 _csm_sampledDiffuseColor = texture2D(map, vMapUv);

            #ifdef DECODE_VIDEO_TEXTURE
            // inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)
            _csm_sampledDiffuseColor = vec4(mix(pow(_csm_sampledDiffuseColor.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), _csm_sampledDiffuseColor.rgb * 0.0773993808, vec3(lessThanEqual(_csm_sampledDiffuseColor.rgb, vec3(0.04045)))), _csm_sampledDiffuseColor.w);
            #endif

            vec4 csm_DiffuseColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;
            vec4 csm_FragColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;
        #else
            vec4 csm_DiffuseColor = vec4(diffuse, opacity);
            vec4 csm_FragColor = vec4(diffuse, opacity);
        #endif
    #endif

    // csm_Emissive, csm_Roughness, csm_Metalness
    #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL
        vec3 csm_Emissive = emissive;
        float csm_Roughness = roughness;
        float csm_Metalness = metalness;
    #endif

    // csm_AO
    #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL || defined IS_MESHBASICMATERIAL || defined IS_MESHLAMBERTMATERIAL || defined IS_MESHPHONGMATERIAL || defined IS_MESHTOONMATERIAL
        float csm_AO = 0.0;
    #endif

    // csm_Bump
    #if defined IS_MESHLAMBERTMATERIAL || defined IS_MESHMATCAPMATERIAL || defined IS_MESHNORMALMATERIAL || defined IS_MESHPHONGMATERIAL || defined IS_MESHPHYSICALMATERIAL || defined IS_MESHSTANDARDMATERIAL || defined IS_MESHTOONMATERIAL || defined IS_SHADOWMATERIAL 
        vec3 csm_Bump = vec3(0.0);
    #endif

    float csm_DepthAlpha = 1.0;
#endif
`,Iu=`
    varying mat4 csm_internal_vModelViewMatrix;
`,Lu=`
    csm_internal_vModelViewMatrix = modelViewMatrix;
`,Ou=`
    varying mat4 csm_internal_vModelViewMatrix;
`,Du=`
    
`,Ye,ku=(Ye={},Ae(Ye,"".concat(me.position),"*"),Ae(Ye,"".concat(me.positionRaw),"*"),Ae(Ye,"".concat(me.normal),"*"),Ae(Ye,"".concat(me.pointSize),["PointsMaterial"]),Ae(Ye,"".concat(me.diffuseColor),"*"),Ae(Ye,"".concat(me.fragColor),"*"),Ae(Ye,"".concat(me.emissive),["MeshStandardMaterial","MeshPhysicalMaterial"]),Ae(Ye,"".concat(me.roughness),["MeshStandardMaterial","MeshPhysicalMaterial"]),Ae(Ye,"".concat(me.metalness),["MeshStandardMaterial","MeshPhysicalMaterial"]),Ae(Ye,"".concat(me.ao),["MeshStandardMaterial","MeshPhysicalMaterial","MeshBasicMaterial","MeshLambertMaterial","MeshPhongMaterial","MeshToonMaterial"]),Ae(Ye,"".concat(me.bump),["MeshLambertMaterial","MeshMatcapMaterial","MeshNormalMaterial","MeshPhongMaterial","MeshPhysicalMaterial","MeshStandardMaterial","MeshToonMaterial","ShadowMaterial"]),Ae(Ye,"".concat(me.depthAlpha),"*"),Ye),Bu=["baseMaterial","fragmentShader","vertexShader","uniforms","patchMap","cacheKey","silent"],Fu=function(e,t,n){return e.split(t).join(n)},Uu=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},Nu=function(e,t){return new RegExp("\\b".concat(Uu(t),"\\b")).test(e)};function Vu(o){try{new o}catch(e){if(e.message.indexOf("is not a constructor")>=0)return!1}return!0}function zu(o,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;Object.assign(o,e);var n=Object.getPrototypeOf(e);Object.entries(Object.getOwnPropertyDescriptors(n)).filter(function(r){var s=typeof r[1].get=="function",i=typeof r[1].set=="function",a=typeof r[1].value=="function",c=r[0]==="constructor";return(s||i||a)&&!c}).forEach(function(r){if(typeof o[r[0]]=="function"){t||console.warn("Function ".concat(r[0]," already exists on CSM, renaming to base_").concat(r[0]));var s="base_".concat(r[0]);o[s]=r[1].value.bind(o);return}Object.defineProperty(o,r[0],r[1])})}function Gu(o){var e=o.toString().trim(),t=e.substring(e.indexOf("{")+1,e.lastIndexOf("}"));return t.trim().length===0}function Bi(o){return o.replace(/\s/g,"")}function ju(o,e,t){var n=o.lastIndexOf(e);return n===-1?o:o.substring(0,n)+t+o.substring(n+e.length)}var Ru=function(o){bu(t,o);var e=Au(t);function t(n){var r,s=n.baseMaterial,i=n.fragmentShader,a=n.vertexShader,c=n.uniforms,h=n.patchMap,f=n.cacheKey,d=n.silent,p=vu(n,Bu);_u(this,t);var g;if(Vu(s)?g=new s(p):(g=s,Object.assign(g,p)),g.type==="RawShaderMaterial")throw new Error("CustomShaderMaterial does not support RawShaderMaterial");r=e.call(this),zu(ki(r),g,d),r.__csm={patchMap:h||{},fragmentShader:i||"",vertexShader:a||"",cacheKey:f,baseMaterial:s,instanceID:Kr.MathUtils.generateUUID(),type:g.type,isAlreadyExtended:!Gu(g.onBeforeCompile),cacheHash:"",silent:d},r.uniforms=Yt(Yt({},r.uniforms||{}),c||{});{var x=r.__csm,v=x.fragmentShader,_=x.vertexShader,m=r.uniforms;r.__csm.cacheHash=r.getCacheHash(),r.generateMaterial(v,_,m)}return r}return wu(t,[{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.uniforms=r.uniforms||this.uniforms,Object.assign(this.__csm,r);var s=this.__csm,i=s.fragmentShader,a=s.vertexShader,c=this.uniforms,h=this.getCacheHash();this.__csm.cacheHash=h,this.generateMaterial(i,a,c)}},{key:"clone",value:function(){var r={baseMaterial:this.__csm.baseMaterial,fragmentShader:this.__csm.fragmentShader,vertexShader:this.__csm.vertexShader,uniforms:this.uniforms,silent:this.__csm.silent,patchMap:this.__csm.patchMap,cacheKey:this.__csm.cacheKey},s=new this.constructor(r);return Object.assign(this,s),s}},{key:"getCacheHash",value:function(){var r=this.__csm,s=r.fragmentShader,i=r.vertexShader,a=this.uniforms,c=Object.values(a).reduce(function(f,d){var p=d.value;return f+JSON.stringify(p)},""),h=Bi(s)+Bi(i)+c;return h.trim().length>0?Ec(h):this.customProgramCacheKey()}},{key:"generateMaterial",value:function(r,s,i){var a=this,c=this.parseShader(r),h=this.parseShader(s);this.uniforms=i||{},this.customProgramCacheKey=function(){return a.__csm.cacheHash};var f=function(g){try{if(c){var x=a.patchShader(c,g.fragmentShader,!0);g.fragmentShader=a.getMaterialDefine()+x}if(h){var v=a.patchShader(h,g.vertexShader);g.vertexShader=`#define IS_VERTEX;
`+v,g.vertexShader=a.getMaterialDefine()+g.vertexShader}g.uniforms=Yt(Yt({},g.uniforms),a.uniforms),a.uniforms=g.uniforms}catch(_){console.error(_)}};if(this.__csm.isAlreadyExtended){var d=this.onBeforeCompile;this.onBeforeCompile=function(p,g){d(p,g),f(p)}}else this.onBeforeCompile=f;this.needsUpdate=!0}},{key:"patchShader",value:function(r,s,i){var a=this,c=s,h=Yt(Yt({},this.getPatchMapForMaterial()),this.__csm.patchMap);Object.keys(h).forEach(function(p){Object.keys(h[p]).forEach(function(g){var x=ku[p],v=a.__csm.type;if(p==="*"||Nu(r.main,p))if(!x||Array.isArray(x)&&x.includes(v)||x==="*")c=Fu(c,g,h[p][g]);else throw new Error("CSM: ".concat(p," is not available in ").concat(v,". Shader cannot compile."))})}),c=c.replace("void main() {",`
        #ifndef CSM_IS_HEAD_DEFAULTS_DEFINED
          `.concat(i?Ou:Iu,`
          #define CSM_IS_HEAD_DEFAULTS_DEFINED 1
        #endif

        `).concat(r.header,`
        
        void main() {
          #ifndef CSM_IS_DEFAULTS_DEFINED
            `).concat(Tu,`
            #define CSM_IS_DEFAULTS_DEFINED 1
          #endif
          
          #ifndef CSM_IS_MAIN_DEFAULTS_DEFINED
            `).concat(i?Du:Lu,`
            #define CSM_IS_MAIN_DEFAULTS_DEFINED 1
          #endif

          // CSM_START
      `));var f=this.__csm.isAlreadyExtended,d=c.includes("// CSM_END");return f&&d?c=ju(c,"// CSM_END",`
          // CSM_END
          `.concat(r.main,`
          // CSM_END
        `)):c=c.replace("// CSM_START",`
        // CSM_START
        `.concat(r.main,`
        // CSM_END
          `)),c=r.defines+c,c}},{key:"parseShader",value:function(r){if(r){var s=r.replace(/\/\*\*(.*?)\*\/|\/\/(.*?)\n/gm,""),i=uu(s),a=mu(i),c=a.map(function(d){return d.name}).indexOf("main"),h=Li(i.slice(0,c>=0?a[c].outer[0]:void 0)),f=c>=0?this.getShaderFromIndex(i,a[c].body):"";return{defines:"",header:h,main:f}}}},{key:"getMaterialDefine",value:function(){var r=this.__csm.type;return r?"#define IS_".concat(r.toUpperCase(),`;
`):`#define IS_UNKNOWN;
`}},{key:"getPatchMapForMaterial",value:function(){switch(this.__csm.type){case"ShaderMaterial":return Pu;default:return Cu}}},{key:"getShaderFromIndex",value:function(r,s){return Li(r.slice(s[0],s[1]))}}]),t}(Kr.Material);const Wu=["args"],Yu=u.defineComponent({__name:"index",props:{baseMaterial:{type:Function},vertexShader:{},fragmentShader:{},silent:{type:Boolean},uniforms:{}},setup(o,{expose:e}){const t=o,n=u.shallowRef(null),{extend:r}=ie.useTresContext();return r({CustomShaderMaterial:Ru}),e({value:n}),(s,i)=>(u.openBlock(),u.createElementBlock("TresCustomShaderMaterial",{ref_key:"customShaderMaterialClass",ref:n,args:[t]},null,8,Wu))}}),Eu=Number.parseInt(l.REVISION.replace(/\D+/g,""));class Xu extends l.ShaderMaterial{constructor(t=new l.Vector2){super({uniforms:{inputBuffer:new l.Uniform(null),depthBuffer:new l.Uniform(null),resolution:new l.Uniform(new l.Vector2),texelSize:new l.Uniform(new l.Vector2),halfTexelSize:new l.Uniform(new l.Vector2),kernel:new l.Uniform(0),scale:new l.Uniform(1),cameraNear:new l.Uniform(0),cameraFar:new l.Uniform(1),minDepthThreshold:new l.Uniform(0),maxDepthThreshold:new l.Uniform(1),depthScale:new l.Uniform(0),depthToBlurRatioBias:new l.Uniform(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${Eu>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:l.NoBlending,depthWrite:!1,depthTest:!1});ce(this,"kernel");this.toneMapped=!1,this.setTexelSize(t.x,t.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(t,n){this.uniforms.texelSize.value.set(t,n),this.uniforms.halfTexelSize.value.set(t,n).multiplyScalar(.5)}setResolution(t){this.uniforms.resolution.value.copy(t)}}class Zu{constructor({resolution:e,width:t=500,height:n=500,minDepthThreshold:r=0,maxDepthThreshold:s=1,depthScale:i=0,depthToBlurRatioBias:a=.25}){ce(this,"renderTargetA");ce(this,"renderTargetB");ce(this,"convolutionMaterial");ce(this,"scene");ce(this,"camera");ce(this,"screen");ce(this,"renderToScreen",!1);this.renderTargetA=new l.WebGLRenderTarget(e,e,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,stencilBuffer:!1,depthBuffer:!1,type:l.HalfFloatType}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new Xu,this.convolutionMaterial.setTexelSize(1/t,1/n),this.convolutionMaterial.setResolution(new l.Vector2(t,n)),this.scene=new l.Scene,this.camera=new l.Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=r,this.convolutionMaterial.uniforms.maxDepthThreshold.value=s,this.convolutionMaterial.uniforms.depthScale.value=i,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=a,this.convolutionMaterial.defines.USE_DEPTH=i>0;const c=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),h=new Float32Array([0,0,2,0,0,2]),f=new l.BufferGeometry;f.setAttribute("position",new l.BufferAttribute(c,3)),f.setAttribute("uv",new l.BufferAttribute(h,2)),this.screen=new l.Mesh(f,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,n){const r=this.scene,s=this.camera,i=this.renderTargetA,a=this.renderTargetB,c=this.convolutionMaterial,h=c.uniforms;h.depthBuffer.value=t.depthTexture;const f=c.kernel;let d=t,p,g,x;for(g=0,x=f.length-1;g<x;++g)p=g&1?a:i,h.kernel.value=f[g],h.inputBuffer.value=d.texture,e.setRenderTarget(p),e.render(r,s),d=p;h.kernel.value=f[g],h.inputBuffer.value=d.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(r,s)}}class qu extends l.MeshStandardMaterial{constructor(t={}){super(t);ce(this,"_tDepth",{value:null});ce(this,"_distortionMap",{value:null});ce(this,"_tDiffuse",{value:null});ce(this,"_tDiffuseBlur",{value:null});ce(this,"_textureMatrix",{value:null});ce(this,"_hasBlur",{value:!1});ce(this,"_mirror",{value:0});ce(this,"_mixBlur",{value:0});ce(this,"_blurStrength",{value:.5});ce(this,"_minDepthThreshold",{value:.9});ce(this,"_maxDepthThreshold",{value:1});ce(this,"_depthScale",{value:0});ce(this,"_depthToBlurRatioBias",{value:.25});ce(this,"_distortion",{value:1});ce(this,"_mixContrast",{value:1});this.setValues(t)}onBeforeCompile(t){var n;(n=t.defines)!=null&&n.USE_UV||(t.defines.USE_UV=""),t.uniforms.hasBlur=this._hasBlur,t.uniforms.tDiffuse=this._tDiffuse,t.uniforms.tDepth=this._tDepth,t.uniforms.distortionMap=this._distortionMap,t.uniforms.tDiffuseBlur=this._tDiffuseBlur,t.uniforms.textureMatrix=this._textureMatrix,t.uniforms.mirror=this._mirror,t.uniforms.mixBlur=this._mixBlur,t.uniforms.mixStrength=this._blurStrength,t.uniforms.minDepthThreshold=this._minDepthThreshold,t.uniforms.maxDepthThreshold=this._maxDepthThreshold,t.uniforms.depthScale=this._depthScale,t.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,t.uniforms.distortion=this._distortion,t.uniforms.mixContrast=this._mixContrast,t.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${t.vertexShader}`,t.vertexShader=t.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),t.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${t.fragmentShader}`,t.fragmentShader=t.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(t){this._tDiffuse.value=t}get tDepth(){return this._tDepth.value}set tDepth(t){this._tDepth.value=t}get distortionMap(){return this._distortionMap.value}set distortionMap(t){this._distortionMap.value=t}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(t){this._tDiffuseBlur.value=t}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(t){this._textureMatrix.value=t}get hasBlur(){return this._hasBlur.value}set hasBlur(t){this._hasBlur.value=t}get mirror(){return this._mirror.value}set mirror(t){this._mirror.value=t}get mixBlur(){return this._mixBlur.value}set mixBlur(t){this._mixBlur.value=t}get mixStrength(){return this._blurStrength.value}set mixStrength(t){this._blurStrength.value=t}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(t){this._minDepthThreshold.value=t}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(t){this._maxDepthThreshold.value=t}get depthScale(){return this._depthScale.value}set depthScale(t){this._depthScale.value=t}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(t){this._depthToBlurRatioBias.value=t}get distortion(){return this._distortion.value}set distortion(t){this._distortion.value=t}get mixContrast(){return this._mixContrast.value}set mixContrast(t){this._mixContrast.value=t}}const Ku=["texture-matrix","mirror","t-diffuse","t-depth","t-diffuse-blur","has-blur","mix-strength","min-depth-threshold","max-depth-threshold","depth-scale","depth-to-blur-ratio-bias","distortion","distortion-map","mix-contrast","defines-USE_BLUR","defines-USE_DEPTH","defines-USE_DISTORTION"],Qu=u.defineComponent({__name:"index",props:{resolution:{default:256},mixBlur:{default:0},mixStrength:{default:1},blur:{default:()=>[0,0]},mirror:{default:0},minDepthThreshold:{default:.9},maxDepthThreshold:{default:1},depthScale:{default:0},depthToBlurRatioBias:{default:.25},distortionMap:{},distortion:{default:1},mixContrast:{default:1},reflectorOffset:{default:0}},setup(o){const e=o;function t(Y,G){let Q;return Y.traverse(K=>{K.isMesh&&K.material&&K.material.uuid===G&&(Q=K)}),Q}const n={reflectorPlane:new l.Plane,normal:new l.Vector3,reflectorWorldPosition:new l.Vector3,cameraWorldPosition:new l.Vector3,rotationMatrix:new l.Matrix4,lookAtPosition:new l.Vector3(0,0,-1),clipPlane:new l.Vector4,view:new l.Vector3,target:new l.Vector3,q:new l.Vector4,virtualCamera:new l.PerspectiveCamera,textureMatrix:new l.Matrix4},{resolution:r,minDepthThreshold:s,maxDepthThreshold:i,depthScale:a,depthToBlurRatioBias:c,blur:h,mirror:f,mixBlur:d,mixStrength:p,distortion:g,distortionMap:x,mixContrast:v}=u.toRefs(e),{camera:_,scene:m,renderer:M,extend:b}=ie.useTresContext();b({MeshReflectorMaterial:qu});const S=u.shallowRef(),L=u.shallowRef(),P=u.shallowRef(),T=u.shallowRef(),y=u.computed(()=>typeof h.value=="number"?[h.value,h.value]:h.value),A=u.computed(()=>y.value[0]>0||y.value[1]>0);function w(Y){var Q,K;if(n.reflectorWorldPosition.setFromMatrixPosition(Y.matrixWorld),n.cameraWorldPosition.setFromMatrixPosition((Q=_.value)==null?void 0:Q.matrixWorld),n.rotationMatrix.extractRotation(Y.matrixWorld),n.normal.set(0,0,1),n.normal.applyMatrix4(n.rotationMatrix),n.reflectorWorldPosition.addScaledVector(n.normal,e.reflectorOffset),n.view.subVectors(n.reflectorWorldPosition,n.cameraWorldPosition),n.view.dot(n.normal)>0)return;n.view.reflect(n.normal).negate(),n.view.add(n.reflectorWorldPosition),n.rotationMatrix.extractRotation((K=_.value)==null?void 0:K.matrixWorld),n.lookAtPosition.set(0,0,-1),n.lookAtPosition.applyMatrix4(n.rotationMatrix),n.lookAtPosition.add(n.cameraWorldPosition),n.target.subVectors(n.reflectorWorldPosition,n.lookAtPosition),n.target.reflect(n.normal).negate(),n.target.add(n.reflectorWorldPosition),n.virtualCamera.position.copy(n.view),n.virtualCamera.up.set(0,1,0),n.virtualCamera.up.applyMatrix4(n.rotationMatrix),n.virtualCamera.up.reflect(n.normal),n.virtualCamera.lookAt(n.target),n.virtualCamera.far=(_==null?void 0:_.value).far,n.virtualCamera.updateMatrixWorld(),n.virtualCamera.projectionMatrix.copy((_==null?void 0:_.value).projectionMatrix),n.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.textureMatrix.multiply(n.virtualCamera.projectionMatrix),n.textureMatrix.multiply(n.virtualCamera.matrixWorldInverse),n.textureMatrix.multiply(Y.matrixWorld),n.reflectorPlane.setFromNormalAndCoplanarPoint(n.normal,n.reflectorWorldPosition),n.reflectorPlane.applyMatrix4(n.virtualCamera.matrixWorldInverse),n.clipPlane.set(n.reflectorPlane.normal.x,n.reflectorPlane.normal.y,n.reflectorPlane.normal.z,n.reflectorPlane.constant);const G=n.virtualCamera.projectionMatrix;n.q.x=(Math.sign(n.clipPlane.x)+G.elements[8])/G.elements[0],n.q.y=(Math.sign(n.clipPlane.y)+G.elements[9])/G.elements[5],n.q.z=-1,n.q.w=(1+G.elements[10])/G.elements[14],n.clipPlane.multiplyScalar(2/n.clipPlane.dot(n.q)),G.elements[2]=n.clipPlane.x,G.elements[6]=n.clipPlane.y,G.elements[10]=n.clipPlane.z+1,G.elements[14]=n.clipPlane.w}u.watchEffect(()=>{var G;(G=S.value)==null||G.texture.dispose();const Y={minFilter:l.LinearFilter,magFilter:l.LinearFilter,type:l.HalfFloatType};S.value=new l.WebGLRenderTarget(r.value,r.value,{...Y,depthBuffer:!0,depthTexture:new l.DepthTexture(r.value,r.value,l.DepthFormat,l.UnsignedShortType)}),L.value=new l.WebGLRenderTarget(r.value,r.value,Y),P.value=new Zu({resolution:r.value,width:y.value[0],height:y.value[1],minDepthThreshold:s.value,maxDepthThreshold:i.value,depthScale:a.value,depthToBlurRatioBias:c.value}),T.value={mirror:f,textureMatrix:n.textureMatrix,mixBlur:d,tDiffuse:S.value.texture,tDepth:S.value.depthTexture,tDiffuseBlur:S.value.texture,hasBlur:A,mixStrength:p,minDepthThreshold:s,maxDepthThreshold:i,depthScale:a,depthToBlurRatioBias:c,distortion:g,distortionMap:x.value,mixContrast:v,"defines-USE_BLUR":A.value?"":void 0,"defines-USE_DEPTH":a.value>0?"":void 0,"defines-USE_DISTORTION":x.value?"":void 0}});const D=u.shallowRef(),{onLoop:k}=ie.useRenderLoop();k(()=>{var K;if(!D.value||!M.value||!S.value||!_.value)return;const Y=t(m.value,D.value.uuid);if(!Y)return;Y.visible=!1;const G=M.value.xr.enabled,Q=M.value.shadowMap.autoUpdate;w(Y),M.value.shadowMap.autoUpdate=!1,M.value.setRenderTarget(S.value),M.value.autoClear||M.value.clear(),M.value.render(m.value,n.virtualCamera),(K=P==null?void 0:P.value)==null||K.render(M.value,S.value,L.value),M.value.xr.enabled=G,M.value.shadowMap.autoUpdate=Q,Y.visible=!0,M.value.setRenderTarget(null)});const R=u.useAttrs(),V=u.computed(()=>{const Y={};return Object.assign(Y,e),Object.assign(Y,R.value),Y});return u.onBeforeUnmount(()=>{var Y,G;(Y=S==null?void 0:S.value)==null||Y.dispose(),(G=L==null?void 0:L.value)==null||G.dispose()}),(Y,G)=>{var Q,K,ne;return u.openBlock(),u.createElementBlock("TresMeshReflectorMaterial",u.mergeProps({key:`key${T.value["defines-USE_BLUR"]}${T.value["defines-USE_DEPTH"]}${T.value["defines-USE_DISTORTION"]}`,ref_key:"materialRef",ref:D},V.value,{"texture-matrix":n.textureMatrix,mirror:u.unref(f),"t-diffuse":(Q=S.value)==null?void 0:Q.texture,"t-depth":(K=S.value)==null?void 0:K.depthTexture,"t-diffuse-blur":(ne=L.value)==null?void 0:ne.texture,"has-blur":A.value,"mix-strength":u.unref(p),"min-depth-threshold":u.unref(s),"max-depth-threshold":u.unref(i),"depth-scale":u.unref(a),"depth-to-blur-ratio-bias":u.unref(c),distortion:u.unref(g),"distortion-map":u.unref(x),"mix-contrast":u.unref(v),"defines-USE_BLUR":A.value?"":void 0,"defines-USE_DEPTH":u.unref(a)>0?"":void 0,"defines-USE_DISTORTION":u.unref(x)?"":void 0}),null,16,Ku)}}});class Fi extends l.ShaderMaterial{constructor(e={}){super(),this.vertexShader=`
      #define STANDARD
      varying vec3 vViewPosition;
      #ifdef USE_TRANSMISSION
      varying vec3 vWorldPosition;
      #endif
    
      varying vec2 vUv;
      varying vec4 vPos;
      varying vec3 vNormalW;
      varying vec3 vPositionW;

      #include <common>
      #include <uv_pars_vertex>
      #include <envmap_pars_vertex>
      #include <color_pars_vertex>
      #include <fog_pars_vertex>
      #include <morphtarget_pars_vertex>
      #include <skinning_pars_vertex>
      #include <logdepthbuf_pars_vertex>
      #include <clipping_planes_pars_vertex>

      void main() {
        
        #include <uv_vertex>
        #include <color_vertex>
        #include <morphcolor_vertex>
      
        #if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
      
          #include <beginnormal_vertex>
          #include <morphnormal_vertex>
          #include <skinbase_vertex>
          #include <skinnormal_vertex>
          #include <defaultnormal_vertex>
      
        #endif
      
        #include <begin_vertex>
        #include <morphtarget_vertex>
        #include <skinning_vertex>
        #include <project_vertex>
        #include <logdepthbuf_vertex>
        #include <clipping_planes_vertex>
      
        #include <worldpos_vertex>
        #include <envmap_vertex>
        #include <fog_vertex>

        mat4 modelViewProjectionMatrix = projectionMatrix * modelViewMatrix;

        vUv = uv;
        vPos = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );
        vPositionW = vec3( vec4( transformed, 1.0 ) * modelMatrix);
        vNormalW = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );
        
        gl_Position = modelViewProjectionMatrix * vec4( transformed, 1.0 );

      }`,this.fragmentShader=` 
      varying vec2 vUv;
      varying vec3 vPositionW;
      varying vec4 vPos;
      varying vec3 vNormalW;
      
      uniform float time;
      uniform float fresnelOpacity;
      uniform float scanlineSize;
      uniform float fresnelAmount;
      uniform float signalSpeed;
      uniform float hologramBrightness;
      uniform float hologramOpacity;
      uniform bool blinkFresnelOnly;
      uniform bool enableBlinking;
      uniform vec3 hologramColor;

      float flicker( float amt, float time ) {return clamp( fract( cos( time ) * 43758.5453123 ), amt, 1.0 );}
      float random(in float a, in float b) { return fract((cos(dot(vec2(a,b) ,vec2(12.9898,78.233))) * 43758.5453)); }

      void main() {
        vec2 vCoords = vPos.xy;
        vCoords /= vPos.w;
        vCoords = vCoords * 0.5 + 0.5;
        vec2 myUV = fract( vCoords );

        // Defines hologram main color
        vec4 hologramColor = vec4(hologramColor, mix(hologramBrightness, vUv.y, 0.5));

        // Add scanlines
        float scanlines = 10.;
        scanlines += 20. * sin(time *signalSpeed * 20.8 - myUV.y * 60. * scanlineSize);
        scanlines *= smoothstep(1.3 * cos(time *signalSpeed + myUV.y * scanlineSize), 0.78, 0.9);
        scanlines *= max(0.25, sin(time *signalSpeed) * 1.0);

        // Scanlines offsets
        float r = random(vUv.x, vUv.y);
        float g = random(vUv.y * 20.2, vUv.y * .2);
        float b = random(vUv.y * .9, vUv.y * .2);

        // Scanline composition
        hologramColor += vec4(r*scanlines, b*scanlines, r, 1.0) / 84.;
        vec4 scanlineMix = mix(vec4(0.0), hologramColor, hologramColor.a);

        // Calculates fresnel
        vec3 viewDirectionW = normalize(cameraPosition - vPositionW);
        float fresnelEffect = dot(viewDirectionW, vNormalW) * (1.6 - fresnelOpacity/2.);
        fresnelEffect = clamp(fresnelAmount - fresnelEffect, 0., fresnelOpacity);

        // Blinkin effect
        //Suggested by Octano - https://x.com/OtanoDesign?s=20
        float blinkValue = enableBlinking ? 0.6 - signalSpeed : 1.0;
        float blink = flicker(blinkValue, time * signalSpeed * .02);

        // Final shader composition
        vec3 finalColor;

        if(blinkFresnelOnly){
          finalColor = scanlineMix.rgb + fresnelEffect * blink;
        }else{
          finalColor = scanlineMix.rgb * blink + fresnelEffect;
        }

        gl_FragColor = vec4( finalColor, hologramOpacity);

      }`,this.uniforms={time:new l.Uniform(0),fresnelOpacity:new l.Uniform(e.fresnelOpacity!==void 0?e.fresnelOpacity:1),fresnelAmount:new l.Uniform(e.fresnelAmount!==void 0?e.fresnelAmount:.45),scanlineSize:new l.Uniform(e.scanlineSize!==void 0?e.scanlineSize:8),hologramBrightness:new l.Uniform(e.hologramBrightness!==void 0?e.hologramBrightness:1),signalSpeed:new l.Uniform(e.signalSpeed!==void 0?e.signalSpeed:1),hologramColor:new l.Uniform(e.hologramColor!==void 0?new l.Color(e.hologramColor):new l.Color("#00d5ff")),enableBlinking:new l.Uniform(e.enableBlinking!==void 0?e.enableBlinking:!0),blinkFresnelOnly:new l.Uniform(e.blinkFresnelOnly!==void 0?e.blinkFresnelOnly:!0),hologramOpacity:new l.Uniform(e.hologramOpacity!==void 0?e.hologramOpacity:1)},this.clock=new l.Clock,this.setValues(e),this.depthTest=e.depthTest!==void 0?e.depthTest:!1,this.blending=e.blendMode!==void 0?e.blendMode:l.AdditiveBlending,this.transparent=!0,this.side=e.side!==void 0?e.side:l.FrontSide}update(){this.uniforms.time.value=this.clock.getElapsedTime()}}const Ju=["uniforms-fresnel-amount-value","uniforms-enable-blinking-value","uniforms-fresnel-opacity-value","uniforms-hologram-brightness-value","uniforms-scanline-size-value","uniforms-signal-speed-value","uniforms-hologram-color-value","uniforms-hologram-opacity-value","uniforms-blink-fresnel-only-value","enable-additive","side"],Hu=u.defineComponent({__name:"index",props:{fresnelAmount:{default:.45},fresnelOpacity:{default:1},blinkFresnelOnly:{type:Boolean,default:!0},enableBlinking:{type:Boolean,default:!0},enableAdditive:{type:Boolean,default:!0},hologramBrightness:{default:.7},scanlineSize:{default:8},signalSpeed:{default:.45},hologramOpacity:{default:1},hologramColor:{default:"#00d5ff"},side:{default:l.FrontSide}},setup(o,{expose:e}){const t=o,n=u.shallowRef(),{extend:r}=ie.useTresContext();r({HolographicMaterial:Fi}),e({root:n,constructor:Fi});const{onLoop:s}=ie.useRenderLoop();return s(()=>{var i;(i=n.value)==null||i.update()}),(i,a)=>(u.openBlock(),u.createElementBlock("TresHolographicMaterial",{ref_key:"MeshHolographicMaterialClass",ref:n,"uniforms-fresnel-amount-value":t.fresnelAmount,"uniforms-enable-blinking-value":t.enableBlinking,"uniforms-fresnel-opacity-value":t.fresnelOpacity,"uniforms-hologram-brightness-value":t.hologramBrightness,"uniforms-scanline-size-value":t.scanlineSize,"uniforms-signal-speed-value":t.signalSpeed,"uniforms-hologram-color-value":t.hologramColor,"uniforms-hologram-opacity-value":t.hologramOpacity,"uniforms-blink-fresnel-only-value":t.blinkFresnelOnly,"enable-additive":t.enableAdditive,side:t.side},null,8,Ju))}}),$u=["args"],eh=["color"],th=u.defineComponent({__name:"Box",props:{args:{default:()=>[1,1,1]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"boxRef",ref:s},i.$attrs),[u.createElementVNode("TresBoxGeometry",{args:u.unref(n)},null,8,$u),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,eh)])],16))}}),Ui=new l.Box3,Nn=new l.Vector3;class Ni extends l.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new l.Float32BufferAttribute(e,3)),this.setAttribute("uv",new l.Float32BufferAttribute(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new l.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new l.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new l.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new l.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new l.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new l.InterleavedBufferAttribute(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new l.WireframeGeometry(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new l.Box3);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Ui.setFromBufferAttribute(t),this.boundingBox.union(Ui))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new l.Sphere),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let s=0,i=e.count;s<i;s++)Nn.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(Nn)),Nn.fromBufferAttribute(t,s),r=Math.max(r,n.distanceToSquared(Nn));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}l.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new l.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},l.ShaderLib.line={uniforms:l.UniformsUtils.merge([l.UniformsLib.common,l.UniformsLib.fog,l.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Vr extends l.ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:l.UniformsUtils.clone(l.ShaderLib.line.uniforms),vertexShader:l.ShaderLib.line.vertexShader,fragmentShader:l.ShaderLib.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const Vi=new l.Vector3,zi=new l.Vector3,Ne=new l.Vector4,Ve=new l.Vector4,it=new l.Vector4,zr=new l.Vector3,Gr=new l.Matrix4,ze=new l.Line3,Gi=new l.Vector3,Vn=new l.Box3,zn=new l.Sphere,ot=new l.Vector4;let at,Bt;function ji(o,e,t){return ot.set(0,0,-e,1).applyMatrix4(o.projectionMatrix),ot.multiplyScalar(1/ot.w),ot.x=Bt/t.width,ot.y=Bt/t.height,ot.applyMatrix4(o.projectionMatrixInverse),ot.multiplyScalar(1/ot.w),Math.abs(Math.max(ot.x,ot.y))}function nh(o,e){const t=o.matrixWorld,n=o.geometry,r=n.attributes.instanceStart,s=n.attributes.instanceEnd,i=Math.min(n.instanceCount,r.count);for(let a=0,c=i;a<c;a++){ze.start.fromBufferAttribute(r,a),ze.end.fromBufferAttribute(s,a),ze.applyMatrix4(t);const h=new l.Vector3,f=new l.Vector3;at.distanceSqToSegment(ze.start,ze.end,f,h),f.distanceTo(h)<Bt*.5&&e.push({point:f,pointOnLine:h,distance:at.origin.distanceTo(f),object:o,face:null,faceIndex:a,uv:null,uv1:null})}}function rh(o,e,t){const n=e.projectionMatrix,s=o.material.resolution,i=o.matrixWorld,a=o.geometry,c=a.attributes.instanceStart,h=a.attributes.instanceEnd,f=Math.min(a.instanceCount,c.count),d=-e.near;at.at(1,it),it.w=1,it.applyMatrix4(e.matrixWorldInverse),it.applyMatrix4(n),it.multiplyScalar(1/it.w),it.x*=s.x/2,it.y*=s.y/2,it.z=0,zr.copy(it),Gr.multiplyMatrices(e.matrixWorldInverse,i);for(let p=0,g=f;p<g;p++){if(Ne.fromBufferAttribute(c,p),Ve.fromBufferAttribute(h,p),Ne.w=1,Ve.w=1,Ne.applyMatrix4(Gr),Ve.applyMatrix4(Gr),Ne.z>d&&Ve.z>d)continue;if(Ne.z>d){const b=Ne.z-Ve.z,S=(Ne.z-d)/b;Ne.lerp(Ve,S)}else if(Ve.z>d){const b=Ve.z-Ne.z,S=(Ve.z-d)/b;Ve.lerp(Ne,S)}Ne.applyMatrix4(n),Ve.applyMatrix4(n),Ne.multiplyScalar(1/Ne.w),Ve.multiplyScalar(1/Ve.w),Ne.x*=s.x/2,Ne.y*=s.y/2,Ve.x*=s.x/2,Ve.y*=s.y/2,ze.start.copy(Ne),ze.start.z=0,ze.end.copy(Ve),ze.end.z=0;const v=ze.closestPointToPointParameter(zr,!0);ze.at(v,Gi);const _=l.MathUtils.lerp(Ne.z,Ve.z,v),m=_>=-1&&_<=1,M=zr.distanceTo(Gi)<Bt*.5;if(m&&M){ze.start.fromBufferAttribute(c,p),ze.end.fromBufferAttribute(h,p),ze.start.applyMatrix4(i),ze.end.applyMatrix4(i);const b=new l.Vector3,S=new l.Vector3;at.distanceSqToSegment(ze.start,ze.end,S,b),t.push({point:S,pointOnLine:b,distance:at.origin.distanceTo(S),object:o,face:null,faceIndex:p,uv:null,uv1:null})}}}class sh extends l.Mesh{constructor(e=new Ni,t=new Vr({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let i=0,a=0,c=t.count;i<c;i++,a+=2)Vi.fromBufferAttribute(t,i),zi.fromBufferAttribute(n,i),r[a]=a===0?0:r[a-1],r[a+1]=r[a]+Vi.distanceTo(zi);const s=new l.InstancedInterleavedBuffer(r,2,1);return e.setAttribute("instanceDistanceStart",new l.InterleavedBufferAttribute(s,1,0)),e.setAttribute("instanceDistanceEnd",new l.InterleavedBufferAttribute(s,1,1)),this}raycast(e,t){const n=this.material.worldUnits,r=e.camera;r===null&&!n&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;at=e.ray;const i=this.matrixWorld,a=this.geometry,c=this.material;Bt=c.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),zn.copy(a.boundingSphere).applyMatrix4(i);let h;if(n)h=Bt*.5;else{const d=Math.max(r.near,zn.distanceToPoint(at.origin));h=ji(r,d,c.resolution)}if(zn.radius+=h,at.intersectsSphere(zn)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),Vn.copy(a.boundingBox).applyMatrix4(i);let f;if(n)f=Bt*.5;else{const d=Math.max(r.near,Vn.distanceToPoint(at.origin));f=ji(r,d,c.resolution)}Vn.expandByScalar(f),at.intersectsBox(Vn)!==!1&&(n?nh(this,t):rh(this,r,t))}}class Ri extends Ni{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setColors(n),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class ih extends sh{constructor(e=new Ri,t=new Vr({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}const oh=["object"],Wi=u.defineComponent({__name:"Line2",props:{points:{},vertexColors:{default:null},color:{default:"white"},lineWidth:{default:1},worldUnits:{type:Boolean,default:!1},alphaToCoverage:{type:Boolean,default:!1},dashed:{type:Boolean,default:!1},dashSize:{default:1},gapSize:{default:1},dashScale:{default:1},dashOffset:{default:0}},setup(o){const e=o;function t(f,d){if(!f||f.length===0)return Array.from({length:d}).fill(ie.normalizeColor(e.color));if(f.length===1)return Array.from({length:d}).fill(ie.normalizeColor(f[0]));if(f.length===d)return f.map(ie.normalizeColor);const p=d-1,g=f.map(ie.normalizeColor);closed&&g.push(g[0].clone());const x=[g[0]],v=p/(g.length-1);for(let _=1;_<p;_++){const m=_%v/v,M=Math.floor(_/v);x.push(g[M].clone().lerp(g[M+1],m))}return x.push(g[g.length-1]),x}const n=new Vr,r=new Ri,s=new ih(r,n),i=ie.useTresContext().sizes,a=u.computed(()=>Array.isArray(e.vertexColors));function c(f,d){f.color=ie.normalizeColor(d.color),f.linewidth=d.lineWidth,f.alphaToCoverage=d.alphaToCoverage,f.worldUnits=d.worldUnits,f.vertexColors=Array.isArray(d.vertexColors),f.dashed=d.dashed,f.dashScale=d.dashScale,f.dashSize=d.dashSize,f.dashOffset=d.dashOffset,f.gapSize=d.gapSize,f.needsUpdate=!0}function h(f,d,p){const g=d.map(v=>v instanceof l.Vector3?[v.x,v.y,v.z]:v instanceof l.Vector2?[v.x,v.y,0]:Array.isArray(v)&&v.length===2?[v[0],v[1],0]:v).flat();f.setPositions(g.flat());const x=t(p,d.length).map(v=>v.toArray()).flat();f.setColors(x),s.computeLineDistances()}return c(n,e),h(r,e.points,e.vertexColors),s.computeLineDistances(),u.watch(()=>[e.color,e.lineWidth,e.alphaToCoverage,e.worldUnits,a,e.dashed,e.dashScale,e.dashSize,e.dashOffset],()=>c(n,e)),u.watch([e.points,e.vertexColors],()=>h(r,e.points,e.vertexColors)),u.watch(()=>e.vertexColors,()=>h(r,e.points,e.vertexColors)),u.watch(()=>e.points,()=>h(r,e.points,e.vertexColors)),u.watch([i.height,i.width],()=>n.resolution=new l.Vector2(i.width.value,i.height.value)),u.onUnmounted(()=>{r.dispose(),n.dispose()}),(f,d)=>(u.openBlock(),u.createElementBlock("primitive",{object:u.unref(s)},null,8,oh))}}),ah=u.defineComponent({__name:"CatmullRomCurve3",props:{segments:{default:20},closed:{type:Boolean,default:!1},curveType:{default:"centripetal"},tension:{default:.5},points:{},vertexColors:{},color:{},lineWidth:{},alphaToCoverage:{type:Boolean},dashed:{type:Boolean},dashSize:{},dashScale:{},dashOffset:{},gapSize:{},worldUnits:{type:Boolean}},setup(o){const e=o;function t(i,a,c,h){const f=i.map(d=>d instanceof l.Vector3?d:new l.Vector3(...d));return new l.CatmullRomCurve3(f,a,c,h)}function n(i,a){return i.getPoints(a)}const r=u.computed(()=>t(e.points,e.closed,e.curveType,e.tension)),s=u.computed(()=>n(r.value,e.segments));return(i,a)=>(u.openBlock(),u.createBlock(Wi,{points:s.value,"vertex-colors":e.vertexColors,color:e.color,"line-width":e.lineWidth,"alpha-to-coverage":e.alphaToCoverage,dashed:e.dashed,"dash-size":e.dashSize,"dash-scale":e.dashScale,"dash-offset":e.dashOffset,"gap-size":e.gapSize,"world-units":e.worldUnits},null,8,["points","vertex-colors","color","line-width","alpha-to-coverage","dashed","dash-size","dash-scale","dash-offset","gap-size","world-units"]))}}),lh=["args"],ch=["color"],uh=u.defineComponent({__name:"Circle",props:{args:{default:()=>[1,32,0,Math.PI*2]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"circleRef",ref:s},i.$attrs),[u.createElementVNode("TresCircleGeometry",{args:u.unref(n)},null,8,lh),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,ch)])],16))}}),hh=["args"],fh=["color"],dh=u.defineComponent({__name:"Cone",props:{args:{default:()=>[1,1,12,12,!1,0,Math.PI*2]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"coneRef",ref:s},i.$attrs),[u.createElementVNode("TresConeGeometry",{args:u.unref(n)},null,8,hh),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,fh)])],16))}}),ph=["args"],mh=["color"],gh=u.defineComponent({__name:"Dodecahedron",props:{args:{default:()=>[1,0]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"dodecahedronRef",ref:s},i.$attrs),[u.createElementVNode("TresDodecahedronGeometry",{args:u.unref(n)},null,8,ph),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,mh)])],16))}}),yh=["args"],vh=["color"],_h=u.defineComponent({__name:"Icosahedron",props:{args:{default:()=>[1,0]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"icosahedronRef",ref:s},i.$attrs),[u.createElementVNode("TresIcosahedronGeometry",{args:u.unref(n)},null,8,yh),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,vh)])],16))}}),xh=["args"],wh=["color"],bh=u.defineComponent({__name:"Octahedron",props:{args:{default:()=>[1,0]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"octahedronRef",ref:s},i.$attrs),[u.createElementVNode("TresOctahedronGeometry",{args:u.unref(n)},null,8,xh),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,wh)])],16))}}),Mh=["rotation"],Sh=["args"],Ah=["color"],Ch=u.defineComponent({__name:"Plane",props:{args:{default:()=>[1,1]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"planeRef",ref:s,rotation:[-Math.PI/2,0,0]},i.$attrs),[u.createElementVNode("TresPlaneGeometry",{args:u.unref(n)},null,8,Sh),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Ah)])],16,Mh))}}),Ph=["args"],Th=["color"],Ih=u.defineComponent({__name:"Ring",props:{args:{default:()=>[.5,1,32]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"ringRef",ref:s},i.$attrs),[u.createElementVNode("TresRingGeometry",{args:u.unref(n)},null,8,Ph),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Th)])],16))}}),Lh=["args"],Oh=["color"],Dh=u.defineComponent({__name:"RoundedBox",props:{args:{default:()=>[1,1,1,2,.1]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{extend:s}=ie.useTresContext();s({RoundedBoxGeometry:ka});const i=u.shallowRef();return e({value:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",{ref_key:"roundedBoxRef",ref:i},[u.createElementVNode("TresRoundedBoxGeometry",{args:u.unref(n)},null,8,Lh),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Oh)])],512))}}),kh=["args"],Bh=["color"],Fh=u.defineComponent({__name:"Sphere",props:{args:{default:()=>[2,32,16]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"sphereRef",ref:s},i.$attrs),[u.createElementVNode("TresSphereGeometry",{args:u.unref(n)},null,8,kh),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Bh)])],16))}}),Uh=["geometry"],Nh=["color"],Vh=u.defineComponent({__name:"Superformula",props:{widthSegments:{default:32},heightSegments:{default:32},numArmsA:{default:4},expA:{default:()=>[40,1.3,.9]},numArmsB:{default:4},expB:{default:()=>[40,1.3,.9]},color:{default:"white"}},setup(o,{expose:e}){const t=o,{cos:n,sin:r,abs:s}=Math,i=u.shallowRef(),a=u.shallowRef(t.color);function c(p,g){const x=new l.BufferGeometry,v=p*g,_=new Float32Array(Array.from({length:3*v}).fill(0)),m=new Float32Array(Array.from({length:3*v}).fill(0)),M=[];for(let b=0;b<g-1;b++){for(let y=0;y<p-1;y++){const A=b*p+y,w=A+1,D=A+p,k=w+p;M.push(A,D,w),M.push(D,k,w)}const S=b*p+p-1,L=b*p,P=S+p,T=L+p;M.push(S,P,L),M.push(P,T,L)}return x.setIndex(M),x.setAttribute("position",new l.BufferAttribute(_,3)),x.setAttribute("normal",new l.BufferAttribute(m,3)),x}function h(p,g,x,v,_){return(s(n(g*p*.25))**v+s(r(g*p*.25))**_)**(-1/x)}function f(p,g,x,v,_,m,M,b,S,L,P){const T=2*Math.PI/L,y=-Math.PI,A=Math.PI/(P-1),w=-.5*Math.PI,D=p.getAttribute("position");let k=0,R=0,V=w;for(let Y=0;Y<P;Y++){R=y;for(let G=0;G<L;G++){const Q=h(R,g,x,v,_),K=h(V,m,M,b,S);D.setXYZ(k,Q*n(R)*K*n(V),K*r(V),Q*r(R)*K*n(V)),k++,R+=T}V+=A}D.needsUpdate=!0,p.computeVertexNormals()}u.watch(()=>t.color,()=>a.value=t.color),u.watch(()=>[t.widthSegments,t.heightSegments],()=>{i.value&&i.value.dispose(),i.value=c(t.widthSegments,t.heightSegments)},{immediate:!0}),u.watch(()=>[t.numArmsA,t.expA[0],t.expA[1],t.expA[2],t.numArmsB,t.expB[0],t.expB[1],t.expB[2]],()=>f(i.value,t.numArmsA,t.expA[0],t.expA[1],t.expA[2],t.numArmsB,t.expB[0],t.expB[1],t.expB[2],t.widthSegments,t.heightSegments),{immediate:!0}),u.onUnmounted(()=>{i.value&&i.value.dispose()});const d=u.shallowRef();return e({value:d}),(p,g)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"superformulaRef",ref:d},p.$attrs,{geometry:i.value}),[u.renderSlot(p.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:a.value},null,8,Nh)])],16,Uh))}}),zh=["rotation"],Gh=["args"],jh=["color"],Rh=u.defineComponent({__name:"Tetrahedron",props:{args:{default:()=>[1,0]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"tetrahedronRef",ref:s,rotation:[-Math.PI/2,0,0]},i.$attrs),[u.createElementVNode("TresTetrahedronGeometry",{args:u.unref(n)},null,8,Gh),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,jh)])],16,zh))}}),Wh=["args"],Yh=["color"],Eh=u.defineComponent({__name:"Torus",props:{args:{default:()=>[1,1,16,80]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"torusRef",ref:s},i.$attrs),[u.createElementVNode("TresTorusGeometry",{args:u.unref(n)},null,8,Wh),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Yh)])],16))}}),Xh=["args"],Zh=["color"],qh=u.defineComponent({__name:"TorusKnot",props:{args:{default:()=>[1,.4,64,8]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"torusKnotRef",ref:s},i.$attrs),[u.createElementVNode("TresTorusKnotGeometry",{args:u.unref(n)},null,8,Xh),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Zh)])],16))}}),Kh=["args"],Qh=["color"],Jh=u.defineComponent({__name:"Tube",props:{args:{default:()=>[new l.QuadraticBezierCurve3(new l.Vector3(-1,0,0),new l.Vector3(0,1,0),new l.Vector3(1,0,0)),20,.2,8,!1]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({value:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"tubeRef",ref:s},i.$attrs),[u.createElementVNode("TresTubeGeometry",{args:u.unref(n)},null,8,Kh),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Qh)])],16))}});class Hh extends l.Object3D{constructor(){super();ce(this,"virtualScene",null);this.virtualScene=new l.Scene}add(...t){return this.virtualScene.add(...t),this}destructor(){this.virtualScene.traverse(t=>{t instanceof l.Mesh&&(t.geometry.dispose(),t.material.dispose(),t.material.map&&t.material.map.dispose(),this.virtualScene.remove(t))}),this.virtualScene=null}}const $h=u.defineComponent({__name:"component",props:{background:{type:[Boolean,String],default:!1},blur:{default:0},files:{default:[]},path:{default:""},preset:{default:void 0},resolution:{default:256},near:{default:1},far:{default:1e3},frames:{default:Number.POSITIVE_INFINITY}},async setup(o,{expose:e}){let t,n;const r=o,s=u.ref(null);e({texture:s});const{extend:i,renderer:a,scene:c}=ie.useTresContext();let h=null;const f=u.ref(null);let d=null;const p=u.ref(null);u.onUnmounted(()=>{var m,M;(m=p.value)==null||m.destructor(),(M=f.value)==null||M.dispose()});const{onBeforeLoop:g}=ie.useRenderLoop();let x=1;g(()=>{d&&p.value&&f.value&&(r.frames===Number.POSITIVE_INFINITY||x<r.frames)&&(d.update(a.value,u.toRaw(p.value.virtualScene)),x++)});const v=([t,n]=u.withAsyncContext(()=>Qs(r,f)),t=await t,n(),t).texture,_=m=>{m?(c.value.environment=m.texture,r.background&&(c.value.background=m.texture)):(c.value.environment=v.value,r.background&&(c.value.background=v.value))};return u.watch(v,()=>{f.value&&_(f.value)},{immediate:!0,deep:!0}),u.watch(u.useSlots().default,m=>{var M,b;if(m&&(h=m,Array.isArray(h)&&h.length>0&&typeof((M=h[0])==null?void 0:M.type)!="symbol")){i({EnvSence:Hh}),f.value=new l.WebGLCubeRenderTarget(r.resolution),f.value.texture.type=l.HalfFloatType,d=new l.CubeCamera(r.near,r.far,f.value),_(f.value);return}(b=f.value)==null||b.dispose(),f.value=null,_()},{immediate:!0,deep:!0}),s.value=v,(m,M)=>f.value?(u.openBlock(),u.createElementBlock("TresEnvSence",{key:0,ref_key:"envSence",ref:p},[u.renderSlot(m.$slots,"default")],512)):u.createCommentVNode("",!0)}}),ef={key:0,args:[0,1,64]},tf={key:1,args:[.5,1,64]},nf={key:2},rf=["tone-mapped","map","side","color"],sf=u.defineComponent({__name:"index",props:{args:{default:null},from:{default:"rect"},toneMapped:{type:Boolean,default:!1},map:{default:null},intensity:{default:1},color:{default:new l.Color(16777215)}},setup(o){const e=o,t=u.ref();return u.watchEffect(()=>{t.value&&(t.value.color.multiplyScalar(e.intensity),t.value.needsUpdate=!0)}),(n,r)=>(u.openBlock(),u.createElementBlock("TresMesh",null,[n.from==="circle"?(u.openBlock(),u.createElementBlock("TresRingGeometry",ef)):n.from==="ring"?(u.openBlock(),u.createElementBlock("TresRingGeometry",tf)):n.from==="rect"?(u.openBlock(),u.createElementBlock("TresPlaneGeometry",nf)):(u.openBlock(),u.createBlock(e.from,{key:3,args:e})),u.createElementVNode("TresMeshBasicMaterial",{ref_key:"material",ref:t,"tone-mapped":n.toneMapped,map:n.map,side:u.unref(l.DoubleSide),color:n.color},null,8,rf)]))}}),of=["receive-shadow","rotation"],af=["args"],lf=u.createElementVNode("TresMeshStandardMaterial",{color:8421504,side:2},null,-1),cf=u.defineComponent({__name:"Backdrop",props:{floor:{default:.25},segments:{default:20},receiveShadow:{type:Boolean,default:!1}},setup(o){const e=o,t=a=>a===0?0:2**(10*a-10),{floor:n,segments:r,receiveShadow:s}=u.toRefs(e),i=u.ref(null);return u.watch(()=>[r.value,n.value,i.value],([a,c,h])=>{if(!h||a===null)return;let f=0;const d=a/a/2,p=h.attributes.position;for(let g=0;g<a+1;g++)for(let x=0;x<a+1;x++)p.setXYZ(f++,g/a-d+(g===0?-c:0),x/a-d,t(g/a));p.needsUpdate=!0,h.computeVertexNormals()}),(a,c)=>(u.openBlock(),u.createElementBlock("TresGroup",u.normalizeProps(u.guardReactiveProps(a.$attrs)),[u.createElementVNode("TresMesh",{"receive-shadow":u.unref(s),rotation:[-Math.PI/2,0,Math.PI/2]},[u.createElementVNode("TresPlaneGeometry",{ref_key:"planeRef",ref:i,args:[1,1,u.unref(r),u.unref(r)]},null,8,af),u.renderSlot(a.$slots,"default",{},()=>[lf])],8,of)],16))}}),uf=["geometry"],hf=["map","opacity","depth-write"],ff=["object"],df=["args"],pf=["rotation","args"],mf=u.defineComponent({__name:"ContactShadows",props:{opacity:{default:1},width:{default:1},height:{default:1},blur:{default:1},far:{default:10},smooth:{type:Boolean,default:!0},resolution:{default:512},frames:{default:Number.POSITIVE_INFINITY},scale:{default:10},color:{default:"#000000"},depthWrite:{type:Boolean,default:!1},helper:{type:Boolean,default:!1}},setup(o,{expose:e}){const t=o,n=u.shallowRef(),r=u.shallowRef();e(n);let s,i,a,c,h;const{renderer:f,scene:d}=ie.useTresContext(),p=u.computed(()=>t.width*(Array.isArray(t.scale)?t.scale[0]:t.scale||1)),g=u.computed(()=>t.height*(Array.isArray(t.scale)?t.scale[1]:t.scale||1));u.watchEffect(()=>{s&&s.dispose(),i&&i.dispose(),a&&a.dispose(),c&&c.geometry.dispose(),s=new l.WebGLRenderTarget(t.resolution,t.resolution),i=new l.WebGLRenderTarget(t.resolution,t.resolution),i.texture.generateMipmaps=s.texture.generateMipmaps=!1,r.value=new l.OrthographicCamera(-p.value/2,p.value/2,g.value/2,-g.value/2,0,t.far),a=new l.PlaneGeometry(p.value,g.value).rotateX(Math.PI/2),c=new l.Mesh(a),c.visible=!1}),u.watchEffect(()=>{t.color&&(h&&h.dispose(),h=new l.MeshDepthMaterial,h.depthTest=h.depthWrite=!1,h.onBeforeCompile=L=>{L.uniforms={...L.uniforms,ucolor:{value:t.color?new l.Color(t.color):new l.Color}},L.fragmentShader=L.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
             void main() {
            `),L.fragmentShader=L.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")})});const x=new l.ShaderMaterial(Ba),v=new l.ShaderMaterial(Fa);v.depthTest=x.depthTest=!1;function _(L){!f.value||!r.value||(c.visible=!0,c.material=x,x.uniforms.tDiffuse.value=s.texture,x.uniforms.h.value=L/256,f.value.setRenderTarget(i),f.value.render(c,r.value),c.material=v,v.uniforms.tDiffuse.value=i.texture,v.uniforms.v.value=L/256,f.value.setRenderTarget(s),f.value.render(c,r.value),c.visible=!1)}const{onLoop:m}=ie.useRenderLoop();let M=0,b,S;return m(()=>{!r.value||d.value===void 0||f.value===void 0||(t.frames===Number.POSITIVE_INFINITY||M<t.frames)&&(M++,b=d.value.background,S=d.value.overrideMaterial,n.value.visible=!1,d.value.background=null,d.value.overrideMaterial=h,f.value.setRenderTarget(s),f.value.render(d.value,r.value),_(t.blur),t.smooth&&_(t.blur*.4),f.value.setRenderTarget(null),n.value.visible=!0,d.value.background=b,d.value.overrideMaterial=S)}),(L,P)=>(u.openBlock(),u.createElementBlock("TresGroup",u.mergeProps({ref_key:"groupRef",ref:n},L.$attrs),[u.createElementVNode("TresMesh",{scale:[1,-1,1],geometry:u.unref(a)},[u.createElementVNode("TresMeshBasicMaterial",{map:u.unref(s).texture,opacity:L.opacity,"depth-write":L.depthWrite,transparent:!0},null,8,hf)],8,uf),u.createElementVNode("primitive",{object:u.unref(c)},null,8,ff),r.value&&L.helper?(u.openBlock(),u.createElementBlock("TresCameraHelper",{key:0,args:[r.value]},null,8,df)):u.createCommentVNode("",!0),u.createElementVNode("TresOrthographicCamera",{ref_key:"shadowCamera",ref:r,position:[0,0,0],rotation:[Math.PI/2,0,0],args:[-p.value/2,p.value/2,g.value/2,-g.value/2,0,L.far]},null,8,pf)],16))}}),gf=u.defineComponent({__name:"Fit",props:{into:{default:()=>new l.Box3(new l.Vector3(-.5,-.5,-.5),new l.Vector3(.5,.5,.5))},precise:{type:Boolean,default:!1}},setup(o,{expose:e}){const t=o,n=u.shallowRef(new l.Group),r=u.shallowRef(new l.Group);function s(c,h){if(n.value.position.set(0,0,0),n.value.updateMatrixWorld(),r.value.scale.set(1,1,1),r.value.updateMatrixWorld(),!r.value.children.length||c===null)return;const{box3:f,use:d}=i(c,h),p=new l.Box3;r.value.children.forEach(m=>p.expandByObject(m,h));const g=p.getSize(new l.Vector3),x=f.getSize(new l.Vector3),v=Math.min(x.x/g.x,x.y/g.y,x.z/g.z);r.value.scale.setScalar(v===Number.POSITIVE_INFINITY?1:v),r.value.updateMatrixWorld();const _=n.value.worldToLocal(p.getCenter(new l.Vector3));if(d.position){const m=n.value.worldToLocal(f.getCenter(new l.Vector3));n.value.position.copy(m.sub(_.multiplyScalar(v)))}else n.value.position.copy(_.sub(_.multiplyScalar(v)))}function i(c,h){return typeof c=="number"?c=new l.Vector3(c,c,c):Array.isArray(c)&&(c=new l.Vector3(...c)),c&&"isVector3"in c&&c.isVector3?{box3:new l.Box3(new l.Vector3(0,0,0),c),use:{position:!1}}:c&&"isBox3"in c&&c.isBox3?{box3:c,use:{position:!0}}:c&&"isObject3D"in c&&c.isObject3D?{box3:new l.Box3().setFromObject(c,h??!1),use:{position:!0}}:{box3:new l.Box3(new l.Vector3(-.5,-.5,-.5),new l.Vector3(.5,.5,.5)),use:{position:!0}}}u.watch(()=>[t.into,t.precise],()=>s(t.into,t.precise)),u.onMounted(()=>{s(t.into,t.precise),u.nextTick().then(()=>{s(t.into,t.precise)})});const a=u.shallowRef();return e({instance:a,fit:(c=new l.Box3(new l.Vector3(-.5,-.5,-.5),new l.Vector3(.5,.5,.5)),h=!1)=>{s(c,h)},update:()=>s(t.into,t.precise)}),(c,h)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"outer",ref:a},[u.createElementVNode("TresGroup",{ref_key:"middle",ref:n},[u.createElementVNode("TresGroup",{ref_key:"inner",ref:r},[u.renderSlot(c.$slots,"default")],512)],512)],512))}}),yf=["size","color","alpha-map","map","opacity","alpha-test","depth-write","transparent","size-attenuation"],vf=["position","velocity"],_f=u.defineComponent({__name:"Precipitation",props:{size:{default:.1},area:{default:()=>[10,10,20]},color:{default:16777215},map:{},alphaMap:{},alphaTest:{default:.01},opacity:{default:.8},count:{default:5e3},speed:{default:.1},randomness:{default:.5},depthWrite:{type:Boolean,default:!1},transparent:{type:Boolean,default:!0},sizeAttenuation:{type:Boolean,default:!0}},setup(o){const e=o,{size:t,area:n,color:r,alphaMap:s,map:i,opacity:a,alphaTest:c,depthWrite:h,transparent:f,sizeAttenuation:d,count:p,speed:g,randomness:x}=u.toRefs(e),v=u.shallowRef();let _=[],m=[];const M=()=>{_=new Float32Array(p.value*3);for(let L=0;L<p.value;L++){const P=L*3;_[P]=(Math.random()-.5)*n.value[0],_[P+1]=(Math.random()-.5)*n.value[1],_[P+2]=(Math.random()-.5)*n.value[2]}},b=()=>{m=new Float32Array(p.value*2);for(let L=0;L<p.value*2;L+=2)m[L]=(Math.random()-.5)/5*g.value*x.value,m[L+1]=Math.random()/5*g.value+.01};b(),M(),u.watchEffect(()=>{b(),M()});const{onLoop:S}=ie.useRenderLoop();return S(()=>{var L,P;if((L=v.value)!=null&&L.attributes.position.array&&((P=v.value)!=null&&P.attributes.position.count)){const T=v.value.attributes.position.array;for(let y=0;y<v.value.attributes.position.count;y++){const A=m[y*2],w=m[y*2+1];T[y*3]+=A,T[y*3+1]-=w,(T[y*3]<=-n.value[0]/2||T[y*3]>=n.value[0]/2)&&(T[y*3]=T[y*3]*-1),(T[y*3+1]<=-n.value[1]/2||T[y*3+1]>=n.value[1]/2)&&(T[y*3+1]=T[y*3+1]*-1)}v.value.attributes.position.needsUpdate=!0}}),(L,P)=>(u.openBlock(),u.createElementBlock("TresPoints",null,[u.createElementVNode("TresPointsMaterial",{size:u.unref(t),color:u.unref(r),"alpha-map":u.unref(s),map:u.unref(i),opacity:u.unref(a),"alpha-test":u.unref(c),"depth-write":u.unref(h),transparent:u.unref(f),"size-attenuation":u.unref(d)},null,8,yf),u.createElementVNode("TresBufferGeometry",{ref_key:"geometryRef",ref:v,position:[u.unref(_),3],velocity:[u.unref(m)]},null,8,vf)]))}});class Gn extends l.Mesh{constructor(){const e=Gn.SkyShader,t=new l.ShaderMaterial({name:e.name,uniforms:l.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:l.BackSide,depthWrite:!1});super(new l.BoxGeometry(1,1,1),t),this.isSky=!0}}Gn.SkyShader={name:"SkyShader",uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new l.Vector3},up:{value:new l.Vector3(0,1,0)}},vertexShader:`
		uniform vec3 sunPosition;
		uniform float rayleigh;
		uniform float turbidity;
		uniform float mieCoefficient;
		uniform vec3 up;

		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		// constants for atmospheric scattering
		const float e = 2.71828182845904523536028747135266249775724709369995957;
		const float pi = 3.141592653589793238462643383279502884197169;

		// wavelength of used primaries, according to preetham
		const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
		// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
		// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
		const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

		// mie stuff
		// K coefficient for the primaries
		const float v = 4.0;
		const vec3 K = vec3( 0.686, 0.678, 0.666 );
		// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
		const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

		// earth shadow hack
		// cutoffAngle = pi / 1.95;
		const float cutoffAngle = 1.6110731556870734;
		const float steepness = 1.5;
		const float EE = 1000.0;

		float sunIntensity( float zenithAngleCos ) {
			zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
			return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
		}

		vec3 totalMie( float T ) {
			float c = ( 0.2 * T ) * 10E-18;
			return 0.434 * c * MieConst;
		}

		void main() {

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vWorldPosition = worldPosition.xyz;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			gl_Position.z = gl_Position.w; // set z to camera.far

			vSunDirection = normalize( sunPosition );

			vSunE = sunIntensity( dot( vSunDirection, up ) );

			vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

			float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

			// extinction (absorbtion + out scattering)
			// rayleigh coefficients
			vBetaR = totalRayleigh * rayleighCoefficient;

			// mie coefficients
			vBetaM = totalMie( turbidity ) * mieCoefficient;

		}`,fragmentShader:`
		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		uniform float mieDirectionalG;
		uniform vec3 up;

		// constants for atmospheric scattering
		const float pi = 3.141592653589793238462643383279502884197169;

		const float n = 1.0003; // refractive index of air
		const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

		// optical length at zenith for molecules
		const float rayleighZenithLength = 8.4E3;
		const float mieZenithLength = 1.25E3;
		// 66 arc seconds -> degrees, and the cosine of that
		const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

		// 3.0 / ( 16.0 * pi )
		const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
		// 1.0 / ( 4.0 * pi )
		const float ONE_OVER_FOURPI = 0.07957747154594767;

		float rayleighPhase( float cosTheta ) {
			return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
		}

		float hgPhase( float cosTheta, float g ) {
			float g2 = pow( g, 2.0 );
			float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
			return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
		}

		void main() {

			vec3 direction = normalize( vWorldPosition - cameraPosition );

			// optical length
			// cutoff angle at 90 to avoid singularity in next formula.
			float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
			float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
			float sR = rayleighZenithLength * inverse;
			float sM = mieZenithLength * inverse;

			// combined extinction factor
			vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

			// in scattering
			float cosTheta = dot( direction, vSunDirection );

			float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
			vec3 betaRTheta = vBetaR * rPhase;

			float mPhase = hgPhase( cosTheta, mieDirectionalG );
			vec3 betaMTheta = vBetaM * mPhase;

			vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
			Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

			// nightsky
			float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
			float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
			vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
			vec3 L0 = vec3( 0.1 ) * Fex;

			// composition + solar disc
			float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
			L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

			vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

			vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

			gl_FragColor = vec4( retColor, 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};const xf=["object","material-uniforms-turbidity-value","material-uniforms-rayleigh-value","material-uniforms-mie-coefficient-value","material-uniforms-mie-directional-g-value","material-uniforms-sun-position-value","scale"],wf=u.defineComponent({__name:"Sky",props:{turbidity:{default:3.4},rayleigh:{default:3},mieCoefficient:{default:.005},mieDirectionalG:{default:.7},elevation:{default:.6},azimuth:{default:180},distance:{default:45e4}},setup(o,{expose:e}){const t=o,n=u.shallowRef(),r=new Gn,s=u.computed(()=>i(t.azimuth,t.elevation));function i(a,c){const h=l.MathUtils.degToRad(90-c),f=l.MathUtils.degToRad(a);return new l.Vector3().setFromSphericalCoords(1,h,f)}return e({root:n,sunPosition:s.value}),(a,c)=>(u.openBlock(),u.createElementBlock("primitive",{ref_key:"skyRef",ref:n,object:u.unref(r),"material-uniforms-turbidity-value":t.turbidity,"material-uniforms-rayleigh-value":t.rayleigh,"material-uniforms-mie-coefficient-value":t.mieCoefficient,"material-uniforms-mie-directional-g-value":t.mieDirectionalG,"material-uniforms-sun-position-value":s.value,scale:t.distance},null,8,xf))}}),bf=["position"],Mf=["position"],Sf=["scale"],Af=["map","depth-test","color-space","color","opacity"],Cf=u.defineComponent({__name:"Smoke",props:{color:{default:"#ffffff"},opacity:{default:.5},speed:{default:.4},width:{default:10},depth:{default:1.5},segments:{default:20},texture:{default:"https://raw.githubusercontent.com/Tresjs/assets/main/textures/clouds/defaultCloud.png"},depthTest:{type:Boolean,default:!0}},async setup(o,{expose:e}){let t,n;const r=o,{width:s,depth:i,segments:a,texture:c,color:h,depthTest:f,opacity:d,speed:p}=u.toRefs(r),g=u.shallowRef(),x=u.shallowRef();e({value:g});const v=[a].map((P,T)=>({x:s.value/2-Math.random()*s.value,y:s.value/2-Math.random()*s.value,scale:.4+Math.sin((T+1)/a.value*Math.PI)*((.2+Math.random())*10),density:Math.max(.2,Math.random()),rotation:Math.max(.002,.005*Math.random())*p.value})),_=(P,T)=>P/6*T*d.value,{map:m}=([t,n]=u.withAsyncContext(()=>ie.useTexture({map:c.value})),t=await t,n(),t),{renderer:M,camera:b}=ie.useTresContext(),S=u.computed(()=>{var P;return(P=M.value)==null?void 0:P.outputColorSpace}),{onLoop:L}=ie.useRenderLoop();return L(()=>{var P,T;g.value&&b.value&&x.value&&((P=x.value)==null||P.children.forEach((y,A)=>{y.rotation.z+=v[A].rotation}),g.value.lookAt((T=b.value)==null?void 0:T.position))}),(P,T)=>(u.openBlock(),u.createElementBlock("TresGroup",u.mergeProps({ref_key:"smokeRef",ref:g},P.$attrs),[u.createElementVNode("TresGroup",{ref_key:"groupRef",ref:x,position:[0,0,u.unref(a)/2*u.unref(i)]},[(u.openBlock(!0),u.createElementBlock(u.Fragment,null,u.renderList(u.unref(v),({scale:y,x:A,y:w,density:D},k)=>(u.openBlock(),u.createElementBlock("TresMesh",{key:`${k}`,position:[A,w,-k*u.unref(i)]},[u.createElementVNode("TresPlaneGeometry",{scale:[y,y,y],rotation:[0,0,0]},null,8,Sf),u.createElementVNode("TresMeshStandardMaterial",{map:u.unref(m),"depth-test":u.unref(f),"color-space":S.value,color:u.unref(h),"depth-write":!1,transparent:"",opacity:_(y,D)},null,8,Af)],8,Mf))),128))],8,bf)],16))}});function Pf(o){return Rr(o,{normalizeValue:e=>ie.normalizeColor(e),getDefaultValue:()=>new l.Color(0,0,0),isSingleValue:e=>!Array.isArray(e),isMultipleValues:e=>Array.isArray(e)&&(e.length===0||!Array.isArray(e[0])),isMultipleValuesWithStops:e=>Array.isArray(e)&&e.length>0&&Array.isArray(e[0]),isEmpty:e=>Array.isArray(e)&&e.length===0})}function jr(o){return"isVector3"in o||Array.isArray(o)&&o.length>0&&o.every(e=>typeof e=="number")}function Tf(o){return Rr(o,{normalizeValue:e=>ie.normalizeVectorFlexibleParam(e),getDefaultValue:()=>[0,0,0],isSingleValue:e=>jr(e),isMultipleValues:e=>Array.isArray(e)&&e.length>0&&jr(e[0]),isMultipleValuesWithStops:e=>Array.isArray(e)&&e.length>0&&Array.isArray(e[0])&&e[0].length===2&&jr(e[0][1]),isEmpty:e=>Array.isArray(e)&&e.length===0})}function If(o){return Rr(o,{normalizeValue:e=>e,getDefaultValue:()=>1,isSingleValue:e=>!Array.isArray(e)&&typeof e<"u",isMultipleValues:e=>Array.isArray(e)&&(e.length===0||!Array.isArray(e[0])),isMultipleValuesWithStops:e=>Array.isArray(e)&&e.length>0&&Array.isArray(e[0]),isEmpty:e=>Array.isArray(e)&&e.length===0})}function Rr(o,e){const{normalizeValue:t,getDefaultValue:n,isEmpty:r}=e,s=c=>e.isSingleValue(c),i=c=>e.isMultipleValues(c),a=c=>e.isMultipleValuesWithStops(c);if(r(o))return[[0,n()]];if(s(o))return[[0,t(o)]];if(i(o)){const c=o.length>1?1/(o.length-1):1;return o.map((h,f)=>[c*f,t(h)])}else if(a(o))return o.map(([c,h],f)=>[c,t(h)]);return[[0,n()]]}class Lf{constructor(e,t){ce(this,"entries");ce(this,"resolution");this.entries=e,this.resolution=t}useTexture(){return new kf(this.entries,this.resolution).use()}}class Wr{constructor(e,t,n,r,s,i){ce(this,"data");ce(this,"ref");ce(this,"name");ce(this,"valueMin");ce(this,"valueMax");ce(this,"suffix");ce(this,"renderToCanvasGradient");this.data=u.isRef(e)?e.value:e,this.ref=u.isRef(e)?e:null,this.name=t,this.valueMin=n,this.valueMax=r,this.suffix=s,this.renderToCanvasGradient=i}}class Of extends Wr{constructor(e,t="color",n=0,r=1,s="rgba",i=Bf){super(e,t,n,r,s,i)}}class Yi extends Wr{constructor(e,t="scalar",n=0,r=1,s="x",i=Ff){super(e,t,n,r,s,i)}}class Df extends Wr{constructor(e,t="scalar3",n=0,r=1,s="xyz",i=Uf){super(e,t,n,r,s,i)}}class kf{constructor(e,t){ce(this,"entries");ce(this,"size");ce(this,"dirty",u.shallowRef(0));ce(this,"context");this.entries=e,this.size=Math.max(t,e.length);const n=document.createElement("canvas");n.height=this.size,n.width=this.size,this.context=n.getContext("2d")}use(){const e=this.build(),t=u.shallowRef(e);for(const n of this.entries)n.ref&&u.watch(n.ref,()=>{var r;n.data=(r=n.ref)==null?void 0:r.value,u.triggerRef(this.dirty)});return Al(this.dirty,()=>{this.build(e),t.value=e},{throttle:1e3/60}),{texture:t,dispose:()=>e.dispose(),yFor:this.entries.reduce((n,r,s)=>(n[r.name]=(s+.5)/this.size,n),{})}}build(e){this.entries.forEach((n,r)=>{const s=this.context.createLinearGradient(0,r,this.size,r);n.renderToCanvasGradient(s,n),this.context.fillStyle=s,this.context.fillRect(0,r,this.size,1)}),e&&(e.source.data=this.context.getImageData(0,0,this.size,this.size));const t=e??new l.DataTexture(this.context.getImageData(0,0,this.size,this.size).data,this.size,this.size,l.RGBAFormat,l.UnsignedByteType,l.UVMapping,l.ClampToEdgeWrapping,l.ClampToEdgeWrapping);return t.needsUpdate=!0,t}}function Ei(o,e,t,n,r){return Nc(bt(o,e,t),e,t,n,r)}function Bf(o,e){return Pf(e.data).forEach(([t,n])=>o.addColorStop(t,`rgb(${n.r*255}, ${n.g*255}, ${n.b*255})`))}function Ff(o,e){return If(e.data).forEach(([t,n])=>{o.addColorStop(t,`rgb(${Ei(n,e.valueMin,e.valueMax,0,255)}, 0, 0)`)})}function Uf(o,e){return Tf(e.data).forEach(([t,n])=>o.addColorStop(t,`rgb(${n.map(r=>Ei(r,e.valueMin,e.valueMax,0,255))})`))}class Nf{constructor(e=256){ce(this,"entries");ce(this,"resolution");this.resolution=e,this.entries=[]}withResolution(e){return this.resolution=e,this}get add(){return new zf(e=>this.onAdd(e))}build(){return new Lf(this.entries,this.resolution)}onAdd(e){return this.entries.push(e),new Vf(e,this)}}class Vf{constructor(e,t){ce(this,"entry");ce(this,"parent");this.entry=e,this.parent=t}id(e){return this.entry.name=e,this}range(e,t){return this.entry.valueMin=e,this.entry.valueMax=t,this}suffix(e){return this.entry.suffix=e,this}canvasGradientRenderer(e){return this.entry.renderToCanvasGradient=e,this}get add(){return this.parent.add}build(){return this.parent.build()}}class zf{constructor(e){ce(this,"onAdd");this.onAdd=e}GradientTresColor(e){return this.onAdd(new Of(e))}Gradient01(e){return this.onAdd(new Yi(e,"zeroOne",0,1))}GradientScalar(e,t,n){return this.onAdd(new Yi(e,"scalar",t,n))}GradientXyz(e,t,n){return this.onAdd(new Df(e,"position",t,n))}}let Yr=null;function Gf(){return Yr===null&&(Yr=new l.DataTexture(new Uint8Array([0,0,0,0]),1,1)),Yr}const jf=["object"],Rf=u.defineComponent({__name:"component",props:{map:{default:"https://raw.githubusercontent.com/Tresjs/assets/e41a93c56ec7cb5ac2d241f309e23582a5fe1fc6/textures/sparkles/particle.png"},geometry:{default:void 0},directionalLight:{default:void 0},lifetimeSec:{default:.4},cooldownSec:{default:2},normalThreshold:{default:.7},noiseScale:{default:3},scaleNoise:{default:1},offsetNoise:{default:.1},lifetimeNoise:{default:0},size:{default:1},alpha:{default:1},offset:{default:1},surfaceDistance:{default:1},sequenceColor:{default:()=>[[.7,"#82dbc5"],[.8,"#fbb03b"]]},sequenceAlpha:{default:()=>[[0,0],[.1,1],[.5,1],[.9,0]]},sequenceOffset:{default:()=>[0,0,0]},sequenceNoise:{default:()=>[.1,.1,.1]},sequenceSize:{default:()=>[0,1]},sequenceSurfaceDistance:{default:()=>[.05,.08,.1]},mixColor:{default:.5},mixAlpha:{default:1},mixOffset:{default:1},mixSize:{default:0},mixSurfaceDistance:{default:1},mixNoise:{default:1},blending:{default:l.AdditiveBlending},transparent:{type:Boolean,default:!0},depthWrite:{type:Boolean,default:!1}},setup(o){const e=o,t=Number.parseInt(l.REVISION.replace(/\D+/g,"")),n=u.toRefs(e),r=typeof e.map=="string"?Gf():e.map,{texture:s,yFor:i}=new Nf(256).add.GradientTresColor(n.sequenceColor).id("sequenceColor").add.Gradient01(n.sequenceAlpha).id("sequenceAlpha").add.Gradient01(n.sequenceSurfaceDistance).id("sequenceSurfaceDistance").add.Gradient01(n.sequenceSize).id("sequenceSize").add.GradientXyz(n.sequenceOffset,-1,1).id("sequenceOffset").add.GradientXyz(n.sequenceNoise,0,1).id("sequenceNoise").build().useTexture(),a={blending:e.blending,transparent:e.transparent,depthWrite:e.depthWrite,uniforms:{uMap:new l.Uniform(r),uPixelRatio:new l.Uniform(1),uNormal:new l.Uniform(l.Object3D.DEFAULT_UP),uNormalThreshold:new l.Uniform(e.normalThreshold),uTime:new l.Uniform(0),uCooldownRatio:new l.Uniform(1),uSize:new l.Uniform(e.size),uAlpha:new l.Uniform(e.alpha),uOffset:new l.Uniform(e.offset),uSurfaceDistance:new l.Uniform(e.surfaceDistance),uNoiseScale:new l.Uniform(e.noiseScale),uScaleNoise:new l.Uniform(e.scaleNoise),uOffsetNoise:new l.Uniform(e.offsetNoise),uLifetimeNoise:new l.Uniform(e.lifetimeNoise),uMixColor:new l.Uniform(e.mixColor),uMixAlpha:new l.Uniform(e.mixAlpha),uMixOffset:new l.Uniform(e.mixOffset),uMixSize:new l.Uniform(e.mixSize),uMixSurfaceDistance:new l.Uniform(e.mixSurfaceDistance),uMixNoise:new l.Uniform(e.mixNoise),uInfoTexture:new l.Uniform(s.value)},vertexShader:`
    uniform float uPixelRatio;
    uniform vec3 uNormal;
    uniform float uNormalThreshold;
    uniform float uTime;
    uniform float uCooldownRatio;
    uniform float uSize;
    uniform float uAlpha;
    uniform float uOffset;
    uniform float uSurfaceDistance;
    uniform float uNoiseScale;
    uniform float uScaleNoise;
    uniform float uOffsetNoise;
    uniform float uLifetimeNoise;
    uniform float uMixColor;
    uniform float uMixAlpha;
    uniform float uMixOffset;
    uniform float uMixSize;
    uniform float uMixSurfaceDistance;
    uniform float uMixNoise;
    uniform sampler2D uInfoTexture;

    varying vec4 vColor;

    void main() {
      float dotNormal = dot(normal, uNormal) * 0.5 + 0.5;
      float normalP = smoothstep(uNormalThreshold, 1., dotNormal);
      float lifetimeNoise = uLifetimeNoise * mix(normalP, 1.0, uMixNoise);

      float t = uTime + position.x * 1. * uNoiseScale + position.y * 10. * uNoiseScale + 
      position.z * 7.3 * uNoiseScale + sin(lifetimeNoise * (position.x + 13. * position.y)) * lifetimeNoise;

      float lifetimeP = max(-0.0001, mix(-uCooldownRatio, 1. + cos(t) * lifetimeNoise, fract(t)));
      float surfaceDistance = texture2D(uInfoTexture, vec2(
        mix(normalP, lifetimeP, uMixSurfaceDistance),
        ${i.sequenceSurfaceDistance})).x * uSurfaceDistance;

      vec4 modelPosition = modelMatrix * (vec4(position, 1.0) + vec4(normal * surfaceDistance, 0.0));
      vec3 noise = texture2D(uInfoTexture, vec2(
        mix(normalP, lifetimeP, uMixNoise),
        ${i.sequenceNoise})).xyz;
      vec3 offset = uOffset * (texture2D(uInfoTexture, vec2(
        mix(normalP, lifetimeP, uMixOffset),
        ${i.sequenceOffset})).xyz * 2.0 - vec3(1.0, 1.0, 1.0));
      modelPosition.x += cos(t * uNoiseScale * 10.0) * 0.2 * uOffsetNoise * noise.x + offset.x;
      modelPosition.y += sin(t * uNoiseScale * 10.0) * 0.2 * uOffsetNoise * noise.y + offset.y;
      modelPosition.z += cos(t * uNoiseScale * 10.0) * 0.2 * uOffsetNoise * noise.z + offset.z;

      vec4 viewPosition = viewMatrix * modelPosition;
      vec4 projectionPostion = projectionMatrix * viewPosition;
      gl_Position = projectionPostion;

      gl_PointSize = 2.
      * texture2D(uInfoTexture, vec2(mix(normalP, lifetimeP, uMixSize), ${i.sequenceSize})).x
      * mix(1., abs(sin(t * uNoiseScale + position.x * 13.9 + position.y * 73.1)), uScaleNoise)
      * uSize * (100.0 / -viewPosition.z) * uPixelRatio;

      if (gl_PointSize < 0.6 || lifetimeP < 0.0) { gl_Position = vec4(2, 2, 2, 1); }

      vColor = texture2D(uInfoTexture, vec2(mix(normalP, lifetimeP, uMixColor), ${i.sequenceColor}))
      * texture2D(uInfoTexture, vec2(mix(normalP, lifetimeP, uMixAlpha), ${i.sequenceAlpha})).x * uAlpha;
    }`,fragmentShader:`
    varying vec4 vColor;

    uniform sampler2D uMap;
    uniform sampler2D uInfoTexture;

    void main() {
      gl_FragColor = vColor * texture2D(uMap, gl_PointCoord);
      #include <tonemapping_fragment>
      #include <${t>=154?"colorspace_fragment":"encodings_fragment"}>
    }`},c=new l.ShaderMaterial(a),h=new l.Points(void 0,c),f=c.uniforms,d={immediate:!0};[[f.uPixelRatio,ie.useTresContext().sizes.aspectRatio],[f.uSize,n.size],[f.uNormalThreshold,n.normalThreshold],[f.uAlpha,n.alpha],[f.uOffset,n.offset],[f.uOffsetNoise,n.offsetNoise],[f.uMixColor,n.mixColor],[f.uMixAlpha,n.mixAlpha],[f.uMixOffset,n.mixOffset],[f.uMixSize,n.mixSize],[f.uMixSurfaceDistance,n.mixSurfaceDistance],[f.uMixNoise,n.mixNoise],[f.uInfoTexture,s]].forEach(([M,b])=>u.watch(b,()=>{M.value=b.value},d)),u.watch([n.noiseScale,n.lifetimeSec],()=>{f.uNoiseScale.value=n.noiseScale.value*n.lifetimeSec.value},d),u.watch([n.lifetimeSec,n.cooldownSec],()=>{f.uCooldownRatio.value=n.cooldownSec.value/n.lifetimeSec.value},d),u.watch(n.map,()=>{typeof n.map.value=="string"?ie.useTexture([n.map.value]).then(M=>c.uniforms.uMap.value=M):c.uniforms.uMap.value=n.map.value});const g=new l.Quaternion,x=new l.Vector3;ie.useRenderLoop().onLoop(({elapsed:M})=>{h.getWorldQuaternion(g),x.copy(e.directionalLight?e.directionalLight.position:l.Object3D.DEFAULT_UP).normalize(),x.applyQuaternion(g.invert()),c.uniforms.uNormal.value=x,c.uniforms.uTime.value=M/(e.cooldownSec+e.lifetimeSec)});function v(M){return M&&"isObject3D"in M}function _(M){return M&&"isBufferGeometry"in M}u.onMounted(()=>{e.geometry?_(e.geometry)?h.geometry.copy(e.geometry):v(e.geometry)&&"geometry"in e.geometry&&_(e.geometry.geometry)&&h.geometry.copy(e.geometry.geometry):v(h.parent)&&"geometry"in h.parent&&_(h.parent.geometry)?h.geometry.copy(h.parent.geometry):h.geometry=new l.IcosahedronGeometry(1,16),typeof e.map=="string"&&ie.useTexture([e.map]).then(M=>c.uniforms.uMap.value=M)}),u.onUnmounted(()=>{var M;(M=c.uniforms.uMap.value)==null||M.dispose(),s.value.dispose(),c.dispose()});const m=u.shallowRef();return(M,b)=>(u.openBlock(),u.createElementBlock("primitive",{ref_key:"sparkleRef",ref:m,object:u.unref(h)},null,8,jf))}}),Wf=["position","a-scale"],Yf=["size","size-attenuation","transparent","alpha-test","alpha-map"],Ef=u.defineComponent({__name:"Stars",props:{size:{default:.1},sizeAttenuation:{type:Boolean,default:!0},transparent:{type:Boolean,default:!0},alphaTest:{default:.01},count:{default:5e3},depth:{default:50},radius:{default:100},alphaMap:{default:null}},setup(o,{expose:e}){const t=o,n=u.ref(),r=u.ref(),{radius:s,depth:i,count:a,size:c,sizeAttenuation:h,transparent:f,alphaMap:d,alphaTest:p}=u.toRefs(t),g=()=>{let v=s.value+i.value;const _=u.computed(()=>i.value/a.value),m=[],M=Array.from({length:a.value},()=>(.5+.5*Math.random())*4),b=S=>new l.Vector3().setFromSpherical(new l.Spherical(S,Math.acos(1-Math.random()*2),Math.random()*2*Math.PI)).toArray();for(let S=0;S<a.value;S++)v-=_.value*Math.random(),m.push(...b(v));n.value=new Float32Array(m),r.value=new Float32Array(M)};u.watchEffect(()=>{g()});const x=u.shallowRef();return e({value:x}),(v,_)=>(u.openBlock(),u.createElementBlock("TresPoints",{ref_key:"starsRef",ref:x},[u.createElementVNode("TresBufferGeometry",{position:[n.value,3],"a-scale":[r.value,1]},null,8,Wf),u.createElementVNode("TresPointsMaterial",{size:u.unref(c),"size-attenuation":u.unref(h),transparent:u.unref(f),"alpha-test":u.unref(p),"alpha-map":u.unref(d)},null,8,Yf)],512))}});class Xf extends l.Mesh{constructor(e,t={}){super(e),this.isWater=!0;const n=this,r=t.textureWidth!==void 0?t.textureWidth:512,s=t.textureHeight!==void 0?t.textureHeight:512,i=t.clipBias!==void 0?t.clipBias:0,a=t.alpha!==void 0?t.alpha:1,c=t.time!==void 0?t.time:0,h=t.waterNormals!==void 0?t.waterNormals:null,f=t.sunDirection!==void 0?t.sunDirection:new l.Vector3(.70707,.70707,0),d=new l.Color(t.sunColor!==void 0?t.sunColor:16777215),p=new l.Color(t.waterColor!==void 0?t.waterColor:8355711),g=t.eye!==void 0?t.eye:new l.Vector3(0,0,0),x=t.distortionScale!==void 0?t.distortionScale:20,v=t.side!==void 0?t.side:l.FrontSide,_=t.fog!==void 0?t.fog:!1,m=new l.Plane,M=new l.Vector3,b=new l.Vector3,S=new l.Vector3,L=new l.Matrix4,P=new l.Vector3(0,0,-1),T=new l.Vector4,y=new l.Vector3,A=new l.Vector3,w=new l.Vector4,D=new l.Matrix4,k=new l.PerspectiveCamera,R=new l.WebGLRenderTarget(r,s),V={name:"MirrorShader",uniforms:l.UniformsUtils.merge([l.UniformsLib.fog,l.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new l.Matrix4},sunColor:{value:new l.Color(8355711)},sunDirection:{value:new l.Vector3(.70707,.70707,0)},eye:{value:new l.Vector3},waterColor:{value:new l.Color(5592405)}}]),vertexShader:`
				uniform mat4 textureMatrix;
				uniform float time;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				#include <common>
				#include <fog_pars_vertex>
				#include <shadowmap_pars_vertex>
				#include <logdepthbuf_pars_vertex>

				void main() {
					mirrorCoord = modelMatrix * vec4( position, 1.0 );
					worldPosition = mirrorCoord.xyzw;
					mirrorCoord = textureMatrix * mirrorCoord;
					vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

				#include <beginnormal_vertex>
				#include <defaultnormal_vertex>
				#include <logdepthbuf_vertex>
				#include <fog_vertex>
				#include <shadowmap_vertex>
			}`,fragmentShader:`
				uniform sampler2D mirrorSampler;
				uniform float alpha;
				uniform float time;
				uniform float size;
				uniform float distortionScale;
				uniform sampler2D normalSampler;
				uniform vec3 sunColor;
				uniform vec3 sunDirection;
				uniform vec3 eye;
				uniform vec3 waterColor;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				vec4 getNoise( vec2 uv ) {
					vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);
					vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );
					vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );
					vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );
					vec4 noise = texture2D( normalSampler, uv0 ) +
						texture2D( normalSampler, uv1 ) +
						texture2D( normalSampler, uv2 ) +
						texture2D( normalSampler, uv3 );
					return noise * 0.5 - 1.0;
				}

				void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
					vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );
					float direction = max( 0.0, dot( eyeDirection, reflection ) );
					specularColor += pow( direction, shiny ) * sunColor * spec;
					diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;
				}

				#include <common>
				#include <packing>
				#include <bsdfs>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <lights_pars_begin>
				#include <shadowmap_pars_fragment>
				#include <shadowmask_pars_fragment>

				void main() {

					#include <logdepthbuf_fragment>
					vec4 noise = getNoise( worldPosition.xz * size );
					vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );

					vec3 diffuseLight = vec3(0.0);
					vec3 specularLight = vec3(0.0);

					vec3 worldToEye = eye-worldPosition.xyz;
					vec3 eyeDirection = normalize( worldToEye );
					sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );

					float distance = length(worldToEye);

					vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;
					vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );

					float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					float rf0 = 0.3;
					float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );
					vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;
					vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);
					vec3 outgoingLight = albedo;
					gl_FragColor = vec4( outgoingLight, alpha );

					#include <tonemapping_fragment>
					#include <colorspace_fragment>
					#include <fog_fragment>	
				}`},Y=new l.ShaderMaterial({name:V.name,uniforms:l.UniformsUtils.clone(V.uniforms),vertexShader:V.vertexShader,fragmentShader:V.fragmentShader,lights:!0,side:v,fog:_});Y.uniforms.mirrorSampler.value=R.texture,Y.uniforms.textureMatrix.value=D,Y.uniforms.alpha.value=a,Y.uniforms.time.value=c,Y.uniforms.normalSampler.value=h,Y.uniforms.sunColor.value=d,Y.uniforms.waterColor.value=p,Y.uniforms.sunDirection.value=f,Y.uniforms.distortionScale.value=x,Y.uniforms.eye.value=g,n.material=Y,n.onBeforeRender=function(G,Q,K){if(b.setFromMatrixPosition(n.matrixWorld),S.setFromMatrixPosition(K.matrixWorld),L.extractRotation(n.matrixWorld),M.set(0,0,1),M.applyMatrix4(L),y.subVectors(b,S),y.dot(M)>0)return;y.reflect(M).negate(),y.add(b),L.extractRotation(K.matrixWorld),P.set(0,0,-1),P.applyMatrix4(L),P.add(S),A.subVectors(b,P),A.reflect(M).negate(),A.add(b),k.position.copy(y),k.up.set(0,1,0),k.up.applyMatrix4(L),k.up.reflect(M),k.lookAt(A),k.far=K.far,k.updateMatrixWorld(),k.projectionMatrix.copy(K.projectionMatrix),D.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),D.multiply(k.projectionMatrix),D.multiply(k.matrixWorldInverse),m.setFromNormalAndCoplanarPoint(M,b),m.applyMatrix4(k.matrixWorldInverse),T.set(m.normal.x,m.normal.y,m.normal.z,m.constant);const ne=k.projectionMatrix;w.x=(Math.sign(T.x)+ne.elements[8])/ne.elements[0],w.y=(Math.sign(T.y)+ne.elements[9])/ne.elements[5],w.z=-1,w.w=(1+ne.elements[10])/ne.elements[14],T.multiplyScalar(2/T.dot(w)),ne.elements[2]=T.x,ne.elements[6]=T.y,ne.elements[10]=T.z+1-i,ne.elements[14]=T.w,g.setFromMatrixPosition(K.matrixWorld);const ee=G.getRenderTarget(),le=G.xr.enabled,he=G.shadowMap.autoUpdate;n.visible=!1,G.xr.enabled=!1,G.shadowMap.autoUpdate=!1,G.setRenderTarget(R),G.state.buffers.depth.setMask(!0),G.autoClear===!1&&G.clear(),G.render(Q,k),n.visible=!0,G.xr.enabled=le,G.shadowMap.autoUpdate=he,G.setRenderTarget(ee);const de=K.viewport;de!==void 0&&G.state.viewport(de)}}}const Zf=["rotation-x","args"],qf=u.createElementVNode("TresPlaneGeometry",{args:[1e4,1e4]},null,-1),Kf=u.defineComponent({__name:"Ocean",props:{textureWidth:{default:512},textureHeight:{default:512},waterNormals:{default:"https://raw.githubusercontent.com/Tresjs/assets/main/textures/water-normals/Water_1_M_Normal.jpg"},sunDirection:{default:()=>new l.Vector3},sunColor:{default:16777215},waterColor:{default:7695},distortionScale:{default:3.7},size:{default:1},clipBias:{default:0},alpha:{default:1},side:{default:l.FrontSide}},async setup(o,{expose:e}){let t,n;const r=o,{textureWidth:s,textureHeight:i,waterNormals:a,sunDirection:c,sunColor:h,waterColor:f,distortionScale:d,size:p,clipBias:g,alpha:x,side:v}=u.toRefs(r),{extend:_,scene:m}=ie.useTresContext();_({Water:Xf});const M=u.shallowRef(),b=u.shallowRef(),S=m.value.fog!==void 0;e({root:M}),m.value.traverse(T=>{Object.prototype.hasOwnProperty.call(T,"isSky")&&(b.value=T)}),u.onMounted(async()=>{if(await u.nextTick(),b.value){const T=b.value.material.uniforms.sunPosition.value;M.value.material.uniforms.sunDirection.value.copy(T)}});const{normalMap:L}=([t,n]=u.withAsyncContext(()=>ie.useTexture({normalMap:a.value})),t=await t,n(),t);L.wrapS=L.wrapT=l.RepeatWrapping;const{onLoop:P}=ie.useRenderLoop();return P(({delta:T})=>{M.value.material.uniforms.time.value+=T}),(T,y)=>(u.openBlock(),u.createElementBlock("TresWater",{ref_key:"waterRef",ref:M,"rotation-x":-Math.PI/2,args:[void 0,{textureWidth:u.unref(s),textureHeight:u.unref(i),waterNormals:u.unref(L),sunDirection:u.unref(c),sunColor:u.unref(h),waterColor:u.unref(f),distortionScale:u.unref(d),fog:S,size:u.unref(p),clipBias:u.unref(g),alpha:u.unref(x),side:u.unref(v)}]},[u.renderSlot(T.$slots,"default",{},()=>[qf])],8,Zf))}});let ut;const Qf=(o="body")=>{ut||(ut=new $i.Pane({container:document.querySelector(o)}),ut.element.style.position="absolute",ut.element.style.top="1rem",ut.element.style.right="1rem",ut.element.style.zIndex="9999");const{logWarning:e}=yr();e("useTweakPane is deprecated as of Cientos v3.7.0 and will no longer be part of this package. Please migrate to @tresjs/leches package https://github.com/Tresjs/leches or v-tweakpane https://github.com/vinayakkulkarni/v-tweakpane instead.");function t(){ut&&ut.dispose()}return u.onMounted(()=>{const{resume:n}=ie.useRenderLoop();n()}),u.onUnmounted(()=>{t()}),{pane:ut,disposeTweakPane:t}};var Xi={exports:{}};(function(o,e){(function(t,n){o.exports=n()})(Wc,function(){var t=function(){function n(g){return i.appendChild(g.dom),g}function r(g){for(var x=0;x<i.children.length;x++)i.children[x].style.display=x===g?"block":"none";s=g}var s=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(g){g.preventDefault(),r(++s%i.children.length)},!1);var a=(performance||Date).now(),c=a,h=0,f=n(new t.Panel("FPS","#0ff","#002")),d=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var p=n(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:i,addPanel:n,showPanel:r,begin:function(){a=(performance||Date).now()},end:function(){h++;var g=(performance||Date).now();if(d.update(g-a,200),g>c+1e3&&(f.update(1e3*h/(g-c),100),c=g,h=0,p)){var x=performance.memory;p.update(x.usedJSHeapSize/1048576,x.jsHeapSizeLimit/1048576)}return g},update:function(){a=this.end()},domElement:i,setMode:r}};return t.Panel=function(n,r,s){var i=1/0,a=0,c=Math.round,h=c(window.devicePixelRatio||1),f=80*h,d=48*h,p=3*h,g=2*h,x=3*h,v=15*h,_=74*h,m=30*h,M=document.createElement("canvas");M.width=f,M.height=d,M.style.cssText="width:80px;height:48px";var b=M.getContext("2d");return b.font="bold "+9*h+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=s,b.fillRect(0,0,f,d),b.fillStyle=r,b.fillText(n,p,g),b.fillRect(x,v,_,m),b.fillStyle=s,b.globalAlpha=.9,b.fillRect(x,v,_,m),{dom:M,update:function(S,L){i=Math.min(i,S),a=Math.max(a,S),b.fillStyle=s,b.globalAlpha=1,b.fillRect(0,0,f,v),b.fillStyle=r,b.fillText(c(S)+" "+n+" ("+c(i)+"-"+c(a)+")",p,g),b.drawImage(M,x+h,v,_-h,m,x,v,_-h,m),b.fillRect(x+_-h,v,h,m),b.fillStyle=s,b.globalAlpha=.9,b.fillRect(x+_-h,v,h,c((1-S/L)*m))}}},t})})(Xi);var Jf=Xi.exports;const Hf=un(Jf),$f=u.defineComponent({name:"Stats",props:{showPanel:{type:Number,default:0}},setup(o,{expose:e}){const t=new Hf;e({stats:t});const n=document.body;t.showPanel(o.showPanel||0),n==null||n.appendChild(t.dom);const{onBeforeLoop:r,onAfterLoop:s,resume:i}=ie.useRenderLoop();i(),r(()=>t.begin()),s(()=>t.end()),u.onUnmounted(()=>{n==null||n.removeChild(t.dom)})}});class ed{constructor(e,t,n){this.name=e,this.fg=t,this.bg=n,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=90*this.PR,this.canvas.height=48*this.PR,this.canvas.style.width="90px",this.canvas.style.position="absolute",this.canvas.style.height="48px",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,n,r,s=0){let i=1/0,a=0;this.context&&(i=Math.min(i,e),a=Math.max(n,e),r=Math.max(r,t),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(e.toFixed(s)+" "+this.name+" ("+i.toFixed(s)+"-"+parseFloat(a.toFixed(s))+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,(1-t/r)*this.GRAPH_HEIGHT))}}const Zi=class qt{constructor({logsPerSecond:e=20,samplesLog:t=100,samplesGraph:n=10,precision:r=2,minimal:s=!1,horizontal:i=!0,mode:a=0}={}){this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.activeQuery=null,this.gpuQueries=[],this.renderCount=0,this.mode=a,this.horizontal=i,this.dom=document.createElement("div"),this.dom.style.cssText="position:fixed;top:0;left:0;opacity:0.9;z-index:10000;",s&&(this.dom.style.cssText+="cursor:pointer"),this.gl=null,this.query=null,this.isRunningCPUProfiling=!1,this.minimal=s,this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.frames=0,this.renderCount=0,this.threeRendererPatched=!1,this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.queryCreated=!1,this.fpsPanel=this.addPanel(new qt.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new qt.Panel("CPU","#0f0","#020"),1),this.gpuPanel=null,this.gpuPanelCompute=null,this.samplesLog=t,this.samplesGraph=n,this.precision=r,this.logsPerSecond=e,this.minimal?(this.dom.addEventListener("click",c=>{c.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},!1),this.mode=a,this.showPanel(this.mode)):window.addEventListener("resize",()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)})}patchThreeRenderer(e){const t=e.render,n=this;e.render=function(r,s){n.begin(),t.call(this,r,s),n.end()},this.threeRendererPatched=!0}resizePanel(e,t){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=t*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=t*e.HEIGHT/e.PR+"px"))}addPanel(e,t){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,t)),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++){const n=this.dom.children[t];n.style.display=t===e?"block":"none"}this.mode=e}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}if(e.isWebGLRenderer&&!this.threeRendererPatched){const t=e;this.patchThreeRenderer(t),this.gl=t.getContext()}else!this.gl&&e instanceof WebGL2RenderingContext&&(this.gl=e);if(e.isWebGPURenderer){e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&(this.gpuPanel=this.addPanel(new qt.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new qt.Panel("CPT","#e1e1e1","#212121"),3),this.info=e.info);return}else if(!this.gl&&e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas){if(this.gl=e.getContext("webgl2"),!this.gl){console.error("Stats: Unable to obtain WebGL2 context.");return}}else if(!this.gl){console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas.");return}this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new qt.Panel("GPU","#ff0","#220"),2))}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),!(!this.gl||!this.ext)&&this.gl&&this.ext&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery!==null&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}processGpuQueries(){!this.gl||!this.ext||(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){const n=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),r=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(n&&!r){const i=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=i,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}update(){this.info===void 0?this.processGpuQueries():(this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu),this.renderCount=0,this.totalCpuDuration===0&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}endInternal(){this.frames++;const e=(performance||Date).now();if(e>=this.prevCpuTime+1e3/this.logsPerSecond&&(this.updatePanel(this.msPanel,this.averageCpu),this.updatePanel(this.gpuPanel,this.averageGpu),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.prevCpuTime=e),e>=this.prevTime+1e3){const t=this.frames*1e3/(e-this.prevTime);this.fpsPanel.update(t,t,100,100,0),this.prevTime=e,this.frames=0}return e}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&t.logs.shift(),t.graph.push(e),t.graph.length>this.samplesGraph&&t.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,t,n){if(window.performance&&t&&this.isRunningCPUProfiling){window.performance.mark(t);const r=performance.measure(n,e,t);this.totalCpuDuration+=r.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,t){if(t.logs.length>0){let n=0,r=.01;for(let a=0;a<t.logs.length;a++)n+=t.logs[a],t.logs[a]>r&&(r=t.logs[a]);let s=0,i=.01;for(let a=0;a<t.graph.length;a++)s+=t.graph[a],t.graph[a]>i&&(i=t.graph[a]);e&&e.update(n/Math.min(t.logs.length,this.samplesLog),s/Math.min(t.graph.length,this.samplesGraph),r,i,this.precision)}}get domElement(){return this.dom}get container(){return console.warn("Stats: Deprecated! this.container as been replaced to this.dom "),this.dom}};Zi.Panel=ed;let td=Zi;const nd=u.defineComponent({name:"StatsGl",props:["logsPerSecond","samplesLog","samplesGraph","precision","horizontal","minimal","mode"],async setup(o,{expose:e}){const t=new td({logsPerSecond:o.logsPerSecond,samplesLog:o.samplesLog,samplesGraph:o.samplesGraph,precision:o.precision,horizontal:o.horizontal,minimal:o.minimal,mode:o.mode});e({statsGl:t});const n=document.body,r=t.dom||t.container;n==null||n.appendChild(r);const{renderer:s}=ie.useTresContext(),{onAfterLoop:i,resume:a}=ie.useRenderLoop();t.init(s.value),a(),i(()=>{t.update()}),u.onUnmounted(()=>{n==null||n.removeChild(r)})}}),rd=u.defineComponent({name:"BakeShadows",setup(){const{renderer:o}=ie.useTresContext();u.watchEffect(()=>{o.value.shadowMap.autoUpdate=!1,o.value.shadowMap.needsUpdate=!0})}});var sd=`#include <common>

void main() {
  vec2 center = vec2(0., 1.);
  float rotation = 0.0;

  
  
  float size = 0.03;

  vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

  bool isPerspective = isPerspectiveMatrix( projectionMatrix );
  if ( isPerspective ) scale *= - mvPosition.z;

  vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
  rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
  mvPosition.xy += rotatedPosition;

  gl_Position = projectionMatrix * mvPosition;
}`,id=`void main() {
  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
}`;const dn=new l.Vector3(0,0,0),Er=new l.Vector3(0,0,0),od=new l.Vector3(0,0,0);function qi(o,e,t){const n=dn.setFromMatrixPosition(o.matrixWorld);n.project(e);const r=t.width/2,s=t.height/2;return[(Number.isNaN(n.x)?0:n.x)*r+r,-(n.y*s)+s]}function ad(o,e){const t=dn.setFromMatrixPosition(o.matrixWorld),n=Er.setFromMatrixPosition(e.matrixWorld),r=t.sub(n),s=e.getWorldDirection(od);return r.angleTo(s)>Math.PI/2}function ld(o,e,t,n){const r=dn.setFromMatrixPosition(o.matrixWorld),s=r.clone();s.project(e),t.setFromCamera(new l.Vector2(s.x,s.y),e);const i=t.intersectObjects(n,!0);if(i.length>0){const a=i[0].distance;return r.distanceTo(t.ray.origin)<a}return!0}function cd(o,e){if(e instanceof l.OrthographicCamera)return e.zoom;if(e instanceof l.PerspectiveCamera){const t=dn.setFromMatrixPosition(o.matrixWorld),n=Er.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=t.distanceTo(n);return 1/(2*Math.tan(r/2)*s)}else return 1}function ud(o,e,t){if(e instanceof l.PerspectiveCamera||e instanceof l.OrthographicCamera){const n=dn.setFromMatrixPosition(o.matrixWorld),r=Er.setFromMatrixPosition(e.matrixWorld),s=n.distanceTo(r),i=(t[1]-t[0])/(e.far-e.near),a=t[1]-i*e.far;return Math.round(i*s+a)}}const Xr=o=>Math.abs(o)<1e-10?0:o;function Ki(o,e,t=""){let n="matrix3d(";for(let r=0;r!==16;r++)n+=Xr(e[r]*o.elements[r])+(r!==15?",":")");return t+n}const hd=(o=>e=>Ki(e,o))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),fd=(o=>(e,t)=>Ki(e,o(t),"translate(-50%,-50%)"))(o=>[1/o,1/o,1/o,1,-1/o,-1/o,-1/o,-1,1/o,1/o,1/o,1,1,1,1,1]),dd=["geometry","material"],pd=u.defineComponent({__name:"HTML",props:{geometry:{default:new l.PlaneGeometry},material:{},as:{default:"div"},transform:{type:Boolean,default:!1},portal:{},wrapperClass:{},eps:{default:1e-4},distanceFactor:{},fullscreen:{type:Boolean},center:{type:Boolean},pointerEvents:{default:"auto"},sprite:{type:Boolean,default:!1},zIndexRange:{default:()=>[16777271,0]},occlude:{type:[Array,Boolean,String]}},emits:["onOcclude"],setup(o,{emit:e}){const t=o,n=e,r=u.useSlots(),s=u.useAttrs(),i=u.ref(),a=u.ref(),{geometry:c,material:h,as:f,transform:d,portal:p,wrapperClass:g,eps:x,distanceFactor:v,fullscreen:_,center:m,pointerEvents:M,sprite:b,occlude:S,zIndexRange:L}=u.toRefs(t),{renderer:P,scene:T,camera:y,raycaster:A,sizes:w}=ie.useTresContext(),D=u.computed(()=>document.createElement(f.value)),k=u.ref([0,0]),R=u.ref(0),V=u.ref(),Y=u.computed(()=>d.value?{position:"absolute",top:0,left:0,width:`${w.width.value}px`,height:`${w.height.value}px`,transformStyle:"preserve-3d",pointerEvents:"none",zIndex:2,willChange:"transform"}:{position:"absolute",transform:m.value?"translate3d(-50%,-50%,0)":"none",..._.value&&{top:-w.height.value/2,left:-w.width.value/2,width:`${w.width.value}px`,height:`${w.height.value}px`},zIndex:2,...s.style,willChange:"transform"}),G=u.computed(()=>({position:"absolute",pointerEvents:M.value})),Q=u.ref(null),K=u.ref(!1),ne=u.computed(()=>(S==null?void 0:S.value)&&(S==null?void 0:S.value)!=="blending"||Array.isArray(S==null?void 0:S.value)&&(S==null?void 0:S.value.length)&&u.isRef(S.value[0]));u.watch(()=>S,O=>{O&&O==="blending"?(D.value.style.zIndex=`${Math.floor(L.value[0]/2)}`,D.value.style.position="absolute",D.value.style.pointerEvents="none"):(D.value.style.zIndex=null,D.value.style.position=null,D.value.style.pointerEvents=null)}),u.watch(()=>{var O;return[i.value,P.value,w.width.value,w.height.value,(O=r.default)==null?void 0:O.call(r)]},([O,z])=>{var U,F,j,C,I,B;if(O&&z){const Z=(p==null?void 0:p.value)||z.domElement;if((U=T.value)==null||U.updateMatrixWorld(),d.value)D.value.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const X=qi(O,y.value,{width:w.width.value,height:w.height.value});D.value.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${X[0]}px,${X[1]}px,0);transform-origin:0 0;`}Z&&!D.value.parentNode&&((F=Z.parentNode)==null||F.appendChild(D.value)),d.value?V.value=u.createVNode("div",{id:"outer",style:Y.value},[u.createVNode("div",{id:"inner",style:G.value},[u.createVNode("div",{key:(j=a.value)==null?void 0:j.uuid,id:T==null?void 0:T.value.uuid,class:s.class,style:s.style},(C=r.default)==null?void 0:C.call(r))])]):V.value=u.createVNode("div",{key:(I=a.value)==null?void 0:I.uuid,id:T==null?void 0:T.value.uuid,style:Y.value},(B=r.default)==null?void 0:B.call(r)),u.render(V.value,D.value)}}),u.watchEffect(()=>{g!=null&&g.value&&(D.value.className=g.value)});const ee=u.ref(!0),{onLoop:le}=ie.useRenderLoop();le(()=>{var O,z,U,F,j,C,I;if(i.value&&y.value&&P.value){(O=y.value)==null||O.updateMatrixWorld(),i.value.updateWorldMatrix(!0,!1);const B=d.value?k.value:qi(i.value,y.value,{width:w.width.value||0,height:w.height.value||0});if(d.value||Math.abs(R.value-y.value.zoom)>x.value||Math.abs(k.value[0]-B[0])>x.value||Math.abs(k.value[1]-B[1])>x.value){const Z=ad(i.value,y.value);let X=!1;ne.value&&(Array.isArray(S==null?void 0:S.value)?X=S==null?void 0:S.value:(S==null?void 0:S.value)!=="blending"&&(X=[T.value]));const W=ee.value;if(X){const se=ld(i.value,y.value,A.value,X);ee.value=se&&!Z}else ee.value=!Z;W!==ee.value&&(n("onOcclude",!ee.value),D.value.style.display=ee.value?"block":"none");const $=Math.floor(L.value[0]/2),re=S!=null&&S.value?ne.value?[L.value[0],$]:[$-1,0]:L.value;if(D.value.style.zIndex=`${ud(i.value,y.value,re)}`,D.value.style.willChange="transform",d.value){const[se,E]=[w.width.value/2,w.height.value/2],N=y.value.projectionMatrix.elements[5]*E,{isOrthographicCamera:ae,top:ue,left:ve,bottom:Oe,right:Te}=y.value,He=hd(y.value.matrixWorldInverse),Ct=ae?`scale(${N})translate(${Xr(-(Te+ve)/2)}px,${Xr((ue+Oe)/2)}px)`:`translateZ(${N}px)`;let Ze=i.value.matrixWorld;b.value&&(Ze=y.value.matrixWorldInverse.clone().transpose().copyPosition(Ze).scale(i.value.scale),Ze.elements[3]=Ze.elements[7]=Ze.elements[11]=0,Ze.elements[15]=1),D.value.style.width=`${w.width.value}px`,D.value.style.height=`${w.height.value}px`,D.value.style.perspective=ae?"":`${N}px`,(z=V.value)!=null&&z.el&&((U=V.value)!=null&&U.children)&&(V.value.el.style.willChange="transform",V.value.el.style.transform=`${Ct}${He}translate(${se}px,${E}px)`,V.value.children[0].willChange="transform",V.value.children[0].el.style.transform=fd(Ze,1/(((v==null?void 0:v.value)||10)/400)))}else{const se=(v==null?void 0:v.value)===void 0?1:cd(i.value,y.value)*(v==null?void 0:v.value);D.value.style.transform=`translate3d(${B[0]}px,${B[1]}px,0) scale(${se})`}}k.value=B,R.value=y.value.zoom}if(!ne.value&&a.value&&!K.value)if(d.value){if((F=V.value)!=null&&F.el&&((j=V.value)!=null&&j.children)){const B=(C=V.value)==null?void 0:C.children[0];if(B!=null&&B.clientWidth&&(B!=null&&B.clientHeight)){const{isOrthographicCamera:Z}=y.value;if(Z||c)s.scale&&(Array.isArray(s.scale)?s.scale instanceof l.Vector3?a.value.scale.copy(s.scale.clone().divideScalar(1)):a.value.scale.set(1/s.scale[0],1/s.scale[1],1/s.scale[2]):a.value.scale.setScalar(1/s.scale));else{const X=((v==null?void 0:v.value)||10)/400,W=B.clientWidth*X,$=B.clientHeight*X;a.value.scale.set(W,$,1)}K.value=!0}}}else{const B=D.value.children[0];if(B!=null&&B.clientWidth&&(B!=null&&B.clientHeight)){const X=B.clientWidth*1,W=B.clientHeight*1;a.value.scale.set(X,W,1),K.value=!0}Q.value.lookAt((I=y.value)==null?void 0:I.position)}});const he=u.computed(()=>({vertexShader:d.value?void 0:sd,fragmentShader:id})),de=u.computed(()=>{const O=he.value;return h.value||new l.ShaderMaterial({vertexShader:O.vertexShader,fragmentShader:O.fragmentShader,side:l.DoubleSide})});return u.onUnmounted(()=>{de.value&&de.value.dispose(),D.value.remove()}),(O,z)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"groupRef",ref:i},[u.unref(S)&&!ne.value?(u.openBlock(),u.createElementBlock("TresMesh",{key:0,ref_key:"meshRef",ref:a,geometry:u.unref(c),material:de.value},null,8,dd)):u.createCommentVNode("",!0)],512))}}),{logError:md}=ie.useLogger();async function gd(o,e){const t=new qn,n=(e==null?void 0:e.fileName)||"scene";t.parse(o,r=>{if(r instanceof ArrayBuffer)vd(r,`${n}.glb`);else{const s=JSON.stringify(r,null,2);yd(s,`${n}.gltf`)}},r=>{md("An error happened while exporting the GLTF",r)},e)}function yd(o,e){Qi(new Blob([o],{type:"text/plain"}),e)}function vd(o,e){Qi(new Blob([o],{type:"application/octet-stream"}),e)}function Qi(o,e){const t=document.createElement("a");t.style.display="none",document.body.appendChild(t),t.href=URL.createObjectURL(o),t.download=e,t.click(),t.remove()}const _d={mounted:(o,e)=>{if(e.arg){console.log(`v-log:${e.arg}`,o[e.arg]);return}console.log("v-log",o)}},{logWarning:Ji}=ie.useLogger();let jn,Xt;const xd={DirectionalLight:l.DirectionalLightHelper,PointLight:l.PointLightHelper,SpotLight:l.SpotLightHelper,HemisphereLight:l.HemisphereLightHelper,RectAreaLight:ks},wd={mounted:o=>{var e;if(!o.isLight){Ji(`${o.type} is not a light`);return}jn=xd[o.type],(e=o==null?void 0:o.parent)==null||e.add(new jn(o,o.intensity))},updated:o=>{Xt=o.parent.children.find(e=>e instanceof jn),!(Xt instanceof ks)&&Xt.update()},unmounted:o=>{if(!o.isLight){Ji(`${o.type} is not a light`);return}Xt=o.parent.children.find(e=>e instanceof jn),Xt.dispose(),o.parent.remove(Xt)}};function bd(o,e){const t={};for(const n of e)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);return t}function Md(o,e){const t=`set${e[0].toUpperCase()}${e.slice(1)}`;return o[t]!==void 0}function Zr(o){var t,n;let e=o.value;return o.value&&((n=(t=o.value)==null?void 0:t.value)!=null&&n.isMesh)&&(e=o.value.value.position),Array.isArray(o.value)&&(e=new l.Vector3(...e)),e}const{logWarning:Sd}=ie.useLogger(),Ad={updated:(o,e)=>{const t=Zr(e);if(!t){Sd(`v-always-look-at: problem with binding value: ${e.value}`);return}const{onLoop:n}=ie.useRenderLoop();n(()=>{o.lookAt(t)})}},{logWarning:Cd}=ie.useLogger();let ht=null;const Pd={updated:(o,e)=>{var r;const t=Zr(e);if(!t){Cd(`v-distance-to: problem with binding value: ${e.value}`);return}ht&&(ht.dispose(),o.parent.remove(ht));const n=t.clone().sub(o.position);n.normalize(),ht=new l.ArrowHelper(n,o.position,o.position.distanceTo(t)/1.5,16776960),o.parent.add(ht),console.table([["Distance:",o.position.distanceTo(t)],[`origin: ${o.name||o.type}`,`x:${o.position.x}, y:${o.position.y}, z:${(r=o.position)==null?void 0:r.z}`],[`Destiny: ${o.name||o.type}`,`x:${t.x}, y:${t.y}, z:${t==null?void 0:t.z}`]])},unmounted:o=>{ht==null||ht.dispose(),o.parent.remove(ht)}};te.Backdrop=cf,te.BakeShadows=rd,te.BaseCameraControls=Ue,te.Box=th,te.CameraControls=Dc,te.CatmullRomCurve3=ah,te.Circle=uh,te.Cone=dh,te.ContactShadows=mf,te.CustomShaderMaterial=Yu,te.Dodecahedron=gh,te.Environment=$h,te.FBXModel=uc,te.Fbo=ec,te.Fit=gf,te.GLTFModel=lc,te.GlobalAudio=Ul,te.HolographicMaterial=Hu,te.Html=pd,te.Icosahedron=_h,te.KeyboardControls=xc,te.Lensflare=$l,te.Levioso=fl,te.Lightformer=sf,te.Line2=Wi,te.MapControls=Cc,te.MeshGlassMaterial=Rc,te.MeshReflectionMaterial=Qu,te.MeshWobbleMaterial=Fc,te.MouseParallax=Fl,te.Ocean=Kf,te.Octahedron=bh,te.OrbitControls=gc,te.Plane=Ch,te.PointerLockControls=Sc,te.PositionalAudio=sc,te.Precipitation=_f,te.Reflector=ml,te.Ring=Ih,te.RoundedBox=Dh,te.SVG=fc,te.Sampler=tc,te.ScrollControls=Pc,te.Sky=wf,te.Smoke=Cf,te.Sparkles=Rf,te.Sphere=Fh,te.Stars=Ef,te.Stats=$f,te.StatsGl=nd,te.Superformula=Vh,te.Tetrahedron=Rh,te.Text3D=ul,te.Torus=Eh,te.TorusKnot=qh,te.TransformControls=bc,te.Tube=Jh,te.extractBindingPosition=Zr,te.hasSetter=Md,te.pick=bd,te.useAnimations=hl,te.useEnvironment=Qs,te.useFBO=qs,te.useFBX=Hs,te.useGLTF=Js,te.useGLTFExporter=gd,te.useProgress=dc,te.useSurfaceSampler=Ks,te.useTweakPane=Qf,te.useVideoTexture=pc,te.vAlwaysLookAt=Ad,te.vDistanceTo=Pd,te.vLightHelper=wd,te.vLog=_d,Object.defineProperty(te,Symbol.toStringTag,{value:"Module"})});
