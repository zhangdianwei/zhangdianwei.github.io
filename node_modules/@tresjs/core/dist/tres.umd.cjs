/**
 * name: @tresjs/core
 * version: v3.9.0
 * (c) 2024
 * description: Declarative ThreeJS using Vue Components
 * author: Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)
 */
(function(h,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("vue"),require("three"),require("@vueuse/core")):typeof define=="function"&&define.amd?define(["exports","vue","three","@vueuse/core"],u):(h=typeof globalThis<"u"?globalThis:h||self,u(h.tres={},h.Vue,h.Three,h.VueUseCore))})(this,function(h,u,f,y){"use strict";var wt=Object.defineProperty;var bt=(h,u,f)=>u in h?wt(h,u,{enumerable:!0,configurable:!0,writable:!0,value:f}):h[u]=f;var Q=(h,u,f)=>(bt(h,typeof u!="symbol"?u+"":u,f),f);function be(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:()=>e[t]})}}return r.default=e,Object.freeze(r)}const J=be(f),_e={name:"@tresjs/core",type:"module",version:"3.9.0",packageManager:"pnpm@8.15.6",description:"Declarative ThreeJS using Vue Components",author:"Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)",license:"MIT",keywords:["vue","3d","threejs","three","threejs-vue"],sideEffects:!1,exports:{".":{types:"./dist/index.d.ts",import:"./dist/tres.js",require:"./dist/tres.umd.cjs"},"./components":{types:"./dist/src/components/index.d.ts"},"./composables":{types:"./dist/src/composables/index.d.ts"},"./types":{types:"./dist/src/types/index.d.ts"},"./utils":{types:"./dist/src/utils/index.d.ts"},"./*":"./*"},main:"./dist/tres.js",module:"./dist/tres.js",types:"./dist/index.d.ts",files:["*.d.ts","dist"],publishConfig:{access:"public"},scripts:{dev:"cd playground && npm run dev",build:"vite build",playground:"cd playground && npm run dev",test:"vitest","test:ci":"vitest run","test:ui":"vitest --ui",release:"release-it",coverage:"vitest run --coverage",lint:"eslint .","lint:fix":"eslint . --fix","docs:dev":"vitepress dev docs","docs:build":"vitepress build docs","docs:serve":"vitepress serve docs","docs:preview":"vitepress preview docs","docs:contributors":"esno scripts/update-contributors.ts",prepare:"node .husky/install.mjs"},peerDependencies:{three:">=0.133",vue:">=3.3"},dependencies:{"@alvarosabu/utils":"^3.1.1","@vue/devtools-api":"^6.6.1","@vueuse/core":"^10.7.0"},devDependencies:{"@release-it/conventional-changelog":"^8.0.1","@stackblitz/sdk":"^1.9.0","@tresjs/cientos":"3.8.0","@tresjs/eslint-config":"^1.0.0","@tresjs/eslint-config-vue":"^0.2.1","@types/three":"^0.163.0","@typescript-eslint/eslint-plugin":"^7.7.1","@typescript-eslint/parser":"^7.7.1","@vitejs/plugin-vue":"^5.0.4","@vitest/coverage-c8":"^0.33.0","@vitest/ui":"^1.5.0","@vue/test-utils":"^2.4.3",eslint:"^9.1.1","eslint-plugin-vue":"^9.25.0",esno:"^4.0.0",gsap:"^3.12.3",husky:"^9.0.11",jsdom:"^24.0.0",kolorist:"^1.8.0",ohmyfetch:"^0.4.21",pathe:"^1.1.1","release-it":"^17.2.0","rollup-plugin-analyzer":"^4.0.0","rollup-plugin-copy":"^3.5.0","rollup-plugin-visualizer":"^5.11.0",three:"^0.163.0",unocss:"^0.59.4",unplugin:"^1.10.1","unplugin-vue-components":"^0.26.0",vite:"^5.2.10","vite-plugin-banner":"^0.7.1","vite-plugin-dts":"3.9.0","vite-plugin-inspect":"^0.8.4","vite-plugin-require-transform":"^1.0.21","vite-svg-loader":"^5.1.0",vitepress:"1.1.3",vitest:"^1.5.0",vue:"^3.4.24","vue-demi":"^0.14.6"}},Y=({sizes:e,scene:r})=>{const t=u.ref([]),n=u.computed(()=>t.value[0]),s=a=>{const l=a instanceof f.Camera?a:t.value.find(v=>v.uuid===a);if(!l)return;const d=t.value.filter(({uuid:v})=>v!==l.uuid);t.value=[l,...d]},i=(a,l=!1)=>{t.value.some(({uuid:d})=>d===a.uuid)||(l?s(a):t.value.push(a))},o=a=>{t.value=t.value.filter(({uuid:l})=>l!==a.uuid)};return u.watchEffect(()=>{e.aspectRatio.value&&t.value.forEach(a=>{a instanceof f.PerspectiveCamera&&(a.aspect=e.aspectRatio.value),(a instanceof f.PerspectiveCamera||a instanceof f.OrthographicCamera)&&a.updateProjectionMatrix()})}),r.userData.tres__registerCamera=i,r.userData.tres__deregisterCamera=o,u.onUnmounted(()=>{t.value=[]}),{camera:n,cameras:t,registerCamera:i,deregisterCamera:o,setCameraActive:s}},K=y.createEventHook(),X=y.createEventHook(),R=y.createEventHook(),j=new f.Clock;let I=0,$=0;const{pause:Ce,resume:Me,isActive:ke}=y.useRafFn(()=>{K.trigger({delta:I,elapsed:$,clock:j}),X.trigger({delta:I,elapsed:$,clock:j}),R.trigger({delta:I,elapsed:$,clock:j})},{immediate:!1});R.on(()=>{I=j.getDelta(),$=j.getElapsedTime()});const V=()=>({onBeforeLoop:K.on,onLoop:X.on,onAfterLoop:R.on,pause:Ce,resume:Me,isActive:ke}),Pe=!0,z="[TresJS ▲ ■ ●] ";function x(){function e(...n){typeof n[0]=="string"?n[0]=z+n[0]:n.unshift(z),console.error(...n)}function r(...n){typeof n[0]=="string"?n[0]=z+n[0]:n.unshift(z),console.warn(...n)}function t(n,s){}return{logError:e,logWarning:r,logMessage:t}}function Se(e){return typeof e=="number"?[e,e,e]:e instanceof f.Vector3?[e.x,e.y,e.z]:e}function Z(e){return e instanceof f.Color?e:Array.isArray(e)?new f.Color(...e):new f.Color(e)}class Ae extends J.Mesh{constructor(...t){super(...t);Q(this,"type","HightlightMesh");Q(this,"createTime");this.createTime=Date.now()}onBeforeRender(){const n=(Date.now()-this.createTime)/1e3,o=1+.07*Math.sin(2.5*n);this.scale.set(o,o,o)}}const ee=(e,r)=>{for(const t of Object.keys(r))r[t]instanceof Object&&Object.assign(r[t],ee(e[t],r[t]));return Object.assign(e||{},r),e},Le=Oe("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot");function te(e){return e&&e.nodeType===1}function W(e){return e.replace(/-([a-z])/g,(r,t)=>t.toUpperCase())}function Oe(e,r){const t=Object.create(null),n=e.split(",");for(let s=0;s<n.length;s++)t[n[s]]=!0;return r?s=>!!t[s.toLowerCase()]:s=>!!t[s]}const xe=(e,r)=>{const t=new Set,n=[];for(const s of e){const i=r(s);t.has(i)||(t.add(i),n.push(s))}return n},re=(e,r)=>{if(!r)return;const t=Array.isArray(r)?r:r.match(/([^[.\]])+/g);return t==null?void 0:t.reduce((n,s)=>n&&n[s],e)},De=(e,r,t)=>{const n=Array.isArray(r)?r:r.match(/([^[.\]])+/g);n&&n.reduce((s,i,o)=>(s[i]===void 0&&(s[i]={}),o===n.length-1&&(s[i]=t),s[i]),e)};function ne(e,r){if(te(e)&&te(r)){const s=e.attributes,i=r.attributes;return s.length!==i.length?!1:Array.from(s).every(({name:o,value:a})=>r.getAttribute(o)===a)}if(e===r)return!0;if(e===null||typeof e!="object"||r===null||typeof r!="object")return!1;const t=Object.keys(e),n=Object.keys(r);if(t.length!==n.length)return!1;for(const s of t)if(!n.includes(s)||!ne(e[s],r[s]))return!1;return!0}function Be(e,r){if(!Array.isArray(e)||!Array.isArray(r)||e.length!==r.length)return!1;for(let t=0;t<e.length;t++)if(!ne(e[t],r[t]))return!1;return!0}const Te=Array.isArray;function je(e,r,t,n){const s=l=>{if(l.uuid===r)return l;for(const d of l.children){const v=s(d);if(v)return v}},i=s(e);if(!i){console.warn("Object with UUID not found in the scene.");return}let o=i;for(let l=0;l<t.length-1;l++)if(o[t[l]]!==void 0)o=o[t[l]];else{console.warn(`Property path is not valid: ${t.join(".")}`);return}const a=t[t.length-1];o[a]!==void 0?o[a]=n:console.warn(`Property path is not valid: ${t.join(".")}`)}function Ve(e){const r=new f.MeshBasicMaterial({color:11003607,transparent:!0,opacity:.2,depthTest:!1,side:f.DoubleSide});return new Ae(e.geometry.clone(),r)}function oe(e){var t;let r=e.value;return e.value&&((t=e.value)!=null&&t.isMesh)&&(r=e.value.position),Array.isArray(e.value)&&(r=new f.Vector3(...r)),r}const Ee=Number.parseInt(f.REVISION.replace("dev","")),F={realistic:{shadows:!0,physicallyCorrectLights:!0,outputColorSpace:f.SRGBColorSpace,toneMapping:f.ACESFilmicToneMapping,toneMappingExposure:3,shadowMap:{enabled:!0,type:f.PCFSoftShadowMap}}};function se({scene:e,canvas:r,options:t,disableRender:n,contextParts:{sizes:s,camera:i}}){const o=u.computed(()=>({alpha:y.toValue(t.alpha),depth:y.toValue(t.depth),canvas:y.unrefElement(r),context:y.toValue(t.context),stencil:y.toValue(t.stencil),antialias:y.toValue(t.antialias)===void 0?!0:y.toValue(t.antialias),precision:y.toValue(t.precision),powerPreference:y.toValue(t.powerPreference),premultipliedAlpha:y.toValue(t.premultipliedAlpha),preserveDrawingBuffer:y.toValue(t.preserveDrawingBuffer),logarithmicDepthBuffer:y.toValue(t.logarithmicDepthBuffer),failIfMajorPerformanceCaveat:y.toValue(t.failIfMajorPerformanceCaveat)})),a=u.shallowRef(new f.WebGLRenderer(o.value));u.watch(o,()=>{a.value.dispose(),a.value=new f.WebGLRenderer(o.value)}),u.watchEffect(()=>{a.value.setSize(s.width.value,s.height.value)});const{pixelRatio:l}=y.useDevicePixelRatio();u.watchEffect(()=>{a.value.setPixelRatio(l.value)});const{logError:d}=x(),p=(()=>{const g=new f.WebGLRenderer,C={shadowMap:{enabled:g.shadowMap.enabled,type:g.shadowMap.type},toneMapping:g.toneMapping,toneMappingExposure:g.toneMappingExposure,outputColorSpace:g.outputColorSpace};return g.dispose(),C})();u.watchEffect(()=>{const g=y.toValue(t.preset);g&&(g in F||d(`Renderer Preset must be one of these: ${Object.keys(F).join(", ")}`),ee(a.value,F[g]));const C=(S,A)=>{const M=y.toValue(S),O=()=>{if(g)return re(F[g],A)};if(M!==void 0)return M;const b=O();return b!==void 0?b:re(p,A)},P=(S,A)=>De(a.value,A,C(S,A));P(t.shadows,"shadowMap.enabled"),P(t.toneMapping,"toneMapping"),P(t.shadowMapType,"shadowMap.type"),Ee<150&&P(!t.useLegacyLights,"physicallyCorrectLights"),P(t.outputColorSpace,"outputColorSpace"),P(t.toneMappingExposure,"toneMappingExposure");const L=C(t.clearColor,"clearColor");L&&a.value.setClearColor(L?Z(L):new f.Color(0))});const{pause:c,resume:m,onLoop:_}=V();return _(()=>{i.value&&!y.toValue(n)&&a.value.render(e,i.value)}),m(),u.onUnmounted(()=>{c(),a.value.dispose(),a.value.forceContextLoss()}),{renderer:a}}const ie=e=>typeof e=="function",Ie=e=>!!e&&e.constructor===Array;function ae(e){const r={nodes:{},materials:{}};return e&&e.traverse(t=>{t.name&&(r.nodes[t.name]=t),t.material&&!r.materials[t.material.name]&&(r.materials[t.material.name]=t.material)}),r}async function $e(e,r,t,n,s){const{logError:i}=x(),o=new e;s&&s(o),t&&t(o);const l=(Array.isArray(r)?r:[r]).map(d=>new Promise((v,p)=>{o.load(d,c=>{c.scene&&Object.assign(c,ae(c.scene)),v(c)},n,c=>p(i("[useLoader] - Failed to load resource",c)))}));return Ie(r)?await Promise.all(l):await l[0]}async function ze(e,r){const t=new f.TextureLoader(r),n=s=>new Promise((i,o)=>{t.load(s,a=>i(a),()=>null,()=>{o(new Error("[useTextures] - Failed to load texture"))})});if(Te(e)){const s=await Promise.all(e.map(i=>n(i)));return e.length>1?s:s[0]}else{const{map:s,displacementMap:i,normalMap:o,roughnessMap:a,metalnessMap:l,aoMap:d,alphaMap:v,matcap:p}=e;return{map:s?await n(s):null,displacementMap:i?await n(i):null,normalMap:o?await n(o):null,roughnessMap:a?await n(a):null,metalnessMap:l?await n(l):null,aoMap:d?await n(d):null,alphaMap:v?await n(v):null,matcap:p?await n(p):null}}}const le=(e,{renderer:r,camera:t,raycaster:n})=>{const s=u.computed(()=>r.value.domElement),{x:i,y:o}=y.usePointer({target:s}),{width:a,height:l,top:d,left:v}=y.useElementBounding(s),p=({x:b,y:k})=>{if(s.value)return{x:(b-v.value)/a.value*2-1,y:-((k-d.value)/l.value)*2+1}},c=({x:b,y:k})=>{if(t.value)return n.value.setFromCamera(new f.Vector2(b,k),t.value),n.value.intersectObjects(e.value,!1)},m=b=>{const k=p({x:(b==null?void 0:b.clientX)??i.value,y:(b==null?void 0:b.clientY)??o.value});return k?c(k)||[]:[]},_=u.computed(()=>m()),g=y.createEventHook(),C=y.createEventHook(),P=(b,k)=>{b.trigger({event:k,intersects:m(k)})},L=b=>{P(C,b)};let S;const A=b=>{var k;S=(k=m(b)[0])==null?void 0:k.object},M=b=>{var k;b instanceof PointerEvent&&S===((k=m(b)[0])==null?void 0:k.object)&&P(g,b)},O=b=>C.trigger({event:b,intersects:[]});return s.value.addEventListener("pointerup",M),s.value.addEventListener("pointerdown",A),s.value.addEventListener("pointermove",L),s.value.addEventListener("pointerleave",O),u.onUnmounted(()=>{s!=null&&s.value&&(s.value.removeEventListener("pointerup",M),s.value.removeEventListener("pointerdown",A),s.value.removeEventListener("pointermove",L),s.value.removeEventListener("pointerleave",O))}),{intersects:_,onClick:b=>g.on(b).off,onPointerMove:b=>C.on(b).off}};function We(){const{logWarning:e}=x();function r(i,o,a){let l=null;return i.traverse(d=>{d[o]===a&&(l=d)}),l||e(`Child with ${o} '${a}' not found.`),l}function t(i,o,a){const l=[];return i.traverse(d=>{d[o].includes(a)&&l.push(d)}),l.length||e(`Children with ${o} '${a}' not found.`),l}function n(i,o){return r(i,"name",o)}function s(i,o){return t(i,"name",o)}return{seek:r,seekByName:n,seekAll:t,seekAllByName:s}}const ue=({scene:e,contextParts:r})=>{const t=u.reactive({click:new Map,pointerMove:new Map,pointerEnter:new Map,pointerLeave:new Map}),n=u.ref(new Set),s=c=>{n.value.add(c)},i=c=>{n.value.delete(c)},o=c=>{Object.values(t).forEach(m=>m.delete(c)),i(c)},a=c=>{const{onClick:m,onPointerMove:_,onPointerEnter:g,onPointerLeave:C}=c;m&&t.click.set(c,m),_&&t.pointerMove.set(c,_),g&&t.pointerEnter.set(c,g),C&&t.pointerLeave.set(c,C)};e.userData.tres__registerAtPointerEventHandler=a,e.userData.tres__deregisterAtPointerEventHandler=o,e.userData.tres__registerBlockingObjectAtPointerEventHandler=s,e.userData.tres__deregisterBlockingObjectAtPointerEventHandler=i;const l=u.computed(()=>xe([...Array.from(n.value),...Object.values(t).map(c=>Array.from(c.keys())).flat()],({uuid:c})=>c)),{onClick:d,onPointerMove:v}=le(l,r);d(({intersects:c,event:m})=>{var _;c.length&&((_=t.click.get(c[0].object))==null||_(c[0],m))});let p;return v(({intersects:c,event:m})=>{var L,S,A,M;const _=(L=c==null?void 0:c[0])==null?void 0:L.object,{pointerLeave:g,pointerEnter:C,pointerMove:P}=t;p&&p!==_&&((S=g.get(p))==null||S(p,m)),_&&(p!==_&&((A=C.get(_))==null||A(c[0],m)),(M=P.get(_))==null||M(c[0],m)),p=_||null}),{registerObject:a,deregisterObject:o}};function ce(e){let r=0;return e.traverse(t=>{if(t.isMesh&&t.geometry){const n=t.geometry,s=n.attributes.position.count*3*Float32Array.BYTES_PER_ELEMENT,i=n.index?n.index.count*Uint32Array.BYTES_PER_ELEMENT:0,o=n.attributes.normal?n.attributes.normal.count*3*Float32Array.BYTES_PER_ELEMENT:0,a=n.attributes.uv?n.attributes.uv.count*2*Float32Array.BYTES_PER_ELEMENT:0,l=s+i+o+a;r+=l}}),r}function Fe(e){return(e/1024).toFixed(2)}const N=u.ref({}),U=e=>Object.assign(N.value,e);function Ne(e,r,t=10){const n=y.toValue(e)?y.useWindowSize():y.useElementSize(u.computed(()=>y.toValue(r).parentElement)),s=u.readonly(y.refDebounced(n.width,t)),i=u.readonly(y.refDebounced(n.height,t)),o=u.computed(()=>s.value/i.value);return{height:i,width:s,aspectRatio:o}}function de({scene:e,canvas:r,windowSize:t,disableRender:n,rendererOptions:s}){const i=Ne(t,r),o=u.shallowRef(e),{camera:a,cameras:l,registerCamera:d,deregisterCamera:v,setCameraActive:p}=Y({sizes:i,scene:e}),{renderer:c}=se({scene:e,canvas:r,options:s,contextParts:{sizes:i,camera:a},disableRender:n}),m={sizes:i,scene:o,camera:a,cameras:u.readonly(l),renderer:c,raycaster:u.shallowRef(new f.Raycaster),controls:u.ref(null),perf:{maxFrames:160,fps:{value:0,accumulator:[]},memory:{currentMem:0,allocatedMem:0,accumulator:[]}},extend:U,registerCamera:d,setCameraActive:p,deregisterCamera:v};u.provide("useTres",m);const _=100,g=y.useFps({every:_}),{isSupported:C,memory:P}=y.useMemory({interval:_}),L=160;let S=performance.now();const A=({timestamp:k})=>{m.scene.value&&(m.perf.memory.allocatedMem=ce(m.scene.value)),k-S>=_&&(S=k,m.perf.fps.accumulator.push(g.value),m.perf.fps.accumulator.length>L&&m.perf.fps.accumulator.shift(),m.perf.fps.value=g.value,C.value&&P.value&&(m.perf.memory.accumulator.push(P.value.usedJSHeapSize/1024/1024),m.perf.memory.accumulator.length>L&&m.perf.memory.accumulator.shift(),m.perf.memory.currentMem=m.perf.memory.accumulator.reduce((vt,yt)=>vt+yt,0)/m.perf.memory.accumulator.length))};let M=0;const O=1,{pause:b}=y.useRafFn(({delta:k})=>{window.__TRES__DEVTOOLS__&&(A({timestamp:performance.now()}),M+=k,M>=O&&(window.__TRES__DEVTOOLS__.cb(m),M=0))},{immediate:!0});return u.onUnmounted(()=>{b()}),m}function fe(){const e=u.inject("useTres");if(!e)throw new Error("useTresContext must be used together with useTresContextProvider");return e}const Ue=fe;function Ft(e){}let w=null;const{logError:pe}=x(),q=["onClick","onPointerMove","onPointerEnter","onPointerLeave"],Ge={createElement(e,r,t,n){var o,a;if(n||(n={}),n.args||(n.args=[]),e==="template"||Le(e))return null;let s=e.replace("Tres",""),i;if(e==="primitive"){(n==null?void 0:n.object)===void 0&&pe("Tres primitives need a prop 'object'");const l=n.object;s=l.type,i=Object.assign(l,{type:s,attach:n.attach,primitive:!0})}else{const l=N.value[s];l||pe(`${s} is not defined on the THREE namespace. Use extend to add it to the catalog.`),i=new l(...n.args)}return i.isCamera&&(n!=null&&n.position||i.position.set(3,3,3),n!=null&&n.lookAt||i.lookAt(0,0,0)),(n==null?void 0:n.attach)===void 0&&(i.isMaterial?i.attach="material":i.isBufferGeometry&&(i.attach="geometry")),i.isObject3D&&((o=n==null?void 0:n.material)!=null&&o.isMaterial&&(i.userData.tres__materialViaProp=!0),(a=n==null?void 0:n.geometry)!=null&&a.isBufferGeometry&&(i.userData.tres__geometryViaProp=!0)),i.userData={...i.userData,tres__name:s},i},insert(e,r){var n,s,i,o;r&&r.isScene&&(w=r);const t=r||w;if(e!=null&&e.isObject3D){if(e!=null&&e.isCamera){if(!(w!=null&&w.userData.tres__registerCamera))throw new Error("could not find tres__registerCamera on scene's userData");(s=w==null?void 0:(n=w.userData).tres__registerCamera)==null||s.call(n,e)}if(e&&q.some(a=>e[a])){if(!(w!=null&&w.userData.tres__registerAtPointerEventHandler))throw new Error("could not find tres__registerAtPointerEventHandler on scene's userData");(o=w==null?void 0:(i=w.userData).tres__registerAtPointerEventHandler)==null||o.call(i,e)}}e!=null&&e.isObject3D&&(t!=null&&t.isObject3D)?(t.add(e),e.dispatchEvent({type:"added"})):e!=null&&e.isFog?t.fog=e:typeof(e==null?void 0:e.attach)=="string"&&(e.__previousAttach=e[t==null?void 0:t.attach],t&&(t[e.attach]=e))},remove(e){var r,t;if(e){if(e.isObject3D){const n=e,s=d=>{var p,c;const v=d;d.userData.tres__materialViaProp||((p=v.material)==null||p.dispose(),v.material=void 0),d.userData.tres__geometryViaProp||((c=v.geometry)==null||c.dispose(),v.geometry=void 0)},i=w==null?void 0:w.userData.tres__deregisterAtPointerEventHandler,o=w==null?void 0:w.userData.tres__deregisterBlockingObjectAtPointerEventHandler,a=d=>{var v,p;if(!o)throw new Error("could not find tres__deregisterBlockingObjectAtPointerEventHandler on scene's userData");if((p=w==null?void 0:(v=w.userData).tres__deregisterBlockingObjectAtPointerEventHandler)==null||p.call(v,d),!i)throw new Error("could not find tres__deregisterAtPointerEventHandler on scene's userData");d&&q.some(c=>d[c])&&(i==null||i(d))},l=d=>{const v=w==null?void 0:w.userData.tres__deregisterCamera;if(!v)throw new Error("could not find tres__deregisterCamera on scene's userData");d.isCamera&&(v==null||v(d))};(r=e.removeFromParent)==null||r.call(e),n.traverse(d=>{s(d),l(d),a==null||a(d)}),s(n),l(n),a==null||a(n)}(t=e.dispose)==null||t.call(e)}},patchProp(e,r,t,n){var s,i,o,a;if(e){let l=e,d=r;if(e.isObject3D&&d==="blocks-pointer-events"){n||n===""?(i=w==null?void 0:(s=w.userData).tres__registerBlockingObjectAtPointerEventHandler)==null||i.call(s,e):(a=w==null?void 0:(o=w.userData).tres__deregisterBlockingObjectAtPointerEventHandler)==null||a.call(o,e);return}let v=W(d),p=l==null?void 0:l[v];if(d==="args"){const m=e,_=t??[],g=n??[],C=e.userData.tres__name||e.type;C&&_.length&&!Be(_,g)&&(l=Object.assign(m,new N.value[C](...n)));return}if(l.type==="BufferGeometry"){if(d==="args")return;l.setAttribute(W(d),new f.BufferAttribute(...n));return}if(d.includes("-")&&p===void 0){const m=d.split("-");p=m.reduce((_,g)=>_[W(g)],l),d=m.pop(),v=d.toLowerCase(),p!=null&&p.set||(l=m.reduce((_,g)=>_[W(g)],l))}let c=n;if(c===""&&(c=!0),ie(p)){q.includes(r)||(Array.isArray(c)?e[v](...c):e[v](c));return}!(p!=null&&p.set)&&!ie(p)?l[v]=c:p.constructor===c.constructor&&(p!=null&&p.copy)?p==null||p.copy(c):Array.isArray(c)?p.set(...c):!p.isColor&&p.setScalar?p.setScalar(c):p.set(c)}},parentNode(e){return(e==null?void 0:e.parent)||null},createText:()=>void 0,createComment:()=>void 0,setText:()=>void 0,setElementText:()=>void 0,nextSibling:()=>void 0,querySelector:()=>void 0,setScopeId:()=>void 0,cloneNode:()=>void 0,insertStaticContent:()=>void 0},{render:Re}=u.createRenderer(Ge);U(J);function qe(){return me().__VUE_DEVTOOLS_GLOBAL_HOOK__}function me(){return typeof navigator<"u"&&typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}}const He=typeof Proxy=="function",Qe="devtools-plugin:setup",Je="plugin:settings:set";let T,H;function Ye(){var e;return T!==void 0||(typeof window<"u"&&window.performance?(T=!0,H=window.performance):typeof globalThis<"u"&&(!((e=globalThis.perf_hooks)===null||e===void 0)&&e.performance)?(T=!0,H=globalThis.perf_hooks.performance):T=!1),T}function Ke(){return Ye()?H.now():Date.now()}class Xe{constructor(r,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=r,this.hook=t;const n={};if(r.settings)for(const o in r.settings){const a=r.settings[o];n[o]=a.defaultValue}const s=`__vue-devtools-plugin-settings__${r.id}`;let i=Object.assign({},n);try{const o=localStorage.getItem(s),a=JSON.parse(o);Object.assign(i,a)}catch{}this.fallbacks={getSettings(){return i},setSettings(o){try{localStorage.setItem(s,JSON.stringify(o))}catch{}i=o},now(){return Ke()}},t&&t.on(Je,(o,a)=>{o===this.plugin.id&&this.fallbacks.setSettings(a)}),this.proxiedOn=new Proxy({},{get:(o,a)=>this.target?this.target.on[a]:(...l)=>{this.onQueue.push({method:a,args:l})}}),this.proxiedTarget=new Proxy({},{get:(o,a)=>this.target?this.target[a]:a==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(a)?(...l)=>(this.targetQueue.push({method:a,args:l,resolve:()=>{}}),this.fallbacks[a](...l)):(...l)=>new Promise(d=>{this.targetQueue.push({method:a,args:l,resolve:d})})})}async setRealTarget(r){this.target=r;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const t of this.targetQueue)t.resolve(await this.target[t.method](...t.args))}}function Ze(e,r){const t=e,n=me(),s=qe(),i=He&&t.enableEarlyProxy;if(s&&(n.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!i))s.emit(Qe,e,r);else{const o=i?new Xe(t,s):null;(n.__VUE_DEVTOOLS_PLUGINS__=n.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:t,setupFn:r,proxy:o}),o&&r(o.proxiedTarget)}}function et(e,r){const t=`▲ ■ ●${e}`;typeof __VUE_DEVTOOLS_TOAST__=="function"?__VUE_DEVTOOLS_TOAST__(t,r):r==="error"?console.error(t):r==="warn"?console.warn(t):console.log(t)}const ge=e=>{const r={id:e.uuid,label:e.type,children:[],tags:[]};e.name!==""&&r.tags.push({label:e.name,textColor:5750629,backgroundColor:15793395});const t=ce(e);return t>0&&r.tags.push({label:`${Fe(t)} KB`,textColor:15707189,backgroundColor:16775644,tooltip:"Memory usage"}),e.type.includes("Light")&&(r.tags.push({label:`${e.intensity}`,textColor:9738662,backgroundColor:16316922,tooltip:"Intensity"}),r.tags.push({label:`#${e.color.getHexString()}`,textColor:9738662,backgroundColor:16316922,tooltip:"Color"})),e.type.includes("Camera")&&(r.tags.push({label:`${e.fov}°`,textColor:9738662,backgroundColor:16316922,tooltip:"Field of view"}),r.tags.push({label:`x: ${Math.round(e.position.x)} y: ${Math.round(e.position.y)} z: ${Math.round(e.position.z)}`,textColor:9738662,backgroundColor:16316922,tooltip:"Position"})),r};function he(e,r){e.children.forEach(t=>{if(t.type==="HightlightMesh")return;const n=ge(t);r.children.push(n),he(t,n)})}const tt=[],E="tres:inspector",rt=u.reactive({sceneGraph:null});function nt(e,r){Ze({id:"dev.esm.tres",label:"TresJS 🪐",logo:"https://raw.githubusercontent.com/Tresjs/tres/main/public/favicon.svg",packageName:"tresjs",homepage:"https://tresjs.org",componentStateTypes:tt,app:e},t=>{typeof t.now!="function"&&et("You seem to be using an outdated version of Vue Devtools. Are you still using the Beta release instead of the stable one? You can find the links at https://devtools.vuejs.org/guide/installation.html."),t.addInspector({id:E,label:"TresJS 🪐",icon:"account_tree",treeFilterPlaceholder:"Search instances"}),setInterval(()=>{t.sendInspectorTree(E)},1e3),setInterval(()=>{t.notifyComponentUpdate()},5e3),t.on.getInspectorTree(i=>{if(i.inspectorId===E){const o=ge(r.scene.value);he(r.scene.value,o),rt.sceneGraph=o,i.rootNodes=[o]}});let n=null,s=null;t.on.getInspectorState(i=>{if(i.inspectorId===E){const[o]=r.scene.value.getObjectsByProperty("uuid",i.nodeId);if(!o)return;if(s&&n&&n.parent&&s.remove(n),o.isMesh){const a=Ve(o);o.add(a),n=a,s=o}i.state={object:[{key:"uuid",editable:!0,value:o.uuid},{key:"name",editable:!0,value:o.name},{key:"type",editable:!0,value:o.type},{key:"position",editable:!0,value:o.position},{key:"rotation",editable:!0,value:o.rotation},{key:"scale",editable:!0,value:o.scale},{key:"geometry",value:o.geometry},{key:"material",value:o.material},{key:"color",editable:!0,value:o.color},{key:"intensity",editable:!0,value:o.intensity},{key:"castShadow",editable:!0,value:o.castShadow},{key:"receiveShadow",editable:!0,value:o.receiveShadow},{key:"frustumCulled",editable:!0,value:o.frustumCulled},{key:"matrixAutoUpdate",editable:!0,value:o.matrixAutoUpdate},{key:"matrixWorldNeedsUpdate",editable:!0,value:o.matrixWorldNeedsUpdate},{key:"matrixWorld",value:o.matrixWorld},{key:"visible",editable:!0,value:o.visible}]}}}),t.on.editInspectorState(i=>{i.inspectorId===E&&je(r.scene.value,i.nodeId,i.path,i.state.value)})})}const ot=["data-scene","data-tres"],ve=u.defineComponent({__name:"TresCanvas",props:{shadows:{type:Boolean,default:void 0},clearColor:{},toneMapping:{},shadowMapType:{},useLegacyLights:{type:Boolean,default:void 0},outputColorSpace:{},toneMappingExposure:{},camera:{},preset:{},windowSize:{type:Boolean,default:void 0},disableRender:{type:Boolean,default:void 0},context:{},precision:{},alpha:{type:Boolean,default:void 0},premultipliedAlpha:{type:Boolean},antialias:{type:Boolean,default:void 0},stencil:{type:Boolean,default:void 0},preserveDrawingBuffer:{type:Boolean,default:void 0},powerPreference:{},depth:{type:Boolean,default:void 0},logarithmicDepthBuffer:{type:Boolean,default:void 0},failIfMajorPerformanceCaveat:{type:Boolean,default:void 0}},setup(e,{expose:r}){var _;const t=e,n=u.useSlots(),{logWarning:s}=x(),i=u.ref(),o=u.shallowRef(new f.Scene),{resume:a}=V(),l=(_=u.getCurrentInstance())==null?void 0:_.appContext.app,d=g=>u.defineComponent({setup(){var P;const C=(P=u.getCurrentInstance())==null?void 0:P.appContext;return C&&(C.app=l),u.provide("useTres",g),u.provide("extend",U),typeof window<"u"&&nt(C.app,g),()=>u.h(u.Fragment,null,n!=null&&n.default?n.default():[])}}),v=g=>{const C=d(g);Re(u.h(C),o.value)},p=(g,C=!1)=>{o.value.children=[],C&&(g.renderer.value.dispose(),g.renderer.value.renderLists.dispose(),g.renderer.value.forceContextLoss()),v(g),a()},c=u.computed(()=>t.disableRender),m=u.shallowRef(null);return r({context:m,dispose:()=>p(m.value,!0)}),u.onMounted(()=>{const g=i;m.value=de({scene:o.value,canvas:g,windowSize:t.windowSize,disableRender:c,rendererOptions:t}),ue({scene:o.value,contextParts:m.value});const{registerCamera:C,camera:P,cameras:L,deregisterCamera:S}=m.value;v(m.value);const A=()=>{const M=new f.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3);M.position.set(3,3,3),M.lookAt(0,0,0),C(M);const O=u.watchEffect(()=>{L.value.length>=2&&(M.removeFromParent(),S(M),O==null||O())})};u.watch(()=>t.camera,(M,O)=>{M&&C(M),O&&(O.removeFromParent(),S(O))},{immediate:!0}),P.value||(s("No camera found. Creating a default perspective camera. To have full control over a camera, please add one to the scene."),A())}),(g,C)=>(u.openBlock(),u.createElementBlock("canvas",{ref_key:"canvas",ref:i,"data-scene":o.value.uuid,class:u.normalizeClass(g.$attrs.class),"data-tres":`tresjs ${u.unref(_e).version}`,style:u.normalizeStyle({display:"block",width:"100%",height:"100%",position:g.windowSize?"fixed":"relative",top:0,left:0,pointerEvents:"auto",touchAction:"none",...g.$attrs.style})},null,14,ot))}}),st=["TresCanvas","TresLeches","TresScene"],it={template:{compilerOptions:{isCustomElement:e=>e.startsWith("Tres")&&!st.includes(e)||e==="primitive"}}},at={mounted:(e,r)=>{if(r.arg){console.log(`v-log:${r.arg}`,e[r.arg]);return}console.log("v-log",e)}};class ye extends f.Line{constructor(r,t){const n=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],s=new f.BufferGeometry;s.setAttribute("position",new f.Float32BufferAttribute(n,3)),s.computeBoundingSphere();const i=new f.LineBasicMaterial({fog:!1});super(s,i),this.light=r,this.color=t,this.type="RectAreaLightHelper";const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],a=new f.BufferGeometry;a.setAttribute("position",new f.Float32BufferAttribute(o,3)),a.computeBoundingSphere(),this.add(new f.Mesh(a,new f.MeshBasicMaterial({side:f.BackSide,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const r=this.material.color,t=Math.max(r.r,r.g,r.b);t>1&&r.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const{logWarning:we}=x();let G,B;const lt={DirectionalLight:f.DirectionalLightHelper,PointLight:f.PointLightHelper,SpotLight:f.SpotLightHelper,HemisphereLight:f.HemisphereLightHelper,RectAreaLight:ye},ut={mounted:e=>{if(!e.isLight){we(`${e.type} is not a light`);return}G=lt[e.type],e.parent.add(new G(e,1,e.color.getHex()))},updated:e=>{B=e.parent.children.find(r=>r instanceof G),!(B instanceof ye)&&B.update()},unmounted:e=>{if(!e.isLight){we(`${e.type} is not a light`);return}B=e.parent.children.find(r=>r instanceof G),B&&B.dispose&&B.dispose(),e.parent.remove(B)}},{logWarning:ct}=x(),dt={updated:(e,r)=>{const t=oe(r);if(!t){ct(`v-always-look-at: problem with binding value: ${r.value}`);return}const{onLoop:n}=V();n(()=>{e.lookAt(t)})}},{logWarning:ft}=x();let D=null;const pt={updated:(e,r)=>{var s;const t=oe(r);if(!t){ft(`v-distance-to: problem with binding value: ${r.value}`);return}D&&(D.dispose(),e.parent.remove(D));const n=t.clone().sub(e.position);n.normalize(),D=new f.ArrowHelper(n,e.position,e.position.distanceTo(t),16776960),e.parent.add(D),console.table([["Distance:",e.position.distanceTo(t)],[`origin: ${e.name||e.type}`,`x:${e.position.x}, y:${e.position.y}, z:${(s=e.position)==null?void 0:s.z}`],[`Destiny: ${e.name||e.type}`,`x:${t.x}, y:${t.y}, z:${t==null?void 0:t.z}`]])},unmounted:e=>{D==null||D.dispose(),e.parent.remove(D)}},{logWarning:mt}=x(),gt={mounted:(e,r)=>{if(e.isCamera){mt(`Rotate the ${e.type} is not a good idea`);return}const t=r.value??.01,n=u.ref(r.modifiers.x||r.arg==="x"?1:0),s=u.ref(r.modifiers.y||r.arg==="y"?1:0),i=u.ref(r.modifiers.z||r.arg==="z"?1:0);n.value+s.value+i.value===0&&(n.value=1,s.value=1);const o=new f.Quaternion().setFromAxisAngle(new f.Vector3(n.value,s.value,i.value).normalize(),t),{onLoop:a}=V();a(()=>{e.applyQuaternion(o)})}},ht={install(e){e.component("TresCanvas",ve)}};h.TresCanvas=ve,h.catalogue=N,h.default=ht,h.extend=U,h.isProd=Pe,h.normalizeColor=Z,h.normalizeVectorFlexibleParam=Se,h.templateCompilerOptions=it,h.trasverseObjects=ae,h.useCamera=Y,h.useLoader=$e,h.useLogger=x,h.usePointerEventHandler=ue,h.useRaycaster=le,h.useRenderLoop=V,h.useRenderer=se,h.useSeek=We,h.useTexture=ze,h.useTres=Ue,h.useTresContext=fe,h.useTresContextProvider=de,h.vAlwaysLookAt=dt,h.vDistanceTo=pt,h.vLightHelper=ut,h.vLog=at,h.vRotate=gt,Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
