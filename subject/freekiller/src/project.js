window.__require=function e(t,n,i){function o(c,a){if(!n[c]){if(!t[c]){var s=c.split("/");if(s=s[s.length-1],!t[s]){var l="function"==typeof __require&&__require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+c+"'")}c=s}var h=n[c]={exports:{}};t[c][0].call(h.exports,function(e){return o(t[c][1][e]||e)},h,h.exports,e,t,n,i)}return n[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<i.length;c++)o(i[c]);return o}({AnyWhereShoot:[function(e,t,n){"use strict";cc._RF.push(t,"ea53aVa24lBbbjuKAq2lZ/I","AnyWhereShoot"),cc.Class({extends:cc.Component,properties:{},start:function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart.bind(this)),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove.bind(this)),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd.bind(this)),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel.bind(this)),this.playerShoot=cc.find("Canvas").getComponent("PlayerShootControl")},onTouchStart:function(e){this.touchPoint=e.getLocation()},onTouchMove:function(e){this.touchPoint=e.getLocation()},onTouchEnd:function(e){this.touchPoint=null},onTouchCancel:function(e){this.touchPoint=null},update:function(e){if(this.touchPoint&&(this.player||(this.player=cc.find("Canvas").getComponent("LevelMan").getPlayerNode()),this.player)){var t=this.player.convertToWorldSpaceAR(cc.v2(0,0)),n=this.touchPoint.sub(t);n=n.normalize().mul(10),this.playerShoot.checkShoot(n)}}}),cc._RF.pop()},{}],BulletLife:[function(e,t,n){"use strict";cc._RF.push(t,"21de3ET0XNJfoYKHoDtRMUO","BulletLife"),cc.Class({extends:cc.Component,properties:{},start:function(){this.bulletMan=this.node.getComponent("Bullet").man},onCollisionEnter:function(e,t){this.bulletMan&&this.bulletMan.removeBulletNode(this.node)},onCollisionStay:function(e,t){this.bulletMan&&this.bulletMan.removeBulletNode(this.node)}}),cc._RF.pop()},{}],BulletMan:[function(e,t,n){"use strict";cc._RF.push(t,"421cfP9JlBLj7NrQaciYZ02","BulletMan"),cc.Class({extends:cc.Component,ctor:function(){this.bullets=[]},properties:{bulletLayer:cc.Node},start:function(){},onLevelLoaded:function(e){this.bulletLayer.removeAllChildren(),this.bullets=[]},addBulletNode:function(e){var t=e.getComponent("Bullet");t.setBulletMan(this),helper.moveNodeTo(e,this.bulletLayer),this.bullets.push(t)},removeBulletNode:function(e){this.bulletLayer.removeChild(e);var t=e.getComponent("Bullet"),n=this.bullets.indexOf(t);n>=0&&this.bullets.splice(n,1)},update:function(e){for(var t=0;t<this.bullets.length;++t)this.bullets[t].bulletUpdate(e)}}),cc._RF.pop()},{}],Bullet:[function(e,t,n){"use strict";cc._RF.push(t,"d9093NpFG1OQaP2+cp2ynQd","Bullet"),cc.Class({extends:cc.Component,properties:{onBulletUpdate:[cc.Component.EventHandler],onSetInitDir:[cc.Component.EventHandler]},setBulletMan:function(e){this.man=e},setInitDir:function(e){for(var t=0;t<this.onSetInitDir.length;++t)this.onSetInitDir[t].emit([e])},bulletUpdate:function(e){for(var t=0;t<this.onBulletUpdate.length;++t)this.onBulletUpdate[t].emit([e])}}),cc._RF.pop()},{}],CauseDamage:[function(e,t,n){"use strict";cc._RF.push(t,"12008PYPNpDuJr2mAa4bP5B","CauseDamage"),cc.Class({extends:cc.Component,properties:{damage:0},getDamage:function(){return this.damage}}),cc._RF.pop()},{}],CenterPlayer:[function(e,t,n){"use strict";cc._RF.push(t,"d78cav85rJAxIOTG8sv8WsL","CenterPlayer"),cc.Class({extends:cc.Component,properties:{},start:function(){},onLevelLoaded:function(e){this.player=e.getPlayerNode(),this.tiledmap=e.getMapNode()},update:function(e){if(this.player&&this.tiledmap){var t=cc.v2(cc.winSize.width/2,cc.winSize.height/2),n=this.player.convertToWorldSpaceAR(cc.v2(0,0)),i=t.sub(n),o=this.node.position.add(i),r=this.tiledmap.width/2-t.x,c=-r,a=this.tiledmap.height/2-t.y,s=-a;o.x>r&&(o.x=r),o.x<c&&(o.x=c),o.y>a&&(o.y=a),o.y<s&&(o.y=s),this.node.position=o}}}),cc._RF.pop()},{}],ClearEnermyToWin:[function(e,t,n){"use strict";cc._RF.push(t,"e14adTQ0WBDV7OmIdXNYOrU","ClearEnermyToWin"),cc.Class({extends:e("FinishCondition"),properties:{},onLevelLoaded:function(e){this.stateMan=e.getStateMan(),this.totalEnermy=e.getEnermyGenner().getTotalEnermy(),this.enermyMan=e.getEnermyMan(),cc.log("ClearEnermy",this.totalEnermy)},update:function(){this.enermyMan.getDeadCount()===this.totalEnermy&&this.stateMan.curState===LevelState.Running&&this.stateMan.setState(LevelState.Finished)}}),cc._RF.pop()},{FinishCondition:"FinishCondition"}],DiffShootEmitter:[function(e,t,n){"use strict";cc._RF.push(t,"925baHc0gVCmqbMtfo8a6Jt","DiffShootEmitter"),cc.Class({extends:cc.Component,properties:{shootDiff:0,onShootTriggered:cc.Component.EventHandler},start:function(){this.weapon=this.node.getComponent("Weapon")},onCheckShoot:function(e){this.lastShootTime||(this.lastShootTime=0),Date.now()-this.lastShootTime<this.shootDiff||(this.onShootTriggered&&this.onShootTriggered.emit([e]),this.lastShootTime=Date.now())}}),cc._RF.pop()},{}],EnermyMan:[function(e,t,n){"use strict";cc._RF.push(t,"7e83ategmFKH5YI7MeoYVkU","EnermyMan"),cc.Class({extends:cc.Component,ctor:function(){this.deadCount=0},properties:{enermyLayer:cc.Node},onLevelLoaded:function(e){this.deadCount=0,this.enermyLayer.removeAllChildren()},addEnermyNode:function(e){helper.moveNodeTo(e,this.enermyLayer);for(var t=e.getComponents(cc.Component),n=0;n<t.length;++n)t[n].setEnermyMan&&t[n].setEnermyMan(this)},removeEnermyNode:function(e){++this.deadCount,this.enermyLayer.removeChild(e,!0)},update:function(e){for(var t=0;t<this.enermyLayer.children.length;++t)this.updateOneEnermy(this.enermyLayer.children[t],e)},updateOneEnermy:function(e,t){for(var n=e.getComponents(cc.Component),i=0;i<n.length;++i)n[i].enermyUpdate&&n[i].enermyUpdate(t)},getAliveEnermyCount:function(){return this.enermyLayer.children.length},getNearestNodeAtWorld:function(e){for(var t=null,n=null,i=this.enermyLayer.convertToNodeSpaceAR(e),o=0;o<this.enermyLayer.children.length;++o){var r=this.enermyLayer.children[o].position.sub(i).len();null===t?(t=r,n=this.enermyLayer.children[o]):r<t&&(t=r,n=this.enermyLayer.children[o])}return n},getDeadCount:function(){return this.deadCount}}),cc._RF.pop()},{}],FinishCondition:[function(e,t,n){"use strict";cc._RF.push(t,"242d84hYatFTIv83HRy4lkr","FinishCondition"),cc.Class({extends:cc.Component,properties:{}}),cc._RF.pop()},{}],FollowPlayerDirect:[function(e,t,n){"use strict";cc._RF.push(t,"db05egFl9ZPxIU5A/Cdtrxx","FollowPlayerDirect"),cc.Class({extends:cc.Component,properties:{}}),cc._RF.pop()},{}],FreeEnermyGenner:[function(e,t,n){"use strict";cc._RF.push(t,"d0556WYa75MT5RN0Zjm9w4X","FreeEnermyGenner"),cc.Class({extends:cc.Component,properties:{},onLevelLoaded:function(e){var t=db.freeEnermyGeneratorRules[e.getCurLevel()]||db.freeEnermyGeneratorDefaultRule;this.rootGenner=helper.create(t.type),this.rootGenner.init(t.config)},update:function(e){this.rootGenner&&(this.rootGenner.gennerUpdate(e)&&(this.rootGenner=null))},getTotalEnermy:function(){return this.rootGenner.getTotalEnermy()}}),cc._RF.pop()},{}],FreeLevelMan:[function(e,t,n){"use strict";cc._RF.push(t,"c2fc7gw4zpF4q/D4snOk/55","FreeLevelMan"),cc.Class({extends:e("LevelMan"),properties:{playerNode:cc.Node,tiledmapNode:cc.Node,centerPlayer:e("CenterPlayer"),title:e("FreeTitle"),debugGun:cc.Prefab},curLevel:0,start:function(){this.curLevel=0,this.emitLevelLoaded(),cc.director.getCollisionManager().enabled=!0},gotoNext:function(){++this.curLevel,this.emitLevelLoaded()},loadPlayerWeapon:function(){if(this.debugGun){var e=this.playerNode.getComponent("WeaponMan"),t=cc.instantiate(this.debugGun);e.addMainWeaponNode(t),this.debugGun=null}},emitLevelLoaded:function(){this.loadPlayerWeapon(),this.centerPlayer.onLevelLoaded(this),this.getComponent("EnermyMan").onLevelLoaded(this),this.getComponent("FreeEnermyGenner").onLevelLoaded(this),this.getComponent("PlayerMoveControl").onLevelLoaded(this),this.getComponent("PlayerShootControl").onLevelLoaded(this),this.getComponent("FinishCondition").onLevelLoaded(this),this.getComponent("FreeStateMan").onLevelLoaded(this),this.title.onLevelLoaded(this)},getPlayerNode:function(){return this.playerNode},getMapNode:function(){return this.tiledmapNode},getCurLevel:function(){return this.curLevel},getEnermyGenner:function(){return this.node.getComponent("FreeEnermyGenner")},getEnermyMan:function(){return this.node.getComponent("EnermyMan")},getStateMan:function(){return this.node.getComponent("StateMan")}}),cc._RF.pop()},{CenterPlayer:"CenterPlayer",FreeTitle:"FreeTitle",LevelMan:"LevelMan"}],FreeMan:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}cc._RF.push(t,"aeaa5Pv6u9KQ76scYZ857+W","FreeMan");var c=function(){function e(){i(this,e),this.curLevel=0}return r(e,[{key:"start",value:function(){cc.director.loadScene("main/FreeScene")}},{key:"gotoNext",value:function(){++this.curLevel,start()}}]),e}();window.freeMan=new c,cc._RF.pop()},{}],FreeStateMan:[function(e,t,n){"use strict";cc._RF.push(t,"968f2KGfVNO9K/9FOdvS9qj","FreeStateMan"),cc.Class({extends:e("StateMan"),properties:{},start:function(){},onLevelLoaded:function(e){this.setState(LevelState.Prepare),this.scheduleOnce(function(){this.setState(LevelState.Running)}.bind(this),1)},emitToSelfComponent:function(){for(var e=this.getComponent("FreeLevelMan"),t=[e.centerPlayer,e.getComponent("FreeEnermyGenner"),e.getComponent("PlayerMoveControl"),e.getComponent("PlayerShootControl"),e.title],n=0;n<t.length;++n)t[n].onStateChanged&&t[n].onStateChanged(this)},onStateChanged:function(){this.emitToSelfComponent(),this.handleState()},handleState:function(){this.curState===LevelState.Finished&&this.scheduleOnce(function(){this.getComponent("FreeLevelMan").gotoNext()}.bind(this),2)}}),cc._RF.pop()},{StateMan:"StateMan"}],FreeTitle:[function(e,t,n){"use strict";cc._RF.push(t,"ba144FWLPBKzLiR9aeMneVh","FreeTitle"),cc.Class({extends:cc.Component,properties:{progressBar:cc.ProgressBar,title:cc.Label},onLevelLoaded:function(e){this.enermyMan=e.getEnermyMan(),this.totalEnermy=e.getEnermyGenner().getTotalEnermy(),this.title.string="\u7b2c".concat(e.getCurLevel()+1,"\u5173")},update:function(){this.totalEnermy&&this.enermyMan&&(this.progressBar.progress=this.enermyMan.getDeadCount()/this.totalEnermy)}}),cc._RF.pop()},{}],LevelLoader:[function(e,t,n){"use strict";cc._RF.push(t,"61c53C5xERHXKJ7GnlW85ty","LevelLoader"),cc.Class({extends:cc.Component,properties:{}}),cc._RF.pop()},{}],LevelMan:[function(e,t,n){"use strict";cc._RF.push(t,"0d899JiX4tCJIyYe1vKpT9Y","LevelMan"),cc.Class({extends:cc.Component,properties:{}}),cc._RF.pop()},{}],LevelState:[function(e,t,n){"use strict";cc._RF.push(t,"64d1a/XXnNAIoGQezQ3Rdo8","LevelState"),window.LevelState={Prepare:"prepare",Running:"running",Pausing:"pausing",Finished:"finished",Ended:"ended"},cc._RF.pop()},{}],LineMove:[function(e,t,n){"use strict";cc._RF.push(t,"3a3289vt69BIJbtr/6KnqZU","LineMove"),cc.Class({extends:cc.Component,properties:{dir:cc.Vec2,speed:cc.Integer},setInitDir:function(e){this.dir=e},checkMove:function(e){var t=this.dir.mul(this.speed);this.node.position=this.node.position.add(t),this.node.angle=180*-t.signAngle(cc.v2(0,1))/3.14}}),cc._RF.pop()},{}],NormalEnermyGenner:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}cc._RF.push(t,"17bf73N6e1IA4kKuRfamH2V","NormalEnermyGenner");var c=function(){function e(){i(this,e)}return r(e,[{key:"init",value:function(e){this.config=e,this.totalCount=this.config.totalCount||1}},{key:"onEnter",value:function(){for(var e=[],t=0;t<this.config.names.length;++t)e.push("enermies/".concat(this.config.names[t]));cc.loader.loadResArray(e,function(e,t){e?cc.error(e.toString()):this.assets=t}.bind(this)),this.enermyMan=cc.find("Canvas").getComponent("EnermyMan")}},{key:"gennerUpdate",value:function(e){if(!this.assets)return!1;for(var t=0;t<this.totalCount;++t){var n=cc.instantiate(helper.randSelect(this.assets));n.x=helper.randInt(0,960),n.y=helper.randInt(0,640);var i=n.getComponent("NormalEnermy");i.blood=i.blood+helper.randInt(this.config.bloodAddRange),i.speed=i.speed+helper.randInt(this.config.speedAddRange),this.enermyMan.addEnermyNode(n)}return!0}},{key:"getTotalEnermy",value:function(){return this.totalCount}}]),e}();t.exports=c,cc._RF.pop()},{}],NormalEnermyHitten:[function(e,t,n){"use strict";cc._RF.push(t,"39e1bNAUX1BYIT7z1xnBpvK","NormalEnermyHitten"),cc.Class({extends:cc.Component,properties:{},start:function(){this.attr=this.node.getComponent("NormalEnermyAttr")},setEnermyMan:function(e){this.man=e},enermyUpdate:function(e){}}),cc._RF.pop()},{}],NormalEnermy:[function(e,t,n){"use strict";cc._RF.push(t,"a05d6ou81NBCbDVXd1yGDAa","NormalEnermy"),cc.Class({extends:cc.Component,properties:{blood:0,speed:0,label:cc.Label},start:function(){this.player=cc.find("Canvas").getComponent("LevelMan").getPlayerNode(),this.label.string=this.blood},setEnermyMan:function(e){this.man=e},update:function(e){},enermyUpdate:function(e){if(this.player){var t=this.player.convertToWorldSpaceAR(cc.v2(0,0)),n=this.node.parent.convertToWorldSpaceAR(this.node.position),i=t.sub(n).normalize().mul(this.speed),o=n.add(i);o=this.node.parent.convertToNodeSpaceAR(o),this.node.position=o}},onCollisionEnter:function(e,t){if(this.man&&!this.dead){var n=e.node.getComponent("CauseDamage");n&&(this.blood-=n.getDamage(),this.label.string=this.blood,this.blood<=0&&(this.dead=!0,this.man.removeEnermyNode(this.node)))}}}),cc._RF.pop()},{}],PlayerInfo:[function(e,t,n){"use strict";cc._RF.push(t,"a224dvXRjZFn5pn0dQUBkH/","PlayerInfo"),cc.Class({extends:cc.Component,properties:{center:cc.Node,buff1:cc.ProgressBar,triangle:cc.Node,radius:{serializable:!1,visible:!1,default:16},speed:{default:1,visible:!1}},start:function(){this.buff1.node.active=!1},weaponman:function(){return this.getComponent("WeaponMan")},getWorldPosition:function(){return this.node.convertToWorldSpaceAR(cc.v2(0,0))}}),cc._RF.pop()},{}],PlayerMoveControl:[function(e,t,n){"use strict";cc._RF.push(t,"7af01Cs8ClM65EL9emStloE","PlayerMoveControl"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.keys=[],cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(e){this.keys.indexOf(e.keyCode)<0&&this.keys.push(e.keyCode)},this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,function(e){var t=this.keys.indexOf(e.keyCode);t>=0&&this.keys.splice(t,1)},this)},onLevelLoaded:function(e){this.player=e.getPlayerNode(),this.displayLayer=e.getMapNode().getComponent(cc.TiledMap).getLayer("display"),this.playerInfo=this.player.getComponent("PlayerInfo"),this.tilesize=this.displayLayer.getMapTileSize(),this.mapsize=e.getMapNode().getContentSize()},positionToRC:function(e){(e=e.clone()).x+=this.mapsize.width/2,e.y+=this.mapsize.height/2;var t=Math.floor(e.y/this.tilesize.height),n=Math.floor(e.x/this.tilesize.width),i=this.mapsize.height/this.tilesize.height;return i!=Math.floor(i)&&cc.error("mapsize\u548ctilesize\u4e0d\u5339\u914d"),{r:t=i-1-t,c:n}},calcYOnCircleMax:function(e,t,n){return Math.sqrt(t*t-(n-e.x)*(n-e.x))+e.y},calcYOnCircleMin:function(e,t,n){return-Math.sqrt(t*t-(n-e.x)*(n-e.x))+e.y},calcXOnCircleMax:function(e,t,n){return Math.sqrt(t*t-(n-e.y)*(n-e.y))+e.x},calcXOnCircleMin:function(e,t,n){return-Math.sqrt(t*t-(n-e.y)*(n-e.y))+e.x},rcBounding:function(e){return new cc.Rect(e.c*this.tilesize.width-this.mapsize.width/2,this.mapsize.height/2-e.r*this.tilesize.height-this.tilesize.height,this.tilesize.width,this.tilesize.height)},isValidRC:function(e){var t=this.mapsize.height/this.tilesize.height,n=this.mapsize.width/this.tilesize.width;return e.r>=0&&e.r<t&&e.c>=0&&e.c<n},calcMaxCanGoToLeft:function(e){var t=this.positionToRC(e),n=this.playerInfo.radius;e.x%this.tilesize.width==0&&(t.c-=1);var i=[],o={r:t.r-1,c:t.c-2};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){var r=this.rcBounding(o),c=this.calcXOnCircleMin(e,n,r.yMin);i.push(r.xMax-c)}o={r:t.r-1,c:t.c-1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcXOnCircleMin(e,n,r.yMin);i.push(r.xMax-c)}o={r:t.r,c:t.c-2};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o);i.push(r.xMax-(e.x-n))}o={r:t.r,c:t.c-1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o);i.push(r.xMax-(e.x-n))}o={r:t.r+1,c:t.c-2};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcXOnCircleMin(e,n,r.yMax);i.push(r.xMax-c)}o={r:t.r+1,c:t.c-1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcXOnCircleMin(e,n,r.yMax);i.push(r.xMax-c)}return 0===i.length?-this.tilesize.width:Math.max.apply(null,i)},calcMaxCanGoToRight:function(e){var t=this.positionToRC(e),n=this.playerInfo.radius,i=[],o={r:t.r-1,c:t.c+2};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){var r=this.rcBounding(o),c=this.calcXOnCircleMax(e,n,r.yMin);i.push(r.xMin-c)}o={r:t.r-1,c:t.c+1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcXOnCircleMax(e,n,r.yMin);i.push(r.xMin-c)}o={r:t.r,c:t.c+2};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o);i.push(r.xMin-(e.x+n))}o={r:t.r,c:t.c+1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o);i.push(r.xMin-(e.x+n))}o={r:t.r+1,c:t.c+2};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcXOnCircleMax(e,n,r.yMax);i.push(r.xMin-c)}o={r:t.r+1,c:t.c+1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcXOnCircleMax(e,n,r.yMax);i.push(r.xMin-c)}return 0===i.length?this.tilesize.width:Math.min.apply(null,i)},calcMaxCanGoToDown:function(e){var t=this.positionToRC(e),n=this.playerInfo.radius;e.y%this.tilesize.height==0&&(t.r+=1);var i=[],o={r:t.r+2,c:t.c-1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){var r=this.rcBounding(o),c=this.calcYOnCircleMin(e,n,r.xMax);i.push(r.yMax-c)}o={r:t.r+1,c:t.c-1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcYOnCircleMin(e,n,r.xMax);i.push(r.yMax-c)}o={r:t.r+2,c:t.c};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o);i.push(r.yMax-(e.y-n))}o={r:t.r+1,c:t.c};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o);i.push(r.yMax-(e.y-n))}o={r:t.r+2,c:t.c+1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcYOnCircleMin(e,n,r.xMin);i.push(r.yMax-c)}o={r:t.r+1,c:t.c+1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcYOnCircleMin(e,n,r.xMin);i.push(r.yMax-c)}return 0===i.length?-this.tilesize.height:Math.max.apply(null,i)},calcMaxCanGoToUp:function(e){var t=this.positionToRC(e),n=this.playerInfo.radius,i=[],o={r:t.r-2,c:t.c-1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){var r=this.rcBounding(o),c=this.calcYOnCircleMax(e,n,r.xMax);i.push(r.yMin-c)}o={r:t.r-1,c:t.c-1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcYOnCircleMax(e,n,r.xMax);i.push(r.yMin-c)}o={r:t.r-2,c:t.c};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o);i.push(r.yMin-(e.y+n))}o={r:t.r-1,c:t.c};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o);i.push(r.yMin-(e.y+n))}o={r:t.r-2,c:t.c+1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcYOnCircleMax(e,n,r.xMin);i.push(r.yMin-c)}o={r:t.r-1,c:t.c+1};if(this.isValidRC(o)&&this.displayLayer.getTileGIDAt(o.c,o.r)>0){r=this.rcBounding(o),c=this.calcYOnCircleMax(e,n,r.xMin);i.push(r.yMin-c)}return 0===i.length?this.tilesize.height:Math.min.apply(null,i)},checkMove:function(e){var t=e.normalize(),n=t.mul(this.playerInfo.speed);if(t.x<0){var i=this.calcMaxCanGoToLeft(this.player.position);n.x<i&&(n.x=i)}else if(t.x>0){i=this.calcMaxCanGoToRight(this.player.position);n.x>i&&(n.x=i)}if(t.y<0){var o=this.calcMaxCanGoToDown(this.player.position);n.y<o&&(n.y=o)}else if(t.y>0){o=this.calcMaxCanGoToUp(this.player.position);n.y>o&&(n.y=o)}this.player.position=this.player.position.add(n)},update:function(e){if(this.player){this.positionToRC(this.player.position);var t=cc.v2(0,0);this.keys.indexOf(cc.macro.KEY.w)>=0&&(t.y+=1),this.keys.indexOf(cc.macro.KEY.s)>=0&&(t.y-=1),this.keys.indexOf(cc.macro.KEY.a)>=0&&(t.x-=1),this.keys.indexOf(cc.macro.KEY.d)>=0&&(t.x+=1),0===t.x&&0===t.y||this.checkMove(t)}}}),cc._RF.pop()},{}],PlayerShootControl:[function(e,t,n){"use strict";cc._RF.push(t,"46deaDdFG5KvZquJjMIqXBJ","PlayerShootControl"),cc.Class({extends:cc.Component,properties:{},start:function(){cc.log("PlayerShoot start")},onLevelLoaded:function(e){this.playerInfo=e.getPlayerNode().getComponent("PlayerInfo"),this.enermyMan=cc.find("Canvas").getComponent("EnermyMan")},checkShoot:function(e){if(e.len()<.5){var t=this.playerInfo.getWorldPosition(),n=this.enermyMan.getNearestNodeAtWorld(t);n&&(e=n.convertToWorldSpaceAR(cc.v2(0,0)).sub(t).normalize())}var i=e.normalize();this.playerInfo.triangle.angle=180*-e.signAngle(cc.v2(0,1))/3.14,this.playerInfo.weaponman().checkShoot(i)}}),cc._RF.pop()},{}],SequenceGenner:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}cc._RF.push(t,"23e2fy9V39BXIAxrRdfhQzE","SequenceGenner");var c=function(){function e(){i(this,e)}return r(e,[{key:"init",value:function(e){this.runningIndex=-1,this.gens=[];for(var t=0;t<e.length;++t){var n=e[t],i=helper.create(n.type);i.init(n.config),this.gens.push(i)}}},{key:"gennerUpdate",value:function(e){return this.runningGenner||(this.runningGenner=this.beginNextGenner()),!this.runningGenner||(this.runningGenner.gennerUpdate(e)&&(this.runningGenner.onExit&&this.runningGenner.onExit(),this.runningGenner=null),!1)}},{key:"beginNextGenner",value:function(){++this.runningIndex;var e=this.gens[this.runningIndex];return e&&e.onEnter&&e.onEnter(),e}},{key:"getTotalEnermy",value:function(){for(var e=0,t=0;t<this.gens.length;++t)e+=this.gens[t].getTotalEnermy();return e}}]),e}();t.exports=c,cc._RF.pop()},{}],ShootMultiBullet:[function(e,t,n){"use strict";cc._RF.push(t,"c27d8OIFYRDwqsXzEReOWtH","ShootMultiBullet"),cc.Class({extends:cc.Component,properties:{bulletPrefab:cc.Prefab,shootSound:{type:cc.AudioClip,default:null},bulletCount:3},start:function(){this.bulletMan=cc.find("Canvas").getComponent("BulletMan"),this.weapon=this.node.getComponent("Weapon")},onShootTriggered:function(e){this.schedule(this.shoot.bind(this),.1,this.bulletCount-1)},shoot:function(){var e=cc.instantiate(this.bulletPrefab);e.position=this.node.convertToWorldSpaceAR(cc.v2(0,0)),e.getComponent("Bullet").setInitDir(this.weapon.man.shootDir),this.bulletMan.addBulletNode(e),helper.playEffect(this.shootSound)}}),cc._RF.pop()},{}],ShootOneBullet:[function(e,t,n){"use strict";cc._RF.push(t,"7438cITdHdPhZmR7og95YkX","ShootOneBullet"),cc.Class({extends:cc.Component,properties:{bulletPrefab:cc.Prefab,shootSound:{type:cc.AudioClip,default:null}},start:function(){this.bulletMan=cc.find("Canvas").getComponent("BulletMan")},onShootTriggered:function(e){var t=cc.instantiate(this.bulletPrefab);t.position=this.node.convertToWorldSpaceAR(cc.v2(0,0)),t.getComponent("Bullet").setInitDir(e),this.bulletMan.addBulletNode(t),helper.playEffect(this.shootSound)}}),cc._RF.pop()},{}],StartScene:[function(e,t,n){"use strict";cc._RF.push(t,"6a966sBvxZPTp0OArLoLKyU","StartScene"),cc.Class({extends:cc.Component,properties:{bg:{default:null,type:cc.Sprite,serializable:!0}},start:function(){},onFreeClicked:function(){freeMan.start()}}),cc._RF.pop()},{}],StateMan:[function(e,t,n){"use strict";cc._RF.push(t,"41285ZpOHdJabFBQbzh9ItL","StateMan"),cc.Class({extends:cc.Component,ctor:function(){this.curState=null,this.lastState=null,this.listeners=[]},properties:{},onLevelLoaded:function(e){0!=this.listeners.length&&cc.error("StateMan\u6709\u672a\u6e05\u7406\u7684listener"),this.listeners=[]},setState:function(e){cc.log("setState:",e),this.lastState=this.curState,this.curState=e,this.emitStateChanged()},addListener:function(e){this.listeners.push(e)},removeListener:function(e){var t=this.listeners.indexOf(e);t>=0&&this.listeners.splice(t,1)},emitStateChanged:function(){this.onStateChanged();for(var e=0;e<this.listeners.length;++e)this.listeners[e](this)},onStateChanged:function(){}}),cc._RF.pop()},{}],StoryLevelLoader:[function(e,t,n){"use strict";cc._RF.push(t,"74d11lDEY1PHZuw+oMTRGuk","StoryLevelLoader"),cc.Class({extends:e("LevelLoader"),properties:{tiledmap:cc.TiledMap,namePattern:cc.String,playerPrefab:cc.Prefab,onLevelLoaded:[cc.Component.EventHandler]},start:function(){},onLevelChanged:function(e){var t=this,n="".concat(this.namePattern).concat(e.curLevel);cc.loader.loadRes(n,function(e,n){t.tiledmap.tmxAsset=n,t.displayLayer=t.tiledmap.getLayer("display");for(var i=t.tiledmap.getObjectGroup("object").getObjects(),o=0;o<i.length;++o)if(i[o].name){var r=i[o].name.split(".");"player"===r[0]?t.loadPlayer(i[o]):"wall"===r[0]?t.loadWall(i[o]):cc.warn("\u672a\u77e5\u7684\u78b0\u649e\u7c7b\u578b:",r[0])}else cc.warn("\u6ca1\u6709\u914d\u7f6e\u5bf9\u8c61\u540d\u79f0");for(o=0;o<t.onLevelLoaded.length;++o)t.onLevelLoaded[o].emit([t])})},loadPlayer:function(e){this.player=cc.instantiate(this.playerPrefab);var t=cc.v2(this.tiledmap.node.width/2,this.tiledmap.node.height/2),n=e.x-t.x,i=e.y-t.y;this.player.position=cc.v2(n,i),this.player.parent=this.displayLayer.node},loadWall:function(e){var t=cc.v2(this.tiledmap.node.width/2,this.tiledmap.node.height/2),n=this.tiledmap.getObjectGroup("object");if("square"===e.name.split(".")[1]){var i=n.addComponent(cc.BoxCollider);i.size=new cc.Size(e.width,e.height),i.offset=cc.v2(e.x-t.x+e.width/2,e.y-t.y-e.height/2)}}}),cc._RF.pop()},{LevelLoader:"LevelLoader"}],WaitSecond:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}cc._RF.push(t,"f5815kz+tlIHpPtAv9gZUBU","WaitSecond");var c=function(){function e(){i(this,e)}return r(e,[{key:"init",value:function(e){this.curTime=0,this.config=e}},{key:"gennerUpdate",value:function(e){return this.curTime+=e,this.curTime>=this.config.second}},{key:"getTotalEnermy",value:function(){return 0}}]),e}();t.exports=c,cc._RF.pop()},{}],WaitZeroEnermy:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}cc._RF.push(t,"e81fesrEf9IYI96S9Wj2lIp","WaitZeroEnermy");var c=function(){function e(){i(this,e)}return r(e,[{key:"init",value:function(e){this.enermyMan=cc.find("Canvas").getComponent("EnermyMan")}},{key:"gennerUpdate",value:function(e){return!(this.enermyMan.getAliveEnermyCount()>0)}},{key:"getTotalEnermy",value:function(){return 0}}]),e}();t.exports=c,cc._RF.pop()},{}],WeaponMan:[function(e,t,n){"use strict";cc._RF.push(t,"afacdhyMyxK8pOm4uLhnYW5","WeaponMan"),cc.Class({extends:cc.Component,properties:{mainHangingNode:cc.Node},ctor:function(){this.weapons=[],this.shootDir=cc.v2(0,1)},addMainWeaponNode:function(e){var t=e.getComponent("Weapon");t&&(t.setWeaponMan(this),e.parent=this.mainHangingNode,this.weapons.push(t))},checkShoot:function(e){this.shootDir=e;for(var t=0;t<this.weapons.length;++t)this.weapons[t].checkShoot(e)}}),cc._RF.pop()},{}],Weapon:[function(e,t,n){"use strict";cc._RF.push(t,"3281bo/s0pHHYX9MTlzr1vJ","Weapon"),cc.Class({extends:cc.Component,properties:{onCheckShoot:[cc.Component.EventHandler]},start:function(){},setWeaponMan:function(e){this.man=e},checkShoot:function(e){for(var t=0;t<this.onCheckShoot.length;++t)this.onCheckShoot[t].emit([e])}}),cc._RF.pop()},{}],WheelUIControl:[function(e,t,n){"use strict";cc._RF.push(t,"8d963eZYb1BFLu0/KY+0cjd","WheelUIControl"),cc.Class({extends:cc.Component,properties:{board:cc.Node,pot:cc.Node,listener:cc.Component.EventHandler},start:function(){this.board.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.board.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.board.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.board.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this),this.pot.active=!1},onTouchStart:function(e){this.touching=!0,this.activePot(e)},onTouchMove:function(e){this.touching&&this.activePot(e)},onTouchEnd:function(e){this.touching=!1,this.activePot(e)},onTouchCancel:function(e){this.touching=!1,this.activePot(e)},activePot:function(e){if(this.pot.active=this.touching,this.pot.active){var t=e.getLocation(),n=this.board.convertToNodeSpaceAR(t),i=this.board.width/2;n.len()>i&&(n=n.normalize().mul(i)),this.pot.setPosition(n)}},checkEmit:function(){var e=this.pot.position,t=this.board.width/2,n=e.len()/t,i=e.normalize().mul(n);i=cc.v2(i),this.listener.emit([i])},update:function(e){this.pot.active&&this.checkEmit()}}),cc._RF.pop()},{}],db:[function(e,t,n){"use strict";cc._RF.push(t,"f89b8XXmRJM1o2FYEhfKiOv","db"),window.db={freeEnermyGeneratorRules:[{type:"SequenceGenner",config:[{type:"NormalEnermyGenner",config:{names:["en3"],bloodAddRange:[0,100],speedAddRange:[0,0],totalCount:2}}]},{type:"SequenceGenner",config:[{type:"NormalEnermyGenner",config:{names:["en4"],bloodAddRange:[0,100],speedAddRange:[0,0],totalCount:2}},{type:"WaitZeroEnermy"},{type:"NormalEnermyGenner",config:{names:["en4"],bloodAddRange:[0,100],speedAddRange:[0,0],totalCount:2}}]},{type:"SequenceGenner",config:[{type:"NormalEnermyGenner",config:{names:["en33"],bloodAddRange:[0,100],speedAddRange:[0,0],totalCount:2}},{type:"WaitSecond",config:{second:2}},{type:"NormalEnermyGenner",config:{names:["en44"],bloodAddRange:[0,100],speedAddRange:[0,0],totalCount:2}},{type:"WaitSecond",config:{second:2}},{type:"NormalEnermyGenner",config:{names:["en33"],bloodAddRange:[0,100],speedAddRange:[0,0],totalCount:2}},{type:"WaitSecond",config:{second:2}},{type:"NormalEnermyGenner",config:{names:["en44"],bloodAddRange:[0,100],speedAddRange:[0,0],totalCount:2}}]}],freeEnermyGeneratorDefaultRule:{type:"SequenceGenner",config:[{type:"NormalEnermyGenner",config:{names:["en33"],bloodAddRange:[0,100],speedAddRange:[0,0]},totalCount:2},{type:"WaitSecond",config:{second:2}},{type:"NormalEnermyGenner",config:{names:["en44"],bloodAddRange:[0,100],speedAddRange:[0,0]},totalCount:2},{type:"WaitSecond",config:{second:2}},{type:"NormalEnermyGenner",config:{names:["en33"],bloodAddRange:[0,100],speedAddRange:[0,0]},totalCount:2},{type:"WaitSecond",config:{second:2}},{type:"NormalEnermyGenner",config:{names:["en44"],bloodAddRange:[0,100],speedAddRange:[0,0]},totalCount:2}]},enermies:{en3:{name:"\u4e09\u89d2\u602a",baseblood:100,speed:10},en4:{name:"\u56db\u811a\u602a",baseblood:200,speed:6},en33:{name:"\u4e09\u4e09\u89d2\u602a",baseblood:300,speed:2},en44:{name:"\u56db\u56db\u89d2\u602a",baseblood:500,speed:2},camp:{name:"\u5175\u8425",baseblood:1e3}}},cc._RF.pop()},{}],helper:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}cc._RF.push(t,"872d21yMCRK27aCaGh+IxW+","helper");var c=function(){function t(){i(this,t),this.sound=!0,this.rescache={}}return r(t,[{key:"moveNodeTo",value:function(e,t){var n=e.convertToWorldSpaceAR(cc.v2(0,0));e.parent=t,e.position=t.convertToNodeSpaceAR(n)}},{key:"playEffect",value:function(e){this.sound&&cc.audioEngine.playEffect(e)}},{key:"debugObject",value:function(e){for(var t in cc.log("----------------"),e)cc.log(t,"=",e[t])}},{key:"create",value:function(t){var n=e(t);return n||cc.log("\u627e\u4e0d\u5230",t),n?new n:null}},{key:"randSelect",value:function(e){return 0===e.length?null:1===e.length?e[0]:e[this.randInt([0,e.length])]}},{key:"randInt",value:function(e,t){if(e instanceof Array&&(t=e[1],e=e[0]),e===t)return e;var n=Math.random();return n*=t-e,Math.floor(e+n)}}]),t}();window.helper=new c,cc._RF.pop()},{}]},{},["AnyWhereShoot","CenterPlayer","EnermyMan","FreeMan","LevelLoader","LevelMan","WheelUIControl","db","ClearEnermyToWin","FinishCondition","LevelState","StateMan","helper","FollowPlayerDirect","NormalEnermy","NormalEnermyGenner","NormalEnermyHitten","SequenceGenner","WaitSecond","WaitZeroEnermy","FreeEnermyGenner","FreeLevelMan","FreeStateMan","FreeTitle","PlayerInfo","PlayerMoveControl","PlayerShootControl","StartScene","StoryLevelLoader","Bullet","BulletLife","BulletMan","CauseDamage","DiffShootEmitter","LineMove","ShootMultiBullet","ShootOneBullet","Weapon","WeaponMan"]);