<!DOCTYPE html>
<html lang="en">

<script type="importmap">
	{
	"imports": {
		"three": "https://unpkg.com/three@0.152.0/build/three.module.js",
        "OrbitControls": "https://unpkg.com/three@0.152.0/examples/jsm/controls/OrbitControls.js"
	}
	}
</script>

<head>
    <meta charset="UTF-8">
    <title>Three.js Template with OrbitControls</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            position: absolute;
            z-index: -1;
        }

        #debug_label {
            margin: 0px;
            font-size: 2em;
        }
    </style>
</head>

<body>
    <canvas id="canvas">
    </canvas>

    <p id="debug_label">xxx</p>

    <script type="module">
        import * as THREE from "three";
        import { OrbitControls } from "OrbitControls";
        import { GameLogic } from "./GameLogic.js";

        const canvas = document.getElementById("canvas");
        const scene = new THREE.Scene();
        let camera = null;
        {
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        }
        // {
        //     camera = new THREE.OrthographicCamera(
        //         window.innerWidth / -150,    // 左侧裁剪面
        //         window.innerWidth / 150,     // 右侧裁剪面
        //         window.innerHeight / 150,   // 顶部裁剪面
        //         window.innerHeight / -150,  // 底部裁剪面
        //         1,                        // 近裁剪面
        //         1000                      // 远裁剪面
        //     );
        // }

        const renderer = new THREE.WebGLRenderer({ antialias: true, canvas: canvas });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(new THREE.Color(0xc5c5c5));

        const gridHelper = new THREE.GridHelper(10, 10);
        gridHelper.position.set(5, 0, -5);
        scene.add(gridHelper);

        // 设置相机位置以便它朝向场景中的模型
        camera.position.set(9, 9, 5);
        // camera.position.set(0, 0, -10);
        camera.lookAt(new THREE.Vector3(5, 0, -5));

        // {
        //     let geometry = new THREE.BoxGeometry(1,1,1);
        //     let material = new THREE.MeshPhongMaterial();
        //     let mesh = new THREE.Mesh(geometry, material);
        //     mesh.position.set(0, 0, 1);
        //     scene.add(mesh);
        // }

        // 使用OrbitControls创建控制器
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.target = new THREE.Vector3(5, 0, -5);
        controls.update();

        const axesHelper = new THREE.AxesHelper(5);
        scene.add(axesHelper);

        // 灯光
        const color = 0xFFFFFF;
        const intensity = 1;
        const light = new THREE.DirectionalLight(color, intensity);
        light.position.set(6, 10, 8);
        light.target.position.set(0, 0, 0);
        scene.add(light);
        scene.add(light.target);

        // 使用 animate 函数来渲染场景并使模型旋转
        function animate() {
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        animate();

        // 当浏览器窗口大小变化时，更新相机和渲染器大小
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        window.addEventListener('resize', onWindowResize, false);

        window.game = {
            scene,
            camera,
            renderer,
            canvas,
        };

        window.THREE = THREE;
        window.game.logic = new GameLogic();

        // 主循环
        {
            let lastUpdateTime = Date.now();
            function mainLoop() {
                let now = Date.now();
                game.logic.update(now - lastUpdateTime);
                lastUpdateTime = now;
            };
            mainLoop();
            setInterval(mainLoop, 0);
        }


    </script>
</body>

</html>